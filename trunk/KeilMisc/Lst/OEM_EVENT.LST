C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_EVENT
OBJECT MODULE PLACED IN Code\OEM\OEM_EVENT.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_EVENT.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\I
                    -NCLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_EVENT.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          //-----------------------------------------------------------------------------
  14          // no change function
  15          
  16          //-----------------------------------------------------------------------------
  17          void NullEvent(void)
  18          {
  19   1      
  20   1      }
  21          
  22          //-----------------------------------------------------------------------------
  23          // Adapter in function
  24          //-----------------------------------------------------------------------------
  25          void AdapterIn(void)
  26          {
  27   1              //DPWROK_EC_HI();
  28   1              /*ANGELAS031 remove start
  29   1              if(SystemIsS5)
  30   1              {
  31   1                      //ANGELAS005:s+ Support UMA SKU EC_ON pin design.
  32   1                      if(NTC_V1>682)
  33   1                      {
  34   1                              GPCRF0 = OUTPUT; 
  35   1                              SET_MASK(GPDRF,BIT(0));
  36   1                              NTC_FLAG=1; //ANGELAS007:Optimize power on sequence.
  37   1                      }
  38   1                      else
  39   1                      //ANGELAS005:e+ Support UMA SKU EC_ON pin design.
  40   1                      { //ANGELAS007:Optimize power on sequence.
  41   1                              GPCRF0 = INPUT; //ANGELAS020
  42   1                              EC_ON_HI();
  43   1                              NTC_FLAG=0; //ANGELAS007:Optimize power on sequence.
  44   1                      } //ANGELAS007:Optimize power on sequence.
  45   1                      Delay1MS(1);
  46   1                      PM_PWRBTN_HI();
  47   1                      Delay1MS(10);
  48   1                      PCH_PWR_EN_ON();
  49   1                      Delay1MS(30);
  50   1                      RSMRST_HI();
  51   1                      //Delay1MS(20);
  52   1              }
  53   1              *///ANGELAS031 remove end
  54   1      
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 2   

  55   1              PECI_SETPL2Watts(2);
  56   1              
  57   1              if ( IS_MASK_CLEAR(SYS_STATUS,AC_ADP) )
  58   1              { 
  59   2                      //cBATTThrottling = 0;  //MEILING048:remove.//MEILING051:-Add cpu P_STATE function.
  60   2              }
  61   1              
  62   1              AC_PRESENT_HI(); 
  63   1              ACInOutIntEnable(); //MEILING039:add.
  64   1              Unlock_ShipMode();  
  65   1              SET_MASK(SYS_STATUS,AC_ADP);    //set AC flag
  66   1              if( IS_MASK_SET(nBatteryStatus1, ENEXIST) )  //G10:add check battery state
  67   1              {
  68   2                      Chk_Battery_Full();
  69   2              }
  70   1      
  71   1              ECSMI_SCIEvent(ACPI_ACIN_SCI);
  72   1              if( SystemIsS0 )
  73   1              {
  74   2                      PWM_BEEP = 0x7F;                        // Out beep
  75   2                      PWM_LEDBeep_CNT = 0x0A;         // 50ms*10
  76   2              }
  77   1              //SetACIN_Int(); //ANGELAS079:remove
  78   1              InitChargerIC();//ANGELAS016:Change charge IC option setting.
  79   1              BatSMbusFailCount = 0;
  80   1              nBattErrorCnt = 0;
  81   1              //Mos: Set 0x12h and 0x3Fh before set ChargeCurrent and ChargeVoltage.
  82   1              CHGIC_ptr = 1;
  83   1              WriteSmartChgIC();
  84   1              WriteSmartChgIC();
  85   1              CHGIC_ptr = 3;
  86   1              ReadSmartChgIC();
  87   1          if (IS_MASK_SET(SYS_STATUS,AC_ADP)) 
  88   1          {
  89   2                  //ADAPTERIDON_LOW(); //MEILING001:remove.
  90   2                  AdapterIDOn_Flag = 0x01; //MEILING001:add.
  91   2              ADPIDON10MS_NUM =0x0A; //change 0x05 to 0x0A to avoid read dirty data.
  92   2          }    
  93   1      //   SetPowerBatteryparameter(); 
  94   1      //   ADAPTERIDON_HI();  
  95   1              if(SystemIsS4||SystemIsS5||SystemIsDSX)
  96   1              {
  97   2                      S4S5_KeyWake(2);//HEGANGS021:one key wake
  98   2              }
  99   1      }
 100          
 101          //-----------------------------------------------------------------------------
 102          // Adapter out function
 103          //-----------------------------------------------------------------------------
 104          void AdapterOut(void)
 105          {
 106   1              //ADAPTERIDON_HI();//when remove AC do not read adapter ID. //MEILING001:remove.
 107   1              AdapterIDOn_Flag = 0x00;//MEILING001:add.
 108   1              AdapterID=0x00;//72JERRY069
 109   1              TYPEC_Adapter_Watts=0x00;//72JERRY069
 110   1              //MEILING039:S- remove.
 111   1              /*if(SystemIsS0)        //ANGELAS095:Modify PROCHOT# unplug AC under S5.
 112   1              {
 113   1                      H_PROCHOT_ON(); //ANGELAS026:Modify PROCHOT# function.
 114   1                      ProchotONCnt = 2; //MEILING033:add(Prochot on 2S when AC out).
 115   1              }*/
 116   1              //MEILING039:E-.
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 3   

 117   1              
 118   1              BATT_LEN_OFF();//JERRYCRZ030 remove AC_OFF function follow charge IC bq24780.
 119   1              AC_PRESENT_LOW(); 
 120   1              ACInOutIntEnable(); //MEILING054:add.
 121   1          CLEAR_MASK(SYS_STATUS,b4IllegalAdp);
 122   1              CLEAR_MASK(SYS_STATUS,b5UnSuitAdpPow);
 123   1              SetVGA_AC_DET();
 124   1              PECI_SETPL2Watts(1);
 125   1      
 126   1              CLEAR_MASK(SYS_STATUS,AC_ADP);  //clear battery flag
 127   1              Chk_Battery_Full();
 128   1              ECSMI_SCIEvent(ACPI_ACOUT_SCI);
 129   1      
 130   1              //Mos: Set P-State highest to force that ChkBattery_OCP will decress P-State step by step.
 131   1              SET_MASK(BatteryAlarm,BATOCP);
 132   1          // if(SMB_BCNT==0x55)  
 133   1              //cBATTThrottling = 0x0F;
 134   1              //cBATTThrottling = PSTATE_MAXStep;//0ptimize CPU P_state (change 16 step to 8 step).  //MEILING048:remov
             -e.//MEILING051:-Add cpu P_STATE function.
 135   1              //Mos: Send QEvent to Bios
 136   1              ThrottlingControl(); 
 137   1      
 138   1              if( SystemIsS0 )
 139   1              {
 140   2                      PWM_BEEP = 0x7F;                        // Out beep
 141   2                      PWM_LEDBeep_CNT = 0x0A;         // 50ms*10
 142   2      
 143   2      
 144   2              if(IS_MASK_SET(LENOVOPMFW,BATTERY_MAIN_CAL))
 145   2              {
 146   3                          uVPCeventSource = General;
 147   3                          uVPCeventSource2 = 0;
 148   3                          ECSMI_SCIEvent(SDV_VPC_notify);
 149   3              }
 150   2              }
 151   1      //72JERRY050:S+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI SPEC.
 152   1              if((SystemIsS3)&&(!Read_LID_SW_IN()))
 153   1                      {USB_ON_INPUT;
 154   2                      }
 155   1                      //72JERRY050:E+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI SPE
             -C.
 156   1              nAvgCurrentL = 0;
 157   1              nAvgCurrentH = 0;
 158   1              Bat0x0BFakeCnt = 60;
 159   1              //CLR_MASK(LENOVOPMFW,BATTERY_CYCLE);
 160   1          DSxPowState = SYSTEM_S3S4;
 161   1          ADPIDON10MS_NUM=0xFF; 
 162   1              InitChargerIC();
 163   1              //SetACIN_Int();
 164   1      }
 165          
 166          //-----------------------------------------------------------------------------
 167          //power button was pressed
 168          //-----------------------------------------------------------------------------
 169          void PSWPressed(void)
 170          {
 171   1              if ( IS_MASK_SET(cCmd, b6TestBtnEn) )
 172   1              {
 173   2                      Buffer_Key(0xE0);               //
 174   2                      Buffer_Key(0x25);               //
 175   2                      F_Service_SEND = 1;
 176   2              }
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 4   

 177   1              /*// ANGELAS007: s-Optimize power on sequence.
 178   1              //ANGELAS005:s+ Support UMA SKU EC_ON pin design.
 179   1              if(NTC_V1>682)
 180   1              {
 181   1                      GPCRF0 = OUTPUT;
 182   1                      SET_MASK(GPDRF,BIT(0));
 183   1              }
 184   1              else
 185   1              //ANGELAS005:e+ Support UMA SKU EC_ON pin design.
 186   1      
 187   1              //EC_ON_HI();
 188   1              //EC_ON2_HI();
 189   1              *///ANGELAS007: e-Optimize power on sequence.
 190   1              ECSleepCount = 3;
 191   1      
 192   1              //Mos: Clear PswPressedCounter
 193   1              CountSecAfterPswPressed = 0;
 194   1              /*//ANGELAS007:s-Optimize power on sequence.
 195   1              //JERRYCRZ022:+ S Filter press power button over 8s can auto power on.
 196   1              #if !EN_PwrSeqTest
 197   1              if (LID_readytime !=0)
 198   1              {
 199   1                      //SET_MASK(SysStatus2,PWRBTN_press_retry);  
 200   1                      return;
 201   1              }
 202   1               #endif
 203   1              //JERRYCRZ022:+ E Filter press power button over 8s can auto power on.  
 204   1              *///ANGELAS007:e-Optimize power on sequence.
 205   1              CLEAR_MASK(SysStatus2,PWRBTN_press_retry);
 206   1              /*ANGELAS036: remove start
 207   1              if(!Read_LID_SW_IN())
 208   1              {
 209   1                      DSxPowState = SYSTEM_S3S4; //ANGELAS031
 210   1                      return;
 211   1              }
 212   1              //LID have not ready, it will influence power button on, so remove it temporary
 213   1              *///ANGELAS036: remove end
 214   1      
 215   1              //LMLKBL0008:S+ Add ignore power button press when lid close.
 216   1              if(!Read_LID_SW_IN())
 217   1              { return; }
 218   1              //LMLKBL0008:E+.
 219   1              
 220   1          switch (SysPowState)
 221   1          {
 222   2          case SYSTEM_S4 :
 223   2              break;
 224   2              case SYSTEM_DSX://72JERRY006: Add DC S5 states.
 225   2          case SYSTEM_S5 :
 226   2                      //ANGELAS111:S+Modify code for befor power on check Battery RSOC in DC mode.
 227   2                      if(!Read_AC_IN()||IS_MASK_SET(ACOFF_SOURCE, BATTLEARN))
 228   2                      {                               
 229   3                              BatSMbusFailCount = 0;
 230   3                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 231   3                              {
 232   4                                      BatSMbusFailCount++;    
 233   4                                      while((BatSMbusFailCount<=4)) 
 234   4                                      {               
 235   5                                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 236   5                                              {
 237   6                                                      BatSMbusFailCount++;
 238   6                                              }
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 5   

 239   5                                              else
 240   5                                              {
 241   6                                                      BatSMbusFailCount=0;
 242   6                                          break; //JIMGBRW022
 243   6                                              }
 244   5                                      }
 245   4                                                                                                               
 246   4                              }
 247   3                              if(BatSMbusFailCount>=4) 
 248   3                                      break;
 249   3                              
 250   3                              if (BAT1PERCL < 0x02)  //T064: change 0x05 to 0x00 G23:modify battery capacity point from 0 to 1 for fl
             -iker.
 251   3                              {
 252   4                                      SET_MASK(nBatteryStatL,CMBS_LOWBATT);
 253   4                                      LOWBATT_3TIMES = 100;           // set 5 sec
 254   4                                      break;
 255   4                              }
 256   3                      }
 257   2                      //ANGELAS111:E+Modify code for befor power on check Battery RSOC in DC mode.
 258   2                      //if ((Battdata_ready != 1)&&(!Read_AC_IN()||Read_ACOFF()))
 259   2                      /*if ((Battdata_ready != 1)&&(!Read_AC_IN()))
 260   2                      {
 261   2                              FirstGetBatData();
 262   2                              if (Battdata_ready != 1)
 263   2                              {
 264   2                                      Battdata_ready = 0xFF;
 265   2                                      break;
 266   2                              }
 267   2                      }
 268   2                      //if ((BAT1PERCL < 0x02)&&(!Read_AC_IN()||Read_ACOFF()))  //change 0x05 to 0x00 G23:modify battery capac
             -ity point from 0 to 1 for fliker.
 269   2                      if ((BAT1PERCL < 0x02)&&(!Read_AC_IN()))  //change 0x05 to 0x00 G23:modify battery capacity point from 0
             - to 1 for fliker.
 270   2                      {
 271   2                              SET_MASK(nBatteryStatL,CMBS_LOWBATT);
 272   2                              LOWBATT_3TIMES = 100;           // set 5 se
 273   2                              break;
 274   2                      }*///ANGELAS111:-Modify code for befor power on check Battery RSOC in DC mode.
 275   2                      //if ((!Read_AC_IN()||Read_ACOFF()))                    // if DC mode
 276   2                      if ((!Read_AC_IN()))                    // if DC mode
 277   2                      {
 278   3                              BatSMbusFailCount = 0;
 279   3                              nBattErrorCnt = 0;
 280   3                              if (IS_MASK_SET(LENOVOBATT,BATTERY_LEGAL))      //SHA1 fail
 281   3                              {
 282   4                                      Service_Auth_Step = 1;                          // start SHA1 again
 283   4                                      SHA1failCnt = 1;
 284   4                              }
 285   3                      }
 286   2              if(IS_MASK_SET(SysStatus2, b3EC8S_Reset))
 287   2              {
 288   3                  break;
 289   3              }
 290   2                      uNovoVPCCount = 0;
 291   2                      ONEKEY_FLAG = 0;//HEGANGS021:one key wake
 292   2              //      ONEKEY_TEMP_FLAG = 0;
 293   2                      PWSeqStep = 1;
 294   2              PowSeqDelay = 0x00;
 295   2              RamDebug(0x51);
 296   2                      SysPowState=SYSTEM_S5_S0;
 297   2                      break;
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 6   

 298   2      
 299   2          case SYSTEM_S3 :
 300   2              case SYSTEM_S0 :
 301   2                      RamDebug(0xF4);//test 
 302   2                      if (IS_MASK_CLEAR(pProject4,pPWSWdisable)) //HEGANGS028:Disable POWERSW when flash bios
 303   2                      {
 304   3                              PM_PWRBTN_LOW();
 305   3                      }   
 306   2                      SET_MASK(SysStatus2,PWRBTN_press_retry);//72JERRY064:Modify press button 1s enter S3/S4/shutdown follow 
             -UI spec.
 307   2                      
 308   2                      break;
 309   2      
 310   2          default :
 311   2              break;
 312   2          }
 313   1      }
 314          
 315          //-----------------------------------------------------------------------------
 316          //power button was released
 317          //-----------------------------------------------------------------------------
 318          void PSWReleased(void)
 319          {
 320   1              CLEAR_MASK(F2_Pressed, F12Flag);// HEGANGS034:Modify onekey battery function
 321   1              CLEAR_MASK(F2_Pressed, F2Flag); 
 322   1              NOVO_COUNTER = T_PSWOFF;//Hang check
 323   1              ONEKEY_FLAG=0;  //HEGANGS025: Modify onekey battery function
 324   1              //ONEKEY_TEMP_FLAG = 0;
 325   1              if(ONEKEY_TEMP_FLAG)
 326   1              SET_MASK(OEMControl,b3ONEKEY_POWERUP);
 327   1              if ( IS_MASK_SET(cCmd, b6TestBtnEn) )
 328   1              {
 329   2                      Buffer_Key(0xE0);       //
 330   2                      Buffer_Key(0xF0);       //
 331   2                      Buffer_Key(0x25);       //
 332   2                      F_Service_SEND = 1;
 333   2              }
 334   1          
 335   1          if(IS_MASK_SET(SysStatus2, b3EC8S_Reset)) 
 336   1              {
 337   2                      CLEAR_MASK(SysStatus2, b3EC8S_Reset);
 338   2              }
 339   1            PWRBTN_press_debounce=0;//72JERRY064:Modify press button 1s enter S3/S4/shutdown follow UI spec.
 340   1                CLEAR_MASK(SysStatus2,PWRBTN_press_retry);   //72JERRY064:Modify press button 1s enter S3/S4/shutdown f
             -ollow UI spec.           
 341   1      //      if(DSxPowState == SYSTEM_S3S4) //LMLNANO016:add.
 342   1      //      {
 343   1      //              PM_PWRBTN_HI(); //LMLNANO014:add. 
 344   1      //      }
 345   1          if(!Read_LID_SW_IN())
 346   1              { return; }
 347   1      
 348   1          //PM_PWRBTN_HI();   //LMLNANO014:remove.
 349   1      
 350   1              PSW_COUNTER = T_PSWOFF; // initialize counter
 351   1              switch (SysPowState)
 352   1              {
 353   2              case SYSTEM_S4 :
 354   2                      break; 
 355   2      
 356   2              case SYSTEM_S5 :
 357   2                      break;
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 7   

 358   2      
 359   2              case SYSTEM_S3 :
 360   2              case SYSTEM_S0 :
 361   2                      PM_PWRBTN_HI();
 362   2                      break;
 363   2      
 364   2              default :
 365   2                      break;
 366   2              }
 367   1      }
 368          //-----------------------------------------------------------------------------
 369          //power button was overrided
 370          //-----------------------------------------------------------------------------
 371          void PSWOverrided(void)
 372          {
 373   1              if(!Read_LID_SW_IN())
 374   1              { return; }
 375   1          if (Read_EC_PWRBTN()&&Read_EC_NOVO())
 376   1          { return; }
 377   1              PowerBottonEvent();//72JERRY064:Modify press button 1s enter S3/S4/shutdown follow UI spec.
 378   1              //LMLKBL0011:S- remove press power button 4s force shutdown function.
 379   1              /*if (SystemIsS0 || SystemIsS3)
 380   1              {
 381   1                      if (Read_EC_PWRBTN())
 382   1                      {
 383   1                              PSW_COUNTER--;
 384   1                              if (PSW_COUNTER == 0)
 385   1                              {
 386   1                                      PWSeqStep = 1;
 387   1                                      PowSeqDelay = 0x00;
 388   1                      RamDebug(0x0C);
 389   1                                      SysPowState=SYSTEM_S0_S5;
 390   1                              }
 391   1                      }
 392   1                      else
 393   1                      {
 394   1                              PSW_COUNTER = T_PSWOFF;         // initialize counter
 395   1                      }
 396   1              }*/
 397   1              //LMLKBL0011:E-.
 398   1      }
 399          
 400          
 401          //-----------------------------------------------------------------------------
 402          //NOVO button was pressed
 403          //-----------------------------------------------------------------------------
 404          void NOVOPressed(void)
 405          {
 406   1              if ( IS_MASK_SET(cCmd, b6TestBtnEn) )
 407   1              {
 408   2                      Buffer_Key(0xE0);       //
 409   2                      Buffer_Key(0x49);       // page down make
 410   2                      F_Service_SEND = 1;
 411   2              }
 412   1              /*//ANGELAS007:s-Optimize power on sequence.
 413   1              //ANGELAS005:s+ Support UMA SKU EC_ON pin design.
 414   1              if(NTC_V1>682)
 415   1              {
 416   1                      GPCRF0 = OUTPUT;
 417   1                      SET_MASK(GPDRF,BIT(0));
 418   1              }
 419   1              else
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 8   

 420   1              //ANGELAS005:e+ Support UMA SKU EC_ON pin design.
 421   1      
 422   1              //EC_ON_HI();
 423   1              //EC_ON2_HI();
 424   1              *///ANGELAS007:e-Optimize power on sequence.
 425   1              ECSleepCount = 3;
 426   1              /*//ANGELAS007:s-Optimize power on sequence.
 427   1              #if !EN_PwrSeqTest
 428   1              if (LID_readytime !=0)
 429   1              {
 430   1                      //SET_MASK(SysStatus2,b1NOVOBTN_retry); 
 431   1                      return;
 432   1              }
 433   1              #endif
 434   1              *///ANGELAS007:e-Optimize power on sequence.
 435   1              CLEAR_MASK(SysStatus2,b1NOVOBTN_retry);
 436   1      
 437   1          if(!Read_LID_SW_IN())
 438   1              { return; }
 439   1      
 440   1              //Mos: Clear NOVOPressedCounter
 441   1              CountSecAfterNOVOPressed = 0;
 442   1      
 443   1              switch (SysPowState)
 444   1          {
 445   2              case SYSTEM_S4 :
 446   2                      //break;
 447   2                      case SYSTEM_DSX://72JERRY006: Add DC S5 states.
 448   2          case SYSTEM_S5 :
 449   2                      // Battery capacity > 5% or not
 450   2                      //ANGELAS111:S+Modify code for befor power on check Battery RSOC in DC mode.
 451   2                      if(!Read_AC_IN()||IS_MASK_SET(ACOFF_SOURCE, BATTLEARN))
 452   2                      {                               
 453   3                              BatSMbusFailCount = 0;
 454   3                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 455   3                              {
 456   4                                      BatSMbusFailCount++;    
 457   4                                      while(BatSMbusFailCount <=4) 
 458   4                                      {               
 459   5                                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 460   5                                              {
 461   6                                                      BatSMbusFailCount++;                                                                             
 462   6                                              }
 463   5                                              else
 464   5                                              {
 465   6                                                      BatSMbusFailCount=0;
 466   6                                                      break;
 467   6                                              }
 468   5                                      }
 469   4                                                                                                               
 470   4                              }
 471   3                              if(BatSMbusFailCount>=4) 
 472   3                                      break;
 473   3                              
 474   3                              if (BAT1PERCL < 0x02)  //T064: change 0x05 to 0x00 G23:modify battery capacity point from 0 to 1 for fl
             -iker.
 475   3                              {
 476   4                                      SET_MASK(nBatteryStatL,CMBS_LOWBATT);
 477   4                                      LOWBATT_3TIMES = 100;           // set 5 sec
 478   4                                      break;
 479   4                              }
 480   3                      }
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 9   

 481   2                      //ANGELAS111:E+Modify code for befor power on check Battery RSOC in DC mode.
 482   2                      if(LOWBATT_3TIMES == 0)
 483   2              {
 484   3                              //EEPROM_PwrSts = Read_Eflash_Byte(EEPROMA2,(EEPROMA1_B03 | 0x07),0xDF);
 485   3                      // NOVO button should be no function when resuming from S4
 486   3                      if( (EEPROM_PwrSts & 0x10) == 0 )
 487   3                      {
 488   4                                      if ( (EEPROM_PwrSts & 0x01) != 0 )
 489   4                                      { 
 490   5                                          break; 
 491   5                      }
 492   4                      }
 493   3                              uNovoVPCCount = 1;
 494   3                              PWSeqStep = 1;
 495   3                              PowSeqDelay = 0x00;
 496   3                  RamDebug(0x52);// T045+
 497   3                              SysPowState=SYSTEM_S5_S0;
 498   3                      }
 499   2              break;
 500   2      
 501   2              case SYSTEM_S3 :
 502   2              break;
 503   2              case SYSTEM_S0 :
 504   2                      // NOVO button should initialize ONEKEY Recovery Windows Module,
 505   2                      // or be no function if ONEKEY Recovery Windows Module hasn't been installed
 506   2                      if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) )
 507   2                      {
 508   3                              uNovoVPCCount++;
 509   3                              if( uNovoVPCCount > (10+1) )
 510   3                                      { uNovoVPCCount--; }
 511   3                              //uNovoVPCCount=0;
 512   3                              //PM_PWRBTN_LOW();
 513   3                      }
 514   2                      //break;
 515   2          default :
 516   2              break;
 517   2          }
 518   1      }
 519          
 520          //-----------------------------------------------------------------------------
 521          //NOVO button was released
 522          //-----------------------------------------------------------------------------
 523          void NOVOReleased(void)
 524          {
 525   1              NOVO_COUNTER = T_PSWOFF;//Hang check
 526   1              ONEKEY_FLAG = 0;
 527   1              ONEKEY_TEMP_FLAG = 0; //HEGANGS025: Modify onekey battery function
 528   1              if ( IS_MASK_SET(cCmd, b6TestBtnEn) )
 529   1              {
 530   2                      Buffer_Key(0xE0);       //
 531   2                      Buffer_Key(0xF0);       //
 532   2                      Buffer_Key(0x49);       // page down make
 533   2                      F_Service_SEND = 1;
 534   2              }
 535   1      
 536   1              //CLR_MASK(SysStatus2,b2NOVOKey_Press);         // Release NOVO key.   
 537   1          if(!Read_LID_SW_IN())
 538   1              { return; }
 539   1      
 540   1              switch (SysPowState)
 541   1              {
 542   2              case SYSTEM_S4 :
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 10  

 543   2                      //break;
 544   2              case SYSTEM_S5 :
 545   2                      //break;
 546   2              case SYSTEM_S3 :
 547   2                      break;
 548   2              case SYSTEM_S0 :
 549   2                      //PM_PWRBTN_HI();
 550   2                      if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) )
 551   2                      {
 552   3                              if( uNovoVPCCount > 10 )                // Delay 100 mSec.
 553   3                          { uNovoVPCCount = 1; }
 554   3                          else
 555   3                              { uNovoVPCCount = 0; }
 556   3                              uVPCeventSource = VPCeventNovo; // bit3:NOVO.
 557   3                          uVPCeventSource2 = 0;
 558   3                              ECQEvent(SDV_VPC_notify);               // 0x44 for Levono used.
 559   3                      }
 560   2                      //break;
 561   2              default :
 562   2                      break;
 563   2              }
 564   1      }
 565          
 566          //-----------------------------------------------------------------------------
 567          //power button was overrided
 568          //-----------------------------------------------------------------------------
 569          void NOVOOverrided(void)
 570          {
 571   1              //HEGANGS022:Add SMI hang check function
 572   1              if (!Read_EC_NOVO())
 573   1              {
 574   2                      return; 
 575   2              }
 576   1              if(NOVO_COUNTER != 0)
 577   1              {
 578   2                      NOVO_COUNTER--;
 579   2                      return;
 580   2              }
 581   1              NOVO_COUNTER = T_PSWOFF;
 582   1              ECSMIEvent();
 583   1      //HEGANGS022:Add SMI hang check function
 584   1      }
 585          
 586          //-----------------------------------------------------------------------------
 587          //LAN_WAKE was low
 588          //-----------------------------------------------------------------------------
 589          void LanWakeLow(void)
 590          {
 591   1              #if     Support_EC_LANWake
                      //if (uReserve07.fbit.nPmeWakeEN==0) return;
              
                      switch (SysPowState)
                      {
                      case SYSTEM_S4 :
                              break;
              
                      case SYSTEM_S5 :
                              //PWSeqStep = 1;
                              //PowSeqDelay = 0x00;
                              //SysPowState=SYSTEM_S5_S0;
                              break;
              
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 11  

                      case SYSTEM_S3 :
                              if ( IS_MASK_SET(AOAC_STATUS, ISCT_Enable) )    // Check ISCT enable?
                              {
                                      PM_PWRBTN_LOW();
                                      AOAC_STATUS |= 0x80;    // Set PME(LAN) wake function.
                              }
                              else
                              {
                                      if ( IS_MASK_SET(SYS_STATUS,AC_ADP) )
                                      { 
                                              RamDebug(0x99);
                                              //PCIE_WAKE_OUTPUT;
                                              //PCIE_WAKE_LOW();
                          } // Set PME(LAN) wake function.
                              }
                              break;
              
                      case SYSTEM_S0 :
                              break;
              
                      default :
                              break;
                      }
                      #endif  // Support_EC_LANWake
 629   1      }
 630          
 631          //-----------------------------------------------------------------------------
 632          //LAN_WAKE was hi
 633          //-----------------------------------------------------------------------------
 634          void LanWakeHi(void)
 635          {
 636   1              #if     Support_EC_LANWake
                      //if (uReserve07.fbit.nPmeWakeEN==0) return;
              
                      switch (SysPowState)
                      {
                      case SYSTEM_S4 :
                              break;
              
                      case SYSTEM_S5 :
                              break;
              
                      case SYSTEM_S3 :
                              PM_PWRBTN_HI();
                      RamDebug(0x9A);
                              //PCIE_WAKE_HI();
                              //PCIE_WAKE_INPUT;
                              break;
              
                      case SYSTEM_S0 :
                              PM_PWRBTN_HI();
                              //PCIE_WAKE_HI();
                              //PCIE_WAKE_INPUT;
                              break;
              
                      default :
                              PM_PWRBTN_HI();
                      //      PCIE_WAKE_HI();
                      //      PCIE_WAKE_INPUT;
                              break;
                      }
                      #endif  // Support_EC_LANWake
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 12  

 667   1      }
 668          //-----------------------------------------------------------------------------
 669          // VoiceWakeSystem(): When mic input voice string match "xxx", Realtek chip 
 670          // notify EC and EC wake up system from s3/S4/S5 except modern standby(s3).
 671          // 72JERRY012£ºVoice wake system event function
 672          //-----------------------------------------------------------------------------
 673          void VoiceWakeSystem(void)
 674          {
 675   1       if(cDev.fbit.cD_WovMFGtest==1)//enable wov MFG test
 676   1              {return;
 677   2              }
 678   1              //72JERRY065:Add CMD 0x59 test voice wake up for MFG.
 679   1              switch(SysPowState)
 680   1              {
 681   2                case SYSTEM_S5:
 682   2                case SYSTEM_DSX://72JERRY029: Modify Voice Wake system method,Add DC S5 wake up status.
 683   2                //72JERRY076:s+Required to power on at battery RSOC below 2% in S5/S4 follow UI spec.
 684   2                if(!Read_AC_IN()||IS_MASK_SET(ACOFF_SOURCE, BATTLEARN))
 685   2                      {                               
 686   3                              BatSMbusFailCount = 0;
 687   3                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 688   3                              {
 689   4                                      BatSMbusFailCount++;    
 690   4                                      while((BatSMbusFailCount<=4)) 
 691   4                                      {               
 692   5                                              if(!bRWSMBus(SMbusChB, SMbusRW, SmBat_Addr, C_RSOC, &BAT1PERCL,SMBus_NoPEC))
 693   5                                              {
 694   6                                                      BatSMbusFailCount++;
 695   6                                              }
 696   5                                              else
 697   5                                              {
 698   6                                                      BatSMbusFailCount=0;
 699   6                                          break; //JIMGBRW022
 700   6                                              }
 701   5                                      }
 702   4                                                                                                               
 703   4                              }
 704   3                              if(BatSMbusFailCount>=4) 
 705   3                                      break;
 706   3                              
 707   3                              if (BAT1PERCL < 0x02)  //T064: change 0x05 to 0x00 G23:modify battery capacity point from 0 to 1 for fl
             -iker.
 708   3                              {
 709   4                                      SET_MASK(nBatteryStatL,CMBS_LOWBATT);
 710   4                                      LOWBATT_3TIMES = 100;           // set 5 sec
 711   4                                      break;
 712   4                              }
 713   3                      }
 714   2                //72JERRY076:e+Required to power on at battery RSOC below 2% in S5/S4 follow UI spec.
 715   2                 if(IS_MASK_SET(SysStatus2, b3EC8S_Reset))
 716   2              {
 717   3                  break;
 718   3              }//72JERRY040:Modify press power button more than 8S can power on.
 719   2                      PWSeqStep = 1;
 720   2                              PowSeqDelay = 0x00;
 721   2                              uWOVSTATUS=1;//72JERRY032: Add voice wake up cmd for BIOS.
 722   2                  RamDebug(0x55);
 723   2                              SysPowState=SYSTEM_S5_S0;
 724   2                              break;
 725   2                case SYSTEM_S3:
 726   2                          PWSeqStep = 1;
 727   2                              PowSeqDelay = 0x00;
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 13  

 728   2                              uWOVSTATUS=1;//72JERRY032: Add voice wake up cmd for BIOS.
 729   2                  RamDebug(0x56);
 730   2                              SysPowState=SYSTEM_S3_S0;
 731   2                              break;
 732   2                      default:
 733   2                              break;
 734   2              }
 735   1      }
 736          
 737          //-----------------------------------------------------------------------------
 738          // battery 1 in function
 739          //-----------------------------------------------------------------------------
 740          void Battery1In(void)
 741          {
 742   1              /*ANGELAS038: remove start
 743   1              //ANGELAS020:S+
 744   1              if(IS_MASK_CLEAR(SYS_STATUS,AC_ADP) &&(!(NTC_V1>682)))
 745   1              {
 746   1                      GPCRF0 = INPUT; 
 747   1              }
 748   1              //ANGELAS020:E+
 749   1              //ANGELAS023:S+Modify UMA LED function.
 750   1              if((SystemIsS5) && (IS_MASK_CLEAR(SYS_STATUS,AC_ADP)))
 751   1              {
 752   1                      if(NTC_V1>682)
 753   1                              NTC_FLAG=1; 
 754   1                      else
 755   1                              NTC_FLAG=0;
 756   1              }
 757   1              //ANGELAS023:E+Modify UMA LED function.
 758   1              *///ANGELAS038:remove end
 759   1              SET_MASK(SEL_STATE0,PRESENT_A);         //set battery flag
 760   1              SET_MASK(nBatteryStatus1,ENEXIST);  //set battery flag
 761   1              FirstGetBatData();                                      //first get battery data
 762   1              ECSMI_SCIEvent(ACPI_BAT1IN_SCI);
 763   1              Service_Auth_Step = 1;                          // start SHA1
 764   1              /*    
 765   1             if (IS_MASK_SET(SYS_STATUS,AC_ADP)) 
 766   1             {
 767   1                  ADAPTERIDON_LOW();
 768   1             }
 769   1              */           
 770   1              //SetPowerBatteryparameter(); 
 771   1              //ADAPTERIDON_HI();   
 772   1              //Mos: Clean Get_Batt_debounce_count to make it check battery data stable or not?
 773   1              Get_Batt_debounce_count = 0;
 774   1      }
 775          
 776          //-----------------------------------------------------------------------------
 777          // battery 1 out function
 778          //-----------------------------------------------------------------------------
 779          void Battery1Out(void)
 780          {
 781   1              PORT_BYTE_PNTR BAT1_pntr;
 782   1      
 783   1              CLEAR_MASK(SEL_STATE0,PRESENT_A);       //clear battery flag
 784   1              CLEAR_MASK(nBatteryStatus1,ENEXIST);    //clear battery flag
 785   1              BAT1_pntr = &SEL_STATE0;        // Base on address 0x04BF.
 786   1              for( ITempW01=0; ITempW01<=57; ITempW01++ )     // Clear 04BF~04F8.
 787   1              {
 788   2                      *BAT1_pntr=0;
 789   2              BAT1_pntr++;
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 14  

 790   2              }
 791   1      
 792   1              BAT1_pntr = &BATTMANUFACTURE;   // Base on address 0x048F.
 793   1              for( ITempW01=0; ITempW01<=16; ITempW01++ )     // Clear 048F~049F.
 794   1              {
 795   2                      *BAT1_pntr=0;
 796   2              BAT1_pntr++;
 797   2              }
 798   1      
 799   1      
 800   1          if(SystemIsS0 && IS_MASK_SET(LENOVOPMFW,BATTERY_MAIN_CAL))
 801   1          {
 802   2              uVPCeventSource = General;
 803   2                      uVPCeventSource2 = 0;
 804   2                      ECSMI_SCIEvent(SDV_VPC_notify);
 805   2          }
 806   1      
 807   1              Battdata_ready = 0;
 808   1              BatSMbusFailCount = 0;
 809   1              nBattErrorCnt = 0;
 810   1              LENOVOBATT = 0;
 811   1              EM8_TEST = 0;
 812   1              LV_Authen_Step_CNT = 0;
 813   1              SHA1failCnt = 0;
 814   1          SHA1FailRetry=0x00;
 815   1              Bat1_FPChgFlag = 0;
 816   1              CellCount=0; //MEILING017: add
 817   1              ECSMI_SCIEvent(ACPI_BAT1IN_SCI);
 818   1      }
 819          //change LID implement method.
 820          void LID_Pressed(void)
 821          {
 822   1          CLEAR_MASK(SWI_EVENT,LID);
 823   1              ECQEvent(SCI_LID_Close);
 824   1              RamDebug(0x15);
 825   1              //EC_TS_ON_LOW();//Add touch panel control signal.  //MEILING001:add.
 826   1              //72JERRY050:S+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI SPEC
             -.
 827   1              if((SystemIsS3)&&(!Read_AC_IN()))
 828   1                      {USB_ON_INPUT;
 829   2                      }
 830   1              //72JERRY050:E+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI SPEC
             -.
 831   1              
 832   1      }
 833          void LID_Released(void)
 834          {
 835   1              SET_MASK(SWI_EVENT,LID);
 836   1              if ((SystemIsS3))
 837   1              {
 838   2                      PulseSBPowerButton();
 839   2              }
 840   1          ECQEvent(SCI_LID_Open);
 841   1              RamDebug(0x16);
 842   1              //EC_TS_ON_HI();//Add touch panel control signal.  //MEILING001:add.
 843   1      }
 844          
 845          //MARTINM026:add start
 846          void LID_PAD_Pressed(void)
 847          {
 848   1               SET_MASK(SYS_STATUS2,PadLidClose);
 849   1           RamDebug(0x93);
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 15  

 850   1               if(SystemIsS0)
 851   1           {     
 852   2                                      if  (IS_MASK_SET(SYS_MISC1, ACPI_OS)) 
 853   2                                      {
 854   3                                              if(READ_EC_TP_ON())
 855   3                                              {
 856   4                                                      EC_TP_ON_LOW();
 857   4                                                      SET_MASK(pDevStatus1, b7DisableTP);
 858   4                                                      uVPCeventSource = TouchPad;
 859   4                                                      uVPCeventSource2 = 0;
 860   4                                                      ECQEvent(SDV_VPC_notify);
 861   4                                              }
 862   3                                      }
 863   2                                  //PAD Cover Close (PAD LID Close)
 864   2                                      if(IS_MASK_SET(SYS_MISC1,ACPI_OS))
 865   2                                      {
 866   3                                        if((IS_MASK_CLEAR(pDevStatus2,b1TransAP_CTRL))&&(IS_MASK_SET(pDevStatus1,b5TPDRIVER_STATUS))
 867   3                                              &&(IS_MASK_CLEAR(pDevStatus1, b7DisableTP)))
 868   3                                        {
 869   4                                              ECQEvent(0x3F); 
 870   4      
 871   4                                              SET_MASK(pDevStatus3,b6EnDisTPSend); 
 872   4                                              if(IS_MASK_SET(pDevStatus1,b7DisableTP))
 873   4                                              {
 874   5                                                 SET_MASK(pDevStatus3,b7TPStateFormer);
 875   5                                              }
 876   4                                              else
 877   4                                              {
 878   5                                                 CLEAR_MASK(pDevStatus3,b7TPStateFormer);
 879   5                                              }  
 880   4      
 881   4                                              RamDebug(0xBF);   
 882   4                                        }
 883   3                                      }
 884   2                                      
 885   2                                      SET_MASK(pDevStatus2,b2PadLid_Close);
 886   2                                      
 887   2                                      if(IS_MASK_CLEAR(pDevStatus2,b1TransAP_CTRL))    
 888   2                                      {
 889   3                                        SET_MASK(pDevStatus1,b2DisableKB);
 890   3                                        RamDebug(0xB4); 
 891   3      
 892   3                                        if(IS_MASK_SET(EM9_NEWFUN, b7_LShiftPress))  
 893   3                                        { 
 894   4                                                      simple_code(0x12,BREAK_EVENT);
 895   4                                                      CLEAR_MASK(EM9_NEWFUN,b7_LShiftPress);
 896   4                                        }
 897   3                                        if(IS_MASK_SET(EM9_NEWFUN,b6_RShiftPress))
 898   3                                        {
 899   4                                                      simple_code(0x59,BREAK_EVENT);
 900   4                                                      CLEAR_MASK(EM9_NEWFUN, b6_RShiftPress);
 901   4                                        }
 902   3                                        if(IS_MASK_SET(EM9_NEWFUN, b5_LAltPress)) 
 903   3                                        { 
 904   4                                                      simple_code(0x11,BREAK_EVENT);
 905   4                                                      CLEAR_MASK(EM9_NEWFUN,b5_LAltPress);
 906   4                                        }
 907   3                                        if(IS_MASK_SET(EM9_NEWFUN,b4_RAltPress))
 908   3                                        {
 909   4                                                       e0_prefix_code(0x11,BREAK_EVENT);
 910   4                                                       CLEAR_MASK(EM9_NEWFUN, b4_RAltPress);
 911   4                                        }
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 16  

 912   3                                        if(IS_MASK_SET(EM9_NEWFUN, b3_LCtrlPress)) 
 913   3                                        { 
 914   4                                                       simple_code(0x14,BREAK_EVENT);
 915   4                                                       CLEAR_MASK(EM9_NEWFUN,b3_LCtrlPress);
 916   4                                        }
 917   3                                        if(IS_MASK_SET(EM9_NEWFUN,b2_RCtrlPress))
 918   3                                        {
 919   4                                                       e0_prefix_code(0x14,BREAK_EVENT);
 920   4                                                       CLEAR_MASK(EM9_NEWFUN, b2_RCtrlPress);
 921   4                                        } 
 922   3      
 923   3                                      }                                                                                               
 924   2                      }               
 925   1      }
 926          
 927          void LID_PAD_Released(void)
 928          {
 929   1          CLEAR_MASK(SYS_STATUS2,PadLidClose);//MARTINM037:Add
 930   1              RamDebug(0x94);
 931   1              if(SystemIsS0)
 932   1          {
 933   2                               if  (IS_MASK_SET(SYS_MISC1, ACPI_OS))//HEGANGS027:Add the function of YMC control the TP
 934   2                                      {
 935   3                                              if(IS_MASK_CLEAR(pDevStatus2,b1TransAP_CTRL))
 936   3                                              {
 937   4                                                      if(!READ_EC_TP_ON())
 938   4                                                      {
 939   5                                                              EC_TP_ON_HI();
 940   5                                                              CLEAR_MASK(pDevStatus1, b7DisableTP);
 941   5                                                              uVPCeventSource = TouchPad;
 942   5                                                              uVPCeventSource2 = 0;
 943   5                                                              ECQEvent(SDV_VPC_notify);
 944   5                                                      }
 945   4                                              }
 946   3                                      }
 947   2                         //PAD Cover Open (PAD LID OPEN)
 948   2                                       if(IS_MASK_SET(SYS_MISC1,ACPI_OS))
 949   2                                       {
 950   3                                                      if((IS_MASK_CLEAR(pDevStatus2,b1TransAP_CTRL))&&(IS_MASK_SET(pDevStatus1,b5TPDRIVER_STATUS))
 951   3                                                              &&(IS_MASK_SET(pDevStatus1, b7DisableTP)))  
 952   3                                                      {
 953   4                                                              ECQEvent(0x3E);         
 954   4      
 955   4                                                              SET_MASK(pDevStatus3,b6EnDisTPSend); 
 956   4                                                              if(IS_MASK_SET(pDevStatus1,b7DisableTP))
 957   4                                                              {
 958   5                                                                 SET_MASK(pDevStatus3,b7TPStateFormer);
 959   5                                                              }
 960   4                                                              else
 961   4                                                              {
 962   5                                                                 CLEAR_MASK(pDevStatus3,b7TPStateFormer);
 963   5                                                              }  
 964   4      
 965   4                                                          RamDebug(0xBE);   
 966   4                                                      }
 967   3                                        }
 968   2                                                      
 969   2                                         CLEAR_MASK(pDevStatus2,b2PadLid_Close);
 970   2                                               
 971   2                                         if(IS_MASK_CLEAR(pDevStatus2,b1TransAP_CTRL))  
 972   2                                         {
 973   3                                               CLEAR_MASK(pDevStatus1,b2DisableKB);
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 17  

 974   3                                               
 975   3                                               RamDebug(0xB5);
 976   3                                               
 977   3                                               Enable_Any_Key_Irq();
 978   3                                               if (SystemIsS3)
 979   3                                               {
 980   4                                                      InterKBDWakeEnable(); 
 981   4                                               }      
 982   3                                         }                                                                                                                                                    
 983   2                      }               
 984   1      }
 985          
 986          //change LID implement method.
 987          // ----------------------------------------------------------------------------
 988          // Device insert/remove debounce routine.
 989          // input:   device_id
 990          // ----------------------------------------------------------------------------
 991          
 992          const struct sDebounce code Debounce_TBL[] =
 993          {
 994          
 995                  {&POWER_FLAG1   ,wait_PSW_off     ,&DEBOUNCE_CONT1       ,T_PSW_DEBOUNCE                ,PSWPressed         ,PSWReleased    ,PS
             -WOverrided        },
 996              {&POWER_FLAG1       ,adapter_in       ,&DEBOUNCE_CONT2       ,T_AC_DEBOUNCE                 ,AdapterIn          ,AdapterOut         ,Null
             -Event            },
 997                  {&BT1_STATUS1   ,bat_in                   ,&DEBOUNCE_CONT3       ,T_BAT_DEBOUNCE            ,Battery1In     ,Battery1Out        ,NullEvent      
             -        },
 998                  {&POWER_FLAG1   ,wati_NOVO_off    ,&DEBOUNCE_CONT4       ,T_NOVO_DEBOUNCE               ,NOVOPressed    ,NOVOReleased   ,NOVO
             -Overrided  }, //LMLNANO008:Modify debunce time define.
 999                  {&POWER_FLAG1   ,LAN_WAKE_Status  ,&DEBOUNCE_CONT5       ,T_LAN_WAKE_DEBOUNCE   ,LanWakeLow         ,LanWakeHi      
             -,NullEvent                },
1000                  {&POWER_FLAG1   ,Lid_Act          ,&DEBOUNCE_CONT6       ,T_LID_DEBOUNCE            ,LID_Pressed        ,LID_Released   ,NullEv
             -ent                },//change LID implement method.
1001                  {&EVT_STATUS1   ,Lid_PAD_Act      ,&DEBOUNCE_CONT7      ,T_EXTEVT_DEBOUNCE         ,LID_PAD_Pressed  ,LID_PAD_Released          
             -,NullEvent                        }, //MARTINM026: Add
1002                  {&EVT_STATUS1   ,DummyFlag                ,&DEBOUNCE_CONT8       ,T_EXTEVT_DEBOUNCE     ,NullEvent          ,NullEvent          ,NullEve
             -nt            },
1003                  {&EVT_STATUS1   ,DummyFlag            ,&DEBOUNCE_CONT9   ,T_EXTEVT_DEBOUNCE     ,NullEvent          ,NullEvent          ,NullE
             -vent            },
1004                  {&EVT_STATUS1   ,DummyFlag                ,&DEBOUNCE_CONT10  ,T_EXTEVT_DEBOUNCE         ,NullEvent          ,NullEvent          ,NullEvent
             -            },
1005          };
1006          
1007          // ----------------------------------------------------------------------------
1008          // EventManager function
1009          //
1010          // Note :
1011          //      If want to call the function of status not change, please set nochange_func = 1
1012          // ----------------------------------------------------------------------------
1013          #pragma OT(8, SPEED)
1014          void EventManager(BYTE device_id)
1015          {
1016   1              BYTE new_state,old_state;
1017   1              BYTE device_flag;
1018   1              //BYTE do_nochange_func = 0x00;
1019   1              switch(device_id)
1020   1              {
1021   2              case 0 :
1022   2              if (Read_EC_PWRBTN()&&Read_EC_NOVO())   return;  //ANGELAS099:Optimize power switch and NOVO control m
             -ethod.//ANGELAS101:Optimize ANGELAS099 change break to return.
1023   2              new_state = Read_EC_PWRBTN();                            
1024   2                      /*  
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 18  

1025   2                      if ( IS_MASK_CLEAR(SysStatus2,b2NOVOKey_Press) )
1026   2                      {
1027   2                              if (((Battdata_ready == 0xFF)&&(!Read_AC_IN()||Read_ACOFF()))||
1028   2                                      (IS_MASK_SET(SysStatus2,PWRBTN_press_retry)))
1029   2                              {
1030   2                                      //new_state = !Read_EC_PWRBTN();       
1031   2                                      //old_state = Read_EC_PWRBTN();          
1032   2                                      new_state = Read_EC_PWRBTN();      
1033   2                                      old_state = !Read_EC_PWRBTN();                                  
1034   2                              }
1035   2                              else
1036   2                              { new_state = Read_EC_PWRBTN(); }
1037   2                      }
1038   2                      else
1039   2                      { new_state = old_state = 0; }
1040   2                      */      
1041   2                      break;
1042   2      
1043   2              case 1 :
1044   2                      new_state = Read_AC_IN();
1045   2                      break;
1046   2      
1047   2              case 2 :
1048   2                      /*if((BATTEMP<0x390)) //martin0216 0x390 -> 0x390*3/0x400 -> 2.67
1049   2                      { new_state = 1; }
1050   2                      else
1051   2                      { new_state = 0; }*/
1052   2                      new_state=Read_BAT_IN();//G03:ADD battery detect
1053   2                      break;
1054   2      
1055   2              case 3 :
1056   2                      /*             
1057   2                      if ( Read_EC_NOVO() )                                                                      
1058   2                      { SET_MASK(SysStatus2,b2NOVOKey_Press); }       // Press NOVO key.    
1059   2      
1060   2                      if ( IS_MASK_SET(SysStatus2,b1NOVOBTN_retry) )
1061   2                      {
1062   2                              new_state = !Read_EC_NOVO();
1063   2                              old_state = Read_EC_NOVO();
1064   2                      }
1065   2                      else
1066   2                      { new_state = Read_EC_NOVO(); }
1067   2                      */      
1068   2              new_state = Read_EC_NOVO(); 
1069   2                      break;
1070   2      
1071   2              case 4 :
1072   2                      #if     Support_EC_LANWake
                              new_state = Read_LAN_WAKE_IN();
                              #else
1075   2                      new_state = 0x00;
1076   2                      #endif  // Support_EC_LANWake
1077   2                      break;
1078   2      
1079   2              case 5 :
1080   2                      //achange LID implement method.
1081   2                      if(IS_MASK_CLEAR(SysStatus,LidKBIgnore)) 
1082   2                      {
1083   3                              #if LID_OnlyQEvent_Support //add judge
1084   3                              new_state = !Read_LID_SW_IN(); //Open: LID_SW_IN: high else: low
1085   3                              #else
                                      new_state = 0x00;
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 19  

                                      #endif
1088   3                      }
1089   2                      else
1090   2                      {
1091   3                              new_state = 0x00;
1092   3                      }
1093   2                      break;
1094   2                      // change LID implement method.
1095   2              case 6 :
1096   2                      
1097   2                      new_state = !Read_LID_PAD(); //Open: LID_SW_IN: high else: low
1098   2                      break;
1099   2              
1100   2      
1101   2              case 7:
1102   2              new_state = 0x00;
1103   2                      break;
1104   2      
1105   2              case 8:
1106   2                      new_state = 0x00;
1107   2                      break;
1108   2      
1109   2              case 9:
1110   2              new_state = 0x00;
1111   2                      break;
1112   2      
1113   2              default :
1114   2                      new_state = 0x00;
1115   2                      break;
1116   2              }
1117   1      
1118   1              Tmp_XPntr = Debounce_TBL[device_id].REG;
1119   1              Tmp_XPntr1 = Debounce_TBL[device_id].Cunter;
1120   1              device_flag = Debounce_TBL[device_id].Flag;
1121   1      
1122   1              old_state = ((*Tmp_XPntr & device_flag) != 0x00);
1123   1              if(new_state != old_state)
1124   1              {
1125   2                      if((*Tmp_XPntr1) == 0x00)
1126   2                      {
1127   3                              //LMLNANO008:S+ modify power button debunce time in S0.
1128   3                              //if((device_id==0) && (SystemIsS0) && (IS_MASK_CLEAR(cCmd, b6TestBtnEn))) //LMLNANO026:add solution fo
             -r P/L test Power Button.//72JERRY042:Modify press power button debounce in SO follow UI spec.
1129   3                                      //(*Tmp_XPntr1) = T_PSW_DEBOUNCE_S0;//72JERRY042:Modify press power button debounce in SO follow UI sp
             -ec.
1130   3                              //else//72JERRY042:Modify press power button debounce in SO follow UI spec.
1131   3                              //LMLNANO008:E+.
1132   3                              (*Tmp_XPntr1) = Debounce_TBL[device_id].Time;
1133   3                      }
1134   2                      else
1135   2                      {
1136   3                              (*Tmp_XPntr1) --;
1137   3                  
1138   3                              if((*Tmp_XPntr1) == 0)
1139   3                              {
1140   4                                      if(new_state)
1141   4                                      {
1142   5                                              (Debounce_TBL[device_id].press)();
1143   5                                              *Tmp_XPntr |= device_flag;
1144   5                                      }
1145   4                                      else
1146   4                                      {
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 20  

1147   5                                              (Debounce_TBL[device_id].release)();
1148   5                                              *Tmp_XPntr  &= (~device_flag);
1149   5                                      }
1150   4                              }
1151   3                      }
1152   2              }
1153   1              else
1154   1              {
1155   2                      *Tmp_XPntr1 = 0x00;
1156   2              }
1157   1      
1158   1              (Debounce_TBL[device_id].nochange)();
1159   1      }
1160          //72JERRY064:s+Modify press button 1s enter S3/S4/shutdown follow UI spec.
1161          void PowerBottonEvent(void)
1162          {
1163   1                       if(IS_MASK_SET(SysStatus2, PWRBTN_press_retry))
1164   1                              {  PWRBTN_press_debounce++;
1165   2                              if(PWRBTN_press_debounce>=1)
1166   2                                      {
1167   3                                      PWRBTN_press_debounce=0;
1168   3                                      CLEAR_MASK(SysStatus2,PWRBTN_press_retry);
1169   3                                      ECQEvent(Powerbotton_SCI);
1170   3                                      }
1171   2                              }
1172   1      }
1173          //72JERRY064:e+Modify press button 1s enter S3/S4/shutdown follow UI spec.
1174          
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 21  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com00EC (BEGIN)
0000         L?0237:
0000         L?0238:
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#BatSMbusFailCount
0004 F0                MOVX    @DPTR,A
0005         L?0239:
0005 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0008 740D              MOV     A,#0DH
000A F0                MOVX    @DPTR,A
000B 7E00        E     MOV     R6,#HIGH BAT1PERCL
000D A3                INC     DPTR
000E 7400        E     MOV     A,#HIGH BAT1PERCL
0010 F0                MOVX    @DPTR,A
0011 A3                INC     DPTR
0012 7400        E     MOV     A,#LOW BAT1PERCL
0014 F0                MOVX    @DPTR,A
0015 E4                CLR     A
0016 A3                INC     DPTR
0017 F0                MOVX    @DPTR,A
0018 7B16              MOV     R3,#016H
001A 7D0C              MOV     R5,#0CH
001C 7F01              MOV     R7,#01H
001E 22                RET     
001F         L?0240:
001F F0                MOVX    @DPTR,A
0020 7420              MOV     A,#020H
0022         L?0241:
0022 900000      E     MOV     DPTR,#uVPCeventSource
0025         L?0242:
0025 F0                MOVX    @DPTR,A
0026 E4                CLR     A
0027 900000      E     MOV     DPTR,#uVPCeventSource2
002A F0                MOVX    @DPTR,A
002B 7F44              MOV     R7,#044H
002D 22                RET     
002E         L?0243:
002E 7401              MOV     A,#01H
0030         L?0244:
0030 900000      E     MOV     DPTR,#PWSeqStep
0033 F0                MOVX    @DPTR,A
0034 E4                CLR     A
0035 900000      E     MOV     DPTR,#PowSeqDelay
0038 F0                MOVX    @DPTR,A
0039 A3                INC     DPTR
003A F0                MOVX    @DPTR,A
003B 22                RET     
003C         L?0245:
003C         L?0246:
003C 900000      E     MOV     DPTR,#nBatteryStatL
003F E0                MOVX    A,@DPTR
0040 4404              ORL     A,#04H
0042 F0                MOVX    @DPTR,A
0043 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0046 7464              MOV     A,#064H
0048 F0                MOVX    @DPTR,A
0049 22                RET     
004A         L?0248:
004A         L?0249:
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 22  

004A D3                SETB    C
004B         L?0250:
004B 900000      E     MOV     DPTR,#BatSMbusFailCount
004E E0                MOVX    A,@DPTR
004F 9404              SUBB    A,#04H
0051 22                RET     
0052         L?0251:
0052 900000      E     MOV     DPTR,#NOVO_COUNTER
0055         L?0252:
0055 7401              MOV     A,#01H
0057 F0                MOVX    @DPTR,A
0058 A3                INC     DPTR
0059 74F4              MOV     A,#0F4H
005B F0                MOVX    @DPTR,A
005C 22                RET     
005D         L?0253:
005D E4                CLR     A
005E         L?0254:
005E 900000      E     MOV     DPTR,#BatSMbusFailCount
0061 F0                MOVX    @DPTR,A
0062 900000      E     MOV     DPTR,#nBattErrorCnt
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         L?0255:
0067 900000      E     MOV     DPTR,#pDevStatus3
006A E0                MOVX    A,@DPTR
006B 4440              ORL     A,#040H
006D F0                MOVX    @DPTR,A
006E 900000      E     MOV     DPTR,#pDevStatus1
0071 E0                MOVX    A,@DPTR
0072 900000      E     MOV     DPTR,#pDevStatus3
0075 22                RET     
0076         L?0256:
0076 E4                CLR     A
0077 F0                MOVX    @DPTR,A
0078 900000      E     MOV     DPTR,#SysStatus2
007B E0                MOVX    A,@DPTR
007C 54FE              ANL     A,#0FEH
007E F0                MOVX    @DPTR,A
007F 900000      E     MOV     DPTR,#GPDRB
0082 E0                MOVX    A,@DPTR
0083 22                RET     
0084         L?0257:
0084 900000      E     MOV     DPTR,#DCR6
0087 747F              MOV     A,#07FH
0089 F0                MOVX    @DPTR,A
008A 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
008D 740A              MOV     A,#0AH
008F F0                MOVX    @DPTR,A
0090 22                RET     
0091         L?0258:
0091         L?0259:
0091 900000      E     MOV     DPTR,#BAT1PERCL
0094 E0                MOVX    A,@DPTR
0095 C3                CLR     C
0096 9402              SUBB    A,#02H
0098 22                RET     
0099         L?0260:
0099         L?0261:
0099 900000      E     MOV     DPTR,#SysPowState
009C E0                MOVX    A,@DPTR
009D 24F0              ADD     A,#0F0H
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 23  

009F 22                RET     
00A0         L?0262:
00A0         L?0263:
00A0 900000      E     MOV     DPTR,#BatSMbusFailCount
00A3 E0                MOVX    A,@DPTR
00A4 04                INC     A
00A5 F0                MOVX    @DPTR,A
00A6 22                RET     
00A7         L?0264:
00A7         L?0265:
00A7 900000      E     MOV     DPTR,#SysPowState
00AA 7450              MOV     A,#050H
00AC F0                MOVX    @DPTR,A
00AD 22                RET     
             ; FUNCTION Com00EC (END)

             ; FUNCTION NullEvent (BEGIN)
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 18
                                           ; SOURCE LINE # 20
0000 22                RET     
             ; FUNCTION NullEvent (END)

             ; FUNCTION AdapterIn (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 55
0000 7F02              MOV     R7,#02H
0002 120000      E     LCALL   _PECI_SETPL2Watts
                                           ; SOURCE LINE # 57
0005 900000      E     MOV     DPTR,#SYS_STATUS
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
                                           ; SOURCE LINE # 58
                                           ; SOURCE LINE # 60
000A         ?C0002:
                                           ; SOURCE LINE # 62
000A 900000      E     MOV     DPTR,#GPDRJ
000D E0                MOVX    A,@DPTR
000E 4440              ORL     A,#040H
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 63
0011 120000      E     LCALL   ACInOutIntEnable
                                           ; SOURCE LINE # 64
0014 120000      E     LCALL   Unlock_ShipMode
                                           ; SOURCE LINE # 65
0017 900000      E     MOV     DPTR,#SYS_STATUS
001A E0                MOVX    A,@DPTR
001B 4480              ORL     A,#080H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 66
001E 900000      E     MOV     DPTR,#nBatteryStatus1
0021 E0                MOVX    A,@DPTR
0022 30E003            JNB     ACC.0,?C0003
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
0025 120000      E     LCALL   Chk_Battery_Full
                                           ; SOURCE LINE # 69
0028         ?C0003:
                                           ; SOURCE LINE # 71
0028 7F37              MOV     R7,#037H
002A 120000      E     LCALL   _ECSMI_SCIEvent
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 24  

                                           ; SOURCE LINE # 72
002D 900000      E     MOV     DPTR,#SysPowState
0030 E0                MOVX    A,@DPTR
0031 B41003            CJNE    A,#010H,?C0004
                                           ; SOURCE LINE # 73
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
0034 120000      R     LCALL   L?0257
                                           ; SOURCE LINE # 76
0037         ?C0004:
                                           ; SOURCE LINE # 78
0037 120000      E     LCALL   InitChargerIC
                                           ; SOURCE LINE # 79
                                           ; SOURCE LINE # 80
003A 120000      R     LCALL   L?0253
                                           ; SOURCE LINE # 82
003D 900000      E     MOV     DPTR,#CHGIC_ptr
0040 04                INC     A
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 83
0042 120000      E     LCALL   WriteSmartChgIC
                                           ; SOURCE LINE # 84
0045 120000      E     LCALL   WriteSmartChgIC
                                           ; SOURCE LINE # 85
0048 900000      E     MOV     DPTR,#CHGIC_ptr
004B 7403              MOV     A,#03H
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 86
004E 120000      E     LCALL   ReadSmartChgIC
                                           ; SOURCE LINE # 87
0051 900000      E     MOV     DPTR,#SYS_STATUS
0054 E0                MOVX    A,@DPTR
0055 30E70C            JNB     ACC.7,?C0005
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 90
0058 900000      E     MOV     DPTR,#AdapterIDOn_Flag
005B 7401              MOV     A,#01H
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 91
005E 900000      E     MOV     DPTR,#ADPIDON10MS_NUM
0061 740A              MOV     A,#0AH
0063 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
0064         ?C0005:
                                           ; SOURCE LINE # 95
0064 900000      E     MOV     DPTR,#SysPowState
0067 E0                MOVX    A,@DPTR
0068 6444              XRL     A,#044H
006A 6009              JZ      ?C0007
006C E0                MOVX    A,@DPTR
006D 6455              XRL     A,#055H
006F 6004              JZ      ?C0007
0071 E0                MOVX    A,@DPTR
0072 B46605            CJNE    A,#066H,?C0008
0075         ?C0007:
                                           ; SOURCE LINE # 96
                                           ; SOURCE LINE # 97
0075 7F02              MOV     R7,#02H
0077 120000      E     LCALL   _S4S5_KeyWake
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
007A         ?C0008:
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 25  

007A 22                RET     
             ; FUNCTION AdapterIn (END)

             ; FUNCTION AdapterOut (BEGIN)
                                           ; SOURCE LINE # 104
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#AdapterIDOn_Flag
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 108
0005 900000      E     MOV     DPTR,#AdapterID
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 109
0009 900000      E     MOV     DPTR,#TYPEC_Adapter_Watts
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 118
000D 120000      E     LCALL   BATT_LEN_OFF
                                           ; SOURCE LINE # 119
0010 900000      E     MOV     DPTR,#GPDRJ
0013 E0                MOVX    A,@DPTR
0014 54BF              ANL     A,#0BFH
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 120
0017 120000      E     LCALL   ACInOutIntEnable
                                           ; SOURCE LINE # 121
001A 900000      E     MOV     DPTR,#SYS_STATUS
001D E0                MOVX    A,@DPTR
001E 54EF              ANL     A,#0EFH
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 122
0021 E0                MOVX    A,@DPTR
0022 54DF              ANL     A,#0DFH
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 123
0025 120000      E     LCALL   SetVGA_AC_DET
                                           ; SOURCE LINE # 124
0028 7F01              MOV     R7,#01H
002A 120000      E     LCALL   _PECI_SETPL2Watts
                                           ; SOURCE LINE # 126
002D 900000      E     MOV     DPTR,#SYS_STATUS
0030 E0                MOVX    A,@DPTR
0031 547F              ANL     A,#07FH
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 127
0034 120000      E     LCALL   Chk_Battery_Full
                                           ; SOURCE LINE # 128
0037 7F38              MOV     R7,#038H
0039 120000      E     LCALL   _ECSMI_SCIEvent
                                           ; SOURCE LINE # 131
003C 900000      E     MOV     DPTR,#BatteryAlarm
003F E0                MOVX    A,@DPTR
0040 4401              ORL     A,#01H
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 136
0043 120000      E     LCALL   ThrottlingControl
                                           ; SOURCE LINE # 138
0046 900000      E     MOV     DPTR,#SysPowState
0049 E0                MOVX    A,@DPTR
004A B41012            CJNE    A,#010H,?C0009
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 26  

                                           ; SOURCE LINE # 141
004D 120000      R     LCALL   L?0257
                                           ; SOURCE LINE # 144
0050 900000      E     MOV     DPTR,#LENOVOPMFW
0053 E0                MOVX    A,@DPTR
0054 30E208            JNB     ACC.2,?C0009
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
0057 7402              MOV     A,#02H
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 148
0059 120000      R     LCALL   L?0241
005C 120000      E     LCALL   _ECSMI_SCIEvent
                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
005F         ?C0009:
                                           ; SOURCE LINE # 152
005F 900000      E     MOV     DPTR,#SysPowState
0062 E0                MOVX    A,@DPTR
0063 B43313            CJNE    A,#033H,?C0011
0066 900000      E     MOV     DPTR,#GPDRB
0069 E0                MOVX    A,@DPTR
006A 30E103            JNB     ACC.1,?C0012
006D D3                SETB    C
006E 8001              SJMP    ?C0013
0070         ?C0012:
0070 C3                CLR     C
0071         ?C0013:
0071 4006              JC      ?C0011
                                           ; SOURCE LINE # 153
0073 900000      E     MOV     DPTR,#GPCRD5
0076 7480              MOV     A,#080H
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 154
0079         ?C0011:
                                           ; SOURCE LINE # 156
0079 E4                CLR     A
007A 900000      E     MOV     DPTR,#nAvgCurrentL
007D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 157
007E 900000      E     MOV     DPTR,#nAvgCurrentH
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
0082 900000      E     MOV     DPTR,#Bat0x0BFakeCnt
0085 743C              MOV     A,#03CH
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
0088 900000      E     MOV     DPTR,#DSxPowState
008B 7434              MOV     A,#034H
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 161
008E 900000      E     MOV     DPTR,#ADPIDON10MS_NUM
0091 74FF              MOV     A,#0FFH
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 162
0094 020000      E     LJMP    InitChargerIC
             ; FUNCTION AdapterOut (END)

             ; FUNCTION PSWPressed (BEGIN)
                                           ; SOURCE LINE # 169
                                           ; SOURCE LINE # 170
                                           ; SOURCE LINE # 171
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 27  

0000 900000      E     MOV     DPTR,#cCmd
0003 E0                MOVX    A,@DPTR
0004 30E60C            JNB     ACC.6,?C0015
                                           ; SOURCE LINE # 172
                                           ; SOURCE LINE # 173
0007 7FE0              MOV     R7,#0E0H
0009 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 174
000C 7F25              MOV     R7,#025H
000E 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 175
0011 D200        E     SETB    F_Service_SEND
                                           ; SOURCE LINE # 176
0013         ?C0015:
                                           ; SOURCE LINE # 190
0013 900000      E     MOV     DPTR,#ECSleepCount
0016 7403              MOV     A,#03H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 193
0019 900000      E     MOV     DPTR,#CountSecAfterPswPressed
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 216
001C 120000      R     LCALL   L?0256
001F 30E103            JNB     ACC.1,?C0017
0022 D3                SETB    C
0023 8001              SJMP    ?C0018
0025         ?C0017:
0025 C3                CLR     C
0026         ?C0018:
0026 4003              JC      $ + 5H
0028 020000      R     LJMP    ?C0019
                                           ; SOURCE LINE # 217
002B         ?C0016:
                                           ; SOURCE LINE # 220
002B 120000      R     LCALL   L?0260
002E 7003              JNZ     $ + 5H
0030 020000      R     LJMP    ?C0041
0033 24DD              ADD     A,#0DDH
0035 7003              JNZ     $ + 5H
0037 020000      R     LJMP    ?C0041
003A 24CD              ADD     A,#0CDH
003C 6007              JZ      ?C0023
003E 2411              ADD     A,#011H
0040 6003              JZ      $ + 5H
0042 020000      R     LJMP    ?C0019
                                           ; SOURCE LINE # 221
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
0045         ?C0023:
                                           ; SOURCE LINE # 227
0045 900000      E     MOV     DPTR,#GPDRB
0048 E0                MOVX    A,@DPTR
0049 30E003            JNB     ACC.0,?C0026
004C D3                SETB    C
004D 8001              SJMP    ?C0027
004F         ?C0026:
004F C3                CLR     C
0050         ?C0027:
0050 5007              JNC     ?C0025
0052 900000      E     MOV     DPTR,#ACOFF_SOURCE
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 28  

0055 E0                MOVX    A,@DPTR
0056 30E232            JNB     ACC.2,?C0024
0059         ?C0025:
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
                                           ; SOURCE LINE # 230
0059 120000      R     LCALL   L?0237
005C 120000      E     LCALL   _bRWSMBus
005F EF                MOV     A,R7
0060 701A              JNZ     ?C0028
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 232
0062 800E              SJMP    ?C0222
0064         ?C0029:
                                           ; SOURCE LINE # 233
0064 120000      R     LCALL   L?0248
0067 5013              JNC     ?C0028
                                           ; SOURCE LINE # 234
                                           ; SOURCE LINE # 235
0069 120000      R     LCALL   L?0239
006C 120000      E     LCALL   _bRWSMBus
006F EF                MOV     A,R7
0070 7005              JNZ     ?C0031
                                           ; SOURCE LINE # 236
                                           ; SOURCE LINE # 237
0072         ?C0222:
0072 120000      R     LCALL   L?0262
                                           ; SOURCE LINE # 238
0075 80ED              SJMP    ?C0029
0077         ?C0031:
                                           ; SOURCE LINE # 240
                                           ; SOURCE LINE # 241
0077 E4                CLR     A
0078 900000      E     MOV     DPTR,#BatSMbusFailCount
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 242
                                           ; SOURCE LINE # 243
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 246
007C         ?C0028:
                                           ; SOURCE LINE # 247
007C C3                CLR     C
007D 120000      R     LCALL   L?0250
0080 5061              JNC     ?C0019
                                           ; SOURCE LINE # 248
0082         ?C0033:
                                           ; SOURCE LINE # 250
0082 120000      R     LCALL   L?0258
0085 5004              JNC     ?C0024
                                           ; SOURCE LINE # 251
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
0087 120000      R     LCALL   L?0245
                                           ; SOURCE LINE # 254
008A 22                RET     
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
008B         ?C0024:
                                           ; SOURCE LINE # 276
008B 900000      E     MOV     DPTR,#GPDRB
008E E0                MOVX    A,@DPTR
008F 30E003            JNB     ACC.0,?C0036
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 29  

0092 D3                SETB    C
0093 8001              SJMP    ?C0037
0095         ?C0036:
0095 C3                CLR     C
0096         ?C0037:
0096 4014              JC      ?C0035
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 279
0098 120000      R     LCALL   L?0253
                                           ; SOURCE LINE # 280
009B 900000      E     MOV     DPTR,#LENOVOBATT
009E E0                MOVX    A,@DPTR
009F 30E10A            JNB     ACC.1,?C0035
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
00A2 900000      E     MOV     DPTR,#Service_Auth_Step
00A5 7401              MOV     A,#01H
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 283
00A8 900000      E     MOV     DPTR,#SHA1failCnt
00AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 285
00AC         ?C0035:
                                           ; SOURCE LINE # 286
00AC 900000      E     MOV     DPTR,#SysStatus2
00AF E0                MOVX    A,@DPTR
00B0 20E330            JB      ACC.3,?C0019
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
                                           ; SOURCE LINE # 289
00B3         ?C0039:
                                           ; SOURCE LINE # 290
00B3 E4                CLR     A
00B4 900000      E     MOV     DPTR,#uNovoVPCCount
00B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 291
00B8 900000      E     MOV     DPTR,#ONEKEY_FLAG
00BB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
00BC 04                INC     A
                                           ; SOURCE LINE # 294
00BD 120000      R     LCALL   L?0244
                                           ; SOURCE LINE # 295
00C0 7F51              MOV     R7,#051H
00C2 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 296
00C5 120000      R     LCALL   L?0264
                                           ; SOURCE LINE # 297
00C8 22                RET     
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
00C9         ?C0041:
                                           ; SOURCE LINE # 301
00C9 7FF4              MOV     R7,#0F4H
00CB 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 302
00CE 900000      E     MOV     DPTR,#pProject4
00D1 E0                MOVX    A,@DPTR
00D2 20E007            JB      ACC.0,?C0042
                                           ; SOURCE LINE # 303
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 30  

                                           ; SOURCE LINE # 304
00D5 900000      E     MOV     DPTR,#GPDRF
00D8 E0                MOVX    A,@DPTR
00D9 54FD              ANL     A,#0FDH
00DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 305
00DC         ?C0042:
                                           ; SOURCE LINE # 306
00DC 900000      E     MOV     DPTR,#SysStatus2
00DF E0                MOVX    A,@DPTR
00E0 4401              ORL     A,#01H
00E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 310
                                           ; SOURCE LINE # 311
                                           ; SOURCE LINE # 312
                                           ; SOURCE LINE # 313
00E3         ?C0019:
00E3 22                RET     
             ; FUNCTION PSWPressed (END)

             ; FUNCTION PSWReleased (BEGIN)
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 320
0000 900000      E     MOV     DPTR,#F2_Pressed
0003 E0                MOVX    A,@DPTR
0004 54FD              ANL     A,#0FDH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 321
0007 E0                MOVX    A,@DPTR
0008 54FE              ANL     A,#0FEH
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 322
000B 120000      R     LCALL   L?0251
                                           ; SOURCE LINE # 323
000E E4                CLR     A
000F 900000      E     MOV     DPTR,#ONEKEY_FLAG
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
0013 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
0016 E0                MOVX    A,@DPTR
0017 6007              JZ      ?C0044
                                           ; SOURCE LINE # 326
0019 900000      E     MOV     DPTR,#OEMControl
001C E0                MOVX    A,@DPTR
001D 4408              ORL     A,#08H
001F F0                MOVX    @DPTR,A
0020         ?C0044:
                                           ; SOURCE LINE # 327
0020 900000      E     MOV     DPTR,#cCmd
0023 E0                MOVX    A,@DPTR
0024 30E611            JNB     ACC.6,?C0045
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
0027 7FE0              MOV     R7,#0E0H
0029 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 330
002C 7FF0              MOV     R7,#0F0H
002E 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 331
0031 7F25              MOV     R7,#025H
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 31  

0033 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 332
0036 D200        E     SETB    F_Service_SEND
                                           ; SOURCE LINE # 333
0038         ?C0045:
                                           ; SOURCE LINE # 335
0038 900000      E     MOV     DPTR,#SysStatus2
003B E0                MOVX    A,@DPTR
003C 30E304            JNB     ACC.3,?C0046
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
003F E0                MOVX    A,@DPTR
0040 54F7              ANL     A,#0F7H
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 338
0043         ?C0046:
                                           ; SOURCE LINE # 339
0043 900000      E     MOV     DPTR,#PWRBTN_press_debounce
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 345
0046 120000      R     LCALL   L?0256
0049 30E103            JNB     ACC.1,?C0048
004C D3                SETB    C
004D 8001              SJMP    ?C0049
004F         ?C0048:
004F C3                CLR     C
0050         ?C0049:
0050 5019              JNC     ?C0050
                                           ; SOURCE LINE # 346
0052         ?C0047:
                                           ; SOURCE LINE # 350
0052 900000      E     MOV     DPTR,#PSW_COUNTER
0055 120000      R     LCALL   L?0252
                                           ; SOURCE LINE # 351
0058 900000      E     MOV     DPTR,#SysPowState
005B E0                MOVX    A,@DPTR
005C 24CD              ADD     A,#0CDH
005E 6004              JZ      ?C0055
0060 2423              ADD     A,#023H
0062 7007              JNZ     ?C0050
                                           ; SOURCE LINE # 352
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
0064         ?C0055:
                                           ; SOURCE LINE # 361
0064 900000      E     MOV     DPTR,#GPDRF
0067 E0                MOVX    A,@DPTR
0068 4402              ORL     A,#02H
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 365
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
006B         ?C0050:
006B 22                RET     
             ; FUNCTION PSWReleased (END)

C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 32  

             ; FUNCTION PSWOverrided (BEGIN)
                                           ; SOURCE LINE # 371
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
0000 900000      E     MOV     DPTR,#GPDRB
0003 E0                MOVX    A,@DPTR
0004 30E103            JNB     ACC.1,?C0058
0007 D3                SETB    C
0008 8001              SJMP    ?C0059
000A         ?C0058:
000A C3                CLR     C
000B         ?C0059:
000B 5011              JNC     ?C0060
                                           ; SOURCE LINE # 374
000D         ?C0057:
                                           ; SOURCE LINE # 375
000D 900000      E     MOV     DPTR,#GPDRB
0010 E0                MOVX    A,@DPTR
0011 20E307            JB      ACC.3,?C0061
0014 900000      E     MOV     DPTR,#GPDRJ
0017 E0                MOVX    A,@DPTR
0018 30E003            JNB     ACC.0,?C0060
                                           ; SOURCE LINE # 376
001B         ?C0061:
                                           ; SOURCE LINE # 377
001B 120000      R     LCALL   PowerBottonEvent
                                           ; SOURCE LINE # 398
001E         ?C0060:
001E 22                RET     
             ; FUNCTION PSWOverrided (END)

             ; FUNCTION NOVOPressed (BEGIN)
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 406
0000 900000      E     MOV     DPTR,#cCmd
0003 E0                MOVX    A,@DPTR
0004 30E60C            JNB     ACC.6,?C0062
                                           ; SOURCE LINE # 407
                                           ; SOURCE LINE # 408
0007 7FE0              MOV     R7,#0E0H
0009 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 409
000C 7F49              MOV     R7,#049H
000E 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 410
0011 D200        E     SETB    F_Service_SEND
                                           ; SOURCE LINE # 411
0013         ?C0062:
                                           ; SOURCE LINE # 425
0013 900000      E     MOV     DPTR,#ECSleepCount
0016 7403              MOV     A,#03H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 435
0019 900000      E     MOV     DPTR,#SysStatus2
001C E0                MOVX    A,@DPTR
001D 54FD              ANL     A,#0FDH
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 437
0020 900000      E     MOV     DPTR,#GPDRB
0023 E0                MOVX    A,@DPTR
0024 30E103            JNB     ACC.1,?C0064
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 33  

0027 D3                SETB    C
0028 8001              SJMP    ?C0065
002A         ?C0064:
002A C3                CLR     C
002B         ?C0065:
002B 4003              JC      $ + 5H
002D 020000      R     LJMP    ?C0066
                                           ; SOURCE LINE # 438
0030         ?C0063:
                                           ; SOURCE LINE # 441
0030 E4                CLR     A
0031 900000      E     MOV     DPTR,#CountSecAfterNOVOPressed
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 443
0035 120000      R     LCALL   L?0260
0038 607B              JZ      ?C0086
003A 24BB              ADD     A,#0BBH
003C 600B              JZ      ?C0070
003E 24EF              ADD     A,#0EFH
0040 6007              JZ      ?C0070
0042 2422              ADD     A,#022H
0044 6003              JZ      $ + 5H
0046 020000      R     LJMP    ?C0066
                                           ; SOURCE LINE # 444
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 448
0049         ?C0070:
                                           ; SOURCE LINE # 451
0049 900000      E     MOV     DPTR,#GPDRB
004C E0                MOVX    A,@DPTR
004D 30E003            JNB     ACC.0,?C0073
0050 D3                SETB    C
0051 8001              SJMP    ?C0074
0053         ?C0073:
0053 C3                CLR     C
0054         ?C0074:
0054 5007              JNC     ?C0072
0056 900000      E     MOV     DPTR,#ACOFF_SOURCE
0059 E0                MOVX    A,@DPTR
005A 30E235            JNB     ACC.2,?C0071
005D         ?C0072:
                                           ; SOURCE LINE # 452
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 454
005D 120000      R     LCALL   L?0237
0060 120000      E     LCALL   _bRWSMBus
0063 EF                MOV     A,R7
0064 701A              JNZ     ?C0075
                                           ; SOURCE LINE # 455
                                           ; SOURCE LINE # 456
0066 800E              SJMP    ?C0223
0068         ?C0076:
                                           ; SOURCE LINE # 457
0068 120000      R     LCALL   L?0248
006B 5013              JNC     ?C0075
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 459
006D 120000      R     LCALL   L?0239
0070 120000      E     LCALL   _bRWSMBus
0073 EF                MOV     A,R7
0074 7005              JNZ     ?C0078
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 34  

                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
0076         ?C0223:
0076 120000      R     LCALL   L?0262
                                           ; SOURCE LINE # 462
0079 80ED              SJMP    ?C0076
007B         ?C0078:
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 465
007B E4                CLR     A
007C 900000      E     MOV     DPTR,#BatSMbusFailCount
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 470
0080         ?C0075:
                                           ; SOURCE LINE # 471
0080 900000      E     MOV     DPTR,#BatSMbusFailCount
0083 E0                MOVX    A,@DPTR
0084 C3                CLR     C
0085 9404              SUBB    A,#04H
0087 5042              JNC     ?C0066
                                           ; SOURCE LINE # 472
0089         ?C0080:
                                           ; SOURCE LINE # 474
0089 120000      R     LCALL   L?0258
008C 5004              JNC     ?C0071
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
008E 120000      R     LCALL   L?0245
                                           ; SOURCE LINE # 478
0091 22                RET     
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 480
0092         ?C0071:
                                           ; SOURCE LINE # 482
0092 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0095 E0                MOVX    A,@DPTR
0096 7033              JNZ     ?C0066
                                           ; SOURCE LINE # 483
                                           ; SOURCE LINE # 486
0098 900000      E     MOV     DPTR,#EEPROM_PwrSts
009B E0                MOVX    A,@DPTR
009C 20E404            JB      ACC.4,?C0083
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 488
009F E0                MOVX    A,@DPTR
00A0 20E028            JB      ACC.0,?C0066
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
00A3         ?C0083:
                                           ; SOURCE LINE # 493
00A3 900000      E     MOV     DPTR,#uNovoVPCCount
00A6 7401              MOV     A,#01H
00A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
                                           ; SOURCE LINE # 495
00A9 120000      R     LCALL   L?0244
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 35  

                                           ; SOURCE LINE # 496
00AC 7F52              MOV     R7,#052H
00AE 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 497
00B1 120000      R     LCALL   L?0264
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
00B4 22                RET     
                                           ; SOURCE LINE # 501
                                           ; SOURCE LINE # 502
                                           ; SOURCE LINE # 503
00B5         ?C0086:
                                           ; SOURCE LINE # 506
00B5 900000      E     MOV     DPTR,#SYS_MISC1
00B8 E0                MOVX    A,@DPTR
00B9 30E70F            JNB     ACC.7,?C0066
                                           ; SOURCE LINE # 507
                                           ; SOURCE LINE # 508
00BC 900000      E     MOV     DPTR,#uNovoVPCCount
00BF E0                MOVX    A,@DPTR
00C0 04                INC     A
00C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 509
00C2 E0                MOVX    A,@DPTR
00C3 D3                SETB    C
00C4 940B              SUBB    A,#0BH
00C6 4003              JC      ?C0066
                                           ; SOURCE LINE # 510
00C8 E0                MOVX    A,@DPTR
00C9 14                DEC     A
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 513
                                           ; SOURCE LINE # 515
                                           ; SOURCE LINE # 516
                                           ; SOURCE LINE # 517
                                           ; SOURCE LINE # 518
00CB         ?C0066:
00CB 22                RET     
             ; FUNCTION NOVOPressed (END)

             ; FUNCTION NOVOReleased (BEGIN)
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
0000 120000      R     LCALL   L?0251
                                           ; SOURCE LINE # 526
0003 E4                CLR     A
0004 900000      E     MOV     DPTR,#ONEKEY_FLAG
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 527
0008 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 528
000C 900000      E     MOV     DPTR,#cCmd
000F E0                MOVX    A,@DPTR
0010 30E611            JNB     ACC.6,?C0090
                                           ; SOURCE LINE # 529
                                           ; SOURCE LINE # 530
0013 7FE0              MOV     R7,#0E0H
0015 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 531
0018 7FF0              MOV     R7,#0F0H
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 36  

001A 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 532
001D 7F49              MOV     R7,#049H
001F 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 533
0022 D200        E     SETB    F_Service_SEND
                                           ; SOURCE LINE # 534
0024         ?C0090:
                                           ; SOURCE LINE # 537
0024 900000      E     MOV     DPTR,#GPDRB
0027 E0                MOVX    A,@DPTR
0028 30E103            JNB     ACC.1,?C0092
002B D3                SETB    C
002C 8001              SJMP    ?C0093
002E         ?C0092:
002E C3                CLR     C
002F         ?C0093:
002F 502A              JNC     ?C0094
                                           ; SOURCE LINE # 538
0031         ?C0091:
                                           ; SOURCE LINE # 540
0031 120000      R     LCALL   L?0261
0034 7025              JNZ     ?C0094
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
                                           ; SOURCE LINE # 544
                                           ; SOURCE LINE # 546
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 548
0036         ?C0099:
                                           ; SOURCE LINE # 550
0036 900000      E     MOV     DPTR,#SYS_MISC1
0039 E0                MOVX    A,@DPTR
003A 30E71E            JNB     ACC.7,?C0094
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
003D 900000      E     MOV     DPTR,#uNovoVPCCount
0040 E0                MOVX    A,@DPTR
0041 D3                SETB    C
0042 940A              SUBB    A,#0AH
0044 4005              JC      ?C0101
                                           ; SOURCE LINE # 553
0046 7401              MOV     A,#01H
0048 F0                MOVX    @DPTR,A
0049 8005              SJMP    ?C0102
004B         ?C0101:
                                           ; SOURCE LINE # 555
004B E4                CLR     A
004C 900000      E     MOV     DPTR,#uNovoVPCCount
004F F0                MOVX    @DPTR,A
0050         ?C0102:
                                           ; SOURCE LINE # 556
0050 900000      E     MOV     DPTR,#uVPCeventSource
0053 7408              MOV     A,#08H
                                           ; SOURCE LINE # 557
                                           ; SOURCE LINE # 558
0055 120000      R     LCALL   L?0242
0058 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 561
                                           ; SOURCE LINE # 562
                                           ; SOURCE LINE # 563
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 37  

                                           ; SOURCE LINE # 564
005B         ?C0094:
005B 22                RET     
             ; FUNCTION NOVOReleased (END)

             ; FUNCTION NOVOOverrided (BEGIN)
                                           ; SOURCE LINE # 569
                                           ; SOURCE LINE # 570
                                           ; SOURCE LINE # 572
0000 900000      E     MOV     DPTR,#GPDRJ
0003 E0                MOVX    A,@DPTR
0004 20E003            JB      ACC.0,?C0105
0007 D3                SETB    C
0008 8001              SJMP    ?C0106
000A         ?C0105:
000A C3                CLR     C
000B         ?C0106:
000B 501A              JNC     ?C0107
                                           ; SOURCE LINE # 573
                                           ; SOURCE LINE # 575
000D         ?C0104:
                                           ; SOURCE LINE # 576
000D 900000      E     MOV     DPTR,#NOVO_COUNTER
0010 E0                MOVX    A,@DPTR
0011 7002              JNZ     ?C0217
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015         ?C0217:
0015 900000      E     MOV     DPTR,#NOVO_COUNTER
0018 6007              JZ      ?C0108
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 578
001A 74FF              MOV     A,#0FFH
001C F5F0              MOV     B,A
001E 020000      E     LJMP    ?C?IILDX
                                           ; SOURCE LINE # 580
0021         ?C0108:
                                           ; SOURCE LINE # 581
0021 120000      R     LCALL   L?0252
                                           ; SOURCE LINE # 582
0024 120000      E     LCALL   ECSMIEvent
                                           ; SOURCE LINE # 584
0027         ?C0107:
0027 22                RET     
             ; FUNCTION NOVOOverrided (END)

             ; FUNCTION LanWakeLow (BEGIN)
                                           ; SOURCE LINE # 589
                                           ; SOURCE LINE # 590
                                           ; SOURCE LINE # 629
0000 22                RET     
             ; FUNCTION LanWakeLow (END)

             ; FUNCTION LanWakeHi (BEGIN)
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 635
                                           ; SOURCE LINE # 667
0000 22                RET     
             ; FUNCTION LanWakeHi (END)

             ; FUNCTION VoiceWakeSystem (BEGIN)
                                           ; SOURCE LINE # 673
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 38  

                                           ; SOURCE LINE # 674
                                           ; SOURCE LINE # 675
0000 900000      E     MOV     DPTR,#cDev
0003 E0                MOVX    A,@DPTR
0004 13                RRC     A
0005 13                RRC     A
0006 13                RRC     A
0007 541F              ANL     A,#01FH
0009 30E003            JNB     ACC.0,$ + 6H
000C 020000      R     LJMP    ?C0112
                                           ; SOURCE LINE # 676
                                           ; SOURCE LINE # 677
000F         ?C0111:
                                           ; SOURCE LINE # 679
000F 900000      E     MOV     DPTR,#SysPowState
0012 E0                MOVX    A,@DPTR
0013 24CD              ADD     A,#0CDH
0015 6069              JZ      ?C0128
0017 24CD              ADD     A,#0CDH
0019 6004              JZ      ?C0115
001B 2411              ADD     A,#011H
001D 7074              JNZ     ?C0112
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
001F         ?C0115:
                                           ; SOURCE LINE # 684
001F 900000      E     MOV     DPTR,#GPDRB
0022 E0                MOVX    A,@DPTR
0023 30E003            JNB     ACC.0,?C0118
0026 D3                SETB    C
0027 8001              SJMP    ?C0119
0029         ?C0118:
0029 C3                CLR     C
002A         ?C0119:
002A 5007              JNC     ?C0117
002C 900000      E     MOV     DPTR,#ACOFF_SOURCE
002F E0                MOVX    A,@DPTR
0030 30E235            JNB     ACC.2,?C0116
0033         ?C0117:
                                           ; SOURCE LINE # 685
                                           ; SOURCE LINE # 686
                                           ; SOURCE LINE # 687
0033 120000      R     LCALL   L?0238
0036 120000      E     LCALL   _bRWSMBus
0039 EF                MOV     A,R7
003A 701A              JNZ     ?C0120
                                           ; SOURCE LINE # 688
                                           ; SOURCE LINE # 689
003C 800E              SJMP    ?C0224
003E         ?C0121:
                                           ; SOURCE LINE # 690
003E 120000      R     LCALL   L?0249
0041 5013              JNC     ?C0120
                                           ; SOURCE LINE # 691
                                           ; SOURCE LINE # 692
0043 120000      R     LCALL   L?0239
0046 120000      E     LCALL   _bRWSMBus
0049 EF                MOV     A,R7
004A 7005              JNZ     ?C0123
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 39  

004C         ?C0224:
004C 120000      R     LCALL   L?0263
                                           ; SOURCE LINE # 695
004F 80ED              SJMP    ?C0121
0051         ?C0123:
                                           ; SOURCE LINE # 697
                                           ; SOURCE LINE # 698
0051 E4                CLR     A
0052 900000      E     MOV     DPTR,#BatSMbusFailCount
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
                                           ; SOURCE LINE # 700
                                           ; SOURCE LINE # 701
                                           ; SOURCE LINE # 703
0056         ?C0120:
                                           ; SOURCE LINE # 704
0056 900000      E     MOV     DPTR,#BatSMbusFailCount
0059 E0                MOVX    A,@DPTR
005A C3                CLR     C
005B 9404              SUBB    A,#04H
005D 5034              JNC     ?C0112
                                           ; SOURCE LINE # 705
005F         ?C0125:
                                           ; SOURCE LINE # 707
005F 120000      R     LCALL   L?0259
0062 5004              JNC     ?C0116
                                           ; SOURCE LINE # 708
                                           ; SOURCE LINE # 709
                                           ; SOURCE LINE # 710
0064 120000      R     LCALL   L?0246
                                           ; SOURCE LINE # 711
0067 22                RET     
                                           ; SOURCE LINE # 712
                                           ; SOURCE LINE # 713
0068         ?C0116:
                                           ; SOURCE LINE # 715
0068 900000      E     MOV     DPTR,#SysStatus2
006B E0                MOVX    A,@DPTR
006C 20E324            JB      ACC.3,?C0112
                                           ; SOURCE LINE # 716
                                           ; SOURCE LINE # 717
                                           ; SOURCE LINE # 718
006F         ?C0127:
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
006F 120000      R     LCALL   L?0243
                                           ; SOURCE LINE # 721
0072 900000      E     MOV     DPTR,#uWOVSTATUS
0075 04                INC     A
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 722
0077 7F55              MOV     R7,#055H
0079 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 723
007C 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 724
007F 22                RET     
                                           ; SOURCE LINE # 725
0080         ?C0128:
                                           ; SOURCE LINE # 726
                                           ; SOURCE LINE # 727
0080 120000      R     LCALL   L?0243
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 40  

                                           ; SOURCE LINE # 728
0083 900000      E     MOV     DPTR,#uWOVSTATUS
0086 04                INC     A
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 729
0088 7F56              MOV     R7,#056H
008A 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 730
008D 900000      E     MOV     DPTR,#SysPowState
0090 7430              MOV     A,#030H
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 731
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
0093         ?C0112:
0093 22                RET     
             ; FUNCTION VoiceWakeSystem (END)

             ; FUNCTION Battery1In (BEGIN)
                                           ; SOURCE LINE # 740
                                           ; SOURCE LINE # 741
                                           ; SOURCE LINE # 759
0000 900000      E     MOV     DPTR,#SEL_STATE0
0003 E0                MOVX    A,@DPTR
0004 4401              ORL     A,#01H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 760
0007 900000      E     MOV     DPTR,#nBatteryStatus1
000A E0                MOVX    A,@DPTR
000B 4401              ORL     A,#01H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 761
000E 120000      E     LCALL   FirstGetBatData
                                           ; SOURCE LINE # 762
0011 7F25              MOV     R7,#025H
0013 120000      E     LCALL   _ECSMI_SCIEvent
                                           ; SOURCE LINE # 763
0016 900000      E     MOV     DPTR,#Service_Auth_Step
0019 7401              MOV     A,#01H
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 773
001C E4                CLR     A
001D 900000      E     MOV     DPTR,#Get_Batt_debounce_count
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 774
0021 22                RET     
             ; FUNCTION Battery1In (END)

             ; FUNCTION Battery1Out (BEGIN)
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 780
                                           ; SOURCE LINE # 783
0000 900000      E     MOV     DPTR,#SEL_STATE0
0003 E0                MOVX    A,@DPTR
0004 54FE              ANL     A,#0FEH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 784
0007 900000      E     MOV     DPTR,#nBatteryStatus1
000A E0                MOVX    A,@DPTR
000B 54FE              ANL     A,#0FEH
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 41  

000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 785
;---- Variable 'BAT1_pntr' assigned to Register 'DPTR' ----
000E 900000      E     MOV     DPTR,#SEL_STATE0
                                           ; SOURCE LINE # 786
0011 E4                CLR     A
0012 F500        E     MOV     ITempW01,A
0014 F500        E     MOV     ITempW01+01H,A
0016         ?C0131:
                                           ; SOURCE LINE # 787
                                           ; SOURCE LINE # 788
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 789
0018 A3                INC     DPTR
                                           ; SOURCE LINE # 790
0019 0500        E     INC     ITempW01+01H
001B E500        E     MOV     A,ITempW01+01H
001D 7002              JNZ     ?C0218
001F 0500        E     INC     ITempW01
0021         ?C0218:
0021 E500        E     MOV     A,ITempW01+01H
0023 643A              XRL     A,#03AH
0025 4500        E     ORL     A,ITempW01
0027 70ED              JNZ     ?C0131
0029         ?C0132:
                                           ; SOURCE LINE # 792
0029 7E00        E     MOV     R6,#HIGH BATTMANUFACTURE
002B 900000      E     MOV     DPTR,#BATTMANUFACTURE
                                           ; SOURCE LINE # 793
002E E4                CLR     A
002F F500        E     MOV     ITempW01,A
0031 F500        E     MOV     ITempW01+01H,A
0033         ?C0134:
                                           ; SOURCE LINE # 794
                                           ; SOURCE LINE # 795
0033 E4                CLR     A
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 796
0035 A3                INC     DPTR
                                           ; SOURCE LINE # 797
0036 0500        E     INC     ITempW01+01H
0038 E500        E     MOV     A,ITempW01+01H
003A 7002              JNZ     ?C0219
003C 0500        E     INC     ITempW01
003E         ?C0219:
003E E500        E     MOV     A,ITempW01+01H
0040 6411              XRL     A,#011H
0042 4500        E     ORL     A,ITempW01
0044 70ED              JNZ     ?C0134
0046         ?C0135:
                                           ; SOURCE LINE # 800
0046 900000      E     MOV     DPTR,#SysPowState
0049 E0                MOVX    A,@DPTR
004A B41012            CJNE    A,#010H,?C0137
004D 900000      E     MOV     DPTR,#LENOVOPMFW
0050 E0                MOVX    A,@DPTR
0051 30E20B            JNB     ACC.2,?C0137
                                           ; SOURCE LINE # 801
                                           ; SOURCE LINE # 802
0054 900000      E     MOV     DPTR,#uVPCeventSource
0057 7402              MOV     A,#02H
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 42  

                                           ; SOURCE LINE # 803
                                           ; SOURCE LINE # 804
0059 120000      R     LCALL   L?0242
005C 120000      E     LCALL   _ECSMI_SCIEvent
                                           ; SOURCE LINE # 805
005F         ?C0137:
                                           ; SOURCE LINE # 807
005F E4                CLR     A
0060 900000      E     MOV     DPTR,#Battdata_ready
0063 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 808
                                           ; SOURCE LINE # 809
0064 120000      R     LCALL   L?0254
                                           ; SOURCE LINE # 810
0067 900000      E     MOV     DPTR,#LENOVOBATT
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 811
006B 900000      E     MOV     DPTR,#EM8_TEST
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 812
006F 900000      E     MOV     DPTR,#LV_Authen_Step_CNT
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 813
0073 900000      E     MOV     DPTR,#SHA1failCnt
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 814
0077 900000      E     MOV     DPTR,#SHA1FailRetry
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 815
007B 900000      E     MOV     DPTR,#Bat1_FPChgFlag
007E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 816
007F 900000      E     MOV     DPTR,#CellCount
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 817
0083 7F25              MOV     R7,#025H
0085 020000      E     LJMP    _ECSMI_SCIEvent
             ; FUNCTION Battery1Out (END)

             ; FUNCTION LID_Pressed (BEGIN)
                                           ; SOURCE LINE # 820
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
0000 900000      E     MOV     DPTR,#SWI_EVENT
0003 E0                MOVX    A,@DPTR
0004 54FD              ANL     A,#0FDH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 823
0007 7F16              MOV     R7,#016H
0009 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 824
000C 7F15              MOV     R7,#015H
000E 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 827
0011 900000      E     MOV     DPTR,#SysPowState
0014 E0                MOVX    A,@DPTR
0015 B43313            CJNE    A,#033H,?C0142
0018 900000      E     MOV     DPTR,#GPDRB
001B E0                MOVX    A,@DPTR
001C 30E003            JNB     ACC.0,?C0140
001F D3                SETB    C
0020 8001              SJMP    ?C0141
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 43  

0022         ?C0140:
0022 C3                CLR     C
0023         ?C0141:
0023 4006              JC      ?C0142
                                           ; SOURCE LINE # 828
0025 900000      E     MOV     DPTR,#GPCRD5
0028 7480              MOV     A,#080H
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 829
                                           ; SOURCE LINE # 832
002B         ?C0142:
002B 22                RET     
             ; FUNCTION LID_Pressed (END)

             ; FUNCTION LID_Released (BEGIN)
                                           ; SOURCE LINE # 833
                                           ; SOURCE LINE # 834
                                           ; SOURCE LINE # 835
0000 900000      E     MOV     DPTR,#SWI_EVENT
0003 E0                MOVX    A,@DPTR
0004 4402              ORL     A,#02H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 836
0007 900000      E     MOV     DPTR,#SysPowState
000A E0                MOVX    A,@DPTR
000B B43303            CJNE    A,#033H,?C0143
                                           ; SOURCE LINE # 837
                                           ; SOURCE LINE # 838
000E 120000      E     LCALL   PulseSBPowerButton
                                           ; SOURCE LINE # 839
0011         ?C0143:
                                           ; SOURCE LINE # 840
0011 7F15              MOV     R7,#015H
0013 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 841
0016 7F16              MOV     R7,#016H
0018 020000      E     LJMP    _RamDebug
             ; FUNCTION LID_Released (END)

             ; FUNCTION LID_PAD_Pressed (BEGIN)
                                           ; SOURCE LINE # 846
                                           ; SOURCE LINE # 847
                                           ; SOURCE LINE # 848
0000 900000      E     MOV     DPTR,#SYS_STATUS2
0003 E0                MOVX    A,@DPTR
0004 4402              ORL     A,#02H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 849
0007 7F93              MOV     R7,#093H
0009 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 850
000C 900000      E     MOV     DPTR,#SysPowState
000F E0                MOVX    A,@DPTR
0010 6410              XRL     A,#010H
0012 6003              JZ      $ + 5H
0014 020000      R     LJMP    ?C0159
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 852
0017 900000      E     MOV     DPTR,#SYS_MISC1
001A E0                MOVX    A,@DPTR
001B 30E717            JNB     ACC.7,?C0146
                                           ; SOURCE LINE # 853
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 44  

                                           ; SOURCE LINE # 854
001E 900000      E     MOV     DPTR,#GPDRJ
0021 E0                MOVX    A,@DPTR
0022 30E310            JNB     ACC.3,?C0146
                                           ; SOURCE LINE # 855
                                           ; SOURCE LINE # 856
0025 E0                MOVX    A,@DPTR
0026 54F7              ANL     A,#0F7H
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 857
0029 900000      E     MOV     DPTR,#pDevStatus1
002C E0                MOVX    A,@DPTR
002D 4480              ORL     A,#080H
                                           ; SOURCE LINE # 858
                                           ; SOURCE LINE # 859
                                           ; SOURCE LINE # 860
002F 120000      R     LCALL   L?0240
0032 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 861
                                           ; SOURCE LINE # 862
0035         ?C0146:
                                           ; SOURCE LINE # 864
0035 900000      E     MOV     DPTR,#SYS_MISC1
0038 E0                MOVX    A,@DPTR
0039 30E72C            JNB     ACC.7,?C0148
                                           ; SOURCE LINE # 865
                                           ; SOURCE LINE # 866
003C 900000      E     MOV     DPTR,#pDevStatus2
003F E0                MOVX    A,@DPTR
0040 20E125            JB      ACC.1,?C0148
0043 900000      E     MOV     DPTR,#pDevStatus1
0046 E0                MOVX    A,@DPTR
0047 30E51E            JNB     ACC.5,?C0148
004A E0                MOVX    A,@DPTR
004B 20E71A            JB      ACC.7,?C0148
                                           ; SOURCE LINE # 868
                                           ; SOURCE LINE # 869
004E 7F3F              MOV     R7,#03FH
0050 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 871
                                           ; SOURCE LINE # 872
0053 120000      R     LCALL   L?0255
0056 30E706            JNB     ACC.7,?C0150
                                           ; SOURCE LINE # 873
                                           ; SOURCE LINE # 874
0059 E0                MOVX    A,@DPTR
005A 4480              ORL     A,#080H
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 875
005D 8004              SJMP    ?C0151
005F         ?C0150:
                                           ; SOURCE LINE # 877
                                           ; SOURCE LINE # 878
005F E0                MOVX    A,@DPTR
0060 547F              ANL     A,#07FH
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 879
0063         ?C0151:
                                           ; SOURCE LINE # 881
0063 7FBF              MOV     R7,#0BFH
0065 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 882
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 45  

                                           ; SOURCE LINE # 883
0068         ?C0148:
                                           ; SOURCE LINE # 885
0068 900000      E     MOV     DPTR,#pDevStatus2
006B E0                MOVX    A,@DPTR
006C 4404              ORL     A,#04H
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 887
006F E0                MOVX    A,@DPTR
0070 20E166            JB      ACC.1,?C0159
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
0073 900000      E     MOV     DPTR,#pDevStatus1
0076 E0                MOVX    A,@DPTR
0077 4404              ORL     A,#04H
0079 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 890
007A 7FB4              MOV     R7,#0B4H
007C 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 892
007F 900000      E     MOV     DPTR,#EM9_NEWFUN
0082 E0                MOVX    A,@DPTR
0083 30E708            JNB     ACC.7,?C0153
                                           ; SOURCE LINE # 893
                                           ; SOURCE LINE # 894
0086 7F12              MOV     R7,#012H
                                           ; SOURCE LINE # 895
0088 120000      R     LCALL   L?0247
008B 547F              ANL     A,#07FH
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 896
008E         ?C0153:
                                           ; SOURCE LINE # 897
008E 900000      E     MOV     DPTR,#EM9_NEWFUN
0091 E0                MOVX    A,@DPTR
0092 30E608            JNB     ACC.6,?C0154
                                           ; SOURCE LINE # 898
                                           ; SOURCE LINE # 899
0095 7F59              MOV     R7,#059H
                                           ; SOURCE LINE # 900
0097 120000      R     LCALL   L?0247
009A 54BF              ANL     A,#0BFH
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 901
009D         ?C0154:
                                           ; SOURCE LINE # 902
009D 900000      E     MOV     DPTR,#EM9_NEWFUN
00A0 E0                MOVX    A,@DPTR
00A1 30E508            JNB     ACC.5,?C0155
                                           ; SOURCE LINE # 903
                                           ; SOURCE LINE # 904
00A4 7F11              MOV     R7,#011H
                                           ; SOURCE LINE # 905
00A6 120000      R     LCALL   L?0266
00A9 54DF              ANL     A,#0DFH
00AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 906
00AC         ?C0155:
                                           ; SOURCE LINE # 907
00AC 900000      E     MOV     DPTR,#EM9_NEWFUN
00AF E0                MOVX    A,@DPTR
00B0 30E408            JNB     ACC.4,?C0156
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 46  

                                           ; SOURCE LINE # 908
                                           ; SOURCE LINE # 909
00B3 7F11              MOV     R7,#011H
                                           ; SOURCE LINE # 910
00B5 120000      R     LCALL   L?0267
00B8 54EF              ANL     A,#0EFH
00BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 911
00BB         ?C0156:
                                           ; SOURCE LINE # 912
00BB 900000      E     MOV     DPTR,#EM9_NEWFUN
00BE E0                MOVX    A,@DPTR
00BF 30E308            JNB     ACC.3,?C0157
                                           ; SOURCE LINE # 913
                                           ; SOURCE LINE # 914
00C2 7F14              MOV     R7,#014H
                                           ; SOURCE LINE # 915
00C4 120000      R     LCALL   L?0266
00C7 54F7              ANL     A,#0F7H
00C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 916
00CA         ?C0157:
                                           ; SOURCE LINE # 917
00CA 900000      E     MOV     DPTR,#EM9_NEWFUN
00CD E0                MOVX    A,@DPTR
00CE 30E208            JNB     ACC.2,?C0159
                                           ; SOURCE LINE # 918
                                           ; SOURCE LINE # 919
00D1 7F14              MOV     R7,#014H
                                           ; SOURCE LINE # 920
00D3 120000      R     LCALL   L?0267
00D6 54FB              ANL     A,#0FBH
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 921
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
                                           ; SOURCE LINE # 925
00D9         ?C0159:
00D9 22                RET     
00DA         L?0247:
00DA 7D01              MOV     R5,#01H
00DC 120000      E     LCALL   _simple_code
00DF 900000      E     MOV     DPTR,#EM9_NEWFUN
00E2 E0                MOVX    A,@DPTR
00E3 22                RET     
00E4         L?0266:
00E4 7D01              MOV     R5,#01H
00E6 120000      E     LCALL   _simple_code
00E9 900000      E     MOV     DPTR,#EM9_NEWFUN
00EC E0                MOVX    A,@DPTR
00ED 22                RET     
00EE         L?0267:
00EE 7D01              MOV     R5,#01H
00F0 120000      E     LCALL   _e0_prefix_code
00F3 900000      E     MOV     DPTR,#EM9_NEWFUN
00F6 E0                MOVX    A,@DPTR
00F7 22                RET     
             ; FUNCTION LID_PAD_Pressed (END)

             ; FUNCTION LID_PAD_Released (BEGIN)
                                           ; SOURCE LINE # 927
                                           ; SOURCE LINE # 928
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 47  

                                           ; SOURCE LINE # 929
0000 900000      E     MOV     DPTR,#SYS_STATUS2
0003 E0                MOVX    A,@DPTR
0004 54FD              ANL     A,#0FDH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 930
0007 7F94              MOV     R7,#094H
0009 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 931
000C 900000      E     MOV     DPTR,#SysPowState
000F E0                MOVX    A,@DPTR
0010 6410              XRL     A,#010H
0012 6003              JZ      $ + 5H
0014 020000      R     LJMP    ?C0172
                                           ; SOURCE LINE # 932
                                           ; SOURCE LINE # 933
0017 900000      E     MOV     DPTR,#SYS_MISC1
001A E0                MOVX    A,@DPTR
001B 30E727            JNB     ACC.7,?C0161
                                           ; SOURCE LINE # 934
                                           ; SOURCE LINE # 935
001E 900000      E     MOV     DPTR,#pDevStatus2
0021 E0                MOVX    A,@DPTR
0022 20E120            JB      ACC.1,?C0161
                                           ; SOURCE LINE # 936
                                           ; SOURCE LINE # 937
0025 900000      E     MOV     DPTR,#GPDRJ
0028 E0                MOVX    A,@DPTR
0029 30E303            JNB     ACC.3,?C0164
002C D3                SETB    C
002D 8001              SJMP    ?C0165
002F         ?C0164:
002F C3                CLR     C
0030         ?C0165:
0030 4013              JC      ?C0161
                                           ; SOURCE LINE # 938
                                           ; SOURCE LINE # 939
0032 900000      E     MOV     DPTR,#GPDRJ
0035 E0                MOVX    A,@DPTR
0036 4408              ORL     A,#08H
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 940
0039 900000      E     MOV     DPTR,#pDevStatus1
003C E0                MOVX    A,@DPTR
003D 547F              ANL     A,#07FH
                                           ; SOURCE LINE # 941
                                           ; SOURCE LINE # 942
                                           ; SOURCE LINE # 943
003F 120000      R     LCALL   L?0240
0042 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 944
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 946
0045         ?C0161:
                                           ; SOURCE LINE # 948
0045 900000      E     MOV     DPTR,#SYS_MISC1
0048 E0                MOVX    A,@DPTR
0049 30E72C            JNB     ACC.7,?C0166
                                           ; SOURCE LINE # 949
                                           ; SOURCE LINE # 950
004C 900000      E     MOV     DPTR,#pDevStatus2
004F E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 48  

0050 20E125            JB      ACC.1,?C0166
0053 900000      E     MOV     DPTR,#pDevStatus1
0056 E0                MOVX    A,@DPTR
0057 30E51E            JNB     ACC.5,?C0166
005A E0                MOVX    A,@DPTR
005B 30E71A            JNB     ACC.7,?C0166
                                           ; SOURCE LINE # 952
                                           ; SOURCE LINE # 953
005E 7F3E              MOV     R7,#03EH
0060 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 955
                                           ; SOURCE LINE # 956
0063 120000      R     LCALL   L?0255
0066 30E706            JNB     ACC.7,?C0168
                                           ; SOURCE LINE # 957
                                           ; SOURCE LINE # 958
0069 E0                MOVX    A,@DPTR
006A 4480              ORL     A,#080H
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 959
006D 8004              SJMP    ?C0169
006F         ?C0168:
                                           ; SOURCE LINE # 961
                                           ; SOURCE LINE # 962
006F E0                MOVX    A,@DPTR
0070 547F              ANL     A,#07FH
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 963
0073         ?C0169:
                                           ; SOURCE LINE # 965
0073 7FBE              MOV     R7,#0BEH
0075 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 966
                                           ; SOURCE LINE # 967
0078         ?C0166:
                                           ; SOURCE LINE # 969
0078 900000      E     MOV     DPTR,#pDevStatus2
007B E0                MOVX    A,@DPTR
007C 54FB              ANL     A,#0FBH
007E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 971
007F E0                MOVX    A,@DPTR
0080 20E119            JB      ACC.1,?C0172
                                           ; SOURCE LINE # 972
                                           ; SOURCE LINE # 973
0083 900000      E     MOV     DPTR,#pDevStatus1
0086 E0                MOVX    A,@DPTR
0087 54FB              ANL     A,#0FBH
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
008A 7FB5              MOV     R7,#0B5H
008C 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 977
008F 120000      E     LCALL   Enable_Any_Key_Irq
                                           ; SOURCE LINE # 978
0092 900000      E     MOV     DPTR,#SysPowState
0095 E0                MOVX    A,@DPTR
0096 B43303            CJNE    A,#033H,?C0172
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
0099 120000      E     LCALL   InterKBDWakeEnable
                                           ; SOURCE LINE # 981
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 49  

                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
                                           ; SOURCE LINE # 984
009C         ?C0172:
009C 22                RET     
             ; FUNCTION LID_PAD_Released (END)

             ; FUNCTION _EventManager (BEGIN)
                                           ; SOURCE LINE # 1014
0000 900000      R     MOV     DPTR,#device_id
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1015
                                           ; SOURCE LINE # 1019
0005 B40A00            CJNE    A,#0AH,?C0220
0008         ?C0220:
0008 4003              JC      $ + 5H
000A 020000      R     LJMP    ?C0204
000D 900000      R     MOV     DPTR,#?C0221
0010 F8                MOV     R0,A
0011 28                ADD     A,R0
0012 28                ADD     A,R0
0013 73                JMP     @A+DPTR
0014         ?C0221:
0014 020000      R     LJMP    ?C0174
0017 020000      R     LJMP    ?C0179
001A 020000      R     LJMP    ?C0182
001D 020000      R     LJMP    ?C0185
0020 020000      R     LJMP    ?C0202
0023 020000      R     LJMP    ?C0189
0026 020000      R     LJMP    ?C0196
0029 020000      R     LJMP    ?C0202
002C 020000      R     LJMP    ?C0202
002F 020000      R     LJMP    ?C0202
                                           ; SOURCE LINE # 1020
                                           ; SOURCE LINE # 1021
0032         ?C0174:
                                           ; SOURCE LINE # 1022
0032 900000      E     MOV     DPTR,#GPDRB
0035 E0                MOVX    A,@DPTR
0036 20E30A            JB      ACC.3,?C0175
0039 900000      E     MOV     DPTR,#GPDRJ
003C E0                MOVX    A,@DPTR
003D 20E003            JB      ACC.0,$ + 6H
0040 020000      R     LJMP    ?C0176
0043         ?C0175:
                                           ; SOURCE LINE # 1023
0043 900000      E     MOV     DPTR,#GPDRB
0046 E0                MOVX    A,@DPTR
0047 20E304            JB      ACC.3,?C0177
004A 7F01              MOV     R7,#01H
004C 8062              SJMP    ?C0231
004E         ?C0177:
004E 7F00              MOV     R7,#00H
0050         ?C0178:
                                           ; SOURCE LINE # 1041
0050 805E              SJMP    ?C0231
                                           ; SOURCE LINE # 1043
0052         ?C0179:
                                           ; SOURCE LINE # 1044
0052 900000      E     MOV     DPTR,#GPDRB
0055 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 50  

0056 30E004            JNB     ACC.0,?C0180
0059 7F01              MOV     R7,#01H
005B 8002              SJMP    ?C0181
005D         ?C0180:
005D 7F00              MOV     R7,#00H
005F         ?C0181:
005F         ?C0226:
                                           ; SOURCE LINE # 1045
005F 804F              SJMP    ?C0231
                                           ; SOURCE LINE # 1047
0061         ?C0182:
                                           ; SOURCE LINE # 1052
0061 900000      E     MOV     DPTR,#GPDRI
0064 E0                MOVX    A,@DPTR
0065 20E204            JB      ACC.2,?C0183
0068 7F01              MOV     R7,#01H
006A 8002              SJMP    ?C0184
006C         ?C0183:
006C 7F00              MOV     R7,#00H
006E         ?C0184:
006E         ?C0227:
                                           ; SOURCE LINE # 1053
006E 8040              SJMP    ?C0231
                                           ; SOURCE LINE # 1055
0070         ?C0185:
                                           ; SOURCE LINE # 1068
0070 900000      E     MOV     DPTR,#GPDRJ
0073 E0                MOVX    A,@DPTR
0074 20E004            JB      ACC.0,?C0186
0077 7F01              MOV     R7,#01H
0079 8002              SJMP    ?C0187
007B         ?C0186:
007B 7F00              MOV     R7,#00H
007D         ?C0187:
007D         ?C0228:
                                           ; SOURCE LINE # 1069
007D 8031              SJMP    ?C0231
                                           ; SOURCE LINE # 1071
                                           ; SOURCE LINE # 1079
007F         ?C0189:
                                           ; SOURCE LINE # 1081
007F 900000      E     MOV     DPTR,#SysStatus
0082 E0                MOVX    A,@DPTR
0083 20E715            JB      ACC.7,?C0190
                                           ; SOURCE LINE # 1082
                                           ; SOURCE LINE # 1084
0086 900000      E     MOV     DPTR,#GPDRB
0089 E0                MOVX    A,@DPTR
008A 30E103            JNB     ACC.1,?C0193
008D D3                SETB    C
008E 8001              SJMP    ?C0194
0090         ?C0193:
0090 C3                CLR     C
0091         ?C0194:
0091 4004              JC      ?C0191
0093 7F01              MOV     R7,#01H
0095 8002              SJMP    ?C0192
0097         ?C0191:
0097 7F00              MOV     R7,#00H
0099         ?C0192:
0099         ?C0229:
                                           ; SOURCE LINE # 1088
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 51  

0099 8015              SJMP    ?C0231
009B         ?C0190:
                                           ; SOURCE LINE # 1090
                                           ; SOURCE LINE # 1091
009B         ?C0230:
                                           ; SOURCE LINE # 1092
                                           ; SOURCE LINE # 1093
009B 801C              SJMP    ?C0235
                                           ; SOURCE LINE # 1095
009D         ?C0196:
                                           ; SOURCE LINE # 1097
009D 900000      E     MOV     DPTR,#GPDRF
00A0 E0                MOVX    A,@DPTR
00A1 30E403            JNB     ACC.4,?C0199
00A4 D3                SETB    C
00A5 8001              SJMP    ?C0200
00A7         ?C0199:
00A7 C3                CLR     C
00A8         ?C0200:
00A8 4004              JC      ?C0197
00AA 7F01              MOV     R7,#01H
00AC 8002              SJMP    ?C0198
00AE         ?C0197:
00AE 7F00              MOV     R7,#00H
00B0         ?C0198:
00B0         ?C0231:
00B0 900000      R     MOV     DPTR,#new_state
00B3 EF                MOV     A,R7
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1098
00B5 8007              SJMP    ?C0173
                                           ; SOURCE LINE # 1101
                                           ; SOURCE LINE # 1105
00B7         ?C0202:
                                           ; SOURCE LINE # 1106
00B7         ?C0233:
                                           ; SOURCE LINE # 1107
00B7 8000              SJMP    ?C0235
                                           ; SOURCE LINE # 1109
                                           ; SOURCE LINE # 1113
00B9         ?C0204:
                                           ; SOURCE LINE # 1114
00B9         ?C0235:
00B9 E4                CLR     A
00BA 900000      R     MOV     DPTR,#new_state
00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
00BE         ?C0173:
                                           ; SOURCE LINE # 1118
00BE 900000      R     MOV     DPTR,#device_id
00C1 E0                MOVX    A,@DPTR
00C2 FF                MOV     R7,A
00C3 75F00C            MOV     B,#0CH
00C6 A4                MUL     AB
00C7 2400        R     ADD     A,#LOW Debounce_TBL
00C9 F582              MOV     DPL,A
00CB E4                CLR     A
00CC 3400        R     ADDC    A,#HIGH Debounce_TBL
00CE F583              MOV     DPH,A
00D0 E4                CLR     A
00D1 93                MOVC    A,@A+DPTR
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 52  

00D2 FC                MOV     R4,A
00D3 7401              MOV     A,#01H
00D5 93                MOVC    A,@A+DPTR
00D6 FD                MOV     R5,A
00D7 7800        E     MOV     R0,#LOW Tmp_XPntr
00D9 EC                MOV     A,R4
00DA F6                MOV     @R0,A
00DB 08                INC     R0
00DC ED                MOV     A,R5
00DD F6                MOV     @R0,A
                                           ; SOURCE LINE # 1119
00DE EF                MOV     A,R7
00DF 75F00C            MOV     B,#0CH
00E2 A4                MUL     AB
00E3 2400        R     ADD     A,#LOW Debounce_TBL+03H
00E5 F582              MOV     DPL,A
00E7 E4                CLR     A
00E8 3400        R     ADDC    A,#HIGH Debounce_TBL+03H
00EA F583              MOV     DPH,A
00EC E4                CLR     A
00ED 93                MOVC    A,@A+DPTR
00EE FF                MOV     R7,A
00EF 7401              MOV     A,#01H
00F1 93                MOVC    A,@A+DPTR
00F2 7800        E     MOV     R0,#LOW Tmp_XPntr1
00F4 CF                XCH     A,R7
00F5 F6                MOV     @R0,A
00F6 08                INC     R0
00F7 EF                MOV     A,R7
00F8 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1120
00F9 900000      R     MOV     DPTR,#device_id
00FC E0                MOVX    A,@DPTR
00FD F9                MOV     R1,A
00FE 75F00C            MOV     B,#0CH
0101 A4                MUL     AB
0102 2400        R     ADD     A,#LOW Debounce_TBL+02H
0104 F582              MOV     DPL,A
0106 E4                CLR     A
0107 3400        R     ADDC    A,#HIGH Debounce_TBL+02H
0109 F583              MOV     DPH,A
010B E4                CLR     A
010C 93                MOVC    A,@A+DPTR
010D FF                MOV     R7,A
010E 900000      R     MOV     DPTR,#device_flag
0111 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1122
0112 8D82              MOV     DPL,R5
0114 8C83              MOV     DPH,R4
0116 E0                MOVX    A,@DPTR
0117 5F                ANL     A,R7
0118 6004              JZ      ?C0205
011A 7F01              MOV     R7,#01H
011C 8002              SJMP    ?C0206
011E         ?C0205:
011E 7F00              MOV     R7,#00H
0120         ?C0206:
;---- Variable 'old_state' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1123
0120 900000      R     MOV     DPTR,#new_state
0123 E0                MOVX    A,@DPTR
0124 FE                MOV     R6,A
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 53  

0125 6F                XRL     A,R7
0126 7003              JNZ     $ + 5H
0128 020000      R     LJMP    ?C0207
                                           ; SOURCE LINE # 1124
                                           ; SOURCE LINE # 1125
012B 7800        E     MOV     R0,#LOW Tmp_XPntr1
012D E6                MOV     A,@R0
012E FC                MOV     R4,A
012F 08                INC     R0
0130 E6                MOV     A,@R0
0131 FD                MOV     R5,A
0132 F582              MOV     DPL,A
0134 8C83              MOV     DPH,R4
0136 E0                MOVX    A,@DPTR
0137 7018              JNZ     ?C0208
                                           ; SOURCE LINE # 1126
                                           ; SOURCE LINE # 1132
0139 E9                MOV     A,R1
013A 75F00C            MOV     B,#0CH
013D A4                MUL     AB
013E 2400        R     ADD     A,#LOW Debounce_TBL+05H
0140 F582              MOV     DPL,A
0142 E4                CLR     A
0143 3400        R     ADDC    A,#HIGH Debounce_TBL+05H
0145 F583              MOV     DPH,A
0147 E4                CLR     A
0148 93                MOVC    A,@A+DPTR
0149 8D82              MOV     DPL,R5
014B 8C83              MOV     DPH,R4
014D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1133
014E 020000      R     LJMP    ?C0213
0151         ?C0208:
                                           ; SOURCE LINE # 1135
                                           ; SOURCE LINE # 1136
0151 7800        E     MOV     R0,#LOW Tmp_XPntr1
0153 E6                MOV     A,@R0
0154 FC                MOV     R4,A
0155 08                INC     R0
0156 E6                MOV     A,@R0
0157 F582              MOV     DPL,A
0159 8C83              MOV     DPH,R4
015B E0                MOVX    A,@DPTR
015C 14                DEC     A
015D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1138
015E E0                MOVX    A,@DPTR
015F 6003              JZ      $ + 5H
0161 020000      R     LJMP    ?C0213
                                           ; SOURCE LINE # 1139
                                           ; SOURCE LINE # 1140
0164 EE                MOV     A,R6
0165 6034              JZ      ?C0211
                                           ; SOURCE LINE # 1141
                                           ; SOURCE LINE # 1142
0167 E9                MOV     A,R1
0168 75F00C            MOV     B,#0CH
016B A4                MUL     AB
016C 2400        R     ADD     A,#LOW Debounce_TBL+06H
016E F582              MOV     DPL,A
0170 E4                CLR     A
0171 3400        R     ADDC    A,#HIGH Debounce_TBL+06H
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 54  

0173 F583              MOV     DPH,A
0175 E4                CLR     A
0176 93                MOVC    A,@A+DPTR
0177 FE                MOV     R6,A
0178 7401              MOV     A,#01H
017A 93                MOVC    A,@A+DPTR
017B CA                XCH     A,R2
017C EE                MOV     A,R6
017D CA                XCH     A,R2
017E F9                MOV     R1,A
017F 120000      E     LCALL   ?C?ICALL
                                           ; SOURCE LINE # 1143
0182 7800        E     MOV     R0,#LOW Tmp_XPntr
0184 E6                MOV     A,@R0
0185 FE                MOV     R6,A
0186 08                INC     R0
0187 E6                MOV     A,@R0
0188 F582              MOV     DPL,A
018A 8E83              MOV     DPH,R6
018C C083              PUSH    DPH
018E C082              PUSH    DPL
0190 E0                MOVX    A,@DPTR
0191 FF                MOV     R7,A
0192 900000      R     MOV     DPTR,#device_flag
0195 E0                MOVX    A,@DPTR
0196 FE                MOV     R6,A
0197 EF                MOV     A,R7
0198 4E                ORL     A,R6
                                           ; SOURCE LINE # 1144
0199 8036              SJMP    ?C0225
019B         ?C0211:
                                           ; SOURCE LINE # 1146
                                           ; SOURCE LINE # 1147
019B 900000      R     MOV     DPTR,#device_id
019E E0                MOVX    A,@DPTR
019F 75F00C            MOV     B,#0CH
01A2 A4                MUL     AB
01A3 2400        R     ADD     A,#LOW Debounce_TBL+08H
01A5 F582              MOV     DPL,A
01A7 E4                CLR     A
01A8 3400        R     ADDC    A,#HIGH Debounce_TBL+08H
01AA F583              MOV     DPH,A
01AC E4                CLR     A
01AD 93                MOVC    A,@A+DPTR
01AE FE                MOV     R6,A
01AF 7401              MOV     A,#01H
01B1 93                MOVC    A,@A+DPTR
01B2 CA                XCH     A,R2
01B3 EE                MOV     A,R6
01B4 CA                XCH     A,R2
01B5 F9                MOV     R1,A
01B6 120000      E     LCALL   ?C?ICALL
                                           ; SOURCE LINE # 1148
01B9 7800        E     MOV     R0,#LOW Tmp_XPntr
01BB E6                MOV     A,@R0
01BC FE                MOV     R6,A
01BD 08                INC     R0
01BE E6                MOV     A,@R0
01BF F582              MOV     DPL,A
01C1 8E83              MOV     DPH,R6
01C3 C083              PUSH    DPH
01C5 C082              PUSH    DPL
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 55  

01C7 E0                MOVX    A,@DPTR
01C8 FF                MOV     R7,A
01C9 900000      R     MOV     DPTR,#device_flag
01CC E0                MOVX    A,@DPTR
01CD F4                CPL     A
01CE FE                MOV     R6,A
01CF EF                MOV     A,R7
01D0 5E                ANL     A,R6
01D1         ?C0225:
01D1 D082              POP     DPL
01D3 D083              POP     DPH
01D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1149
                                           ; SOURCE LINE # 1150
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
01D6 800C              SJMP    ?C0213
01D8         ?C0207:
                                           ; SOURCE LINE # 1154
                                           ; SOURCE LINE # 1155
01D8 7800        E     MOV     R0,#LOW Tmp_XPntr1
01DA E6                MOV     A,@R0
01DB FE                MOV     R6,A
01DC 08                INC     R0
01DD E6                MOV     A,@R0
01DE F582              MOV     DPL,A
01E0 8E83              MOV     DPH,R6
01E2 E4                CLR     A
01E3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1156
01E4         ?C0213:
                                           ; SOURCE LINE # 1158
01E4 900000      R     MOV     DPTR,#device_id
01E7 E0                MOVX    A,@DPTR
01E8 75F00C            MOV     B,#0CH
01EB A4                MUL     AB
01EC 2400        R     ADD     A,#LOW Debounce_TBL+0AH
01EE F582              MOV     DPL,A
01F0 E4                CLR     A
01F1 3400        R     ADDC    A,#HIGH Debounce_TBL+0AH
01F3 F583              MOV     DPH,A
01F5 E4                CLR     A
01F6 93                MOVC    A,@A+DPTR
01F7 FE                MOV     R6,A
01F8 7401              MOV     A,#01H
01FA 93                MOVC    A,@A+DPTR
01FB CA                XCH     A,R2
01FC EE                MOV     A,R6
01FD CA                XCH     A,R2
01FE F9                MOV     R1,A
01FF 120000      E     LCALL   ?C?ICALL
                                           ; SOURCE LINE # 1159
0202         ?C0176:
0202 22                RET     
             ; FUNCTION _EventManager (END)

             ; FUNCTION PowerBottonEvent (BEGIN)
                                           ; SOURCE LINE # 1161
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
0000 900000      E     MOV     DPTR,#SysStatus2
0003 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_EVENT                                                             09/14/2018 11:08:13 PAGE 56  

0004 30E01A            JNB     ACC.0,?C0216
                                           ; SOURCE LINE # 1164
0007 900000      E     MOV     DPTR,#PWRBTN_press_debounce
000A E0                MOVX    A,@DPTR
000B 04                INC     A
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1165
000D E0                MOVX    A,@DPTR
000E C3                CLR     C
000F 9401              SUBB    A,#01H
0011 400E              JC      ?C0216
                                           ; SOURCE LINE # 1166
                                           ; SOURCE LINE # 1167
0013 E4                CLR     A
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1168
0015 900000      E     MOV     DPTR,#SysStatus2
0018 E0                MOVX    A,@DPTR
0019 54FE              ANL     A,#0FEH
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1169
001C 7F32              MOV     R7,#032H
001E 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
                                           ; SOURCE LINE # 1172
0021         ?C0216:
0021 22                RET     
             ; FUNCTION PowerBottonEvent (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2497    ----
   CONSTANT SIZE    =    120    ----
   XDATA SIZE       =   ----       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
