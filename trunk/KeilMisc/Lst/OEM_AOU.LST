C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_AOU
OBJECT MODULE PLACED IN Code\Oem\OEM_AOU.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\Oem\OEM_AOU.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_AOU.C
   3           * TITLE: OEM_AOU.H
   4           *
   5           * Author : Ivan Chen
   6           *
   7           * spec : Always On USB Ver5 Specification V1.2
   8          *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          #if Support_AOU5_V1_2
  14          // Always On USB Ver5 Specification Rev1.2 (Draft 2013-08-28).pdf
  15          // Table 6. Condition of default setting (enabled)
  16          // ------------------------------------------------------------
  17          //                        |   S0   |   S3   |   S4   |   S5   |
  18          // -------------+---------+--------+--------+--------+--------|
  19          // AOU port     | AC mode | PwrCDP | PwrDCP | PwrDCP | PwrDCP |
  20          //              | DC mode | PwrCDP | PwrDCP | PwrOff | PwrOff |
  21          // -------------+---------+--------+--------+--------+--------|
  22          // Non-AOU port | AC mode | PwrSDP | PwrSDP | PwrOn  | PwrOn  |
  23          //              | DC mode | PwrSDP | PwrSDP | PwrOff | PwrOff |
  24          // -------------+---------+--------+--------+--------+---------
  25          
  26          // Always On USB Ver5 Specification Rev1.2 (Draft 2013-08-28).pdf
  27          // Table 8. Condition of disabled AOU
  28          // ------------------------------------------------------------
  29          //                        |   S0   |   S3   |   S4   |   S5   |
  30          // -------------+---------+--------+--------+--------+--------|
  31          // AOU port     | AC mode | PwrSDP | PwrSDP | PwrOff | PwrOff |
  32          //              | DC mode | PwrSDP | PwrSDP | PwrOff | PwrOff |
  33          // -------------+---------+--------+--------+--------+--------|
  34          // Non-AOU port | AC mode | PwrSDP | PwrSDP | PwrOff | PwrOff |
  35          //              | DC mode | PwrSDP | PwrSDP | PwrOff | PwrOff |
  36          // -------------+---------+--------+--------+--------+---------
  37          static AOU_USB_PORT_POWER_TABLE code AouPortPowerTbl = {
  38            {    // S0    // S3    // S4_5
  39              {  PwrCDP,  PwrDCP,  PwrDCP  }, // AcEnMode  (Table 6.)
  40              {  PwrCDP,  PwrDCP,  PwrOff  }, // DcEnMode  (Table 6.)
  41              {  PwrSDP,  PwrSDP,  PwrOff  }, // AcDisMode (Table 8.)
  42              {  PwrSDP,  PwrSDP,  PwrOff  }, // DcDisMode (Table 8.)
  43            }
  44          };
  45          
  46          static AOU_USB_PORT_POWER_TABLE code NonAouPortPowerTbl = {
  47            {    // S0    // S3    // S4_5
  48              {  PwrSDP,  PwrSDP,  PwrOn   }, // AcEnMode  (Table 6.)
  49              {  PwrSDP,  PwrSDP,  PwrOff  }, // DcEnMode  (Table 6.)
  50              {  PwrSDP,  PwrSDP,  PwrOff  }, // AcDisMode (Table 8.)
  51              {  PwrSDP,  PwrSDP,  PwrOff  }, // DcDisMode (Table 8.)
  52            }
  53          };
  54          
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 2   

  55          
  56          // Always On USB Ver5 Specification Rev1.2 (Draft 2013-08-28).pdf
  57          // Table 7. AOU mode and the battery remaining for AOU disabling condition
  58          // ------------------------------------------------------------------------
  59          //                                 | 100%-16% | 15%-11% | 10%-6% | 5%-0%  |
  60          // -------------+------------------+----------+---------+--------+--------|
  61          // AOU port     | S0               | PwrCDP   | PwrCDP  | PwrCDP | PwrCDP |
  62          //              | S3 w/ device     | PwrDCP   | PwrDCP  | PwrSDP | PwrOff |
  63          //              | S3 w/o device    | PwrDCP   | PwrSDP  | PwrSDP | PwrOff |
  64          //              | S4/S5 w/ device  | PwrDCP   | PwrDCP  | PwrOff | PwrOff |
  65          //              | S4/S5 w/o device | PwrDCP   | PwrOff  | PwrOff | PwrOff |
  66          // -------------+------------------+----------+---------+--------+--------|
  67          // Non-AOU port | S0               | PwrSDP   | PwrSDP  | PwrSDP | PwrSDP |
  68          //              | S3 w/ device     | PwrSDP   | PwrSDP  | PwrSDP | PwrOff |
  69          //              | S3 w/o device    | PwrSDP   | PwrSDP  | PwrSDP | PwrOff |
  70          //              | S4/S5 w/ device  | PwrOff   | PwrOff  | PwrOff | PwrOff |
  71          //              | S4/S5 w/o device | PwrOff   | PwrOff  | PwrOff | PwrOff |
  72          // -------------+------------------+----------+---------+--------+---------
  73          
  74          static AOU_BATT_PERCENT_TABLE code AouBattDcPercentTbl[5] = {
  75            // AOU port
  76               // 100%-16%   // 15%-11%    // 10%-6%     // 5%-0%
  77            {  PwrCDP      , PwrCDP      , PwrCDP      , PwrCDP  },  // S0
  78            {  PwrDCP      , PwrDCP      , PwrSDP      , PwrOff  },  // S3 w/ device
  79            {  PwrDCP      , PwrSDP      , PwrSDP      , PwrOff  },  // S3 w/o device
  80            {  PwrDCP      , PwrDCP      , PwrOff      , PwrOff  },  // S4/S5 w/ device
  81            {  PwrDCP      , PwrOff      , PwrOff      , PwrOff  }   // S4/S5 w/o device
  82          };
  83          
  84          static AOU_BATT_PERCENT_TABLE  code NonAouDcBattPercentTbl[5] = {
  85            // Non-AOU port
  86               // 100%-16%   // 15%-11%    // 10%-6%     // 5%-0%
  87            {  PwrSDP      , PwrSDP      , PwrSDP      , PwrSDP  },  // S0
  88            {  PwrSDP      , PwrSDP      , PwrSDP      , PwrOff  },  // S3 w/ device
  89            {  PwrSDP      , PwrSDP      , PwrSDP      , PwrOff  },  // S3 w/o device
  90            {  PwrOff      , PwrOff      , PwrOff      , PwrOff  },  // S4/S5 w/ device
  91            {  PwrOff      , PwrOff      , PwrOff      , PwrOff  }   // S4/S5 w/o device
  92          };
  93          
  94          // Truth Table of AOU_CTL1 & AOU_CTL3 (from TPS2546 specification)
  95          // Note that, we assume AOU_CTL2 and ILIM_SEL are dedicated be 1 in actual circuit.
  96          //
  97          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
  98          // | AOU_CTL1 | AOU_CTL3 |  Comment                                                                       
             -                |
  99          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
 100          // |    0     |    0     |  SDP1, keyboard/mouse wake-up (S3)                                             
             -                |
 101          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
 102          // |    0     |    1     |  DCP_Auto, keyboard/mouse wake up, load detection with ILIM_LO + 60 mA threshol
             -ds (S3)         |
 103          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
 104          // |    1     |    0     |  SDP1 (S0)                                                                     
             -                |
 105          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
 106          // |    1     |    1     |  CDP, load detection with ILIM_LO + 60mA thresholds or if a BC1.2 primary detec
             -tion occurs (S0)|
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 3   

 107          // +----------+----------+--------------------------------------------------------------------------------
             -----------------+
 108          //
 109          void AouSdpModeS3 (
 110          ) {
 111   1      CHG_MOD1_LOW();
 112   1      CHG_MOD3_LOW();
 113   1      }
 114          
 115          void AouDcpMode(
 116          ) {
 117   1      CHG_MOD1_LOW();
 118   1      CHG_MOD3_HI();
 119   1      }
 120          
 121          void AouSdpModeS0(
 122          ) { 
 123   1      CHG_MOD1_HI();
 124   1      CHG_MOD3_LOW();
 125   1      }
 126          
 127          void AouCdpMode(
 128          ) {
 129   1      CHG_MOD1_HI();
 130   1      CHG_MOD3_HI();
 131   1      }
 132          //Modify USB charge setting in DC S5.
 133          void AouPowoffMode(
 134          )
 135          {
 136   1      CHG_MOD1_LOW();
 137   1      CHG_MOD3_LOW();
 138   1      
 139   1      }
 140          //Modify USB charge setting in DC S5.
 141          void GetSystemSxType (
 142            AOU_SX_MODE     *AouSxMode
 143          ) {
 144   1        switch (SysPowState) {
 145   2          case SYSTEM_S0:
 146   2            *AouSxMode = S0PwrMode;
 147   2            break;
 148   2      
 149   2          case SYSTEM_S3:
 150   2          case SYSTEM_S0_S3:
 151   2            *AouSxMode = S3PwrMode;
 152   2            break;
 153   2      
 154   2          case SYSTEM_S4:
 155   2          case SYSTEM_S5:
 156   2              case SYSTEM_DSX://modify USB charge setting.
 157   2          case SYSTEM_S0_S4:
 158   2          case SYSTEM_S0_S5:
 159   2              case SYSTEM_S5_DSX://modify USB charge setting.
 160   2                      
 161   2            *AouSxMode = S4_5PwrMode;
 162   2            break;
 163   2        }
 164   1      }
 165          
 166          AOU_USB_POWER_MODE  DetectAouUsbPwrMode (
 167            AOU_USB_PORT_MODE UsbPortMode
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 4   

 168          ) {
 169   1        AOU_USB_POWER_MODE  UsbPowerMode;
 170   1        AOU_STATE           AouState;
 171   1        AOU_SX_MODE         AouSxMode;
 172   1      
 173   1        GetSystemSxType (&AouSxMode);
 174   1        if (SYS_IS_AC_MODE) {
 175   2          // System is in AC mode
 176   2          if (IS_MASK_SET(EMStatusBit,b1SetUSBChgEn)) {
 177   3            // AOU AC enabled
 178   3            AouState = AcEnMode;
 179   3          } else {
 180   3            // AOU disabled
 181   3            AouState = AcDisMode;
 182   3          }
 183   2        } else {
 184   2          // System is in DC mode
 185   2          if (IS_MASK_CLEAR(EMStatusBit,b1SetUSBChgEn)){ 
 186   3            // AOU disabled
 187   3            AouState = DcDisMode;      
 188   3          } else {
 189   3            // AOU AC/DC enabled
 190   3            AouState = DcEnMode;
 191   3          }
 192   2        }
 193   1      
 194   1        GetSystemSxType (&AouSxMode);
 195   1        if (UsbPortMode == AOU_PORT) {
 196   2          UsbPowerMode = AouPortPowerTbl.PwrMode[AouState].Sx[AouSxMode];
 197   2        } else {
 198   2          UsbPowerMode = NonAouPortPowerTbl.PwrMode[AouState].Sx[AouSxMode];
 199   2        }
 200   1      
 201   1        return UsbPowerMode;  
 202   1      }
 203          
 204          AOU_USB_POWER_MODE  DetectAouDcUsbPwrMode (
 205            AOU_USB_PORT_MODE UsbPortMode
 206          ) {
 207   1        AOU_USB_POWER_MODE  UsbPowerMode;
 208   1        BYTE                AouBattIndex;
 209   1        BYTE                BattLevel;
 210   1        AOU_SX_MODE         AouSxMode;
 211   1        AOU_DC_SX_MODE      AouDcSxIndex;
 212   1      
 213   1        //
 214   1        // A debug flag for engineer to assign battery level directly for testing.
 215   1        //
 216   1        if (IS_MASK_SET (EC_AOU_DBG_FLAG, AOU_DC_LEVEL_DBG)) {
 217   2          BattLevel = (EC_AOU_DBG_FLAG & (~AOU_DC_LEVEL_DBG));
 218   2          if (BattLevel > 100) {
 219   3            //
 220   3            //  Max battery level is up to 100%.
 221   3            //
 222   3            BattLevel = 100;
 223   3          }
 224   2        } else {
 225   2          //
 226   2          //  Real battery level.
 227   2          //
 228   2          BattLevel = nBattGasgauge;
 229   2        }
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 5   

 230   1      
 231   1        AouBattIndex = 0; // Default 100%-16%
 232   1      
 233   1        if ((BattLevel <= 15) && (BattLevel >= 11)) {
 234   2          AouBattIndex = 1; // 15%-11%
 235   2        } 
 236   1        if ((BattLevel <= 10) && (BattLevel >= 5)) {
 237   2          AouBattIndex = 2; // 10%-5%
 238   2        } 
 239   1        if (BattLevel <= 5) {
 240   2          AouBattIndex = 3; // 5%-0%
 241   2        }
 242   1      
 243   1        GetSystemSxType (&AouSxMode);
 244   1        if (AouSxMode != S0PwrMode) {
 245   2          if (AouSxMode == S3PwrMode) {
 246   3            if (1) {
 247   4              AouDcSxIndex = S3DcPwrMode;
 248   4            } else {
 249   4              AouDcSxIndex = S3DcPwrModeNoDev;
 250   4            }      
 251   3          } else if (AouSxMode == S4_5PwrMode) {
 252   3            if (1) {
 253   4              AouDcSxIndex = S4_5DcPwrMode;
 254   4            } else {
 255   4              AouDcSxIndex = S4_5DcPwrModeNoDev;
 256   4            }
 257   3          }
 258   2        } else {
 259   2          AouDcSxIndex = S0DcPwrMode;
 260   2        };
 261   1      
 262   1        if (UsbPortMode == AOU_PORT) {
 263   2          UsbPowerMode = AouBattDcPercentTbl[AouDcSxIndex].AouBattLevel[AouBattIndex];
 264   2          if ((IS_MASK_CLEAR(EMStatusBit,b6RdUSBChgS45)) && (AouSxMode == S4_5PwrMode)) {    //disable charge wh
             -en S4/S5 and DC mode
 265   3          UsbPowerMode = PwrOff;
 266   3          }
 267   2        } else {
 268   2          UsbPowerMode = NonAouDcBattPercentTbl[AouDcSxIndex].AouBattLevel[AouBattIndex];
 269   2        }
 270   1      
 271   1        return UsbPowerMode;  
 272   1      }
 273          
 274          void  SetAouUsbPortMode (
 275            AOU_USB_PORT_MODE   UsbPortMode,
 276            AOU_USB_POWER_MODE  UsbPwrMode
 277          ) {
 278   1      //
 279   1      // Description:
 280   1      //      Handler for setting USB power mode.
 281   1      //
 282   1      // Arguments:
 283   1      //      UsbPortMode  - AOU_PORT or NON_AOU_PORT.
 284   1      //      UsbPwrMode   - There is PwrOff, PwrOn, PwrSDP, PwrCDP and PwrDCP for applying.
 285   1      //
 286   1      // Return:
 287   1      //      None.
 288   1      //
 289   1        if (UsbPortMode == AOU_PORT) {
 290   2          //
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 6   

 291   2          // AOU port
 292   2          //
 293   2      
 294   2          switch (UsbPwrMode) {
 295   3            case PwrOff:
 296   3             USB_CHG_EN_LOW();
 297   3             AouPowoffMode();//Modify USB charge setting in DC S5.
 298   3              RamDebug (0xF0);
 299   3              break;
 300   3      
 301   3            case PwrSDP:
 302   3              AouSdpModeS0();
 303   3                      USB_CHG_EN_HI();
 304   3              RamDebug (0xF1);
 305   3              break;
 306   3      
 307   3            case PwrCDP:
 308   3              AouCdpMode();
 309   3                      USB_CHG_EN_HI();
 310   3              RamDebug (0xF2);
 311   3              break;
 312   3      
 313   3            case PwrDCP:
 314   3              AouDcpMode();
 315   3                      USB_CHG_EN_HI();
 316   3              RamDebug (0xF3);
 317   3              break;     
 318   3          }
 319   2        } else {
 320   2          //
 321   2          // Non-AOU port
 322   2          //
 323   2          switch (UsbPwrMode) {
 324   3            case PwrOff:
 325   3              USB_ON_INPUT;
 326   3              break;
 327   3      
 328   3            case PwrSDP:
 329   3            case PwrCDP: // should not exist
 330   3            case PwrDCP: // should not exist
 331   3              USB_ON_OUTPUT;
 332   3              USB_ON_LOW();
 333   3              break;  
 334   3              }
 335   2              if(IS_MASK_SET(OEMControl,b4DisUSBpower))//HEGANGS026:Modify usb power setting when bios has detected the
             - wake up device
 336   2              {
 337   3                      if((SystemIsS3) && IS_MASK_CLEAR(EMStatusBit, b1SetUSBChgEn))
 338   3                      {
 339   4                              USB_ON_INPUT;
 340   4                      }
 341   3              }
 342   2        }
 343   1      }
 344          #endif
 345          
 346          
 347          //
 348          // Description:
 349          //      Main function of AOU processes.
 350          //
 351          // Arguments:
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 7   

 352          //      None.
 353          //
 354          // Return:
 355          //      None.
 356          //
 357          void AOU_Main (
 358            )
 359          {
 360   1      #if Support_AOU5_V1_2
 361   1      
 362   1        static AOU_USB_POWER_MODE  AouUsbPowerMode, NonAouUsbPowerMode;
 363   1        AOU_USB_POWER_MODE  PastAouUsbPowerMode, PastNonAouUsbPowerMode;
 364   1        //
 365   1        // To detect if device is connected to AOU port.
 366   1        //
 367   1      if(Read_AOU_DET()) {
 368   2          AOUPort_DevCLR;
 369   2              if(((SysPowState==SYSTEM_S0_S3)||(SysPowState==SYSTEM_S3))&&(AOU_IFG_Debounce_Cnt == 0))
 370   2              {
 371   3              AOU_IFG_Debounce_Cnt = 40;
 372   3              AOUPort_DevSET; //Work-around debounce 4 sec to avoid AOU charger IC need reset 3~4 sec and system as
             -k device stop charging
 373   3          }
 374   2          else if(AOU_IFG_Debounce_Cnt>0)
 375   2          {
 376   3              AOU_IFG_Debounce_Cnt--;
 377   3              AOUPort_DevSET; //Work-around debounce 4 sec to avoid AOU charger IC need reset 3~4 sec and system as
             -k device stop charging
 378   3          }
 379   2        } else {
 380   2          AOUPort_DevSET;
 381   2        }
 382   1      
 383   1        //
 384   1        // Save past power mode.
 385   1        //
 386   1        PastAouUsbPowerMode = AouUsbPowerMode;
 387   1        PastNonAouUsbPowerMode = NonAouUsbPowerMode;
 388   1      
 389   1        //
 390   1        // Cover AOU v5 1.2 Table6. and Table8.
 391   1        //
 392   1        AouUsbPowerMode = DetectAouUsbPwrMode(AOU_PORT);
 393   1        EC_AOU_PWR_TYPE = ((BYTE)AouUsbPowerMode) << 4;
 394   1      
 395   1        NonAouUsbPowerMode = DetectAouUsbPwrMode(NON_AOU_PORT);
 396   1        EC_AOU_PWR_TYPE += (BYTE)NonAouUsbPowerMode;
 397   1      
 398   1        //
 399   1        // Process the conditions of enabled setting for DC mode in the each battery remaining conditions.
 400   1        //
 401   1        if(!SYS_IS_AC_MODE) {
 402   2          //
 403   2          // DC mode && Battery is exist.
 404   2          //
 405   2          if (IS_MASK_SET(EMStatusBit,b1SetUSBChgEn)) {
 406   3            // AOU AC/DC enabled
 407   3            AouUsbPowerMode = DetectAouDcUsbPwrMode(AOU_PORT);
 408   3            EC_AOU_PWR_TYPE = ((BYTE)AouUsbPowerMode) << 4;
 409   3      
 410   3            NonAouUsbPowerMode = DetectAouDcUsbPwrMode(NON_AOU_PORT);
 411   3            EC_AOU_PWR_TYPE += (BYTE)NonAouUsbPowerMode;
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 8   

 412   3          }
 413   2        }
 414   1      
 415   1        if (IS_MASK_SET (USB_Charger, b2USB_TmlDis)) {
 416   2          //
 417   2          // Unexpected power shutdown by thermal issue.
 418   2          // (The user needs to take off all power of the system for recovery from the thermal issue)
 419   2          //
 420   2          AouUsbPowerMode = NonAouUsbPowerMode = PwrOff;
 421   2        }
 422   1        //
 423   1        // Avoid power mode switched too frequently.
 424   1        //
 425   1              else if(IS_MASK_SET(OEMControl,b4DisUSBpower))//HEGANGS026:Modify usb power setting when bios has detecte
             -d the wake up device
 426   1              {       
 427   2                      if((SystemIsS3) && IS_MASK_CLEAR(EMStatusBit, b1SetUSBChgEn))
 428   2                              {
 429   3                                      AouUsbPowerMode = NonAouUsbPowerMode =  PwrOff;
 430   3                              }
 431   2              }
 432   1        if (AouUsbPowerMode != PastAouUsbPowerMode) {
 433   2          SetAouUsbPortMode (AOU_PORT, AouUsbPowerMode);
 434   2        }
 435   1        if (NonAouUsbPowerMode != PastNonAouUsbPowerMode) {
 436   2          SetAouUsbPortMode (NON_AOU_PORT, NonAouUsbPowerMode);
 437   2        }
 438   1      
 439   1        
 440   1      #else
              #endif
 442   1      }
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 9   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0059 (BEGIN)
0000         L?0090:
0000         L?0091:
0000 F583              MOV     DPH,A
0002 E582              MOV     A,DPL
0004 2F                ADD     A,R7
0005 F582              MOV     DPL,A
0007 E4                CLR     A
0008 3583              ADDC    A,DPH
000A F583              MOV     DPH,A
000C E4                CLR     A
000D 93                MOVC    A,@A+DPTR
000E 22                RET     
000F         L?0092:
000F 900000      R     MOV     DPTR,#AouUsbPowerMode
0012 EF                MOV     A,R7
0013 F0                MOVX    @DPTR,A
0014 E0                MOVX    A,@DPTR
0015 C4                SWAP    A
0016 54F0              ANL     A,#0F0H
0018 900000      E     MOV     DPTR,#EC_AOU_PWR_TYPE
001B F0                MOVX    @DPTR,A
001C 7F01              MOV     R7,#01H
001E 22                RET     
001F         L?0093:
001F         L?0094:
001F 900000      E     MOV     DPTR,#GPDRF
0022 E0                MOVX    A,@DPTR
0023 54DF              ANL     A,#0DFH
0025 F0                MOVX    @DPTR,A
0026 E0                MOVX    A,@DPTR
0027 22                RET     
0028         L?0095:
0028         L?0096:
0028 900000      E     MOV     DPTR,#GPDRE
002B E0                MOVX    A,@DPTR
002C 4420              ORL     A,#020H
002E F0                MOVX    @DPTR,A
002F 22                RET     
0030         L?0097:
0030 900000      R     MOV     DPTR,#NonAouUsbPowerMode
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
0035 900000      E     MOV     DPTR,#EC_AOU_PWR_TYPE
0038 E0                MOVX    A,@DPTR
0039 2F                ADD     A,R7
003A F0                MOVX    @DPTR,A
003B 22                RET     
             ; FUNCTION Com0059 (END)

             ; FUNCTION AouSdpModeS3 (BEGIN)
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 112
0000 120000      R     LCALL   L?0093
0003 547F              ANL     A,#07FH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 10  

0006 22                RET     
             ; FUNCTION AouSdpModeS3 (END)

             ; FUNCTION AouDcpMode (BEGIN)
                                           ; SOURCE LINE # 115
                                           ; SOURCE LINE # 116
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 118
0000 120000      R     LCALL   L?0093
0003 4480              ORL     A,#080H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
0006 22                RET     
             ; FUNCTION AouDcpMode (END)

             ; FUNCTION AouSdpModeS0 (BEGIN)
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0000 900000      E     MOV     DPTR,#GPDRF
0003 E0                MOVX    A,@DPTR
0004 4420              ORL     A,#020H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 124
0007 E0                MOVX    A,@DPTR
0008 547F              ANL     A,#07FH
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 125
000B 22                RET     
             ; FUNCTION AouSdpModeS0 (END)

             ; FUNCTION AouCdpMode (BEGIN)
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
0000 900000      E     MOV     DPTR,#GPDRF
0003 E0                MOVX    A,@DPTR
0004 4420              ORL     A,#020H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 130
0007 E0                MOVX    A,@DPTR
0008 4480              ORL     A,#080H
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 131
000B 22                RET     
             ; FUNCTION AouCdpMode (END)

             ; FUNCTION AouPowoffMode (BEGIN)
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 137
0000 120000      R     LCALL   L?0094
0003 547F              ANL     A,#07FH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 139
0006 22                RET     
             ; FUNCTION AouPowoffMode (END)

             ; FUNCTION L?0098 (BEGIN)
0000 7B01              MOV     R3,#01H
0002 7A00        R     MOV     R2,#HIGH AouSxMode
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 11  

0004 7900        R     MOV     R1,#LOW AouSxMode
             ; FUNCTION _GetSystemSxType (BEGIN)
                                           ; SOURCE LINE # 141
;---- Variable 'AouSxMode' assigned to Register 'R1/R2/R3' ----
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 144
0006 900000      E     MOV     DPTR,#SysPowState
0009 E0                MOVX    A,@DPTR
000A 120000      E     LCALL   ?C?CCASE
000D 0000        R     DW      ?C0009
000F 03                DB      03H
0010 0000        R     DW      ?C0015
0012 04                DB      04H
0013 0000        R     DW      ?C0015
0015 05                DB      05H
0016 0000        R     DW      ?C0015
0018 06                DB      06H
0019 0000        R     DW      ?C0007
001B 10                DB      010H
001C 0000        R     DW      ?C0009
001E 33                DB      033H
001F 0000        R     DW      ?C0015
0021 44                DB      044H
0022 0000        R     DW      ?C0015
0024 55                DB      055H
0025 0000        R     DW      ?C0015
0027 66                DB      066H
0028 0000              DW      00H
002A 0000        R     DW      ?C0016
                                           ; SOURCE LINE # 145
002C         ?C0007:
                                           ; SOURCE LINE # 146
002C E4                CLR     A
                                           ; SOURCE LINE # 147
002D 8006              SJMP    ?C0080
                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
002F         ?C0009:
                                           ; SOURCE LINE # 151
002F 7401              MOV     A,#01H
0031         ?C0079:
                                           ; SOURCE LINE # 152
0031 8002              SJMP    ?C0080
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 158
                                           ; SOURCE LINE # 159
0033         ?C0015:
                                           ; SOURCE LINE # 161
0033 7402              MOV     A,#02H
0035         ?C0080:
0035 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 162
                                           ; SOURCE LINE # 163
                                           ; SOURCE LINE # 164
0038         ?C0016:
0038 22                RET     
             ; FUNCTION _GetSystemSxType (END)

             ; FUNCTION _DetectAouUsbPwrMode (BEGIN)
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 12  

                                           ; SOURCE LINE # 166
;---- Variable 'AouState' assigned to Register 'R6' ----
;---- Variable 'UsbPowerMode' assigned to Register 'R5' ----
;---- Variable 'UsbPortMode' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 168
                                           ; SOURCE LINE # 173
0000 120000      R     LCALL   L?0098
                                           ; SOURCE LINE # 174
0003 900000      E     MOV     DPTR,#SYS_STATUS
0006 E0                MOVX    A,@DPTR
0007 20E703            JB      ACC.7,?C0018
000A D3                SETB    C
000B 8001              SJMP    ?C0019
000D         ?C0018:
000D C3                CLR     C
000E         ?C0019:
000E 400F              JC      ?C0017
                                           ; SOURCE LINE # 176
0010 900000      E     MOV     DPTR,#EMStatusBit
0013 E0                MOVX    A,@DPTR
0014 30E104            JNB     ACC.1,?C0020
                                           ; SOURCE LINE # 178
0017 E4                CLR     A
0018 FE                MOV     R6,A
                                           ; SOURCE LINE # 179
0019 8011              SJMP    ?C0022
001B         ?C0020:
                                           ; SOURCE LINE # 181
001B 7E02              MOV     R6,#02H
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
001D 800D              SJMP    ?C0022
001F         ?C0017:
                                           ; SOURCE LINE # 185
001F 900000      E     MOV     DPTR,#EMStatusBit
0022 E0                MOVX    A,@DPTR
0023 20E104            JB      ACC.1,?C0023
                                           ; SOURCE LINE # 187
0026 7E03              MOV     R6,#03H
                                           ; SOURCE LINE # 188
0028 8002              SJMP    ?C0022
002A         ?C0023:
                                           ; SOURCE LINE # 190
002A 7E01              MOV     R6,#01H
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
002C         ?C0022:
                                           ; SOURCE LINE # 194
002C 120000      R     LCALL   L?0098
                                           ; SOURCE LINE # 195
002F EF                MOV     A,R7
0030 900000      R     MOV     DPTR,#AouSxMode
0033 7010              JNZ     ?C0025
                                           ; SOURCE LINE # 196
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 EE                MOV     A,R6
0038 75F003            MOV     B,#03H
003B A4                MUL     AB
003C 2400        R     ADD     A,#LOW AouPortPowerTbl
003E F582              MOV     DPL,A
0040 E4                CLR     A
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 13  

0041 3400        R     ADDC    A,#HIGH AouPortPowerTbl
                                           ; SOURCE LINE # 197
0043 800E              SJMP    ?C0081
0045         ?C0025:
                                           ; SOURCE LINE # 198
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 EE                MOV     A,R6
0048 75F003            MOV     B,#03H
004B A4                MUL     AB
004C 2400        R     ADD     A,#LOW NonAouPortPowerTbl
004E F582              MOV     DPL,A
0050 E4                CLR     A
0051 3400        R     ADDC    A,#HIGH NonAouPortPowerTbl
0053         ?C0081:
0053 120000      R     LCALL   L?0090
0056 FD                MOV     R5,A
                                           ; SOURCE LINE # 199
0057         ?C0026:
                                           ; SOURCE LINE # 201
0057 CF                XCH     A,R7
0058 ED                MOV     A,R5
0059 CF                XCH     A,R7
                                           ; SOURCE LINE # 202
005A         ?C0027:
005A 22                RET     
             ; FUNCTION _DetectAouUsbPwrMode (END)

             ; FUNCTION _DetectAouDcUsbPwrMode (BEGIN)
                                           ; SOURCE LINE # 204
;---- Variable 'BattLevel' assigned to Register 'R6' ----
;---- Variable 'AouDcSxIndex' assigned to Register 'R5' ----
0000 900000      R     MOV     DPTR,#UsbPortMode
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 216
0005 900000      E     MOV     DPTR,#EC_AOU_DBG_FLAG
0008 E0                MOVX    A,@DPTR
0009 30E70D            JNB     ACC.7,?C0028
                                           ; SOURCE LINE # 217
000C E0                MOVX    A,@DPTR
000D 547F              ANL     A,#07FH
000F FE                MOV     R6,A
                                           ; SOURCE LINE # 218
0010 D3                SETB    C
0011 9464              SUBB    A,#064H
0013 4009              JC      ?C0030
                                           ; SOURCE LINE # 222
0015 7E64              MOV     R6,#064H
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
0017 8005              SJMP    ?C0030
0019         ?C0028:
                                           ; SOURCE LINE # 228
0019 900000      E     MOV     DPTR,#nBattGasgauge
001C E0                MOVX    A,@DPTR
001D FE                MOV     R6,A
                                           ; SOURCE LINE # 229
001E         ?C0030:
                                           ; SOURCE LINE # 231
;---- Variable 'AouBattIndex' assigned to Register 'R7' ----
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 14  

001E E4                CLR     A
001F FF                MOV     R7,A
                                           ; SOURCE LINE # 233
0020 EE                MOV     A,R6
0021 D3                SETB    C
0022 940F              SUBB    A,#0FH
0024 5007              JNC     ?C0031
0026 EE                MOV     A,R6
0027 C3                CLR     C
0028 940B              SUBB    A,#0BH
002A 4001              JC      ?C0031
                                           ; SOURCE LINE # 234
002C 0F                INC     R7
                                           ; SOURCE LINE # 235
002D         ?C0031:
                                           ; SOURCE LINE # 236
002D EE                MOV     A,R6
002E D3                SETB    C
002F 940A              SUBB    A,#0AH
0031 5008              JNC     ?C0032
0033 EE                MOV     A,R6
0034 C3                CLR     C
0035 9405              SUBB    A,#05H
0037 4002              JC      ?C0032
                                           ; SOURCE LINE # 237
0039 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 238
003B         ?C0032:
                                           ; SOURCE LINE # 239
003B EE                MOV     A,R6
003C D3                SETB    C
003D 9405              SUBB    A,#05H
003F 5002              JNC     ?C0033
                                           ; SOURCE LINE # 240
0041 7F03              MOV     R7,#03H
                                           ; SOURCE LINE # 241
0043         ?C0033:
                                           ; SOURCE LINE # 243
0043 7B01              MOV     R3,#01H
0045 7A00        R     MOV     R2,#HIGH AouSxMode
0047 7900        R     MOV     R1,#LOW AouSxMode
0049 120000      R     LCALL   _GetSystemSxType
                                           ; SOURCE LINE # 244
004C 900000      R     MOV     DPTR,#AouSxMode
004F E0                MOVX    A,@DPTR
0050 FC                MOV     R4,A
0051 600F              JZ      ?C0034
                                           ; SOURCE LINE # 245
0053 B40104            CJNE    A,#01H,?C0035
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 247
0056 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 248
0058 800A              SJMP    ?C0042
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
                                           ; SOURCE LINE # 251
005A         ?C0035:
005A EC                MOV     A,R4
005B B40206            CJNE    A,#02H,?C0042
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 15  

005E 7D03              MOV     R5,#03H
                                           ; SOURCE LINE # 254
0060 8002              SJMP    ?C0042
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
                                           ; SOURCE LINE # 258
0062         ?C0034:
                                           ; SOURCE LINE # 259
0062 E4                CLR     A
0063 FD                MOV     R5,A
                                           ; SOURCE LINE # 260
0064         ?C0042:
                                           ; SOURCE LINE # 262
0064 900000      R     MOV     DPTR,#UsbPortMode
0067 E0                MOVX    A,@DPTR
0068 7024              JNZ     ?C0043
                                           ; SOURCE LINE # 263
006A ED                MOV     A,R5
006B 25E0              ADD     A,ACC
006D 25E0              ADD     A,ACC
006F 2400        R     ADD     A,#LOW AouBattDcPercentTbl
0071 F582              MOV     DPL,A
0073 E4                CLR     A
0074 3400        R     ADDC    A,#HIGH AouBattDcPercentTbl
0076 120000      R     LCALL   L?0090
0079 900000      R     MOV     DPTR,#UsbPowerMode
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
007D 900000      E     MOV     DPTR,#EMStatusBit
0080 E0                MOVX    A,@DPTR
0081 20E61D            JB      ACC.6,?C0045
0084 900000      R     MOV     DPTR,#AouSxMode
0087 E0                MOVX    A,@DPTR
0088 B40216            CJNE    A,#02H,?C0045
                                           ; SOURCE LINE # 265
008B E4                CLR     A
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 267
008C 800F              SJMP    ?C0082
008E         ?C0043:
                                           ; SOURCE LINE # 268
008E ED                MOV     A,R5
008F 25E0              ADD     A,ACC
0091 25E0              ADD     A,ACC
0093 2400        R     ADD     A,#LOW NonAouDcBattPercentTbl
0095 F582              MOV     DPL,A
0097 E4                CLR     A
0098 3400        R     ADDC    A,#HIGH NonAouDcBattPercentTbl
009A 120000      R     LCALL   L?0091
009D         ?C0082:
009D 900000      R     MOV     DPTR,#UsbPowerMode
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 269
00A1         ?C0045:
                                           ; SOURCE LINE # 271
00A1 900000      R     MOV     DPTR,#UsbPowerMode
00A4 E0                MOVX    A,@DPTR
00A5 FF                MOV     R7,A
                                           ; SOURCE LINE # 272
00A6         ?C0046:
00A6 22                RET     
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 16  

             ; FUNCTION _DetectAouDcUsbPwrMode (END)

             ; FUNCTION _SetAouUsbPortMode (BEGIN)
                                           ; SOURCE LINE # 274
0000 900000      R     MOV     DPTR,#UsbPwrMode
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
;---- Variable 'UsbPortMode' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 289
0005 EF                MOV     A,R7
0006 703B              JNZ     ?C0047
                                           ; SOURCE LINE # 294
0008 E0                MOVX    A,@DPTR
0009 14                DEC     A
000A 6018              JZ      ?C0050
000C 14                DEC     A
000D 601F              JZ      ?C0051
000F 14                DEC     A
0010 6026              JZ      ?C0052
0012 2403              ADD     A,#03H
0014 706A              JNZ     ?C0061
                                           ; SOURCE LINE # 295
0016         ?C0049:
                                           ; SOURCE LINE # 296
0016 900000      E     MOV     DPTR,#GPDRE
0019 E0                MOVX    A,@DPTR
001A 54DF              ANL     A,#0DFH
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 297
001D 120000      R     LCALL   AouPowoffMode
                                           ; SOURCE LINE # 298
0020 7FF0              MOV     R7,#0F0H
                                           ; SOURCE LINE # 299
0022 801C              SJMP    ?C0085
                                           ; SOURCE LINE # 301
0024         ?C0050:
                                           ; SOURCE LINE # 302
0024 120000      R     LCALL   AouSdpModeS0
                                           ; SOURCE LINE # 303
0027 120000      R     LCALL   L?0095
                                           ; SOURCE LINE # 304
002A 7FF1              MOV     R7,#0F1H
002C         ?C0083:
                                           ; SOURCE LINE # 305
002C 8012              SJMP    ?C0085
                                           ; SOURCE LINE # 307
002E         ?C0051:
                                           ; SOURCE LINE # 308
002E 120000      R     LCALL   AouCdpMode
                                           ; SOURCE LINE # 309
0031 120000      R     LCALL   L?0095
                                           ; SOURCE LINE # 310
0034 7FF2              MOV     R7,#0F2H
0036         ?C0084:
                                           ; SOURCE LINE # 311
0036 8008              SJMP    ?C0085
                                           ; SOURCE LINE # 313
0038         ?C0052:
                                           ; SOURCE LINE # 314
0038 120000      R     LCALL   AouDcpMode
                                           ; SOURCE LINE # 315
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 17  

003B 120000      R     LCALL   L?0096
                                           ; SOURCE LINE # 316
003E 7FF3              MOV     R7,#0F3H
0040         ?C0085:
0040 020000      E     LJMP    _RamDebug
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
0043         ?C0047:
                                           ; SOURCE LINE # 323
0043 900000      R     MOV     DPTR,#UsbPwrMode
0046 E0                MOVX    A,@DPTR
0047 14                DEC     A
0048 24FD              ADD     A,#0FDH
004A 500C              JNC     ?C0058
004C 2404              ADD     A,#04H
004E 7015              JNZ     ?C0054
                                           ; SOURCE LINE # 324
0050         ?C0055:
                                           ; SOURCE LINE # 325
0050 900000      E     MOV     DPTR,#GPCRD5
0053 7480              MOV     A,#080H
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
0056 800D              SJMP    ?C0054
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
0058         ?C0058:
                                           ; SOURCE LINE # 331
0058 900000      E     MOV     DPTR,#GPCRD5
005B 7440              MOV     A,#040H
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 332
005E 900000      E     MOV     DPTR,#GPDRD
0061 E0                MOVX    A,@DPTR
0062 54DF              ANL     A,#0DFH
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 333
                                           ; SOURCE LINE # 334
0065         ?C0054:
                                           ; SOURCE LINE # 335
0065 900000      E     MOV     DPTR,#OEMControl
0068 E0                MOVX    A,@DPTR
0069 30E414            JNB     ACC.4,?C0061
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
006C 900000      E     MOV     DPTR,#SysPowState
006F E0                MOVX    A,@DPTR
0070 B4330D            CJNE    A,#033H,?C0061
0073 900000      E     MOV     DPTR,#EMStatusBit
0076 E0                MOVX    A,@DPTR
0077 20E106            JB      ACC.1,?C0061
                                           ; SOURCE LINE # 338
                                           ; SOURCE LINE # 339
007A 900000      E     MOV     DPTR,#GPCRD5
007D 7480              MOV     A,#080H
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 342
                                           ; SOURCE LINE # 343
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 18  

0080         ?C0061:
0080 22                RET     
             ; FUNCTION _SetAouUsbPortMode (END)

             ; FUNCTION AOU_Main (BEGIN)
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 367
0000 900000      E     MOV     DPTR,#GPDRE
0003 E0                MOVX    A,@DPTR
0004 30E12B            JNB     ACC.1,?C0062
                                           ; SOURCE LINE # 368
0007 900000      E     MOV     DPTR,#AOU_status
000A E0                MOVX    A,@DPTR
000B 54FE              ANL     A,#0FEH
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
000E 900000      E     MOV     DPTR,#SysPowState
0011 E0                MOVX    A,@DPTR
0012 6403              XRL     A,#03H
0014 6004              JZ      ?C0064
0016 E0                MOVX    A,@DPTR
0017 B4330A            CJNE    A,#033H,?C0063
001A         ?C0064:
001A 900000      E     MOV     DPTR,#AOU_IFG_Debounce_Cnt
001D E0                MOVX    A,@DPTR
001E 7004              JNZ     ?C0063
                                           ; SOURCE LINE # 370
                                           ; SOURCE LINE # 371
0020 7428              MOV     A,#028H
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
0022 800B              SJMP    ?C0086
0024         ?C0063:
                                           ; SOURCE LINE # 374
0024 900000      E     MOV     DPTR,#AOU_IFG_Debounce_Cnt
0027 E0                MOVX    A,@DPTR
0028 D3                SETB    C
0029 9400              SUBB    A,#00H
002B 400C              JC      ?C0067
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
002D E0                MOVX    A,@DPTR
002E 14                DEC     A
002F         ?C0086:
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 377
                                           ; SOURCE LINE # 378
                                           ; SOURCE LINE # 379
0030 8000              SJMP    ?C0087
0032         ?C0062:
                                           ; SOURCE LINE # 380
0032         ?C0087:
0032 900000      E     MOV     DPTR,#AOU_status
0035 E0                MOVX    A,@DPTR
0036 4401              ORL     A,#01H
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 381
0039         ?C0067:
                                           ; SOURCE LINE # 386
0039 900000      R     MOV     DPTR,#AouUsbPowerMode
003C E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 19  

003D 900000      R     MOV     DPTR,#PastAouUsbPowerMode
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 387
0041 900000      R     MOV     DPTR,#NonAouUsbPowerMode
0044 E0                MOVX    A,@DPTR
0045 900000      R     MOV     DPTR,#PastNonAouUsbPowerMode
0048 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 392
0049 E4                CLR     A
004A FF                MOV     R7,A
004B 120000      R     LCALL   _DetectAouUsbPwrMode
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 395
004E 120000      R     LCALL   L?0092
0051 120000      R     LCALL   _DetectAouUsbPwrMode
                                           ; SOURCE LINE # 396
0054 120000      R     LCALL   L?0097
                                           ; SOURCE LINE # 401
0057 900000      E     MOV     DPTR,#SYS_STATUS
005A E0                MOVX    A,@DPTR
005B 20E703            JB      ACC.7,?C0069
005E D3                SETB    C
005F 8001              SJMP    ?C0070
0061         ?C0069:
0061 C3                CLR     C
0062         ?C0070:
0062 5015              JNC     ?C0068
                                           ; SOURCE LINE # 405
0064 900000      E     MOV     DPTR,#EMStatusBit
0067 E0                MOVX    A,@DPTR
0068 30E10E            JNB     ACC.1,?C0068
                                           ; SOURCE LINE # 407
006B E4                CLR     A
006C FF                MOV     R7,A
006D 120000      R     LCALL   _DetectAouDcUsbPwrMode
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 410
0070 120000      R     LCALL   L?0092
0073 120000      R     LCALL   _DetectAouDcUsbPwrMode
                                           ; SOURCE LINE # 411
0076 120000      R     LCALL   L?0097
                                           ; SOURCE LINE # 412
                                           ; SOURCE LINE # 413
0079         ?C0068:
                                           ; SOURCE LINE # 415
0079 900000      E     MOV     DPTR,#USB_Charger
007C E0                MOVX    A,@DPTR
007D 30E202            JNB     ACC.2,?C0072
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
0080 8015              SJMP    ?C0088
0082         ?C0072:
                                           ; SOURCE LINE # 425
0082 900000      E     MOV     DPTR,#OEMControl
0085 E0                MOVX    A,@DPTR
0086 30E417            JNB     ACC.4,?C0073
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 427
0089 900000      E     MOV     DPTR,#SysPowState
008C E0                MOVX    A,@DPTR
008D B43310            CJNE    A,#033H,?C0073
0090 900000      E     MOV     DPTR,#EMStatusBit
C51 COMPILER V8.12   OEM_AOU                                                               09/14/2018 11:08:45 PAGE 20  

0093 E0                MOVX    A,@DPTR
0094 20E109            JB      ACC.1,?C0073
                                           ; SOURCE LINE # 428
                                           ; SOURCE LINE # 429
0097         ?C0088:
0097 E4                CLR     A
0098 900000      R     MOV     DPTR,#NonAouUsbPowerMode
009B F0                MOVX    @DPTR,A
009C 900000      R     MOV     DPTR,#AouUsbPowerMode
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 430
                                           ; SOURCE LINE # 431
00A0         ?C0073:
                                           ; SOURCE LINE # 432
00A0 900000      R     MOV     DPTR,#PastAouUsbPowerMode
00A3 E0                MOVX    A,@DPTR
00A4 FF                MOV     R7,A
00A5 900000      R     MOV     DPTR,#AouUsbPowerMode
00A8 E0                MOVX    A,@DPTR
00A9 FD                MOV     R5,A
00AA 6F                XRL     A,R7
00AB 6005              JZ      ?C0076
                                           ; SOURCE LINE # 433
00AD E4                CLR     A
00AE FF                MOV     R7,A
00AF 120000      R     LCALL   _SetAouUsbPortMode
                                           ; SOURCE LINE # 434
00B2         ?C0076:
                                           ; SOURCE LINE # 435
00B2 900000      R     MOV     DPTR,#PastNonAouUsbPowerMode
00B5 E0                MOVX    A,@DPTR
00B6 FF                MOV     R7,A
00B7 900000      R     MOV     DPTR,#NonAouUsbPowerMode
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC 6F                XRL     A,R7
00BD 6005              JZ      ?C0078
                                           ; SOURCE LINE # 436
00BF 7F01              MOV     R7,#01H
00C1 120000      R     LCALL   _SetAouUsbPortMode
                                           ; SOURCE LINE # 437
                                           ; SOURCE LINE # 442
00C4         ?C0078:
00C4 22                RET     
             ; FUNCTION AOU_Main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    746    ----
   CONSTANT SIZE    =     64    ----
   XDATA SIZE       =      2       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
