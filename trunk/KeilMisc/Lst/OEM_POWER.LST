C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_POWER
OBJECT MODULE PLACED IN Code\OEM\OEM_POWER.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_POWER.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\I
                    -NCLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*----------------------------------------------------------------------------
   2           * Filename: OEM_Power.C  For Chipset: ITE.IT85XX
   3           *
   4           * Function: Power sequnce control function example
   5           *
   6           * Author  : Dino
   7           *
   8           * Copyright (c) 2009 - , ITE Tech. Inc. All Rights Reserved.
   9           *
  10           * Note : These functions are reference only.
  11           *        Please follow your project software specification to do some modification.
  12           *---------------------------------------------------------------------------*/
  13          
  14          #include <CORE_INCLUDE.H>
  15          #include <OEM_INCLUDE.H>
  16          
  17          // ----------------------------------------------------------------------------
  18          // To read variable [RSTStatus] to get EC reset source
  19          // ----------------------------------------------------------------------------
  20          void CheckResetSource(void)
  21          {
  22   1      //add debug information for EC reset status(1.external watch-dog, 2.internal watch-dog; 3. EC VSTBY or WRS
             -T reset,4.EC code reset).
  23   1              RamDebug(0xBB); //ANGELAS089:add
  24   1              RamDebug(RSTStatus);
  25   1              RamDebug(GPCRA0);
  26   1              RamDebug(PWRSW8SRST);  //ANGELAS089:add
  27   1              RamDebug(0xBB);     //ANGELAS089:add
  28   1              switch(RSTStatus&0x03)
  29   1              {
  30   2              case 0:
  31   2              case 1:
  32   2                      if(GPCRA0==0x80)
  33   2                      {
  34   3                              ShutDnCause = SC_ECColdBoot;
  35   3                      }
  36   2                      else
  37   2                      {
  38   3                              ShutDnCause = SC_EC_0x0000;
  39   3                      }
  40   2                      break;
  41   2                                      
  42   2              case 2:
  43   2                      if(GPCRA0==0x80)
  44   2                      {
  45   3                              ShutDnCause = SC_IntWatchDog;
  46   3                      }
  47   2                      else
  48   2                      {
  49   3                              ShutDnCause = SC_EC_0x0000;
  50   3                      }
  51   2                      break;             
  52   2              
  53   2              case 3:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 2   

  54   2                      if(GPCRA0==0x80)
  55   2                      {
  56   3                              ShutDnCause = SC_ExtWatchDog;
  57   3                      }
  58   2                      else
  59   2                      {
  60   3                              ShutDnCause = SC_EC_0x0000;
  61   3                      }
  62   2                      break;
  63   2              }
  64   1              
  65   1              //ANGELAS089 add start
  66   1              if(IS_MASK_SET(PWRSW8SRST,BIT(1)))
  67   1              {
  68   2              ShutDnCause = SC_EC8SRESET;
  69   2              }
  70   1              //ANGELAS089 add end
  71   1              
  72   1      //add debug information for EC reset status(1.external watch-dog, 2.internal watch-dog; 3. EC VSTBY or WRS
             -T reset,4.EC code reset).             
  73   1      }
  74          
  75          void Check_LPC_Reset(void)
  76          {
  77   1              if(!Read_LPC_RST())
  78   1              {
  79   2                      //GATEA20_HI();
  80   2                      CLEAR_MASK(KBHISR,SYSF);
  81   2                  CLEAR_MASK(SYS_MISC1,ACPI_OS);
  82   2                      OEM_LPC_Reset();        // initial OEM status.
  83   2              }
  84   1      }
  85          
  86          void OEM_LPC_Reset(void)
  87          {
  88   1              BYTE BSLI_Det;
  89   1              BYTE EVENT_BUFFER_CNT;//72JERRY063:Clear Qevent Buffer when enter S3, S5, and LPC RESET.
  90   1              uReserve07.fbit.nTPDriverIn = 0;
  91   1              uReserve07.fbit.nVPCDriverIn = 0;
  92   1              uReserve07.fbit.nFanManual = 0; //ANGELAS030:Clear thermal tool flag under S3/S4/S5. return EC control
  93   1              //SYS_STATUS &= 0xF8;                   // Clear OS mode.
  94   1              CPU_TYPE &= 0x3f;//CLEAR BIT6 and BIT7 Unit abnormal shuntdown will not clear GPU flag,so when enter S5,W
             -B and S3 we clear GPU flag to not read GPU temperature.
  95   1              SET_MASK(pDevStus, pENABLE_TP); // Turn on TouchPad.
  96   1              //CMOS_Cam_ON();                                        // Turn on Camera power.
  97   1              CLR_MASK(cCmd, b3BkOff);                // Turn on backlight.
  98   1              CLR_MASK(OEMControl, b1BkOff);  //ANGELAG005:add
  99   1              SMartNoise = 0x04;                              // Stop Fan Dust mode.
 100   1              BackLight_En_Delay = 40;                        //:Increase lit backlight time for reboot.//:Panel background light delay abou
             -t 1s after Lenovo logo show out when reboot change 40 to 3. //:Remove  CHANGE 3 TO 40 
 101   1              //if (IS_MASK_SET(LENOVOPMFW,BATTERY_MAIN_CAL))
 102   1              //{
 103   1                      CLEAR_MASK(LENOVOPMFW,BATTERY_MAIN_CAL);
 104   1                      CLEAR_MASK(LENOVOPMFW,BATTERY_CAL_END);
 105   1                      LENOVOPMFW_Temp = 0;
 106   1              CLEAR_MASK(ACOFF_SOURCE, BATTLEARN);
 107   1              // ACOFF_LOW();
 108   1              //}
 109   1              //uNovoVPCCount = 0;                    // Clear NOVO VPC status.    ANGELAS004 Remove  clear novo button status when LPC 
             -reset function.
 110   1      //72JERRY063:s+Clear Qevent Buffer when enter S3, S5, and LPC RESET.
 111   1      for( EVENT_BUFFER_CNT=0; EVENT_BUFFER_CNT<=EVENT_BUFFER_SIZE; EVENT_BUFFER_CNT++)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 3   

 112   1              {
 113   2                                               SCI_Event_Buffer[EVENT_BUFFER_CNT] = 0x00;                                             
 114   2              }
 115   1              SCI_Event_In_Index      = 0x00;                                                                                                           //clear SCI index   
 116   1              SCI_Event_Out_Index = 0x00; 
 117   1      //      72JERRY063:e+Clear Qevent Buffer when enter S3, S5, and LPC RESET.      
 118   1              //#if SupportReadTPID
 119   1              //ReadTPid();
 120   1              //#endif
 121   1              EC_TP_ON_HI();//enable TP //72JERRY056:Add enable/disable TP function by HW pin.
 122   1              CLEAR_MASK(pDevStatus1, b7DisableTP);//enable TP//72JERRY056:Add enable/disable TP function by HW pin.
 123   1              F2_Pressed=0;//72JERRY059:Optimize F2/F12 flag to BIOS.
 124   1      //ANGELAG008: add start
 125   1              CLEAR_MASK(pDevStatus3,b6EnDisTPSend);
 126   1              CLEAR_MASK(pDevStatus3,b7TPStateFormer);
 127   1              CLEAR_MASK(pDevStatus1,b0F6ScanCodeSend);
 128   1              CLEAR_MASK(pDevStatus1,b1F6DisableTP);
 129   1              CLEAR_MASK(pDevStatus1,b4LNVAPP_STATUS);
 130   1              CLEAR_MASK(pDevStatus1,b5TPDRIVER_STATUS);
 131   1              CLEAR_MASK(pDevStatus1,b6MODE_STATUS);
 132   1              if(IS_MASK_CLEAR(P80CMOSSts,P80CMOSDis)) //HEGANG0027:Add bios hang check
 133   1              {
 134   2                      bios_check = 0;
 135   2              }
 136   1              //CLEAR_MASK(pDevStatus1,b7DisableTP);//72JERRY043:Support PTP TP show OSD,there isn't driver notify EC T
             -P status,EC keep flag to rom.
 137   1      //ANGELAG008: add end
 138   1      }
 139          
 140          
 141          void CHK_SUSACK(void)
 142          {
 143   1      #if 0
                      if(!Read_SUSWARN())
                      {
                              if (Read_SUSACK())
                              {
                                      if (SUSACK_LOW_CNT > 500)  //for DS3 test
                                      {
                                              SUSACK_LOW();
                                      }
                                      else
                                      {
                                              SUSACK_LOW_CNT++;
                                      }
                              }
                              else
                              {       SUSACK_LOW_CNT = 0;     }
                      }
                      else
                      {
                              if (!Read_SUSACK())
                              {
                                      if (SUSACK_HI_CNT > 20)
                                      {
                                              SUSACK_HI();
                                      }
                                      else
                                      {
                                              SUSACK_HI_CNT++;
                                      }
                              }
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 4   

                              else
                              {       SUSACK_HI_CNT = 0;              }
                      }
              #endif
 177   1      }
 178          
 179          #if 0
              void CHK_DRAMRST_CNTRL(void)
              {
                      if (Read_VR_ON())
                      {
                              if (!Read_DRAMRST_CNTRL_EC())
                              {
                                      if (DRAMRST_CNTRL_CNT > 200)
                                      {
                                              DRAMRST_CNTRL_EC_HI();
                                      }
                                      else
                                      {
                                              DRAMRST_CNTRL_CNT++;
                                      }
                              }
                      }
                      else
                      { DRAMRST_CNTRL_CNT = 0; }
              
                      if (!Read_SLPS3())
                      {
                              if ( SysPowState != SYSTEM_S5_S0 )
                              {
                                      DRAMRST_CNTRL_EC_LOW();
                                      DRAMRST_CNTRL_CNT = 0;
                              }
              /*
                              if (DRAMRST_CNTRL_LOW_CNT > 20)
                              {
                                      DRAMRST_CNTRL_EC_LOW();
                              }
                              else
                              {
                                      DRAMRST_CNTRL_LOW_CNT++;
                              }
              */
                      }
                      else
                      { DRAMRST_CNTRL_LOW_CNT = 0; }
              }
              #endif
 221          
 222          //-----------------------------------------------------------------------------
 223          // Handle System Power Control
 224          // Called by service_1mS -> Timer1msEvent -> Hook_Timer1msEvent
 225          //-----------------------------------------------------------------------------
 226          void Oem_SysPowerContrl(void)
 227          {
 228   1              //CHK_SUSACK();
 229   1              //CHK_DRAMRST_CNTRL();
 230   1      
 231   1          // Check current System PowerState to see what should we do.
 232   1          switch (SysPowState)
 233   1          {
 234   2              case SYSTEM_S0:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 5   

 235   2                      if(!Read_SLPS3())
 236   2                      {
 237   3                              
 238   3                              if (S3S4DelayCnt > 10)
 239   3                              {
 240   4                      PWSeqStep = 1;
 241   4                                      PowSeqDelay = 00;
 242   4                      RamDebug(0xD0);        
 243   4                      SysPowState=SYSTEM_S0_S3;
 244   4                                      //S0S3_VR_ON(); // include SYS_PWROK, PCH_PWROK,VR_ON enable orderly.
 245   4                                      if (!Read_SLPS4())
 246   4                                      {
 247   5                                              PWSeqStep = 1;
 248   5                                              PowSeqDelay = 0x00;
 249   5                          RamDebug(0x0D);
 250   5                                      SysPowState=SYSTEM_S0_S5;
 251   5                                      }
 252   4                                      else if (IS_MASK_SET(SysStatus,CloseLid))
 253   4                                      {
 254   5                                              //CLEAR_MASK(SysStatus,CloseLid);
 255   5                                              SET_MASK(SysStatus,EnterS3Lid);
 256   5                                      }
 257   4                              }
 258   3                              else
 259   3                              {       
 260   4                                      S3S4DelayCnt++; 
 261   4                              }
 262   3                      }
 263   2                      else
 264   2                      {       
 265   3                              S3S4DelayCnt = 0;               
 266   3                      }
 267   2                      Check_LPC_Reset();
 268   2                      break;
 269   2      
 270   2              case SYSTEM_S3:
 271   2                                   
 272   2              if(Read_SLPS3())  //S3 to S0
 273   2              {
 274   3                  PWSeqStep = 3;
 275   3                          PowSeqDelay = 20;
 276   3                  RamDebug(0x33);   
 277   3                      SysPowState=SYSTEM_S3_S0;
 278   3              }
 279   2                      // for EM9 adapter detection and protection       
 280   2              if(IS_MASK_SET(SYS_STATUS,b4IllegalAdp)&&Read_AC_IN())
 281   2              {
 282   3                          SET_MASK(SYS_STATUS,AC_ADP);        //set AC in  flag
 283   3                          //ACOFF_LOW();
 284   3                              BATT_LEN_OFF();//JERRYCRZ030¡êo
 285   3              }
 286   2                      //for EM9 adapter detection and protection 
 287   2              break;
 288   2      
 289   2          case SYSTEM_S4:
 290   2          case SYSTEM_S5:
 291   2                      if((Read_SLPS3() && Read_SLPS4())) 
 292   2                      {
 293   3                              PWSeqStep = 1;
 294   3                              PowSeqDelay = 0x00;
 295   3                  RamDebug(0x53);
 296   3                              SysPowState=SYSTEM_S5_S0;
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 6   

 297   3                      }
 298   2                      CheckAutoPowerOn();
 299   2                      // (remove to avoid turn off EC_ON)                     Check_EC_ON();
 300   2                      //ANGELAS031 Check_EC_ON(); //martin0313C+
 301   2                      //ANGELAS032:add start
 302   2                      if((ShipModeEn==0xA5)||IS_MASK_SET(EMStatusBit2,b0SetBatteryShipMode))
 303   2                      {
 304   3                              CLEAR_MASK(ACPI_HOTKEY, b7BIOS_NoShut);
 305   3                              CLEAR_MASK(ACPI_HOTKEY, b6Cmd_NoShut);
 306   3                      }
 307   2                      //ANGELAS032:add end
 308   2                       if(( IS_MASK_CLEAR(ACPI_HOTKEY, b7BIOS_NoShut))&& (IS_MASK_CLEAR(ACPI_HOTKEY, b6Cmd_NoShut))&&(LOWBATT_
             -3TIMES==0)) 
 309   2                        { 
 310   3                           //S34toDSx(); 
 311   3                            if ((!Read_AC_IN())&&IS_MASK_CLEAR(cCmd, bPCHPWR_Keep)) {
 312   4                                       PWSeqStep = 1;
 313   4                                   PowSeqDelay = 0x00;
 314   4                                         SysPowState=SYSTEM_S5_DSX;
 315   4                              }
 316   3                        }     
 317   2      #if SUPPORT_PMIC
 318   2                      //MEILING002: S+
 319   2                      if(PowerOTP_REG)
 320   2                      {
 321   3                              if ( IS_MASK_CLEAR(SysStatus, ERR_ShuntDownFlag) ) //ANGELAG007: add
 322   3                              { ProcessSID(PMIC_Shutdown_ID); } //ANGELAG007: add
 323   3                              OTP_TEMP = PowerOTP_REG;
 324   3                              PowerOTP_REG = 0;
 325   3                              RSMRST_LOW();
 326   3                              Delay1MS(12);
 327   3                              EC_ON_LOW();
 328   3                              PowerInitOK = 0;
 329   3                              if(Read_AC_IN())
 330   3                              {
 331   4                                      //DSxPowState = SYSTEM_DSxOK;
 332   4                              }
 333   3                      }
 334   2      #endif
 335   2                      //for EM9 adapter detection and protection       
 336   2              if(IS_MASK_SET(SYS_STATUS,b4IllegalAdp)&&Read_AC_IN())
 337   2              {
 338   3                          SET_MASK(SYS_STATUS,AC_ADP);        //set AC in  flag
 339   3                          //   ACOFF_LOW();
 340   3                              BATT_LEN_OFF();//JERRYCRZ030
 341   3              }
 342   2                      //for EM9 adapter detection and protection 
 343   2              break;
 344   2      
 345   2                      case SYSTEM_DSX:
 346   2                              CheckAutoPowerOn(); 
 347   2                              if(nBattGasgauge<=10)
 348   2                              EC_ON_5V_LOW();
 349   2                       if((Read_AC_IN())||(LOWBATT_3TIMES!=0)){   //JERRYBR012:Fixed Power led will not flick 3 times when pow
             -er on after discharged battery to 0% till system shut down.TDMS#110153 
 350   3                              PWSeqStep = 1;
 351   3                              PowSeqDelay = 0x00;
 352   3                          SysPowState=SYSTEM_DSX_S5;
 353   3                              }
 354   2                      break;
 355   2                      
 356   2      
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 7   

 357   2               case SYSTEM_DSX_S5:
 358   2                          Oem_DSXS5Sequence();
 359   2                  break;
 360   2          case SYSTEM_S5_S0:
 361   2                      Oem_S5S0Sequence();
 362   2                      break;
 363   2      
 364   2          case SYSTEM_S3_S0:
 365   2                      Oem_S3S0Sequence();
 366   2              break;
 367   2      
 368   2          case SYSTEM_S0_S3:
 369   2                      Oem_S0S3Sequence();
 370   2                      /*                       
 371   2                      if (!Read_SLPS4())
 372   2                      {
 373   2                              PWSeqStep = 1;
 374   2                              PowSeqDelay = 0x00;
 375   2                              SysPowState=SYSTEM_S0_S5;
 376   2                      }
 377   2                      */
 378   2              break;
 379   2      
 380   2          case SYSTEM_S0_S4:
 381   2              break;
 382   2      
 383   2          case SYSTEM_S0_S5:
 384   2                      Oem_S0S5Sequence();
 385   2              break;
 386   2               case SYSTEM_S5_DSX:
 387   2                       Oem_S5DSXSequence();
 388   2                      break;
 389   2              case SYSTEM_EC_WDTRST:
 390   2                      break;
 391   2      
 392   2              default:
 393   2               SysPowState=SYSTEM_DSX; 
 394   2                              if(!Read_AC_IN())
 395   2            {   
 396   3                   PWSeqStep = 1;
 397   3                               PowSeqDelay = 0x00;
 398   3                                SysPowState = SYSTEM_S5_DSX;
 399   3            }
 400   2            else
 401   2            {
 402   3                   PWSeqStep = 1;
 403   3                              PowSeqDelay = 0x00;
 404   3                                SysPowState = SYSTEM_DSX_S5;
 405   3            }
 406   2                      break;
 407   2          }
 408   1      }
 409          
 410          void SetS3GPIO(void)
 411          {
 412   1              //USB_CHG_EN_HI();//72JERRY008: Add Always On USB feature follow 'lenovo Always On USB Ver5'.
 413   1          //CHG_MOD1_LOW();//72JERRY008:-
 414   1         // CHG_MOD2_HI();//72JERRY008:-
 415   1          //CHG_MOD3_LOW();//72JERRY008:-
 416   1      }
 417          
 418          void SetS0GPIO(void)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 8   

 419          {
 420   1              SCI_HI();                               //RUNSCI Hi
 421   1              RCING_HI();
 422   1      
 423   1              SMBus2_CLK_ALT;                 // SMBus2 CLK to alternate pin
 424   1              SMBus2_DAT_ALT;                 // SMBus2 DATA to alternate pin
 425   1      
 426   1              #if FAN_TABLE_Already
 427   1              FAN_PWM_ALT;                    // Set FAN_PWM Alt.
 428   1              FAN1_PWM_ALT;//72JERRY001: Modify GPIO setting and fan1 setting.
 429   1              #else
                      FAN_PWM_OUT;                    // Set FAN_PWM OUTPUT.
                      EC_FAN_PWM_HI();
                      FAN1_PWM_OUT;//72JERRY001: Modify GPIO setting and fan1 setting.
                      EC_FAN1_PWM_HI();//72JERRY001: Modify GPIO setting and fan1 setting.
                      
                      #endif  // FAN_TABLE_Already
 436   1      
 437   1              FAN_SPEED_ALT;                  // Set FAN Speed Alt.
 438   1              FAN1_SPEED_ALT;//72JERRY001: Modify GPIO setting and fan1 setting.
 439   1              InitSio();
 440   1      
 441   1              KBHISR = 0x00;
 442   1              KBHIKDOR = 0x00;
 443   1              CLEAR_MASK(KBHISR,SYSF);
 444   1      
 445   1              SPCTRL1 = 0x83;                 //msmart test
 446   1              BRAM3E =0;
 447   1              BRAM3F =0;
 448   1      
 449   1              PECIDelayCnt = 0x04;
 450   1      
 451   1              Fan_Init();
 452   1              //pDevStus=Read_Eflash_Byte(EEPROMA2,(EEPROMA1_B03|0x07),0xE1);
 453   1      
 454   1      #if UCS1022_Support
                      USB_CH_OUTPUT;
                      //if ( IS_MASK_CLEAR(USB_Charger, b0USB_EN) )
                      if ( IS_MASK_CLEAR(EMStatusBit, b1SetUSBChgEn) )
                      { USB_CH_LOW(); }
                      CLR_MASK(USB_Charger, b1USB_initOK);
              #endif  // UCS1022_Support
 461   1      
 462   1              if ( IS_MASK_SET(SYS_MISC1, b1Num_LED) )
 463   1              { //NUMLED_ON(); 
 464   2              }
 465   1              else
 466   1              { //NUMLED_OFF(); 
 467   2              }
 468   1      }
 469          
 470          void SetS5GPIO(void)
 471          {
 472   1              SCI_LOW();                      //RUNSCI Hi
 473   1              RCING_LOW();
 474   1              SMBus2_CLK_INDW;        // SMBus2 CLK to Input+pull_DW pin
 475   1              SMBus2_DAT_INDW;        // SMBus2 DATA to Input+pull_DW pin
 476   1              FAN_PWM_INDW;           // Set FAN_PWM input+pull_dw.
 477   1              FAN_SPEED_INDW;         // Set FAN Speed input+pull_dw.
 478   1              FAN1_PWM_INDW;//72JERRY001: Modify GPIO setting and fan1 setting.
 479   1              FAN1_SPEED_INDW;//72JERRY001: Modify GPIO setting and fan1 setting.
 480   1      
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 9   

 481   1              CAPLED_OFF();           // Turn off Cap LED.
 482   1              /*
 483   1              if(IS_MASK_CLEAR(EMStatusBit,b1SetUSBChgEn))
 484   1              //USB_ON_INPUT;
 485   1              if(IS_MASK_CLEAR(EMStatusBit,b6RdUSBChgS45))
 486   1              //USB_ON_INPUT;
 487   1              if ( SysPowState == SYSTEM_S0_S5 ) //ANGELAS063:add
 488   1              {
 489   1                      USB_ON_INPUT;   // Disable USB wake.
 490   1      
 491   1              }
 492   1              else
 493   1              {
 494   1                      if ( IS_MASK_CLEAR(SYS_STATUS,AC_ADP) )
 495   1                      { 
 496   1                               
 497   1              }       // turn off LAN power.
 498   1                      else
 499   1                      { 
 500   1                              
 501   1              }       // Turn on LAN power.
 502   1                      
 503   1                      {
 504   1                              USB_ON_OUTPUT;
 505   1                              USB_ON_LOW();   // Turn on USB power.
 506   1                      }
 507   1              }*/
 508   1              AC_IN_INPUT;
 509   1      
 510   1      #if UCS1022_Support
                      //if ( IS_MASK_SET(USB_Charger, b0USB_EN) )
                      if ( IS_MASK_SET(EMStatusBit, b1SetUSBChgEn) )
                      { UCS1002HCACharger_Init(); }
                      else 
                      {
                              if ( SysPowState != SYSTEM_S0_S5 )
                              { UCS1002HCACharger_Init(); }   // Entry S3 status.
                      }
              #endif  // UCS1022_Support
 520   1              CLR_MASK(SYS_MISC1,b5Crisis_LED);       // Clear Crisis LED.
 521   1      }
 522          
 523          void S5DSX_RSMRST_LOW()
 524          {
 525   1        RSMRST_LOW();
 526   1      }
 527          void S5DSX_PCH_PWR_EN_OFF()
 528          {
 529   1         Lowpower_ENfunction();
 530   1         
 531   1      }
 532          
 533          void Enter_ShipMode()
 534          {
 535   1        #if shipmodesupport
 536   1        if((ShipModeEn==0xA5)||IS_MASK_SET(EMStatusBit2,b0SetBatteryShipMode)) {
 537   2              ShipModeEn=0x00;
 538   2              Lock_ShipMode();
 539   2              }
 540   1        #endif
 541   1      }
 542          void RecordenEnterShipMode()
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 10  

 543          {
 544   1       #if shipmodesupport
 545   1        if((ShipModeEn==0xA5)||IS_MASK_SET(EMStatusBit2,b0SetBatteryShipMode)) {
 546   2         ProcessSID(0xA6);
 547   2        if(nBattGasgauge < 95)
 548   2              {
 549   3                      ProcessSID(0xA8);
 550   3                      while(1);
 551   3              }
 552   2              }
 553   1       #endif
 554   1      }
 555          void S5DSX_CHECK_RSMRST_P()
 556          {
 557   1       
 558   1      }
 559          
 560          void S5DSX_EC_ON_LOW()
 561          {
 562   1              EC_ON_LOW();
 563   1              if(IS_MASK_CLEAR(EMStatusBit,b1SetUSBChgEn))
 564   1              EC_ON_5V_LOW();
 565   1              if(IS_MASK_CLEAR(EMStatusBit,b6RdUSBChgS45))
 566   1              EC_ON_5V_LOW();
 567   1              if(nBattGasgauge<=10)
 568   1              EC_ON_5V_LOW();
 569   1              PowerInitOK=0;//HEGANGS015:Clear pmic initial ok flag in DC S5
 570   1              SMBUS_CK3_IN;//72JERRY052:Modify the SMBUS leakage in DC S5.
 571   1              SMBUS_DA3_IN;//72JERRY052:Modify the SMBUS leakage in DC S5.
 572   1              //EC_ON_1_8V_LOW();//72JERRY037: -Modify power sequence and GPIO setting follow EE.
 573   1              // EC_CCG4_ON_LOW();
 574   1              PM_PWRBTN_LOW();
 575   1      }
 576          //72JERRY037: S+Modify power sequence and GPIO setting follow EE.
 577          void S5DSX_EC_ON_18V_LOW()
 578          {
 579   1              EC_ON_1_8V_LOW();
 580   1      }
 581          //72JERRY037:E+ Modify power sequence and GPIO setting follow EE.
 582          void S5DSX_Init_Status()
 583          {
 584   1              SysPowState = SYSTEM_DSX;
 585   1      }
 586          
 587          
 588          const sPowerSEQ code asPowerSEQS5DSX[]=
 589          {
 590            { 0x0000,                        0,   0,  },  // step0
 591            { S5DSX_RSMRST_LOW,           5,   0,  },  //step1//JERRYBR005:Modify GPIO setting and power sequence.
 592            { S5DSX_PCH_PWR_EN_OFF,          5,   0,  },    //step2//JERRYBR005:Modify GPIO setting and power sequence.
 593            {S5DSX_EC_ON_18V_LOW,         2,      0,},//72JERRY037: Modify power sequence and GPIO setting follow EE.
 594            { S5DSX_EC_ON_LOW,             0,     0,  },  //step4
 595            { S5DSX_Init_Status,             0,           0,      },  //step5
 596            { Enter_ShipMode,            120,        0}, //step6
 597           { RecordenEnterShipMode,               0,       0},//step7
 598          };
 599          
 600          
 601           
 602          void Oem_S5DSXSequence(void)
 603          {
 604   1        if(PowSeqDelay != 0x00 )
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 11  

 605   1        {
 606   2          PowSeqDelay--;        //1m Sec count base
 607   2          if(PowSeqDelay != 0x00 )
 608   2          {
 609   3            return;
 610   3          }
 611   2        }
 612   1      
 613   1        while(PWSeqStep<(sizeof(asPowerSEQS5DSX)/sizeof(sPowerSEQ)))
 614   1        {
 615   2          if(asPowerSEQS5DSX[PWSeqStep].checkstatus==0x00) // Do function
 616   2          {
 617   3            (asPowerSEQS5DSX[PWSeqStep].func)();
 618   3              PowSeqDelay = asPowerSEQS5DSX[PWSeqStep].delay;
 619   3              PWSeqStep++;
 620   3            if(PowSeqDelay!=0x00)
 621   3            {
 622   4              break;
 623   4            }
 624   3          }
 625   2          else        // Check input status pin
 626   2          {
 627   3            if((asPowerSEQS5DSX[PWSeqStep].func)())
 628   3            {
 629   4              PowSeqDelay = asPowerSEQS5DSX[PWSeqStep].delay;
 630   4              PWSeqStep++;
 631   4            }
 632   3            break;
 633   3          }
 634   2        }
 635   1      }
 636          
 637          
 638          void DSXS5_EC_ON_HI()
 639          {
 640   1              SMBUS_CK3_ALT;//72JERRY052:Modify the SMBUS leakage in DC S5.
 641   1              SMBUS_DA3_ALT;//72JERRY052:Modify the SMBUS leakage in DC S5.
 642   1              EC_ON_HI();
 643   1              EC_ON_5V_HI();
 644   1              PM_PWRBTN_HI();
 645   1      }
 646          BYTE DSXS5_PMIC_Initial(void)
 647          {
 648   1              InitPMIC();
 649   1              if(!PowerInitOK)
 650   1                      return 0;
 651   1              else
 652   1                      return 1;
 653   1      }
 654          void DSXS5_EC_ON_1_8HI()
 655          {
 656   1              EC_ON_1_8V_HI();
 657   1      }
 658          void DSXS5_RSMRST_HI()
 659          {
 660   1              RSMRST_HI();
 661   1      }
 662          
 663          void DSXS5_Init_Status()
 664          {
 665   1              AC_PRESENT_HI();  //72JERRY017: Modify poweron sequence 
 666   1          SysPowState = SYSTEM_S5;
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 12  

 667   1      }
 668          
 669          
 670          const sPowerSEQ code asPowerSEQDSXS5[]=
 671          {
 672            { 0x0000,                        0,   0,  },  // step0
 673            { DSXS5_EC_ON_HI,                0,   0,  },  //step1//72JERRY017: Modify poweron sequence 
 674            { DSXS5_PMIC_Initial,            0,   1,      },
 675            { DSXS5_EC_ON_1_8HI,             30,  0,  },//72JERRY025: Modify power sequence follow EE.
 676            { DSXS5_RSMRST_HI,           20,  0,  },  //step6
 677            { DSXS5_Init_Status,             0,   0,      }, //step7
 678          };
 679          
 680          
 681          void Oem_DSXS5Sequence(void)
 682          {
 683   1        if(PowSeqDelay != 0x00 )
 684   1        {
 685   2          PowSeqDelay--;        //1m Sec count base
 686   2          if(PowSeqDelay != 0x00 )
 687   2          {
 688   3            return;
 689   3          }
 690   2        }
 691   1      
 692   1        while(PWSeqStep<(sizeof(asPowerSEQDSXS5)/sizeof(sPowerSEQ)))
 693   1        {
 694   2          if(asPowerSEQDSXS5[PWSeqStep].checkstatus==0x00) // Do function
 695   2          {
 696   3            (asPowerSEQDSXS5[PWSeqStep].func)();
 697   3              PowSeqDelay = asPowerSEQDSXS5[PWSeqStep].delay;
 698   3              PWSeqStep++;
 699   3            if(PowSeqDelay!=0x00)
 700   3            {
 701   4              break;
 702   4            }
 703   3          }
 704   2          else        // Check input status pin
 705   2          {
 706   3            if((asPowerSEQDSXS5[PWSeqStep].func)())
 707   3            {
 708   4              PowSeqDelay = asPowerSEQDSXS5[PWSeqStep].delay;
 709   4              PWSeqStep++;
 710   4            }
 711   3            break;
 712   3          }
 713   2        }
 714   1      }
 715          //============S5 -> S0==========================================================
 716          BYTE S5S0_STEP1(void)
 717          {
 718   1          CLR_MASK(cCmd, bPCHPWR_Keep);    
 719   1          AutoTimer=0x00; 
 720   1          if(IS_MASK_SET(SysStatus2, b3EC8S_Reset)) 
 721   1              {
 722   2                      CLEAR_MASK(SysStatus2, b3EC8S_Reset);
 723   2              }
 724   1              SMBUS_CK3_ALT;//72JERRY052:Modify the SMBUS leakage in DC S5.
 725   1              SMBUS_DA3_ALT;//72JERRY052:Modify the SMBUS leakage in DC S5.
 726   1              if(ONEKEY_TEMP_FLAG) //HEGANGS025: Modify onekey battery function
 727   1              {
 728   2                      DCR3 = 0;
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 13  

 729   2              }
 730   1              EC_ON_HI(); //ANGELAS038:add
 731   1              EC_ON_5V_HI();
 732   1              PM_PWRBTN_HI();
 733   1              return(1);
 734   1      }
 735          
 736          void S5S0_EC_ON_1_8_EN(void) 
 737          {
 738   1         EC_ON_1_8V_HI();
 739   1      }
 740          
 741          void S5S0_EC_CCG4_ON_HI(void) 
 742          {
 743   1       //  EC_CCG4_ON_HI();
 744   1      }//72JERRY025: Modify power sequence follow EE.
 745          
 746          #if SUPPORT_PMIC
 747          //MEILING002: S+
 748          BYTE S5S0_PMIC_Initial(void)
 749          {
 750   1              InitPMIC(); 
 751   1              if(!PowerInitOK)
 752   1                      return 0;
 753   1              else
 754   1                      return 1;
 755   1      }
 756          //MEILING002: E+
 757          #endif
 758          
 759          void S5S0_AC_PRESENT_EN(void) 
 760          {
 761   1              uPGID= Read_Eflash_Byte(EEPROMA2,(EEPROMA1_B03 | 0x07) ,0xE0); //:Add the difference between G and Z proj
             -ect
 762   1          MBID_FB=uPGID;       
 763   1              PM_PWRBTN_HI();
 764   1          if(IS_MASK_SET(SYS_STATUS,AC_ADP)) 
 765   1          {
 766   2                 //AC_PRESENT_HI();
 767   2          } 
 768   1      }
 769          
 770          
 771          void S5S0_RSMRST_EN(void)
 772          {
 773   1              RSMRST_HI();
 774   1      }
 775          
 776          void S5S0_PM_PWER_BTN2(void)
 777          {
 778   1              PM_PWRBTN_LOW();
 779   1              SET_MASK(CMOS_TEST,BIT2); //ANGELAS052:add
 780   1      }
 781          // open
 782          void S5S0_PM_PWER_BTN3(void)
 783          {
 784   1              PM_PWRBTN_HI();
 785   1      }
 786          
 787          BYTE S5S0_CHK_S4(void)
 788          {
 789   1              if(Read_SLPS4())
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 14  

 790   1              {
 791   2                  PM_PWRBTN_HI(); 
 792   2                      //SYSON_HI(); //ANGELAS063:remove
 793   2                      //EC_VCCST_EN_HI(); //ANGELAS063:add//72JERRY037:- Modify power sequence and GPIO setting follow EE.
 794   2                      return(1);
 795   2              }
 796   1          //Reset_Delay=0x44; //:Remove work around
 797   1          PM_PWRBTN_LOW(); 
 798   1              return(0);
 799   1      }
 800          
 801          BYTE S5S0_CHK_S3(void)
 802          {
 803   1              if(Read_SLPS3())
 804   1              {
 805   2                      return(1);
 806   2              }
 807   1              //Reset_Delay=0x55;  //Remove work around
 808   1              return(0);
 809   1      }
 810          
 811          void S5S0_EC_VCCST_EN(void)
 812          {
 813   1              EC_VCCST_EN_HI();
 814   1      }
 815          
 816          //MEILING001:S+
 817          void S5S0_EC_VPP_PWREN(void)
 818          {
 819   1              EC_VPP_PWREN_HI();
 820   1      }
 821          //MEILING001:E+
 822          
 823          //ANGELAS063:add start
 824          void S5S0_SYSON(void)
 825          {
 826   1              SYSON_HI();
 827   1      }
 828          //ANGELAS063:add end
 829          void S5S0_GPO7(void)
 830          {
 831   1      //      VGA_AC_DET_HI();
 832   1      }
 833          void S5S0_SUSP(void)
 834          {
 835   1              SUSP_ON();
 836   1          //ROMPWREN_HIGH(); 
 837   1              CURRENT_STATUS &= 0xC0; //Clear flags of entering and resuming from S3 & S4 &S5
 838   1          //LAN_PWR_IN; 
 839   1              SetS0GPIO();
 840   1              //USB_CHG_EN_HI();////72JERRY008:-
 841   1          //CHG_MOD1_HI();//72JERRY008:-
 842   1          //CHG_MOD2_HI();//72JERRY008:-
 843   1         // CHG_MOD3_LOW();//72JERRY008:-
 844   1      }
 845          
 846          void S5S0_EC_VCCIO_EN(void)
 847          {
 848   1              EC_VCCIO_EN_HI();
 849   1      }
 850          
 851          void S5S0_NVDD_PWR(void)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 15  

 852          {
 853   1              #if     Support_External_IO
                  NVDD_PWR_EN_HI();
                      S_NVDD_PWR_EN_HI();
                      #endif  // Support_External_IO
 857   1      }
 858          
 859          void S5S0_USBON(void)
 860          {
 861   1              USB_ON_OUTPUT;
 862   1              USB_ON_LOW();
 863   1              SET_MASK(EMStatusBit, b7RdUSBChgEn);    // default support USB charger S4/S5.
 864   1      }
 865          
 866          void S5S0_VCCST_PWRGD(void)
 867          {
 868   1              EC_VCCST_PWRGD_HI();
 869   1      }
 870          
 871          //same as S5S0_CHK_SA_PWRGOOD, only change name for clear read.
 872          
 873          BYTE S5S0_CHK_VDDQ_PWRGOOD(void)
 874          {
 875   1              BYTE BPwrDate=0x03;
 876   1          // Reset_Delay=0x00;  //Remove work around
 877   1              if(Read_VDDQ_PGOOD())
 878   1              {
 879   2                      //bRWSMBus(SMbusCh4, SMbusWB, TmlIC_Addr, TmlIC_Rate, &BPwrDate, SMBus_NoPEC);
 880   2                      //LED_KB_PWM_Step=Read_Eflash_Byte(EEPROMA2,(EEPROMA1_B03|0x07),0xE2);//72JERRY039:Modify KB backlight s
             -etting follow UI SPEC.
 881   2                      return(1);
 882   2              }
 883   1              return(0);
 884   1      }
 885          
 886          
 887          
 888          void S5S0_VR_ON(void)
 889          {
 890   1              Clr_UEFIStatus();       // Clear UEFI status for BIOS used.
 891   1              VR_ON_ON();
 892   1       
 893   1              // for EM9 adapter detection and protection     
 894   1          //SetPowerBatteryparameter(); 
 895   1          if (IS_MASK_SET(SYS_STATUS,AC_ADP))   
 896   1          {
 897   2                      AdapterIDOn_Flag = 0x01; //MEILING001:add.
 898   2                      ADPIDON10MS_NUM=0xa0;  // Modify read adapter ID time, in order to enter S4 under DC mode ,then plug in
             - AC and wake up from S4 not pop up limited support.
 899   2          } 
 900   1              //:for EM9 adapter detection and protection   
 901   1              MuteCount = 4;
 902   1      }
 903          
 904          BYTE S5S0_CHK_VRREADY(void)
 905          {
 906   1              //if(Read_VR_CPU_PWROK())
 907   1              if(Read_VR_CPU_PWROK > CPU_PWROK_VLIMIT)
 908   1              {
 909   2                      return(1);
 910   2              }
 911   1              return(0);
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 16  

 912   1      }
 913          
 914          void S5S0_PCH_PWROK(void)
 915          {
 916   1              PCH_PWROK_HI();
 917   1          PwrOnDly5Sec =5;    //optimize PwrOnDly5Sec,from 40 to 5.
 918   1      }
 919          
 920          void S5S0_SYS_PWROK(void)
 921          {
 922   1              SYS_PWROK_HI();
 923   1      }
 924          
 925          void LPC_RST(void)
 926          {
 927   1              #if     Support_External_IO
                      DGPU_HOLD_RST_HI();
                      S_DGPU_RST_HI();
                      #endif  // Support_External_IO
 931   1      }
 932          
 933          
 934          void S5S0_Init_Status(void)
 935          {
 936   1              if(IS_MASK_CLEAR(P80CMOSSts,P80CMOSDis))
 937   1              {
 938   2                      bios_check = 0;//HEGANGS022:Add SMI hang check function
 939   2              }
 940   1              CLEAR_MASK(ACPI_HOTKEY, b7BIOS_NoShut); //support RTC wake and psw can wake during RTC wake enable  in DC
             - mode except ship mode enable //ANGELAS031
 941   1              CLEAR_MASK(ACPI_HOTKEY, b6Cmd_NoShut); //ANGELAS031
 942   1              ShipModeEn=0x00; //ANGELAS037: add 
 943   1              Fan_ON_Count = FAN_Boot_On;     // Turn on Fan 3 Sec.
 944   1              nBrightValue = 17;                      // Default WIN8 brightness 110~130 nit.
 945   1              nCpuTemp = VGA_TEMP = EXTVGA_TEMP = nSKINTemp90 = 32;   // Default temperature value.
 946   1              ThermistorCPU_TEMP=32;  //ANGELAS070:add
 947   1              //ANGELAS033:Add start  
 948   1              if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 949   1              {
 950   2              batteryFirstUsedDateL = batteryFirstUsedDateH = 0x00;
 951   2                      if(bRWSMBus(SMbusChB,SMbusRW,SmBat_Addr,FirstUsedDate,&batteryFirstUsedDateL,SMBus_NeedPEC))
 952   2                      {
 953   3                              if(batteryFirstUsedDateL || batteryFirstUsedDateH )
 954   3                                      CLEAR_MASK(pProject0,b3uBatteryTimeNoOK);
 955   3                              else
 956   3                                      SET_MASK(pProject0,b3uBatteryTimeNoOK);
 957   3                              RamDebug(0xAE);
 958   3                      }
 959   2              }                       
 960   1              //ANGELAS033:Add end
 961   1              //SysPowState = SYSTEM_S0;      // Set System S0 status. //ANGELAS045:remove
 962   1              LED_KB_PWM_Count = 42;  // Turn on KB BL LED.  //MEILING030:change 3 to 10(1.5s to 5s).//72JERRY039:Modify
             - KB backlight setting follow UI SPEC.
 963   1              ACPI_HOTKEY &= 0x1F;    // Clear bit6,7, can cut power in the battery mode.
 964   1              SYS_STATUS &= 0xF8;             // Clear OS mode.
 965   1              //DSxPowState = SYSTEM_S3S4;    // Clear Deep status. //ANGELAS045:remove
 966   1              CLR_MASK(cCmd, b3BkOff);        // Turn on backlight.
 967   1              CLR_MASK(OEMControl, b1BkOff); //ANGELAG005:add
 968   1              BackLight_En_Delay =16; // Delay 280msec turn on backlight.//reduce light backlight time for clodboot.fro
             -m 28 to 16.
 969   1          delayEDPTm = 5;                             // Delay 50ms to initial EDP.   // CMW Temp
 970   1              //SetACIN_Int(); //ANGELAS079:remove
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 17  

 971   1              SET_MASK(pDevStus, pENABLE_TP); // Turn on TouchPad.
 972   1              //turn on touch sensor power
 973   1              //if ( uMBID & 0x08 )  // add MBID judge.
 974   1          //add lid flag to BIOS, whether need to open  backlight.
 975   1          CLEAR_MASK(USB_Charger, b2USB_TmlDis);//enable USB charge when Unexpected power shutdown//72JERRY046:c
             -lear Unexpected power shutdown flag when power on.
 976   1          if(Read_LID_SW_IN())
 977   1              SET_MASK(SWI_EVENT,LID);
 978   1          else
 979   1              CLEAR_MASK(SWI_EVENT,LID);
 980   1      
 981   1               if(!Read_LID_PAD())
 982   1               {
 983   2                      SET_MASK(pDevStatus1,b2DisableKB);
 984   2               }
 985   1               else
 986   1               {
 987   2                 CLEAR_MASK(pDevStatus1,b2DisableKB);  
 988   2               }
 989   1          #if SupportReadTPID
                  ReadTPid();
                  #endif
 992   1          uReserve07.fbit.uACInOutBeep = 1;
 993   1              //CLEAR_MASK(BATTUPDATEFW,BIT0); //ANGELAS054:add //ANGELAS083:remove
 994   1              EC_TP_ON_HI();//enable TP //72JERRY056:Add enable/disable TP function by HW pin.
 995   1              CLEAR_MASK(pDevStatus1, b7DisableTP);//enable TP//72JERRY056:Add enable/disable TP function by HW pin.
 996   1              Lowpower_DISfunction(); //ANGELAS047:add
 997   1              //PECIBIOSTEST=2;//when enter S3/S4/CB,BIOS sent B4 CMD to EC from 66port for peci fail.// : CHANGE FROM 
             -0 TO 2//remove 
 998   1              CPUThrottlingDelayTime = 60; //MEILING052:add delay time 1 minute to send 0x1D event.
 999   1              SysPowState = SYSTEM_S0;        //ANGELAS045:add set S0 power state.
1000   1              DSxPowState = SYSTEM_S3S4;      // Clear Deep status. //ANGELAS045:add
1001   1      }
1002          
1003          /* follow ITE EVB Power Sequence 20111202.pdf
1004          ;===========================================================================================
1005          ; Power On (DC mode)
1006          ;===========================================================================================
1007          ;
1008          ;S5_ENABLE(O)   +----------------------------------------------------------------------------
1009          ;--------------+(1)Always power group 3,5VA (if Adapter in,this signal will exist always)
1010          ;
1011          ;PM_Power_BTN(O)            +----------------------+    ~       +-----------------------
1012          ;----------------------+                                       +--~----+
1013          ;
1014          ;RSMRST(O)                           +----------------------------------------
1015          ;-------------------------+
1016          ;
1017          ;AC_Present (Intel Only and if AC attached)(O)   +----------------------------------------
1018          ;----------------------------------------+
1019          ;
1020          ;                                                                                                        +
             ----------------------
1021          ;SLP_S4#(I) SLP4(I)-------------------------------------------+
1022          ;
1023          ;                                                                                                         
             -      +---------------------
1024          ;IMVP_PWRGD (I)  ------------------------------------------------+
1025          ;                                                                                                         
             -                  +------------------
1026          ;S0_Power_Good(O)------------------------------------------------------+
1027          ;========================================================================
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 18  

1028          */
1029          
1030          //-------------------------------------------------------------------------------------
1031          //  Do S5 -> S0 power sequnce
1032          //-------------------------------------------------------------------------------------
1033          const sPowerSEQ code asPowerSEQS5S0[]=
1034          {
1035                  { 0x0000,                               0,              0,  },  //Dummy step always in the top of tabel
1036                  { S5S0_STEP1,                   0,              1,      },  //72JERRY017: Modify poweron sequence 
1037                  { S5S0_PMIC_Initial,    0,              1,      },
1038                  {S5S0_EC_ON_1_8_EN,     30,     0,  },  //72JERRY025: Modify power sequence follow EE.
1039          //      {S5S0_EC_CCG4_ON_HI,     26,     0, },//72JERRY025: Modify power sequence follow EE.
1040                  { S5S0_RSMRST_EN,               20,             0,  },
1041                  { S5S0_AC_PRESENT_EN,   76,             0,  }, 
1042                  { S5S0_PM_PWER_BTN2,    20,             0,  },
1043                  { S5S0_PM_PWER_BTN3,    0,      0,  },   
1044                  { S5S0_CHK_S4,                  0,              1,      }, 
1045                  { S5S0_EC_VPP_PWREN,    2,      0,  }, 
1046                  { S5S0_SYSON,                   0,              0,      }, 
1047                  { S5S0_CHK_VDDQ_PWRGOOD,2,              1,      },//72JERRY037: Modify power sequence and GPIO setting follow EE.
1048                  { S5S0_EC_VCCST_EN,     2,              0,      },
1049                  { S5S0_CHK_S3,                  0,      1,  }, 
1050                  { SLPS3_Sleep_En,       0,      0,  }, 
1051                  { SLPS4_Sleep_En,       0,      0,  }, 
1052                  { S5S0_SUSP,                    2,              0,      },  
1053                  { S5S0_EC_VCCIO_EN,             8,              0,      },  
1054              { S5S0_USBON,                       50,             0,      },
1055              { S5S0_VCCST_PWRGD,         5,              0,      },
1056                  { S5S0_VR_ON,                   0,              0,      },    
1057                  { S5S0_CHK_VRREADY,             10,             1,      },
1058                  { S5S0_PCH_PWROK,               100,    0,      }, 
1059                  { S5S0_SYS_PWROK,               49,             0,      },      
1060                  { S5S0_Init_Status,             0,              0,      },
1061          };
1062          
1063          //----------------------------------------------------------------------------
1064          // S5 to S0 sequnce
1065          //----------------------------------------------------------------------------
1066          void Oem_S5S0Sequence(void)
1067          {
1068   1          if ( PowSeqDelay != 0x00 )
1069   1          {
1070   2              PowSeqDelay--;                                                                  //1m Sec count base
1071   2              if ( PowSeqDelay != 0x00 )      return;
1072   2          }
1073   1      
1074   1              while(PWSeqStep<(sizeof(asPowerSEQS5S0)/sizeof(sPowerSEQ)))
1075   1              {
1076   2                      if(asPowerSEQS5S0[PWSeqStep].checkstatus==0x00) // Do function
1077   2                      {
1078   3                              (asPowerSEQS5S0[PWSeqStep].func)();
1079   3                              PowSeqDelay = asPowerSEQS5S0[PWSeqStep].delay;
1080   3                              PWSeqStep++;
1081   3                              if(PowSeqDelay!=0x00)
1082   3                              {
1083   4                                      break;
1084   4                              }
1085   3                      }
1086   2                      else    // Check input status pin
1087   2                      {
1088   3                              if((asPowerSEQS5S0[PWSeqStep].func)())
1089   3                              {
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 19  

1090   4                                      PowSeqDelay = asPowerSEQS5S0[PWSeqStep].delay;
1091   4                                  PWSeqStep++;
1092   4                              }
1093   3                              break;
1094   3                      }
1095   2              }
1096   1      }
1097          
1098          //============S0 -> S5==========================================================
1099          void S0S5_VR_ON(void)
1100          {
1101   1              SYS_PWROK_LOW();
1102   1              PCH_PWROK_LOW();
1103   1              VR_ON_OFF();
1104   1              EC_VCCST_PWRGD_LOW();
1105   1      //      USB_ON_INPUT; //ANGELAS031: add
1106   1              EC_VCCIO_EN_LOW();
1107   1              #if     Support_External_IO
                      DGPU_HOLD_RST_LOW();
                      S_DGPU_RST_LOW();
                      #endif  // Support_External_IO
1111   1      }
1112          
1113          void S0S5_NVDD_OFF(void)
1114          {
1115   1              #if     Support_External_IO
                      NVDD_PWR_EN_LOW();
                      S_NVDD_PWR_EN_LOW();
                      #endif  // Support_External_IO
1119   1      }
1120          
1121          void S0S5_SUSP(void)
1122          {
1123   1              SUSP_OFF();
1124   1              SetS5GPIO();
1125   1              //USB_CHG_EN_LOW();//72JERRY045:-Modify USB charge setting in DC S5.
1126   1         // CHG_MOD1_LOW();//72JERRY045:-Modify USB charge setting in DC S5.
1127   1          //CHG_MOD2_LOW();//72JERRY045:-Modify USB charge setting in DC S5.
1128   1          //CHG_MOD3_LOW();//72JERRY045:-Modify USB charge setting in DC S5.
1129   1      }
1130          void S0S5_EC_VCCST_EN(void)
1131          {
1132   1              EC_VCCST_EN_LOW();
1133   1      }
1134          
1135          //MEILING001:S+
1136          void S0S5_EC_VPP_PWREN(void)
1137          {
1138   1              EC_VPP_PWREN_LOW();
1139   1      }
1140          //MEILING001:E+
1141          
1142          void S0S5_GPO7(void)
1143          {
1144   1              //VGA_AC_DET_LO();
1145   1      }
1146          
1147          void S0S5_SYS_ON(void)
1148          {
1149   1              SYSON_LOW();
1150   1              Write_NOVOS4();
1151   1      }
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 20  

1152          void S0S5_DPWROK_OFF(void)
1153          {
1154   1              if(IS_MASK_CLEAR(cCmd, bPCHPWR_Keep))
1155   1              {
1156   2                  // DPWROK_EC_LOW();
1157   2              RSMRST_LOW(); 
1158   2          }
1159   1      }
1160          
1161          
1162          void S0S5_Init_Status(void)
1163          {
1164   1      BYTE EVENT_BUFFER_CNT;//72JERRY063:Clear Qevent Buffer when enter S3, S5, and LPC RESET.
1165   1              F2_Pressed=0; //ANGELAG001: ADD
1166   1              CLEAR_MASK(pProject4,pPWSWdisable);//HEGANGS028:Disable POWERSW when flash bios
1167   1              //DSxPowState = SYSTEM_S3S4; //ANGELAS045:remove
1168   1              //ANGELAS033:Add start  
1169   1      /*              
1170   1              if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
1171   1              {
1172   1              if(IS_MASK_SET(pProject0,b1uFUdayClr))
1173   1              {
1174   1                      batteryFirstUsedDateH = 0x00;
1175   1                              batteryFirstUsedDateL = 0x00;
1176   1                      if(bRWSMBus(SMbusChB,SMbusWW,SmBat_Addr,FirstUsedDate,&batteryFirstUsedDateL,SMBus_NeedPEC))
1177   1                      {
1178   1                              CLEAR_MASK(pProject0,b1uFUdayClr);
1179   1                              RamDebug(0xAD);
1180   1                      }
1181   1              }
1182   1              }
1183   1      */
1184   1              //ANGELAS033:Add end
1185   1      //72JERRY063:s+Clear Qevent Buffer when enter S3, S5, and LPC RESET.
1186   1              for( EVENT_BUFFER_CNT=0; EVENT_BUFFER_CNT<=EVENT_BUFFER_SIZE; EVENT_BUFFER_CNT++)
1187   1              {
1188   2                                               SCI_Event_Buffer[EVENT_BUFFER_CNT] = 0x00;                                             
1189   2              }
1190   1              SCI_Event_In_Index      = 0x00;                                                                                                           //clear SCI index   
1191   1              SCI_Event_Out_Index = 0x00;
1192   1              //72JERRY063:e+Clear Qevent Buffer when enter S3, S5, and LPC RESET. 
1193   1              Bioswatchdog=0;////ANGELAS106:Optimize ANGELAS094 clear time.
1194   1              //SysPowState = SYSTEM_S5; //ANGELAS045:remove
1195   1              cDev.fbit.cD_WovMFGtest = 0;//72JERRY065:Add CMD 0x59 test voice wake up for MFG.
1196   1              uNovoVPCCount = 0;                              // Clear NOVO VPC status.
1197   1              uWOVSTATUS =0;                                  // Clear WOV status.//Add voice wake up cmd for BIOS.
1198   1              nCpuTemp = TEMP_Buff_1 = TEMP_Buff_2 = TEMP_Buff_3 = TEMP_Buff_4 = TEMP_Buff_5 = TEMP_Buff_6 = TEMP_Buff_
             -7 = TEMP_Buff_8 = TEMP_Buff_9 = TEMP_Buff_10 = TEMP_Buff_0 =0x00; //:Clear CPU & VGA & thermal IC temp after system shut
             -down or enter s3.//72JERRY057:Update fan table follow'720S_13IKB fan table_V03'.
1199   1              VGA_TEMP = VGA_TBuff3 = VGA_TBuff2 = VGA_TBuff1 = 0x00; //:Clear CPU & VGA & thermal IC temp after system
             - shutdown or enter s3.
1200   1              nNBTemp = nRamTemp =0;//:Clear CPU & VGA & thermal IC temp after system shutdown or enter s3.
1201   1              CLEAR_MASK(nBatteryStatH, CMBS_CRITICALLOW); 
1202   1              CPU_TYPE &= 0x3f;//:CLEAR BIT6 and BIT7 Unit abnormal shuntdown will not clear GPU flag,so when enter S5,
             -WB and S3 we clear GPU flag to not read GPU temperature.
1203   1              CPU_Shut_Cnt = VGA_Shut_Cnt = EXTVGA_Shut_Cnt = 0;      // Clear shutdown conunt.
1204   1              ERR_THMSTS = 0;                                 // Clear thermal status fail bit.
1205   1              Thro_Status = Thro_Status2 = 0; // clear Throttling status.
1206   1              ECSleepCount = 3;                               // Delay entry EC sleep.
1207   1      #if TouchPad_only
1208   1          PowerOffClearTPPendingData();
1209   1      #endif
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 21  

1210   1          if(Read_LID_SW_IN())
1211   1              SET_MASK(SWI_EVENT,LID);
1212   1          else
1213   1              CLEAR_MASK(SWI_EVENT,LID);
1214   1      
1215   1             
1216   1              if (cSysActionFlag == SysAction_EC_Restart || cSysActionFlag == SysAction_SysShutdown_EC_AutoBoot)
1217   1              {
1218   2                  WinFlashMark = 0x53;
1219   2              WinFlashMark2 = 0x35;
1220   2                      InternalWDTNow(SYSACTION_ID);
1221   2              }
1222   1              //else if(( (WinFlashMark == 0xFC)&&(WinFlashMark1==0x55)) || (cSysActionFlag == SysAction_EC_Shutdown)) 
             -//ANGELAG012:remove.
1223   1              else if(cSysActionFlag == SysAction_EC_Shutdown) //ANGELAG012:add.
1224   1              {
1225   2                      WinFlashMark = 0xAA;
1226   2                      WinFlashMark1=0x88;
1227   2                      InternalWDTNow(FLASH_ID);
1228   2              }
1229   1      
1230   1              Clr_Thermal_Tab();      // Clear Thermal table value.
1231   1      
1232   1              if(IS_MASK_SET(SysStatus,LidKBIgnore))
1233   1              {
1234   2                      Ccb42_DISAB_KEY = 0;
1235   2                      Flag.SCAN_INH = 0;      // not Inhibit scanner (internal keyboard).
1236   2                      Unlock_Scan();          // UnLock scanner
1237   2                      CLEAR_MASK(SysStatus,LidKBIgnore);
1238   2              }
1239   1      #if SUPPORT_PMIC
1240   1              //ANGELAG007: add start
1241   1              if(PowerOVP_REG|PowerUVP_REG|PowerOCP_REG|PowerOTP_REG)
1242   1              {
1243   2                      if ( IS_MASK_CLEAR(SysStatus, ERR_ShuntDownFlag) )
1244   2                      { ProcessSID(PMIC_Shutdown_ID); }
1245   2              }
1246   1              //ANGELAG007: add end
1247   1      
1248   1              PollingOTP();//MEILING002:add.
1249   1      #endif
1250   1              if ( IS_MASK_CLEAR(SysStatus, ERR_ShuntDownFlag) )
1251   1              { ProcessSID(S5_ID); }
1252   1              CLEAR_MASK(SysStatus,ERR_ShuntDownFlag);        // Clear Shutdown ID bit.
1253   1              initMark = 0x00;        // CMW 20121203 for PS8625 translator
1254   1              TEMP_Error = 0x00; // CMW 20121203 for PS8625 translator
1255   1              PECI_Err_CNT=0;//When enter S3/S4/S4,clear PECI fail count.
1256   1              // PECI_INDW;                   // Set PECI pin to ALT.//Change PECI initialize after S0 states.//: +remove  AND 
1257   1          //CLR_MASK(GCR2, PECIE);     // Enable PECI//Change PECI initialize after S0 states.//: +remove  AND 
1258   1              Lowpower_ENfunction(); 
1259   1      //ANGELAG008: add start
1260   1              CLEAR_MASK(pDevStatus3,b6EnDisTPSend);
1261   1              CLEAR_MASK(pDevStatus3,b7TPStateFormer);
1262   1              CLEAR_MASK(pDevStatus1,b0F6ScanCodeSend);
1263   1              CLEAR_MASK(pDevStatus1,b1F6DisableTP);
1264   1              CLEAR_MASK(pDevStatus1,b4LNVAPP_STATUS);
1265   1              CLEAR_MASK(pDevStatus1,b5TPDRIVER_STATUS);
1266   1              CLEAR_MASK(pDevStatus1,b6MODE_STATUS);
1267   1              //CLEAR_MASK(pDevStatus1,b7DisableTP);//72JERRY043:Support PTP TP show OSD,there isn't driver notify EC T
             -P status,EC keep flag to rom.
1268   1              EC_TP_ON_LOW();//disable tp//72JERRY056:Add enable/disable TP function by HW pin.
1269   1              SET_MASK(pDevStatus1, b7DisableTP);//72JERRY056:Add enable/disable TP function by HW pin.
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 22  

1270   1              
1271   1      //ANGELAG008: add end
1272   1              SysPowState = SYSTEM_S5;
1273   1              
1274   1              if((ONEKEY_TEMP_FLAG)&&(IS_MASK_SET(OEMControl,b3ONEKEY_POWERUP)))//HEGANGS025: Modify onekey battery fun
             -ction
1275   1              {
1276   2                      S4S5_KeyWake(0);
1277   2              }
1278   1              ONEKEY_FLAG = 0;
1279   1              ONEKEY_TEMP_FLAG = 0;
1280   1              CLEAR_MASK(OEMControl,b3ONEKEY_POWERUP);
1281   1      }
1282          
1283          //-------------------------------------------------------------------------------------
1284          //  Do S0 -> S5 power sequnce
1285          //-------------------------------------------------------------------------------------
1286          const sPowerSEQ code asPowerSEQS0S5[]=
1287          {
1288                  { 0x0000,                               0,              0,  },  // Dummy step always in the top of tabel
1289                  { S0S5_VR_ON,                   0,              0,      },  
1290                  { S0S5_SUSP,                    0,              0,  },
1291                  { S0S5_SYS_ON,                  0,              0,      },
1292                  { S0S5_EC_VCCST_EN,             30,             0,      }, 
1293                  { S0S5_EC_VPP_PWREN,    10,     0,  },
1294                  { S0S5_Init_Status,             0,              0,      },
1295          };
1296          
1297          //----------------------------------------------------------------------------
1298          // S0 to S5 sequnce
1299          //----------------------------------------------------------------------------
1300          void Oem_S0S5Sequence(void)
1301          {
1302   1              if ( PowSeqDelay != 0x00 )
1303   1              {
1304   2                      PowSeqDelay--;                          //1m Sec count base
1305   2                      if ( PowSeqDelay != 0x00 )
1306   2                      {
1307   3                              return;
1308   3                      }
1309   2              }
1310   1      
1311   1              while(PWSeqStep<(sizeof(asPowerSEQS0S5)/sizeof(sPowerSEQ)))
1312   1              {
1313   2                      if(asPowerSEQS0S5[PWSeqStep].checkstatus==0x00) // Do function
1314   2                      {
1315   3                              (asPowerSEQS0S5[PWSeqStep].func)();
1316   3                              PowSeqDelay = asPowerSEQS0S5[PWSeqStep].delay;
1317   3                              PWSeqStep++;
1318   3                              if(PowSeqDelay!=0x00)
1319   3                              {
1320   4                                      break;
1321   4                              }
1322   3                      }
1323   2                      else                                                                                    // Check input status pin
1324   2                      {
1325   3                              if((asPowerSEQS0S5[PWSeqStep].func)())
1326   3                              {
1327   4                                      PowSeqDelay = asPowerSEQS0S5[PWSeqStep].delay;
1328   4                                      PWSeqStep++;
1329   4                              }
1330   3                              break;
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 23  

1331   3                      }
1332   2              }
1333   1      }
1334          
1335          //============S0 -> S3==========================================================
1336          void S0S3_VR_ON(void)
1337          {
1338   1              SYS_PWROK_LOW();
1339   1              PCH_PWROK_LOW();
1340   1              VR_ON_OFF();    
1341   1              EC_VCCST_PWRGD_LOW();
1342   1              EC_VCCIO_EN_LOW();
1343   1              #if     Support_External_IO     //cwy
                      NVDD_PWR_EN_LOW();
                      S_NVDD_PWR_EN_LOW();
                      S_DGPU_PWR_EN_LOW();
                      DGPU_PWR_EN_LOW();
                      #endif  // Support_External_IO
1349   1      }
1350          
1351          void S0S3_SUSP(void)
1352          {
1353   1              SUSP_OFF();
1354   1              #if     Support_External_IO
                      DGPU_HOLD_RST_LOW();
                      S_DGPU_RST_LOW();
                      #endif  // Support_External_IO
1358   1              SetS5GPIO();
1359   1              //USB_CHG_EN_HI();//72JERRY008:-
1360   1          //CHG_MOD1_LOW();//72JERRY008:-
1361   1          //CHG_MOD2_HI();//72JERRY008:-
1362   1          //CHG_MOD3_LOW();//72JERRY008:-
1363   1      }
1364          void S0S3_EC_VCCST_EN(void)
1365          {
1366   1              EC_VCCST_EN_LOW();
1367   1      }
1368          void S0S3_GPO7(void)
1369          {
1370   1      //      VGA_AC_DET_LO();
1371   1      }
1372          void S0S3_Init_Status(void)
1373          {
1374   1      BYTE EVENT_BUFFER_CNT;//72JERRY063:Clear Qevent Buffer when enter S3, S5, and LPC RESET.
1375   1              #if     Support_External_IO
                      Init_IT8302();  //cwy
                      #endif  // Support_External_IO
1378   1              CPU_TYPE &= 0x3f;//:CLEAR BIT6 and BIT7 Unit abnormal shuntdown will not clear GPU flag,so when enter S5,
             -WB and S3 we clear GPU flag to not read GPU temperature.
1379   1              CPU_Shut_Cnt = VGA_Shut_Cnt = EXTVGA_Shut_Cnt = 0;      // Clear shutdown conunt.
1380   1              nCpuTemp = TEMP_Buff_1 = TEMP_Buff_2 = TEMP_Buff_3 = TEMP_Buff_4 = TEMP_Buff_5 = TEMP_Buff_6 = TEMP_Buff_
             -7 = TEMP_Buff_8 = TEMP_Buff_9 = TEMP_Buff_10 = TEMP_Buff_0 =0x00; //:Clear CPU & VGA & thermal IC temp after system shut
             -down or enter s3.//72JERRY057:Update fan table follow'720S_13IKB fan table_V03'.
1381   1              VGA_TEMP = VGA_TBuff3 = VGA_TBuff2 = VGA_TBuff1 = 0x00; //:Clear CPU & VGA & thermal IC temp after system
             - shutdown or enter s3.
1382   1              nNBTemp = nRamTemp =0;//:Clear CPU & VGA & thermal IC temp after system shutdown or enter s3.
1383   1              //SysPowState=SYSTEM_S3;  //ANGELAS045:remove
1384   1              //DSxPowState = SYSTEM_S3S4;  //ANGELAS045:remove
1385   1      //72JERRY063:s+Clear Qevent Buffer when enter S3, S5, and LPC RESET.
1386   1              for( EVENT_BUFFER_CNT=0; EVENT_BUFFER_CNT<=EVENT_BUFFER_SIZE; EVENT_BUFFER_CNT++)
1387   1              {
1388   2                                               SCI_Event_Buffer[EVENT_BUFFER_CNT] = 0x00;                                             
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 24  

1389   2              }
1390   1              SCI_Event_In_Index      = 0x00;                                                                                                           //clear SCI index   
1391   1              SCI_Event_Out_Index = 0x00; 
1392   1              //72JERRY063:e+Clear Qevent Buffer when enter S3, S5, and LPC RESET.
1393   1      #if TouchPad_only
1394   1          PowerOffClearTPPendingData();
1395   1      #endif  
1396   1              Clr_Thermal_Tab();                              // Clear Thermal table value.
1397   1              ERR_THMSTS = 0;                                 // Clear thermal status fail bit.
1398   1              Thro_Status = Thro_Status2 = 0; // clear Throttling status.  
1399   1              AOAC_STATUS &= 0x10;                    // Clear ISCT status.
1400   1              initMark = 0x00;        // CMW 20121203
1401   1              TEMP_Error = 0x00;      // CMW 20121203
1402   1              // EC_TS_ON_INPUT;   //   turn off touch sensor power
1403   1         // EC_TS_ON_LOW();//Turn off touch pad sensor power in s5/s3.  //MEILING001:add.
1404   1          PECI_Err_CNT=0;//:When enter S3/S4/S4,clear PECI fail count.
1405   1              // PECI_INDW;                   // Set PECI pin to ALT.//:Change PECI initialize after S0 states.//: +remove  AND 
1406   1              // CLR_MASK(GCR2, PECIE);     // Enable PECI//:Change PECI initialize after S0 states.//: +remove  AND
1407   1              Lowpower_ENfunction(); //ANGELAS047:add
1408   1      //ANGELAG008: add start
1409   1              CLEAR_MASK(pDevStatus3,b6EnDisTPSend);
1410   1              CLEAR_MASK(pDevStatus3,b7TPStateFormer);
1411   1              CLEAR_MASK(pDevStatus1,b0F6ScanCodeSend);
1412   1              CLEAR_MASK(pDevStatus1,b1F6DisableTP);
1413   1          CLEAR_MASK(pDevStatus1,b2DisableKB);
1414   1               Enable_Any_Key_Irq();
1415   1              YogaModeStatus = 0x00;
1416   1              CLEAR_MASK(pDevStatus1,b4LNVAPP_STATUS);
1417   1              CLEAR_MASK(pDevStatus1,b5TPDRIVER_STATUS);
1418   1                      CLEAR_MASK(pDevStatus1,b6MODE_STATUS);
1419   1              EC_TP_ON_LOW();//disable tp//72JERRY056:Add enable/disable TP function by HW pin.
1420   1              SET_MASK(pDevStatus1, b7DisableTP);//72JERRY056:Add enable/disable TP function by HW pin.
1421   1                      //CLEAR_MASK(pDevStatus1,b7DisableTP);//72JERRY043:Support PTP TP show OSD,there isn't driver notify EC 
             -TP status,EC keep flag to rom.
1422   1      //ANGELAG008: add end
1423   1              SysPowState=SYSTEM_S3;  //ANGELAS045:add
1424   1              //72JERRY050:S+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI S
             -PEC.
1425   1         if((!Read_LID_SW_IN())&& !Read_AC_IN())
1426   1              {USB_ON_INPUT;
1427   2              }
1428   1              //72JERRY050:E+Modify the USB mouse can wake up from S3 at DC mode when the LID closed,not follow UI SPEC
             -.
1429   1              DSxPowState = SYSTEM_S3S4;  //ANGELAS045:add
1430   1         
1431   1      }
1432          
1433          //-------------------------------------------------------------------------------------
1434          //  Do S0 -> S3 power sequnce
1435          //-------------------------------------------------------------------------------------
1436          const sPowerSEQ code asPowerSEQS0S3[]=
1437          {
1438                  { 0x0000,                       0,      0,  },  // Dummy step always in the top of tabel
1439                  { S0S3_VR_ON,           0,      0,  }, 
1440                  { S0S3_SUSP,                    0,      0,  },  
1441                  { S0S3_Init_Status,             0,              0,      },
1442          };
1443          
1444          //----------------------------------------------------------------------------
1445          // S0 to S3 sequnce
1446          //----------------------------------------------------------------------------
1447          void Oem_S0S3Sequence(void)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 25  

1448          {
1449   1              if(PowSeqDelay != 0x00 )
1450   1              {
1451   2              PowSeqDelay--;        //1m Sec count base
1452   2              if(PowSeqDelay != 0x00 )
1453   2              {
1454   3                      return;
1455   3              }
1456   2              }
1457   1      
1458   1              while(PWSeqStep<(sizeof(asPowerSEQS0S3)/sizeof(sPowerSEQ)))
1459   1              {
1460   2              if(asPowerSEQS0S3[PWSeqStep].checkstatus==0x00) // Do function
1461   2              {
1462   3                      (asPowerSEQS0S3[PWSeqStep].func)();
1463   3                      PowSeqDelay = asPowerSEQS0S3[PWSeqStep].delay;
1464   3                      PWSeqStep++;
1465   3                      if(PowSeqDelay!=0x00)
1466   3                      {
1467   4                              break;
1468   4                      }
1469   3              }
1470   2              else                      // Check input status pin
1471   2              {
1472   3                      if((asPowerSEQS0S3[PWSeqStep].func)())
1473   3                      {
1474   4                              PowSeqDelay = asPowerSEQS0S3[PWSeqStep].delay;
1475   4                              PWSeqStep++;
1476   4                      }
1477   3                      break;
1478   3              }
1479   2              }
1480   1      }
1481          
1482          //============S3 -> S0==========================================================
1483          void S3S0_PM_PWER_BTN1(void)
1484          {
1485   1              PM_PWRBTN_LOW();
1486   1      }
1487          
1488          void S3S0_PM_PWER_BTN2(void)
1489          {
1490   1              PM_PWRBTN_HI();
1491   1              SysPowState=SYSTEM_S3;
1492   1      }
1493          void S3S0_EC_VCCST_EN(void)
1494          {
1495   1              EC_VCCST_EN_HI();
1496   1      }
1497          void S3S0_GPO7(void)
1498          {
1499   1      //VGA_AC_DET_HI();
1500   1      }
1501          void S3S0_SUSP(void)
1502          {
1503   1              PM_PWRBTN_HI();
1504   1              SUSP_ON();
1505   1              SetS0GPIO();
1506   1              USB_ON_OUTPUT;
1507   1              USB_ON_LOW();
1508   1              //USB_CHG_EN_HI();//72JERRY008:-
1509   1          //CHG_MOD1_HI();//72JERRY008:-
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 26  

1510   1         // CHG_MOD2_HI();//72JERRY008:-
1511   1         // CHG_MOD3_LOW();//72JERRY008:-
1512   1          //LAN_PWR_IN; 
1513   1              #if     Support_External_IO
                      DGPU_PWR_EN_HI();
                      S_DGPU_PWR_EN_HI();
                      Delay1MS(7);
                      NVDD_PWR_EN_HI();
                      S_NVDD_PWR_EN_HI();
                      #endif  // Support_External_IO
1520   1      }
1521          
1522          void S3S0_EC_VCCIO_EN(void)
1523          {
1524   1              EC_VCCIO_EN_HI();
1525   1      }
1526          
1527          void S3S0_VCCST_PWRGD(void)
1528          {
1529   1              EC_VCCST_PWRGD_HI();
1530   1      }
1531          
1532          void S3S0_VR_ON(void)
1533          {
1534   1              VR_ON_ON();
1535   1              MuteCount = 18;  
1536   1              //: for EM9 adapter detection and protection    
1537   1          if (IS_MASK_SET(SYS_STATUS,AC_ADP))   
1538   1          {
1539   2                      //ADAPTERIDON_LOW(); //MEILINNG001:remove.
1540   2                      AdapterIDOn_Flag = 0x01; //MEILING001:add.
1541   2                      ADPIDON10MS_NUM=0x20;
1542   2          }
1543   1              //:for EM9 adapter detection and protection 
1544   1      }
1545          void PCH_PWROK(void)
1546          {
1547   1              PCH_PWROK_HI();
1548   1      }
1549          
1550          
1551          void S3S0_Init_Status(void)
1552          {
1553   1              Fan_ON_Count = FAN_Boot_On;     // Turn on Fan 3 Sec.
1554   1              //SysPowState = SYSTEM_S0; //ANGELAS045:remove
1555   1              //DSxPowState = SYSTEM_S3S4;    // Clear Deep status. //ANGELAS045:remove
1556   1          RamDebug(0x9B);
1557   1          // AOAC_INPUT();   
1558   1              //LED_KB_PWM_Count = 3; // Turn on KB BL LED.  //MEILING030:remove.
1559   1              CLR_MASK(cCmd, b3BkOff);        // Turn on backlight.
1560   1              CLR_MASK(OEMControl, b1BkOff); //ANGELAG005:add
1561   1              BackLight_En_Delay = 3;         // Delay 30msec turn on backlight.
1562   1          delayEDPTm = 40;                           // Delay 100ms to initial EDP. // CMW Temp
1563   1              //SetACIN_Int(); //ANGELAS079:remove
1564   1              SET_MASK(pDevStus, pENABLE_TP); // Turn on TouchPad.
1565   1              CURRENT_STATUS &= 0xC0;                 //(JSN20120614) Clear flags of entering and resuming from S3 & S4 &S5
1566   1              //turn on touch sensor power
1567   1              //if ( uMBID & 0x08 )  //T28A +: add MBID judge.
1568   1              //if ( uMBID & 0x08 )  //T28A +: add MBID judge.  //T028C+
1569   1           {
1570   2                //EC_TS_ON_OUTPUT;
1571   2                //EC_TS_ON_LOW();//Remove  for SIT unit.//:-Add touch panel control signal. 
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 27  

1572   2                //EC_TS_ON_HI(); //MEILING001:add.
1573   2           }      
1574   1              //if ( (IS_MASK_SET(ACPI_HOTKEY,b5BIOS_IFFS)) )
1575   1              //{ EC_LID_OUT_HI(); }
1576   1              Lowpower_DISfunction(); //ANGELAS047:add
1577   1              EC_TP_ON_HI();//enable TP//72JERRY056:Add enable/disable TP function by HW pin.
1578   1              CLEAR_MASK(pDevStatus1, b7DisableTP);//enable TP//72JERRY056:Add enable/disable TP function by HW pin.
1579   1              SysPowState = SYSTEM_S0;   //ANGELAS045:add
1580   1              DSxPowState = SYSTEM_S3S4;      // Clear Deep status. //ANGELAS045:add
1581   1      }
1582          
1583          //-------------------------------------------------------------------------------------
1584          //  Do S3 -> S0 power sequnce
1585          //-------------------------------------------------------------------------------------
1586          const sPowerSEQ code asPowerSEQS3S0[]=
1587          {
1588                  { 0x0000,                       0,      0,  },  // Dummy step always in the top of tabel
1589                  { S3S0_PM_PWER_BTN1,    20,             0,  },
1590                  { S3S0_PM_PWER_BTN2,    2,      0,  },
1591                  { S3S0_SUSP,                    2,      0,  },          
1592                  { S3S0_EC_VCCIO_EN,     50,     0,  },          
1593                  { S3S0_VCCST_PWRGD,     5,      0,  },          
1594                  { S3S0_VR_ON,                   0,              0,      },
1595                  { SLPS3_Sleep_En,       0,      0,  }, //ANGELAS063:add
1596                  { SLPS4_Sleep_En,       0,      0,  }, //ANGELAS063:add
1597                  { S5S0_CHK_VRREADY,             10,             1,      },      //  there S5S0... same as S3S0... 
1598                  { S5S0_PCH_PWROK,               100,    0,      },      //  there S5S0... same as S3S0...  //LMLKBL0013:modify delay time from 85 
             -to 100.
1599                  { S5S0_SYS_PWROK,               110,    0,      },      //  there S5S0... same as S3S0...
1600                  { S3S0_Init_Status,             0,              0,      },
1601          };
1602          
1603          //----------------------------------------------------------------------------
1604          //S3 to S0 Sequence
1605          //----------------------------------------------------------------------------
1606          void Oem_S3S0Sequence(void)
1607          {
1608   1              if(PowSeqDelay != 0x00 )
1609   1              {
1610   2              PowSeqDelay--;        //1m Sec count base
1611   2              if(PowSeqDelay != 0x00 )
1612   2              {
1613   3                      return;
1614   3              }
1615   2              }
1616   1      
1617   1              while(PWSeqStep<(sizeof(asPowerSEQS3S0)/sizeof(sPowerSEQ)))
1618   1              {
1619   2              if(asPowerSEQS3S0[PWSeqStep].checkstatus==0x00) // Do function
1620   2              {
1621   3                      (asPowerSEQS3S0[PWSeqStep].func)();
1622   3                      PowSeqDelay = asPowerSEQS3S0[PWSeqStep].delay;
1623   3                      PWSeqStep++;
1624   3                      if(PowSeqDelay!=0x00)
1625   3                      {
1626   4                              break;
1627   4                      }
1628   3              }
1629   2              else    // Check input status pin
1630   2              {
1631   3                      if((asPowerSEQS3S0[PWSeqStep].func)())
1632   3                      {
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 28  

1633   4                              PowSeqDelay = asPowerSEQS3S0[PWSeqStep].delay;
1634   4                              PWSeqStep++;
1635   4                      }
1636   3                      break;
1637   3              }
1638   2              }
1639   1      }
1640          //=============================================================================
1641          void CheckAutoPowerOn(void)
1642          {
1643   1              if ((WinFlashMark == 0x53) && (WinFlashMark2 == 0x35) && (SystemIsS5 || SystemIsDSX))
1644   1              {
1645   2                      //AutoTimer = 0x01;
1646   2                      AutoTimer = 0x83;
1647   2                      WinFlashMark = 0;
1648   2              WinFlashMark2 = 0;
1649   2              }
1650   1      }
1651          
1652          void Check_EC_ON()
1653          {
1654   1              //if ( IS_MASK_CLEAR(ACPI_HOTKEY, b7BIOS_NoShut)&&(LOWBATT_3TIMES==0)&&((SysStatus2&0x03)== 0))         // Not 
             -cut power in the battery mode for BIOS used.
1655   1              if ( IS_MASK_CLEAR(ACPI_HOTKEY, b7BIOS_NoShut)&&(LOWBATT_3TIMES==0))  
1656   1              {
1657   2                      if ( IS_MASK_CLEAR(ACPI_HOTKEY, b6Cmd_NoShut) ) // Not cut power in the battery mode for command used.
1658   2                      {
1659   3                  //if (!Read_AC_IN())   
1660   3                  //if (!Read_AC_IN()&& (DSxPowState == SYSTEM_DSxOK))//SysPowState
1661   3                  if (!Read_AC_IN()&& (SysPowState == SYSTEM_S5))
1662   3                  {
1663   4                                  //T31- EC_ON_LOW();
1664   4                                  //EC_ON_Flag =0x55;  
1665   4                              #if shipmodesupport             //:add ship mode judge
1666   4                                      if(ShipModeEn==0xA5)
1667   4                                      {
1668   5                                              ShipModeEn=0x00;
1669   5                                              Lock_ShipMode();
1670   5                              GPCRC1=INPUT;
1671   5                              GPCRC2=INPUT;
1672   5                                              Delay1MS(100);                                                     
1673   5                                      }
1674   4                              #endif
1675   4                                              //Delay1MS(10); 
1676   4                                      RSMRST_LOW();
1677   4                                      Delay1MS(2); 
1678   4                                      //PCH_PWR_EN_OFF();
1679   4                                      Delay1MS(12); //:Add 12 ms delay between PCH_PWR_EN_OFF and EC_ON_LOW
1680   4                                      /*//ANGELAS038:remove start
1681   4                                      //ANGELAS005:s+ Support UMA SKU EC_ON pin design.
1682   4                                      //if(NTC_V1>682)        //ANGELAS007:Optimize power on sequence.
1683   4                                      if(NTC_FLAG)//ANGELAS007:Optimize power on sequence.
1684   4                                      {
1685   4                                              CLR_MASK(GPDRF,BIT(0));
1686   4                                              //GPCRF0 = INPUT; //ANGELAS020
1687   4                                      }
1688   4                                      else
1689   4                                      //ANGELAS005:e+ Support UMA SKU EC_ON pin design.
1690   4                                      *///ANGELAS038:remove end
1691   4                                  EC_ON_LOW();    
1692   4                                      PM_PWRBTN_LOW();
1693   4                                      //LID_readytime = 11 ;   //ANGELAS007:Optimize power on sequence.                                                                       // LID switch wakeup time = 1
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 29  

             -00ms
1694   4                                      CLR_MASK(LENOVOPMFW_Temp,b3EC_ONStatus);
1695   4                                      SET_MASK(LENOVOPMFW_Temp,b5EC_ON_EN);             
1696   4                          }
1697   3          
1698   3                              return;
1699   3                      }
1700   2              }
1701   1              SET_MASK(LENOVOPMFW_Temp,b3EC_ONStatus);
1702   1              CLR_MASK(LENOVOPMFW_Temp,b5EC_ON_EN);
1703   1      }
1704          
1705          //ANGELAS041:add start
1706          void check8sreset(void)
1707          {
1708   1              
1709   1              RamDebug(ShutDnCause);
1710   1              Init_SMBus_Regs();
1711   1              if(IS_MASK_SET(PWRSW8SRST,BIT1))  //ANGELAS089:add
1712   1          {  
1713   2              SET_MASK(SysStatus2, b3EC8S_Reset);
1714   2              RamDebug(0xA8);
1715   2          }
1716   1          else 
1717   1          {
1718   2              CLEAR_MASK(SysStatus2, b3EC8S_Reset);
1719   2              RamDebug(0xA9);
1720   2          }
1721   1      }
1722          //ANGELAS041:add end
1723          
1724          
1725          
1726          void SendSynapticsIDSequence()
1727          {
1728   1          BYTE Temp;
1729   1      
1730   1              Temp=0;
1731   1              do 
1732   1              {
1733   2                      Send2PortNWait(0x02, 0xE8, 1);
1734   2                      Send2PortNWait(0x02, 0x00, 1);
1735   2                      Temp++;
1736   2              }while(Temp<4);
1737   1      
1738   1              Send2PortNWait(0x02, 0xE9, 4);
1739   1      }
1740          
1741          void SendElanIDSequence()
1742          {
1743   1          Send2PortNWait(0x02, 0xE6, 1);
1744   1          Send2PortNWait(0x02, 0xE6, 1);
1745   1          Send2PortNWait(0x02, 0xE6, 1);
1746   1          Send2PortNWait(0x02, 0xE9, 4);
1747   1      }
1748          void SendALPSIDSequence()
1749          {
1750   1          Send2PortNWait(0x02, 0xE7, 1);
1751   1          Send2PortNWait(0x02, 0xE7, 1);
1752   1          Send2PortNWait(0x02, 0xE7, 1);
1753   1          Send2PortNWait(0x02, 0xE9, 4);
1754   1      }
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 30  

1755          void ReadTPid()
1756          {
1757   1          //BYTE Temp;
1758   1          // if((TP_Type == 0x01)||(TP_Type == 0x02)||(TP_Type == 0x03)) //G34: remove read TP ID only one time.
1759   1             // return;
1760   1          SendSynapticsIDSequence();
1761   1      
1762   1          if(TPID3 == 0x47)
1763   1          {
1764   2              TP_Type = 0x02;         // Synatics TouchPad.
1765   2          }
1766   1          else
1767   1          {
1768   2              SendElanIDSequence();
1769   2              if(TPID2 == 0x3C)
1770   2              {
1771   3                  TP_Type = 0x01;     // ELAN ToucnPad.
1772   3              }
1773   2             else
1774   2            {
1775   3                 SendALPSIDSequence();
1776   3                 if(TPID2==0x73)
1777   3                {
1778   4                      TP_Type =0x03;
1779   4                }
1780   3                 
1781   3             }  
1782   2              }
1783   1      
1784   1              /*
1785   1              Temp = Read_Eflash_Byte(0x01,0xB0,0xEF);
1786   1      
1787   1              if(Temp != TP_Type)
1788   1              {
1789   1                      eEEPROMBank= 0x00;
1790   1                      eEEPROMAddrsss = 0xEF;
1791   1                      eEEPROMData     = TP_Type;
1792   1                      Update_EEPROMMark();
1793   1              }
1794   1              */
1795   1      }
1796          
1797          void Write_NOVOS4(void)
1798          {
1799   1              if(IS_MASK_CLEAR(LENOVOPMFW_Temp,EEPROM_Token))
1800   1              {
1801   2                      EEPROM_PwrSts = Read_Eflash_Byte(EEPROMA2,(EEPROMA1_B03 | 0x07) ,0xDF);
1802   2                      if(CURRENT_STATUS & ENTER_S4) // S4
1803   2                      {       // Entering S4
1804   3                              //if ( (SYS_STATUS & 0x07) == 0x04 )
1805   3                              if (( (SYS_STATUS & 0x07) >= 0x04 )&&( (SYS_STATUS & 0x07) <= 0x06))    // Win8 or win10 ANGELAS010: add w
             -in10 mode
1806   3                              {       // Win8
1807   4                                      if( (EEPROM_PwrSts & 0x10) == 0 )               // check S4 bit to before.
1808   4                                  {
1809   5                                              if( (EEPROM_PwrSts & 0x01) != 0 )       // check WIN8 bit to before.
1810   5                                              {
1811   6                                                      eEEPROMAddrsss = 0xDF;
1812   6                                                      eEEPROMBank = 0x07;
1813   6                                                      eEEPROMData = EEPROM_PwrSts = 0xEE;
1814   6                                                      Update_EEPROMMark();
1815   6                                              }
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 31  

1816   5                                  }
1817   4                                      else
1818   4                                      {
1819   5                                              eEEPROMAddrsss = 0xDF;
1820   5                                              eEEPROMBank = 0x07;
1821   5                                              eEEPROMData = EEPROM_PwrSts = 0xEE;
1822   5                                              Update_EEPROMMark();
1823   5                                      }
1824   4                              }
1825   3                              else
1826   3                              {       // Win7 or other.
1827   4                                      if( (EEPROM_PwrSts & 0x10) == 0 )               // check S4 bit to before.
1828   4                                  {
1829   5                                              if( (EEPROM_PwrSts & 0x01) == 0 )       // check WIN8 bit to before.
1830   5                                              {
1831   6                                                      eEEPROMAddrsss = 0xDF;
1832   6                                                      eEEPROMBank = 0x07;
1833   6                                                      eEEPROMData = EEPROM_PwrSts = 0xEF;
1834   6                                                      Update_EEPROMMark();
1835   6                                              }
1836   5                                  }
1837   4                                      else
1838   4                                      {
1839   5                                              eEEPROMAddrsss = 0xDF;
1840   5                                              eEEPROMBank = 0x07;
1841   5                                              eEEPROMData = EEPROM_PwrSts = 0xEF;
1842   5                                              Update_EEPROMMark();
1843   5                                      }
1844   4                              }
1845   3                      }
1846   2                      else // S5
1847   2                      {
1848   3                              if ( (EEPROM_PwrSts & 0x10) == 0 )              // check S4 bit to before.
1849   3                              {
1850   4                                      eEEPROMAddrsss = 0xDF;
1851   4                                      eEEPROMBank = 0x07;
1852   4                                      eEEPROMData = EEPROM_PwrSts = 0xFF;
1853   4                                      Update_EEPROMMark();
1854   4                              }
1855   3                              else
1856   3                              {
1857   4                                      if ( (EEPROM_PwrSts & 0x01) == 0 )      // check S4 bit to before.
1858   4                                      {
1859   5                                              //if ( (SYS_STATUS & 0x07) != 0x04 )    // Check WIN8.
1860   5                                              if (!( (SYS_STATUS & 0x07) >= 0x04 )&&( (SYS_STATUS & 0x07) <= 0x06))   // check not Win8, win8.1  or w
             -in10 ANGELAS010: add win10 mode
1861   5                                              {
1862   6                                                      eEEPROMAddrsss = 0xDF;
1863   6                                                      eEEPROMBank = 0x07;
1864   6                                                      eEEPROMData = EEPROM_PwrSts = 0xFF;
1865   6                                                      Update_EEPROMMark();
1866   6                                              }
1867   5                                      }
1868   4                              }
1869   3                      }
1870   2              }
1871   1      }
1872          
1873          //-----------------------------------------------------------------------------
1874          // The function of pulsing S.B. power button 100ms
1875          //-----------------------------------------------------------------------------
1876          void PulseSBPowerButton(void)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 32  

1877          {
1878   1              PM_PWRBTN_LOW();
1879   1          SBSWReleaseCunt = 20;   // decrease timer base is 10ms total time 200ms
1880   1      }
1881          
1882          
1883          //-----------------------------------------------------------------------------
1884          // The function of releasing S.B. power button
1885          //-----------------------------------------------------------------------------
1886          void CheckSBPowerButton(void)
1887          {
1888   1              if(SBSWReleaseCunt!=0x00)
1889   1              {
1890   2                      SBSWReleaseCunt--;
1891   2                      if(SBSWReleaseCunt==0x00)
1892   2                      {
1893   3                              PM_PWRBTN_HI();
1894   3                      }
1895   2              }
1896   1      }
1897          
1898          void GC6_FBClamp(void)
1899          {
1900   1              
1901   1              if( (IS_MASK_SET(SYS_MISC1, ACPI_OS)) && (SystemNotS3) && (SystemNotS5) )
1902   1              {  
1903   2                      // for GC6  function control by interrupt
1904   2              if(IS_MASK_CLEAR(FBClamp, REQactive))
1905   2              {
1906   3                              WUEMR7 |= 0x02;
1907   3                              WUESR7 = 0x02;
1908   3                              SET_MASK(IER9, Int_WKO71);
1909   3                              SET_MASK(FBClamp, REQactive);
1910   3              }
1911   2          }
1912   1              else
1913   1              {
1914   2                      //FB_Clamp_OFF();
1915   2                      CLR_MASK(FBClamp, FBClamp_EN);
1916   2      
1917   2                      if(IS_MASK_SET(FBClamp, REQactive))
1918   2                      {
1919   3                              CLR_MASK(IER9, Int_WKO71);
1920   3                              CLEAR_MASK(FBClamp, REQactive);
1921   3                      }
1922   2              }
1923   1              /*    
1924   1             if(!Read_GC6_EVENT()&& IS_MASK_SET(FBClamp, FBClamp_REQ))
1925   1              {
1926   1                      if(IS_MASK_CLEAR(FBClamp, FBClamp_EN))
1927   1                      {
1928   1                              FB_Clamp_ON();
1929   1                              SET_MASK(FBClamp, FBClamp_EN);
1930   1                              return;
1931   1                      }
1932   1                      else
1933   1                      {
1934   1                              FB_Clamp_OFF();
1935   1                              CLR_MASK(FBClamp, FBClamp_EN);
1936   1                              return;
1937   1                      }
1938   1              }
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 33  

1939   1              }
1940   1      
1941   1              else
1942   1              {
1943   1                      FB_Clamp_OFF();
1944   1                      CLR_MASK(FBClamp, FBClamp_EN);
1945   1              }
1946   1              */   
1947   1      }
1948          
1949          //ANGELAS047:add start
1950          void Lowpower_ENfunction(void)
1951          {
1952   1              SET_MASK(CHGIC_WriteCmd0x12H,LOWPWR_EN);
1953   1              if (!bRWSMBus(SMbusChB, SMbusWW, Charger_Addr, C_ChargerMode, &CHGIC_WriteCmd0x12L,SMBus_NoPEC)) //ANGE
             -LAS059:0x12H to 0x12L 
1954   1          {
1955   2                      CHGIC_SMbusFailCnt++;
1956   2                                 
1957   2          }
1958   1      }
1959          
1960          void Lowpower_DISfunction(void)
1961          {
1962   1              CLEAR_MASK(CHGIC_WriteCmd0x12H,LOWPWR_EN);
1963   1              if (!bRWSMBus(SMbusChB, SMbusWW, Charger_Addr, C_ChargerMode, &CHGIC_WriteCmd0x12L,SMBus_NoPEC)) //ANGE
             -LAS059:0x12H to 0x12L 
1964   1          {
1965   2                       CHGIC_SMbusFailCnt++;
1966   2              }
1967   1      }
1968          //ANGELAS047:add end
1969          #if SUPPORT_PMIC
1970          const sPMICStruct code powerInit[] =
1971          {       // command         REG                          
1972          //      { SDWN,                 &PowerSDWN                }, // HEGANGS008£ºMofify power setting
1973                  { EN_MASK,              &PowerEN_MASK     },
1974                  { EN_RW,                &PowerEN_RW               },
1975                  { EN_DEGL_SEL1, &PowerEN_DEGL_SEL1},
1976                  //{ EN_DEGL_SEL2,       &PowerEN_DEGL_SEL2},
1977                  { BUCK1CTRL,    &PowerBUCK1CTRL   },
1978                  { BUCK2CTRL,    &PowerBUCK2CTRL   },
1979                  { BUCK3CTRL,    &PowerBUCK3CTRL   },
1980                  { LDO1CTRL,             &PowerLDO1CTRL    },
1981                  { LDO2CTRL,             &PowerLDO2CTRL    },
1982                  { DISCHCTRL1,   &PowerDISCHCTRL1  },
1983                  { DISCHCTRL2,   &PowerDISCHCTRL2  },
1984                  { OC_CTRL,              &PowerOC_CTRL     },
1985                  { BUCK_FSW,             &PowerBUCK_FSW    },
1986          };
1987          
1988          BYTE CheckInitPMIC(void)
1989          {
1990   1              PowerReturnData=0xFE; //ANGELAN011 add
1991   1              if(!PowerIICWriteByte(0xE2,0x00)) //ANGELAN011 03 to 00
1992   1              {
1993   2                      RamDebug(0xC1);
1994   2                      return 0;
1995   2              }
1996   1              return 1;
1997   1      }
1998          void PMICID(void)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 34  

1999          {
2000   1              if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, VENDODID, &PowerVENDODID,SMBus_NoPEC))
2001   1              {
2002   2                      PowerInitError++;
2003   2              }
2004   1      }
2005          void InitPMICReg(void)
2006          {
2007   1              if(PowerVENDODID == 0)
2008   1              {
2009   2                      PMICID(); //
2010   2              }
2011   1              PowerInitIndex=0;
2012   1              //PowerSDWN = 0x00; // HEGANGS008£ºMofify power setting
2013   1              PowerEN_MASK = 0x80; //
2014   1              PowerEN_RW = 0x80;  //set to 0x80 allow EC write PMIC
2015   1      
2016   1              if(PowerVENDODID==0x53) //5028
2017   1              { 
2018   2                      PowerBUCK1CTRL = 0x26; 
2019   2                      if(Read_EC_ID()) 
2020   2                      {
2021   3                              PowerBUCK2CTRL = 0x24; // GPU is N16
2022   3                      }
2023   2                      else       
2024   2                      {
2025   3                              PowerBUCK2CTRL = 0x2C;// GPU is N17
2026   3                      }
2027   2                      PowerEN_DEGL_SEL1=0x04;
2028   2                      PowerBUCK3CTRL = 0x36; 
2029   2                      PowerLDO1CTRL = 0x1E;  
2030   2                      PowerLDO2CTRL = 0x02; 
2031   2                      PowerDISCHCTRL1 = 0x15;
2032   2                      PowerDISCHCTRL2 = 0x05;
2033   2                      PowerOC_CTRL = 0x26;
2034   2              PowerBUCK_FSW = 0x03; 
2035   2              }
2036   1              else //5075 
2037   1              {
2038   2      
2039   2                      PowerBUCK1CTRL = 0x26; 
2040   2                      if(Read_EC_ID()) 
2041   2                      {
2042   3                              PowerBUCK2CTRL = 0x08; // GPU is N16
2043   3                      }
2044   2                      else       
2045   2                      {
2046   3                              PowerBUCK2CTRL = 0x0C;// GPU is N17
2047   3                      } 
2048   2                      PowerEN_DEGL_SEL1=0x04;
2049   2                      PowerBUCK3CTRL = 0x36; 
2050   2                      PowerLDO1CTRL = 0x1E;  
2051   2                      PowerLDO2CTRL = 0x04;
2052   2                      PowerDISCHCTRL1 = 0x15;
2053   2                      PowerDISCHCTRL2 = 0x05;
2054   2                      PowerOC_CTRL = 0x26;
2055   2                      PowerBUCK_FSW = 0x00; 
2056   2              } 
2057   1      
2058   1              while(PowerInitIndex < (sizeof(powerInit)/sizeof(sPMICStruct)))
2059   1              {
2060   2                      if(PowerIICWriteByte(powerInit[PowerInitIndex].cmd, *powerInit[PowerInitIndex].smbdataA))
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 35  

2061   2                      {
2062   3                              PowerInitIndex++;
2063   3                      }
2064   2                      else
2065   2                      {
2066   3                              PowerInitIndex++;
2067   3                              RamDebug(0xC2);
2068   3                              RamDebug(PowerInitErrorCMD);
2069   3                              RamDebug(PowerInitErrorDATA);
2070   3                      }
2071   2              }
2072   1      
2073   1              if(!PowerIICWriteByte(0xD1,0xBF))  // set to 0xBF, then PMIC run
2074   1              {
2075   2                      RamDebug(0xC3);
2076   2                      RamDebug(PowerInitErrorCMD);
2077   2                      RamDebug(PowerInitErrorDATA);
2078   2              }
2079   1      }
2080          
2081          void InitPMIC(void)
2082          {
2083   1              if(!PowerInitOK)
2084   1              {       
2085   2                      if(CheckInitPMIC())
2086   2                      {
2087   3                              InitPMICReg();
2088   3                              RamDebug(0xC0);
2089   3                              PowerInitOK=1;
2090   3                      }
2091   2              }
2092   1      }
2093          
2094          BYTE PowerIICWriteByte(BYTE Reg_offset, BYTE PS_data)
2095          {
2096   1              PMIC_counter = 0;
2097   1              
2098   1              while(1)
2099   1              {
2100   2                      if(!bRWSMBus(SMbusChA, SMbusWB, powerICaddress, Reg_offset, &PS_data, SMBus_NoPEC))
2101   2                      {
2102   3                              PowerInitError++;
2103   3                              ResetSMBus(SMbusChA); 
2104   3                      }
2105   2                      if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, Reg_offset, &PowerReturnData,SMBus_NoPEC))
2106   2                      {
2107   3                              PowerInitError++;
2108   3                              ResetSMBus(SMbusChA);
2109   3                      }
2110   2                      if(PowerReturnData == PS_data)
2111   2                      {
2112   3                              return 1;
2113   3                      }
2114   2                      else
2115   2                      {
2116   3                              if(PMIC_counter == 5)
2117   3                              {
2118   4                                      return 0;
2119   4                              }
2120   3                              PowerInitErrorCMD=Reg_offset;
2121   3                              PowerInitErrorDATA=PowerReturnData;
2122   3                              PMIC_counter++;
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 36  

2123   3                      }
2124   2              }
2125   1      }
2126          
2127          void PollingOTP(void)
2128          {
2129   1              if(PowerInitOK==1)
2130   1              {
2131   2              //ANGELAG007: add start
2132   2                      if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, OVP_REG, &PowerOVP_REG,SMBus_NoPEC))
2133   2                      {
2134   3                              PowerInitError++;
2135   3                      }
2136   2                      if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, UVP_REG, &PowerUVP_REG,SMBus_NoPEC))
2137   2                      {
2138   3                              PowerInitError++;
2139   3                      }
2140   2                      if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, OCP_REG, &PowerOCP_REG,SMBus_NoPEC))
2141   2                      {
2142   3                              PowerInitError++;
2143   3                      }
2144   2                      //ANGELAG007: add end
2145   2                      if(!bRWSMBus(SMbusChA, SMbusRB, powerICaddress, OTP_REG, &PowerOTP_REG,SMBus_NoPEC))
2146   2                      {
2147   3                              PowerInitError++;
2148   3                      //      ResetSMBus(SMbusChA); //ANGELAG007: REMOVE
2149   3                      }
2150   2              }
2151   1      }
2152          //MEILING002: E+
2153          #endif
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 37  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0175 (BEGIN)
0000         L?0374:
0000 900000      E     MOV     DPTR,#PWSeqStep
0003 E0                MOVX    A,@DPTR
0004 75F005            MOV     B,#05H
0007 A4                MUL     AB
0008 2400        R     ADD     A,#LOW asPowerSEQS5DSX+02H
000A F582              MOV     DPL,A
000C E4                CLR     A
000D 3400        R     ADDC    A,#HIGH asPowerSEQS5DSX+02H
000F         L?0375:
000F F583              MOV     DPH,A
0011 E4                CLR     A
0012 93                MOVC    A,@A+DPTR
0013 FF                MOV     R7,A
0014 7401              MOV     A,#01H
0016 93                MOVC    A,@A+DPTR
0017 900000      E     MOV     DPTR,#PowSeqDelay
001A CF                XCH     A,R7
001B F0                MOVX    @DPTR,A
001C A3                INC     DPTR
001D EF                MOV     A,R7
001E F0                MOVX    @DPTR,A
001F 900000      E     MOV     DPTR,#PWSeqStep
0022 E0                MOVX    A,@DPTR
0023 04                INC     A
0024 F0                MOVX    @DPTR,A
0025 22                RET     
0026         L?0376:
0026         L?0377:
0026 F583              MOV     DPH,A
0028 E4                CLR     A
0029 93                MOVC    A,@A+DPTR
002A FE                MOV     R6,A
002B 7401              MOV     A,#01H
002D 93                MOVC    A,@A+DPTR
002E CA                XCH     A,R2
002F EE                MOV     A,R6
0030 CA                XCH     A,R2
0031 F9                MOV     R1,A
0032 120000      E     LCALL   ?C?ICALL
0035         L?0378:
0035 900000      E     MOV     DPTR,#PWSeqStep
0038 E0                MOVX    A,@DPTR
0039 75F005            MOV     B,#05H
003C A4                MUL     AB
003D 22                RET     
003E         L?0379:
003E 2400        R     ADD     A,#LOW asPowerSEQS5DSX
0040 F582              MOV     DPL,A
0042 E4                CLR     A
0043 3400        R     ADDC    A,#HIGH asPowerSEQS5DSX
0045         L?0380:
0045 F583              MOV     DPH,A
0047 E4                CLR     A
0048 93                MOVC    A,@A+DPTR
0049 FE                MOV     R6,A
004A 7401              MOV     A,#01H
004C 93                MOVC    A,@A+DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 38  

004D CA                XCH     A,R2
004E EE                MOV     A,R6
004F CA                XCH     A,R2
0050 F9                MOV     R1,A
0051 020000      E     LJMP    ?C?ICALL
0054         L?0381:
0054 F0                MOVX    @DPTR,A
0055 900000      E     MOV     DPTR,#TEMP_Buff_0
0058 F0                MOVX    @DPTR,A
0059 900000      E     MOV     DPTR,#TEMP_Buff_10
005C F0                MOVX    @DPTR,A
005D 900000      E     MOV     DPTR,#TEMP_Buff_9
0060 F0                MOVX    @DPTR,A
0061 900000      E     MOV     DPTR,#TEMP_Buff_8
0064 F0                MOVX    @DPTR,A
0065 900000      E     MOV     DPTR,#TEMP_Buff_7
0068 F0                MOVX    @DPTR,A
0069 900000      E     MOV     DPTR,#TEMP_Buff_6
006C F0                MOVX    @DPTR,A
006D 900000      E     MOV     DPTR,#TEMP_Buff_5
0070 F0                MOVX    @DPTR,A
0071 900000      E     MOV     DPTR,#TEMP_Buff_4
0074 F0                MOVX    @DPTR,A
0075 900000      E     MOV     DPTR,#TEMP_Buff_3
0078 F0                MOVX    @DPTR,A
0079 900000      E     MOV     DPTR,#TEMP_Buff_2
007C F0                MOVX    @DPTR,A
007D 900000      E     MOV     DPTR,#TEMP_Buff_1
0080 F0                MOVX    @DPTR,A
0081 900000      E     MOV     DPTR,#nCpuTemp
0084 F0                MOVX    @DPTR,A
0085 900000      E     MOV     DPTR,#VGA_TBuff1
0088 F0                MOVX    @DPTR,A
0089 900000      E     MOV     DPTR,#VGA_TBuff2
008C F0                MOVX    @DPTR,A
008D 900000      E     MOV     DPTR,#VGA_TBuff3
0090 F0                MOVX    @DPTR,A
0091 900000      E     MOV     DPTR,#VGA_TEMP
0094 F0                MOVX    @DPTR,A
0095 900000      E     MOV     DPTR,#nRamTemp
0098 F0                MOVX    @DPTR,A
0099 900000      E     MOV     DPTR,#nNBTemp
009C F0                MOVX    @DPTR,A
009D 22                RET     
009E         L?0382:
009E         L?0383:
009E 900000      E     MOV     DPTR,#PowSeqDelay
00A1 74FF              MOV     A,#0FFH
00A3 F5F0              MOV     B,A
00A5 120000      E     LCALL   ?C?IILDX
00A8 900000      E     MOV     DPTR,#PowSeqDelay
00AB E0                MOVX    A,@DPTR
00AC 22                RET     
00AD         L?0384:
00AD 900000      E     MOV     DPTR,#pDevStatus3
00B0 E0                MOVX    A,@DPTR
00B1 54BF              ANL     A,#0BFH
00B3 F0                MOVX    @DPTR,A
00B4 547F              ANL     A,#07FH
00B6 F0                MOVX    @DPTR,A
00B7 900000      E     MOV     DPTR,#pDevStatus1
00BA E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 39  

00BB 54FE              ANL     A,#0FEH
00BD F0                MOVX    @DPTR,A
00BE E0                MOVX    A,@DPTR
00BF 54FD              ANL     A,#0FDH
00C1 F0                MOVX    @DPTR,A
00C2         L?0385:
00C2 E0                MOVX    A,@DPTR
00C3 54EF              ANL     A,#0EFH
00C5 F0                MOVX    @DPTR,A
00C6 E0                MOVX    A,@DPTR
00C7 54DF              ANL     A,#0DFH
00C9 F0                MOVX    @DPTR,A
00CA E0                MOVX    A,@DPTR
00CB 54BF              ANL     A,#0BFH
00CD F0                MOVX    @DPTR,A
00CE 22                RET     
00CF         L?0386:
00CF         L?0387:
00CF 900000      E     MOV     DPTR,#eEEPROMAddrsss
00D2 74DF              MOV     A,#0DFH
00D4 F0                MOVX    @DPTR,A
00D5 900000      E     MOV     DPTR,#eEEPROMBank
00D8 7407              MOV     A,#07H
00DA F0                MOVX    @DPTR,A
00DB 900000      E     MOV     DPTR,#EEPROM_PwrSts
00DE 22                RET     
00DF         L?0388:
00DF         L?0389:
00DF 900000      E     MOV     DPTR,#PWSeqStep
00E2 7401              MOV     A,#01H
00E4         L?0390:
00E4 F0                MOVX    @DPTR,A
00E5 E4                CLR     A
00E6 900000      E     MOV     DPTR,#PowSeqDelay
00E9 F0                MOVX    @DPTR,A
00EA A3                INC     DPTR
00EB F0                MOVX    @DPTR,A
00EC 22                RET     
00ED         L?0391:
00ED 900000      E     MOV     DPTR,#GPDRF
00F0 E0                MOVX    A,@DPTR
00F1 4401              ORL     A,#01H
00F3 F0                MOVX    @DPTR,A
00F4 900000      E     MOV     DPTR,#GPDRC
00F7 E0                MOVX    A,@DPTR
00F8 4410              ORL     A,#010H
00FA         L?0392:
00FA F0                MOVX    @DPTR,A
00FB         L?0393:
00FB 900000      E     MOV     DPTR,#GPDRF
00FE E0                MOVX    A,@DPTR
00FF 4402              ORL     A,#02H
0101 F0                MOVX    @DPTR,A
0102 22                RET     
0103         L?0394:
0103 A3                INC     DPTR
0104         L?0395:
0104 F0                MOVX    @DPTR,A
0105 E4                CLR     A
0106 A3                INC     DPTR
0107 F0                MOVX    @DPTR,A
0108 7B68              MOV     R3,#068H
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 40  

010A 7D08              MOV     R5,#08H
010C FF                MOV     R7,A
010D 22                RET     
010E         L?0396:
010E 900000      E     MOV     DPTR,#GPDRI
0111 E0                MOVX    A,@DPTR
0112 547F              ANL     A,#07FH
0114 F0                MOVX    @DPTR,A
0115 900000      E     MOV     DPTR,#GPDRH
0118 E0                MOVX    A,@DPTR
0119 54BF              ANL     A,#0BFH
011B F0                MOVX    @DPTR,A
011C 900000      E     MOV     DPTR,#GPDRE
011F E0                MOVX    A,@DPTR
0120 54EF              ANL     A,#0EFH
0122 F0                MOVX    @DPTR,A
0123 900000      E     MOV     DPTR,#GPDRH
0126 E0                MOVX    A,@DPTR
0127 54DF              ANL     A,#0DFH
0129 F0                MOVX    @DPTR,A
012A 900000      E     MOV     DPTR,#GPDRB
012D E0                MOVX    A,@DPTR
012E 54FB              ANL     A,#0FBH
0130 F0                MOVX    @DPTR,A
0131 22                RET     
0132         L?0397:
0132 F0                MOVX    @DPTR,A
0133         L?0398:
0133 900000      E     MOV     DPTR,#cCmd
0136 E0                MOVX    A,@DPTR
0137 54F7              ANL     A,#0F7H
0139 F0                MOVX    @DPTR,A
013A 900000      E     MOV     DPTR,#OEMControl
013D E0                MOVX    A,@DPTR
013E 54FD              ANL     A,#0FDH
0140 F0                MOVX    @DPTR,A
0141 22                RET     
0142         L?0399:
0142 F0                MOVX    @DPTR,A
0143         L?0400:
0143 900000      E     MOV     DPTR,#GPDRJ
0146 E0                MOVX    A,@DPTR
0147 4408              ORL     A,#08H
0149 F0                MOVX    @DPTR,A
014A 900000      E     MOV     DPTR,#pDevStatus1
014D E0                MOVX    A,@DPTR
014E 547F              ANL     A,#07FH
0150 F0                MOVX    @DPTR,A
0151 22                RET     
0152         L?0401:
0152 F0                MOVX    @DPTR,A
0153 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0156 7412              MOV     A,#012H
0158 F0                MOVX    @DPTR,A
0159 7E00        E     MOV     R6,#HIGH CHGIC_WriteCmd0x12L
015B A3                INC     DPTR
015C 7400        E     MOV     A,#HIGH CHGIC_WriteCmd0x12L
015E F0                MOVX    @DPTR,A
015F A3                INC     DPTR
0160 7400        E     MOV     A,#LOW CHGIC_WriteCmd0x12L
0162 F0                MOVX    @DPTR,A
0163 E4                CLR     A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 41  

0164 A3                INC     DPTR
0165 F0                MOVX    @DPTR,A
0166 7B12              MOV     R3,#012H
0168 7D8C              MOV     R5,#08CH
016A 7F01              MOV     R7,#01H
016C 22                RET     
016D         L?0402:
016D 900000      E     MOV     DPTR,#PowerLDO2CTRL
0170 F0                MOVX    @DPTR,A
0171 900000      E     MOV     DPTR,#PowerDISCHCTRL1
0174 7415              MOV     A,#015H
0176 F0                MOVX    @DPTR,A
0177 900000      E     MOV     DPTR,#PowerDISCHCTRL2
017A 7405              MOV     A,#05H
017C F0                MOVX    @DPTR,A
017D 900000      E     MOV     DPTR,#PowerOC_CTRL
0180 7426              MOV     A,#026H
0182 F0                MOVX    @DPTR,A
0183 22                RET     
0184         L?0403:
0184         L?0404:
0184 900000      E     MOV     DPTR,#PowerInitError
0187 E0                MOVX    A,@DPTR
0188 04                INC     A
0189 F0                MOVX    @DPTR,A
018A 22                RET     
018B         L?0405:
018B 900000      E     MOV     DPTR,#CPU_TYPE
018E E0                MOVX    A,@DPTR
018F 543F              ANL     A,#03FH
0191 F0                MOVX    @DPTR,A
0192 E4                CLR     A
0193 900000      E     MOV     DPTR,#EXTVGA_Shut_Cnt
0196 F0                MOVX    @DPTR,A
0197 900000      E     MOV     DPTR,#VGA_Shut_Cnt
019A F0                MOVX    @DPTR,A
019B 900000      E     MOV     DPTR,#CPU_Shut_Cnt
019E 22                RET     
019F         L?0407:
019F 900000      E     MOV     DPTR,#PowerEN_DEGL_SEL1
01A2 7404              MOV     A,#04H
01A4 F0                MOVX    @DPTR,A
01A5 900000      E     MOV     DPTR,#PowerBUCK3CTRL
01A8 7436              MOV     A,#036H
01AA F0                MOVX    @DPTR,A
01AB 900000      E     MOV     DPTR,#PowerLDO1CTRL
01AE 741E              MOV     A,#01EH
01B0 F0                MOVX    @DPTR,A
01B1 22                RET     
01B2         L?0408:
01B2 900000      E     MOV     DPTR,#GPDRJ
01B5 E0                MOVX    A,@DPTR
01B6 54F7              ANL     A,#0F7H
01B8 F0                MOVX    @DPTR,A
01B9 900000      E     MOV     DPTR,#pDevStatus1
01BC E0                MOVX    A,@DPTR
01BD 4480              ORL     A,#080H
01BF F0                MOVX    @DPTR,A
01C0 900000      E     MOV     DPTR,#SysPowState
01C3 22                RET     
01C4         L?0409:
01C4         L?0410:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 42  

01C4 900000      E     MOV     DPTR,#GPDRC
01C7 E0                MOVX    A,@DPTR
01C8 54FE              ANL     A,#0FEH
01CA F0                MOVX    @DPTR,A
01CB 22                RET     
01CC         L?0411:
01CC         L?0412:
01CC 900000      E     MOV     DPTR,#GPDRC
01CF E0                MOVX    A,@DPTR
01D0 54EF              ANL     A,#0EFH
01D2 F0                MOVX    @DPTR,A
01D3 22                RET     
01D4         L?0413:
01D4         L?0414:
01D4 900000      E     MOV     DPTR,#GPDRF
01D7 E0                MOVX    A,@DPTR
01D8 54FD              ANL     A,#0FDH
01DA F0                MOVX    @DPTR,A
01DB 22                RET     
01DC         L?0415:
01DC 900000      E     MOV     DPTR,#SysPowState
01DF 7410              MOV     A,#010H
01E1 F0                MOVX    @DPTR,A
01E2         L?0416:
01E2 900000      E     MOV     DPTR,#DSxPowState
01E5 7434              MOV     A,#034H
01E7 F0                MOVX    @DPTR,A
01E8 22                RET     
01E9         L?0419:
01E9 900000      E     MOV     DPTR,#delayEDPTm
01EC         L?0420:
01EC F0                MOVX    @DPTR,A
01ED 900000      E     MOV     DPTR,#pDevStus
01F0 E0                MOVX    A,@DPTR
01F1 4408              ORL     A,#08H
01F3 22                RET     
01F4         L?0421:
01F4 F0                MOVX    @DPTR,A
01F5 E4                CLR     A
01F6 900000      E     MOV     DPTR,#initMark
01F9 F0                MOVX    @DPTR,A
01FA 900000      E     MOV     DPTR,#TEMP_Error
01FD F0                MOVX    @DPTR,A
01FE 900000      E     MOV     DPTR,#PECI_Err_CNT
0201 F0                MOVX    @DPTR,A
0202 22                RET     
0203         L?0422:
0203         L?0423:
0203 E4                CLR     A
0204 900000      E     MOV     DPTR,#SCI_Event_In_Index
0207 F0                MOVX    @DPTR,A
0208 900000      E     MOV     DPTR,#SCI_Event_Out_Index
020B 22                RET     
020C         L?0424:
020C 900000      E     MOV     DPTR,#GPCRD5
020F 7440              MOV     A,#040H
0211 F0                MOVX    @DPTR,A
0212 900000      E     MOV     DPTR,#GPDRD
0215 E0                MOVX    A,@DPTR
0216 54DF              ANL     A,#0DFH
0218 F0                MOVX    @DPTR,A
0219 22                RET     
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 43  

021A         L?0425:
021A 900000      E     MOV     DPTR,#PowerBUCK1CTRL
021D 7426              MOV     A,#026H
021F F0                MOVX    @DPTR,A
0220 900000      E     MOV     DPTR,#GPDRC
0223 E0                MOVX    A,@DPTR
0224 900000      E     MOV     DPTR,#PowerBUCK2CTRL
0227 22                RET     
0228         L?0426:
0228 900000      E     MOV     DPTR,#ERR_THMSTS
022B F0                MOVX    @DPTR,A
022C 900000      E     MOV     DPTR,#Thro_Status2
022F F0                MOVX    @DPTR,A
0230 900000      E     MOV     DPTR,#Thro_Status
0233 F0                MOVX    @DPTR,A
0234 22                RET     
0235         L?0428:
0235         L?0429:
0235 900000      E     MOV     DPTR,#GPCRA0
0238 E0                MOVX    A,@DPTR
0239 900000      E     MOV     DPTR,#ShutDnCause
023C 22                RET     
023D         L?0430:
023D 900000      E     MOV     DPTR,#ACPI_HOTKEY
0240 E0                MOVX    A,@DPTR
0241 547F              ANL     A,#07FH
0243 F0                MOVX    @DPTR,A
0244 E0                MOVX    A,@DPTR
0245 54BF              ANL     A,#0BFH
0247 F0                MOVX    @DPTR,A
0248 22                RET     
0249         L?0431:
0249         L?0432:
0249 900000      E     MOV     DPTR,#GPDRF
024C E0                MOVX    A,@DPTR
024D 54FE              ANL     A,#0FEH
024F F0                MOVX    @DPTR,A
0250 22                RET     
0251         L?0433:
0251         L?0434:
0251 7F09              MOV     R7,#09H
0253 900000      E     MOV     DPTR,#SCI_Event_Buffer
0256 E4                CLR     A
0257 22                RET     
0258         L?0435:
0258         L?0436:
0258 900000      E     MOV     DPTR,#ShipModeEn
025B E0                MOVX    A,@DPTR
025C 64A5              XRL     A,#0A5H
025E 22                RET     
025F         L?0437:
025F F0                MOVX    @DPTR,A
0260 900000      E     MOV     DPTR,#GPCRH2
0263 F0                MOVX    @DPTR,A
0264 900000      E     MOV     DPTR,#GPCRA5
0267 F0                MOVX    @DPTR,A
0268 22                RET     
0269         L?0438:
0269 E4                CLR     A
026A 900000      E     MOV     DPTR,#GPCRF2
026D F0                MOVX    @DPTR,A
026E 900000      E     MOV     DPTR,#GPCRF3
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 44  

0271 F0                MOVX    @DPTR,A
0272 22                RET     
0273         L?0439:
0273 900000      E     MOV     DPTR,#AdapterIDOn_Flag
0276 7401              MOV     A,#01H
0278 F0                MOVX    @DPTR,A
0279 900000      E     MOV     DPTR,#ADPIDON10MS_NUM
027C 22                RET     
027D         L?0440:
027D         L?0441:
027D 7B04              MOV     R3,#04H
027F 7DE9              MOV     R5,#0E9H
0281 7F02              MOV     R7,#02H
0283 22                RET     
0284         L?0442:
0284         L?0443:
0284 900000      E     MOV     DPTR,#SYS_STATUS
0287 E0                MOVX    A,@DPTR
0288 5407              ANL     A,#07H
028A 22                RET     
             ; FUNCTION Com0175 (END)

             ; FUNCTION CheckResetSource (BEGIN)
                                           ; SOURCE LINE # 20
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 23
                                           ; SOURCE LINE # 24
0000 120000      R     LCALL   L?0444
0003 FF                MOV     R7,A
0004 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 25
0007 900000      E     MOV     DPTR,#GPCRA0
000A E0                MOVX    A,@DPTR
000B FF                MOV     R7,A
000C 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 26
000F 900000      E     MOV     DPTR,#PWRSW8SRST
0012 E0                MOVX    A,@DPTR
0013 FF                MOV     R7,A
0014 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
0017 120000      R     LCALL   L?0444
001A 5403              ANL     A,#03H
001C 14                DEC     A
001D 600A              JZ      ?C0003
001F 14                DEC     A
0020 6014              JZ      ?C0006
0022 14                DEC     A
0023 601E              JZ      ?C0009
0025 2403              ADD     A,#03H
0027 7028              JNZ     ?C0001
                                           ; SOURCE LINE # 29
                                           ; SOURCE LINE # 30
                                           ; SOURCE LINE # 31
0029         ?C0003:
                                           ; SOURCE LINE # 32
0029 120000      R     LCALL   L?0428
002C B48005            CJNE    A,#080H,?C0004
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
002F 74FC              MOV     A,#0FCH
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 45  

0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 35
0032 801D              SJMP    ?C0001
0034         ?C0004:
                                           ; SOURCE LINE # 37
                                           ; SOURCE LINE # 38
                                           ; SOURCE LINE # 39
                                           ; SOURCE LINE # 40
0034 8018              SJMP    ?C0363
                                           ; SOURCE LINE # 42
0036         ?C0006:
                                           ; SOURCE LINE # 43
0036 120000      R     LCALL   L?0428
0039 B48005            CJNE    A,#080H,?C0007
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
003C 74FE              MOV     A,#0FEH
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 46
003F 8010              SJMP    ?C0001
0041         ?C0007:
                                           ; SOURCE LINE # 48
                                           ; SOURCE LINE # 49
0041         ?C0362:
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
0041 800B              SJMP    ?C0363
                                           ; SOURCE LINE # 53
0043         ?C0009:
                                           ; SOURCE LINE # 54
0043 120000      R     LCALL   L?0429
0046 B48005            CJNE    A,#080H,?C0010
                                           ; SOURCE LINE # 55
                                           ; SOURCE LINE # 56
0049 74FF              MOV     A,#0FFH
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 57
004C 8003              SJMP    ?C0001
004E         ?C0010:
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
004E         ?C0363:
004E 74EC              MOV     A,#0ECH
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
0051         ?C0001:
                                           ; SOURCE LINE # 66
0051 900000      E     MOV     DPTR,#PWRSW8SRST
0054 E0                MOVX    A,@DPTR
0055 30E106            JNB     ACC.1,?C0013
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
0058 900000      E     MOV     DPTR,#ShutDnCause
005B 74FD              MOV     A,#0FDH
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 73
005E         ?C0013:
005E 22                RET     
005F         L?0444:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 46  

005F 7FBB              MOV     R7,#0BBH
0061 120000      E     LCALL   _RamDebug
0064 900000      E     MOV     DPTR,#RSTStatus
0067 E0                MOVX    A,@DPTR
0068 22                RET     
             ; FUNCTION CheckResetSource (END)

             ; FUNCTION Check_LPC_Reset (BEGIN)
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 76
                                           ; SOURCE LINE # 77
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 30E203            JNB     ACC.2,?C0015
0007 D3                SETB    C
0008 8001              SJMP    ?C0016
000A         ?C0015:
000A C3                CLR     C
000B         ?C0016:
000B 4011              JC      ?C0017
                                           ; SOURCE LINE # 78
                                           ; SOURCE LINE # 80
000D 900000      E     MOV     DPTR,#KBHISR
0010 E0                MOVX    A,@DPTR
0011 54FB              ANL     A,#0FBH
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 81
0014 900000      E     MOV     DPTR,#SYS_MISC1
0017 E0                MOVX    A,@DPTR
0018 547F              ANL     A,#07FH
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 82
001B 120000      R     LCALL   OEM_LPC_Reset
                                           ; SOURCE LINE # 83
                                           ; SOURCE LINE # 84
001E         ?C0017:
001E 22                RET     
             ; FUNCTION Check_LPC_Reset (END)

             ; FUNCTION OEM_LPC_Reset (BEGIN)
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 90
0000 900000      E     MOV     DPTR,#uReserve07
                                           ; SOURCE LINE # 91
                                           ; SOURCE LINE # 92
0003 120000      R     LCALL   L?0385
                                           ; SOURCE LINE # 94
0006 900000      E     MOV     DPTR,#CPU_TYPE
0009 E0                MOVX    A,@DPTR
000A 543F              ANL     A,#03FH
                                           ; SOURCE LINE # 95
000C 120000      R     LCALL   L?0420
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 98
000F 120000      R     LCALL   L?0397
                                           ; SOURCE LINE # 99
0012 900000      E     MOV     DPTR,#SMartNoise
0015 7404              MOV     A,#04H
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 100
0018 900000      E     MOV     DPTR,#BackLight_En_Delay
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 47  

001B 7428              MOV     A,#028H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 103
001E 900000      E     MOV     DPTR,#LENOVOPMFW
0021 E0                MOVX    A,@DPTR
0022 54FB              ANL     A,#0FBH
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
0025 E0                MOVX    A,@DPTR
0026 54FE              ANL     A,#0FEH
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
0029 E4                CLR     A
002A 900000      E     MOV     DPTR,#LENOVOPMFW_Temp
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 106
002E 900000      E     MOV     DPTR,#ACOFF_SOURCE
0031 E0                MOVX    A,@DPTR
0032 54FB              ANL     A,#0FBH
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 111
;---- Variable 'EVENT_BUFFER_CNT' assigned to Register 'R7' ----
0035         ?C0018:
                                           ; SOURCE LINE # 112
                                           ; SOURCE LINE # 113
0035 120000      R     LCALL   L?0433
0038         ?C0341:
0038 F0                MOVX    @DPTR,A
0039 A3                INC     DPTR
003A DFFC              DJNZ    R7,?C0341
                                           ; SOURCE LINE # 114
003C         ?C0019:
                                           ; SOURCE LINE # 115
                                           ; SOURCE LINE # 116
003C 120000      R     LCALL   L?0422
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
003F 120000      R     LCALL   L?0399
                                           ; SOURCE LINE # 123
0042 E4                CLR     A
0043 900000      E     MOV     DPTR,#F2_Pressed
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 125
                                           ; SOURCE LINE # 126
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 131
0047 120000      R     LCALL   L?0384
                                           ; SOURCE LINE # 132
004A 900000      E     MOV     DPTR,#P80CMOSSts
004D E0                MOVX    A,@DPTR
004E 20E005            JB      ACC.0,?C0022
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 134
0051 E4                CLR     A
0052 900000      E     MOV     DPTR,#bios_check
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 138
0056         ?C0022:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 48  

0056 22                RET     
             ; FUNCTION OEM_LPC_Reset (END)

             ; FUNCTION CHK_SUSACK (BEGIN)
                                           ; SOURCE LINE # 141
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 177
0000 22                RET     
             ; FUNCTION CHK_SUSACK (END)

             ; FUNCTION Oem_SysPowerContrl (BEGIN)
                                           ; SOURCE LINE # 226
                                           ; SOURCE LINE # 227
                                           ; SOURCE LINE # 232
0000 900000      E     MOV     DPTR,#SysPowState
0003 E0                MOVX    A,@DPTR
0004 120000      E     LCALL   ?C?CCASE
0007 0000        R     DW      ?C0060
0009 03                DB      03H
000A 0000        R     DW      ?C0070
000C 04                DB      04H
000D 0000        R     DW      ?C0062
000F 05                DB      05H
0010 0000        R     DW      ?C0063
0012 06                DB      06H
0013 0000        R     DW      ?C0025
0015 10                DB      010H
0016 0000        R     DW      ?C0059
0018 30                DB      030H
0019 0000        R     DW      ?C0037
001B 33                DB      033H
001C 0000        R     DW      ?C0041
001E 44                DB      044H
001F 0000        R     DW      ?C0058
0021 50                DB      050H
0022 0000        R     DW      ?C0041
0024 55                DB      055H
0025 0000        R     DW      ?C0057
0027 60                DB      060H
0028 0000        R     DW      ?C0053
002A 66                DB      066H
002B 0000        R     DW      ?C0070
002D FF                DB      0FFH
002E 0000              DW      00H
0030 0000        R     DW      ?C0065
                                           ; SOURCE LINE # 233
                                           ; SOURCE LINE # 234
0032         ?C0025:
                                           ; SOURCE LINE # 235
0032 900000      E     MOV     DPTR,#GPDRD
0035 E0                MOVX    A,@DPTR
0036 30E003            JNB     ACC.0,?C0027
0039 D3                SETB    C
003A 8001              SJMP    ?C0028
003C         ?C0027:
003C C3                CLR     C
003D         ?C0028:
003D 4043              JC      ?C0026
                                           ; SOURCE LINE # 236
                                           ; SOURCE LINE # 238
003F 900000      E     MOV     DPTR,#S3S4DelayCnt
0042 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 49  

0043 D3                SETB    C
0044 940A              SUBB    A,#0AH
0046 4032              JC      ?C0029
                                           ; SOURCE LINE # 239
                                           ; SOURCE LINE # 240
                                           ; SOURCE LINE # 241
0048 120000      R     LCALL   L?0388
                                           ; SOURCE LINE # 242
004B 7FD0              MOV     R7,#0D0H
                                           ; SOURCE LINE # 243
004D 120000      R     LCALL   L?0427
0050 7403              MOV     A,#03H
0052 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 245
0053 900000      E     MOV     DPTR,#GPDRD
0056 E0                MOVX    A,@DPTR
0057 30E103            JNB     ACC.1,?C0031
005A D3                SETB    C
005B 8001              SJMP    ?C0032
005D         ?C0031:
005D C3                CLR     C
005E         ?C0032:
005E 400D              JC      ?C0030
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 247
                                           ; SOURCE LINE # 248
0060 120000      R     LCALL   L?0388
                                           ; SOURCE LINE # 249
0063 7F0D              MOV     R7,#0DH
                                           ; SOURCE LINE # 250
0065 120000      R     LCALL   L?0427
0068 7405              MOV     A,#05H
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 251
006B 801A              SJMP    ?C0036
006D         ?C0030:
                                           ; SOURCE LINE # 252
006D 900000      E     MOV     DPTR,#SysStatus
0070 E0                MOVX    A,@DPTR
0071 30E513            JNB     ACC.5,?C0036
                                           ; SOURCE LINE # 253
                                           ; SOURCE LINE # 255
0074 E0                MOVX    A,@DPTR
0075 4440              ORL     A,#040H
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
0078 800D              SJMP    ?C0036
007A         ?C0029:
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 260
007A 900000      E     MOV     DPTR,#S3S4DelayCnt
007D E0                MOVX    A,@DPTR
007E 04                INC     A
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
0080 8005              SJMP    ?C0036
0082         ?C0026:
                                           ; SOURCE LINE # 264
                                           ; SOURCE LINE # 265
0082 E4                CLR     A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 50  

0083 900000      E     MOV     DPTR,#S3S4DelayCnt
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 266
0087         ?C0036:
                                           ; SOURCE LINE # 267
0087 020000      R     LJMP    Check_LPC_Reset
                                           ; SOURCE LINE # 268
                                           ; SOURCE LINE # 270
008A         ?C0037:
                                           ; SOURCE LINE # 272
008A 900000      E     MOV     DPTR,#GPDRD
008D E0                MOVX    A,@DPTR
008E 30E01A            JNB     ACC.0,?C0038
                                           ; SOURCE LINE # 273
                                           ; SOURCE LINE # 274
0091 900000      E     MOV     DPTR,#PWSeqStep
0094 7403              MOV     A,#03H
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 275
0097 900000      E     MOV     DPTR,#PowSeqDelay
009A E4                CLR     A
009B F0                MOVX    @DPTR,A
009C A3                INC     DPTR
009D 7414              MOV     A,#014H
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 276
00A0 7F33              MOV     R7,#033H
00A2 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 277
00A5 900000      E     MOV     DPTR,#SysPowState
00A8 7430              MOV     A,#030H
00AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 278
00AB         ?C0038:
                                           ; SOURCE LINE # 280
00AB 900000      E     MOV     DPTR,#SYS_STATUS
00AE E0                MOVX    A,@DPTR
00AF 20E403            JB      ACC.4,$ + 6H
00B2 020000      R     LJMP    ?C0070
00B5 900000      E     MOV     DPTR,#GPDRB
00B8 E0                MOVX    A,@DPTR
00B9 20E003            JB      ACC.0,$ + 6H
00BC 020000      R     LJMP    ?C0070
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 285
                                           ; SOURCE LINE # 287
00BF 020000      R     LJMP    ?C0364
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 290
00C2         ?C0041:
                                           ; SOURCE LINE # 291
00C2 900000      E     MOV     DPTR,#GPDRD
00C5 E0                MOVX    A,@DPTR
00C6 30E012            JNB     ACC.0,?C0042
00C9 E0                MOVX    A,@DPTR
00CA 30E10E            JNB     ACC.1,?C0042
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
00CD 120000      R     LCALL   L?0389
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 51  

                                           ; SOURCE LINE # 295
00D0 7F53              MOV     R7,#053H
00D2 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 296
00D5 900000      E     MOV     DPTR,#SysPowState
00D8 7450              MOV     A,#050H
00DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 297
00DB         ?C0042:
                                           ; SOURCE LINE # 298
00DB 120000      R     LCALL   CheckAutoPowerOn
                                           ; SOURCE LINE # 302
00DE 120000      R     LCALL   L?0435
00E1 6007              JZ      ?C0044
00E3 900000      E     MOV     DPTR,#EMStatusBit2
00E6 E0                MOVX    A,@DPTR
00E7 30E003            JNB     ACC.0,?C0043
00EA         ?C0044:
                                           ; SOURCE LINE # 303
                                           ; SOURCE LINE # 304
                                           ; SOURCE LINE # 305
00EA 120000      R     LCALL   L?0430
                                           ; SOURCE LINE # 306
00ED         ?C0043:
                                           ; SOURCE LINE # 308
00ED 900000      E     MOV     DPTR,#ACPI_HOTKEY
00F0 E0                MOVX    A,@DPTR
00F1 20E727            JB      ACC.7,?C0045
00F4 E0                MOVX    A,@DPTR
00F5 20E623            JB      ACC.6,?C0045
00F8 900000      E     MOV     DPTR,#LOWBATT_3TIMES
00FB E0                MOVX    A,@DPTR
00FC 701D              JNZ     ?C0045
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 311
00FE 900000      E     MOV     DPTR,#GPDRB
0101 E0                MOVX    A,@DPTR
0102 30E003            JNB     ACC.0,?C0047
0105 D3                SETB    C
0106 8001              SJMP    ?C0048
0108         ?C0047:
0108 C3                CLR     C
0109         ?C0048:
0109 4010              JC      ?C0045
010B 900000      E     MOV     DPTR,#cCmd
010E E0                MOVX    A,@DPTR
010F 20E209            JB      ACC.2,?C0045
                                           ; SOURCE LINE # 312
                                           ; SOURCE LINE # 313
0112 120000      R     LCALL   L?0389
                                           ; SOURCE LINE # 314
0115 900000      E     MOV     DPTR,#SysPowState
0118 7406              MOV     A,#06H
011A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 315
                                           ; SOURCE LINE # 316
011B         ?C0045:
                                           ; SOURCE LINE # 319
011B 900000      E     MOV     DPTR,#PowerOTP_REG
011E E0                MOVX    A,@DPTR
011F 602E              JZ      ?C0049
                                           ; SOURCE LINE # 320
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 52  

                                           ; SOURCE LINE # 321
0121 900000      E     MOV     DPTR,#SysStatus
0124 E0                MOVX    A,@DPTR
0125 20E105            JB      ACC.1,?C0050
                                           ; SOURCE LINE # 322
0128 7F36              MOV     R7,#036H
012A 120000      E     LCALL   _ProcessSID
012D         ?C0050:
                                           ; SOURCE LINE # 323
012D 900000      E     MOV     DPTR,#PowerOTP_REG
0130 E0                MOVX    A,@DPTR
0131 900000      E     MOV     DPTR,#OTP_TEMP
0134 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 324
0135 E4                CLR     A
0136 900000      E     MOV     DPTR,#PowerOTP_REG
0139 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
013A 120000      R     LCALL   L?0409
                                           ; SOURCE LINE # 326
013D 7F0C              MOV     R7,#0CH
013F 120000      E     LCALL   _Delay1MS
                                           ; SOURCE LINE # 327
0142 120000      R     LCALL   L?0431
                                           ; SOURCE LINE # 328
0145 E4                CLR     A
0146 900000      E     MOV     DPTR,#PowerInitOK
0149 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 329
014A 900000      E     MOV     DPTR,#GPDRB
014D E0                MOVX    A,@DPTR
014E FF                MOV     R7,A
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
014F         ?C0049:
                                           ; SOURCE LINE # 336
014F 900000      E     MOV     DPTR,#SYS_STATUS
0152 E0                MOVX    A,@DPTR
0153 30E471            JNB     ACC.4,?C0070
0156 900000      E     MOV     DPTR,#GPDRB
0159 E0                MOVX    A,@DPTR
015A 30E06A            JNB     ACC.0,?C0070
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 338
015D         ?C0364:
015D 900000      E     MOV     DPTR,#SYS_STATUS
0160 E0                MOVX    A,@DPTR
0161 4480              ORL     A,#080H
0163 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 340
0164 020000      E     LJMP    BATT_LEN_OFF
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 343
                                           ; SOURCE LINE # 345
0167         ?C0053:
                                           ; SOURCE LINE # 346
0167 120000      R     LCALL   CheckAutoPowerOn
                                           ; SOURCE LINE # 347
016A 900000      E     MOV     DPTR,#nBattGasgauge
016D E0                MOVX    A,@DPTR
016E D3                SETB    C
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 53  

016F 940A              SUBB    A,#0AH
0171 5003              JNC     ?C0054
                                           ; SOURCE LINE # 348
0173 120000      R     LCALL   L?0411
0176         ?C0054:
                                           ; SOURCE LINE # 349
0176 900000      E     MOV     DPTR,#GPDRB
0179 E0                MOVX    A,@DPTR
017A 20E006            JB      ACC.0,?C0056
017D 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0180 E0                MOVX    A,@DPTR
0181 6044              JZ      ?C0070
0183         ?C0056:
                                           ; SOURCE LINE # 350
0183 900000      E     MOV     DPTR,#PWSeqStep
0186 7401              MOV     A,#01H
                                           ; SOURCE LINE # 351
                                           ; SOURCE LINE # 352
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 354
0188 8034              SJMP    ?C0365
                                           ; SOURCE LINE # 357
018A         ?C0057:
                                           ; SOURCE LINE # 358
018A 020000      R     LJMP    Oem_DSXS5Sequence
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
018D         ?C0058:
                                           ; SOURCE LINE # 361
018D 020000      R     LJMP    Oem_S5S0Sequence
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 364
0190         ?C0059:
                                           ; SOURCE LINE # 365
0190 020000      R     LJMP    Oem_S3S0Sequence
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 368
0193         ?C0060:
                                           ; SOURCE LINE # 369
0193 020000      R     LJMP    Oem_S0S3Sequence
                                           ; SOURCE LINE # 378
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 383
0196         ?C0062:
                                           ; SOURCE LINE # 384
0196 020000      R     LJMP    Oem_S0S5Sequence
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
0199         ?C0063:
                                           ; SOURCE LINE # 387
0199 020000      R     LJMP    Oem_S5DSXSequence
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 389
                                           ; SOURCE LINE # 390
                                           ; SOURCE LINE # 392
019C         ?C0065:
                                           ; SOURCE LINE # 393
019C 900000      E     MOV     DPTR,#SysPowState
019F 7466              MOV     A,#066H
01A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 394
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 54  

01A2 900000      E     MOV     DPTR,#GPDRB
01A5 E0                MOVX    A,@DPTR
01A6 30E003            JNB     ACC.0,?C0067
01A9 D3                SETB    C
01AA 8001              SJMP    ?C0068
01AC         ?C0067:
01AC C3                CLR     C
01AD         ?C0068:
01AD 900000      E     MOV     DPTR,#PWSeqStep
01B0 7401              MOV     A,#01H
01B2 400A              JC      ?C0066
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
                                           ; SOURCE LINE # 397
01B4 120000      R     LCALL   L?0390
                                           ; SOURCE LINE # 398
01B7 900000      E     MOV     DPTR,#SysPowState
01BA 7406              MOV     A,#06H
01BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 399
01BD 22                RET     
01BE         ?C0066:
                                           ; SOURCE LINE # 401
                                           ; SOURCE LINE # 402
01BE         ?C0365:
                                           ; SOURCE LINE # 403
01BE 120000      R     LCALL   L?0390
                                           ; SOURCE LINE # 404
01C1 900000      E     MOV     DPTR,#SysPowState
01C4 7460              MOV     A,#060H
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
                                           ; SOURCE LINE # 408
01C7         ?C0070:
01C7 22                RET     
01C8         L?0427:
01C8 120000      E     LCALL   _RamDebug
01CB 900000      E     MOV     DPTR,#SysPowState
01CE 22                RET     
             ; FUNCTION Oem_SysPowerContrl (END)

             ; FUNCTION SetS3GPIO (BEGIN)
                                           ; SOURCE LINE # 410
                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 416
0000 22                RET     
             ; FUNCTION SetS3GPIO (END)

             ; FUNCTION SetS0GPIO (BEGIN)
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 4408              ORL     A,#08H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 421
0007 900000      E     MOV     DPTR,#GPDRB
000A E0                MOVX    A,@DPTR
000B 4440              ORL     A,#040H
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 55  

000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 423
000E E4                CLR     A
000F 900000      E     MOV     DPTR,#GPCRH1
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 427
0012 120000      R     LCALL   L?0437
                                           ; SOURCE LINE # 428
0015 900000      E     MOV     DPTR,#GPCRA4
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 437
0019 900000      E     MOV     DPTR,#GPCRD6
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
001D 900000      E     MOV     DPTR,#GPCRD7
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 439
0021 120000      E     LCALL   InitSio
                                           ; SOURCE LINE # 441
0024 E4                CLR     A
0025 900000      E     MOV     DPTR,#KBHISR
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 442
0029 900000      E     MOV     DPTR,#KBHIKDOR
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 443
002D 900000      E     MOV     DPTR,#KBHISR
0030 E0                MOVX    A,@DPTR
0031 54FB              ANL     A,#0FBH
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
0034 900000      E     MOV     DPTR,#SPCTRL1
0037 7483              MOV     A,#083H
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 446
003A 9022BE            MOV     DPTR,#022BEH
003D E4                CLR     A
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 447
003F A3                INC     DPTR
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 449
0041 900000      E     MOV     DPTR,#PECIDelayCnt
0044 7404              MOV     A,#04H
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 451
0047 120000      E     LCALL   Fan_Init
                                           ; SOURCE LINE # 462
004A 900000      E     MOV     DPTR,#SYS_MISC1
004D E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
004E         ?C0074:
004E 22                RET     
             ; FUNCTION SetS0GPIO (END)

             ; FUNCTION SetS5GPIO (BEGIN)
                                           ; SOURCE LINE # 470
                                           ; SOURCE LINE # 471
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 56  

                                           ; SOURCE LINE # 472
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 54F7              ANL     A,#0F7H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 473
0007 900000      E     MOV     DPTR,#GPDRB
000A E0                MOVX    A,@DPTR
000B 54BF              ANL     A,#0BFH
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 474
000E 900000      E     MOV     DPTR,#GPCRH1
0011 7482              MOV     A,#082H
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
0013 120000      R     LCALL   L?0437
                                           ; SOURCE LINE # 477
0016 900000      E     MOV     DPTR,#GPCRD6
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 478
001A 900000      E     MOV     DPTR,#GPCRA4
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 479
001E 900000      E     MOV     DPTR,#GPCRD7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 481
0022 900000      E     MOV     DPTR,#GPDRH
0025 E0                MOVX    A,@DPTR
0026 4408              ORL     A,#08H
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 508
0029 900000      E     MOV     DPTR,#GPCRB0
002C 7480              MOV     A,#080H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 520
002F 900000      E     MOV     DPTR,#SYS_MISC1
0032 E0                MOVX    A,@DPTR
0033 54DF              ANL     A,#0DFH
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 521
0036 22                RET     
             ; FUNCTION SetS5GPIO (END)

             ; FUNCTION S5DSX_RSMRST_LOW (BEGIN)
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
0000 120000      R     LCALL   L?0409
                                           ; SOURCE LINE # 526
0003 22                RET     
             ; FUNCTION S5DSX_RSMRST_LOW (END)

             ; FUNCTION S5DSX_PCH_PWR_EN_OFF (BEGIN)
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
0000 020000      R     LJMP    Lowpower_ENfunction
             ; FUNCTION S5DSX_PCH_PWR_EN_OFF (END)

             ; FUNCTION Enter_ShipMode (BEGIN)
                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 57  

                                           ; SOURCE LINE # 536
0000 120000      R     LCALL   L?0435
0003 6007              JZ      ?C0079
0005 900000      E     MOV     DPTR,#EMStatusBit2
0008 E0                MOVX    A,@DPTR
0009 30E008            JNB     ACC.0,?C0080
000C         ?C0079:
                                           ; SOURCE LINE # 537
000C E4                CLR     A
000D 900000      E     MOV     DPTR,#ShipModeEn
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 538
0011 120000      E     LCALL   Lock_ShipMode
                                           ; SOURCE LINE # 539
                                           ; SOURCE LINE # 541
0014         ?C0080:
0014 22                RET     
             ; FUNCTION Enter_ShipMode (END)

             ; FUNCTION RecordenEnterShipMode (BEGIN)
                                           ; SOURCE LINE # 542
                                           ; SOURCE LINE # 543
                                           ; SOURCE LINE # 545
0000 120000      R     LCALL   L?0436
0003 6007              JZ      ?C0082
0005 900000      E     MOV     DPTR,#EMStatusBit2
0008 E0                MOVX    A,@DPTR
0009 30E015            JNB     ACC.0,?C0086
000C         ?C0082:
                                           ; SOURCE LINE # 546
000C 7FA6              MOV     R7,#0A6H
000E 120000      E     LCALL   _ProcessSID
                                           ; SOURCE LINE # 547
0011 900000      E     MOV     DPTR,#nBattGasgauge
0014 E0                MOVX    A,@DPTR
0015 C3                CLR     C
0016 945F              SUBB    A,#05FH
0018 5007              JNC     ?C0086
                                           ; SOURCE LINE # 548
                                           ; SOURCE LINE # 549
001A 7FA8              MOV     R7,#0A8H
001C 120000      E     LCALL   _ProcessSID
001F         ?C0084:
                                           ; SOURCE LINE # 550
001F 80FE              SJMP    ?C0084
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
                                           ; SOURCE LINE # 554
0021         ?C0086:
0021 22                RET     
             ; FUNCTION RecordenEnterShipMode (END)

             ; FUNCTION S5DSX_CHECK_RSMRST_P (BEGIN)
                                           ; SOURCE LINE # 555
                                           ; SOURCE LINE # 556
                                           ; SOURCE LINE # 558
0000 22                RET     
             ; FUNCTION S5DSX_CHECK_RSMRST_P (END)

             ; FUNCTION S5DSX_EC_ON_LOW (BEGIN)
                                           ; SOURCE LINE # 560
                                           ; SOURCE LINE # 561
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 58  

                                           ; SOURCE LINE # 562
0000 120000      R     LCALL   L?0431
                                           ; SOURCE LINE # 563
0003 900000      E     MOV     DPTR,#EMStatusBit
0006 E0                MOVX    A,@DPTR
0007 20E103            JB      ACC.1,?C0088
                                           ; SOURCE LINE # 564
000A 120000      R     LCALL   L?0411
000D         ?C0088:
                                           ; SOURCE LINE # 565
000D 900000      E     MOV     DPTR,#EMStatusBit
0010 E0                MOVX    A,@DPTR
0011 20E603            JB      ACC.6,?C0089
                                           ; SOURCE LINE # 566
0014 120000      R     LCALL   L?0412
0017         ?C0089:
                                           ; SOURCE LINE # 567
0017 900000      E     MOV     DPTR,#nBattGasgauge
001A E0                MOVX    A,@DPTR
001B D3                SETB    C
001C 940A              SUBB    A,#0AH
001E 5003              JNC     ?C0090
                                           ; SOURCE LINE # 568
0020 120000      R     LCALL   L?0412
0023         ?C0090:
                                           ; SOURCE LINE # 569
0023 E4                CLR     A
0024 900000      E     MOV     DPTR,#PowerInitOK
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 570
0028 900000      E     MOV     DPTR,#GPCRF2
002B 7480              MOV     A,#080H
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 571
002E 900000      E     MOV     DPTR,#GPCRF3
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 574
0032 120000      R     LCALL   L?0413
                                           ; SOURCE LINE # 575
0035 22                RET     
             ; FUNCTION S5DSX_EC_ON_LOW (END)

             ; FUNCTION S5DSX_EC_ON_18V_LOW (BEGIN)
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 579
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 54EF              ANL     A,#0EFH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 580
0007 22                RET     
             ; FUNCTION S5DSX_EC_ON_18V_LOW (END)

             ; FUNCTION S5DSX_Init_Status (BEGIN)
                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
                                           ; SOURCE LINE # 584
0000 900000      E     MOV     DPTR,#SysPowState
0003 7466              MOV     A,#066H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 585
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 59  

0006 22                RET     
             ; FUNCTION S5DSX_Init_Status (END)

             ; FUNCTION Oem_S5DSXSequence (BEGIN)
                                           ; SOURCE LINE # 602
                                           ; SOURCE LINE # 603
                                           ; SOURCE LINE # 604
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0342
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0342:
0008 6009              JZ      ?C0097
                                           ; SOURCE LINE # 605
                                           ; SOURCE LINE # 606
                                           ; SOURCE LINE # 607
000A 120000      R     LCALL   L?0382
000D 7002              JNZ     ?C0343
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0343:
0011 703B              JNZ     ?C0096
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 610
                                           ; SOURCE LINE # 611
0013         ?C0097:
                                           ; SOURCE LINE # 613
0013 900000      E     MOV     DPTR,#PWSeqStep
0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 9408              SUBB    A,#08H
001A 5032              JNC     ?C0096
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 615
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQS5DSX+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQS5DSX+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7014              JNZ     ?C0099
                                           ; SOURCE LINE # 616
                                           ; SOURCE LINE # 617
002E 120000      R     LCALL   L?0378
0031 120000      R     LCALL   L?0379
                                           ; SOURCE LINE # 618
                                           ; SOURCE LINE # 619
0034 120000      R     LCALL   L?0374
                                           ; SOURCE LINE # 620
0037 900000      E     MOV     DPTR,#PowSeqDelay
003A E0                MOVX    A,@DPTR
003B 7002              JNZ     ?C0344
003D A3                INC     DPTR
003E E0                MOVX    A,@DPTR
003F         ?C0344:
003F 60D2              JZ      ?C0097
                                           ; SOURCE LINE # 621
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 60  

                                           ; SOURCE LINE # 622
0041 22                RET     
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
0042         ?C0099:
                                           ; SOURCE LINE # 626
                                           ; SOURCE LINE # 627
0042 120000      R     LCALL   L?0378
0045 120000      R     LCALL   L?0379
0048 EF                MOV     A,R7
0049 6003              JZ      ?C0096
                                           ; SOURCE LINE # 628
                                           ; SOURCE LINE # 629
                                           ; SOURCE LINE # 630
004B 120000      R     LCALL   L?0374
                                           ; SOURCE LINE # 631
                                           ; SOURCE LINE # 632
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 635
004E         ?C0096:
004E 22                RET     
             ; FUNCTION Oem_S5DSXSequence (END)

             ; FUNCTION DSXS5_EC_ON_HI (BEGIN)
                                           ; SOURCE LINE # 638
                                           ; SOURCE LINE # 639
                                           ; SOURCE LINE # 640
                                           ; SOURCE LINE # 641
0000 120000      R     LCALL   L?0438
                                           ; SOURCE LINE # 642
                                           ; SOURCE LINE # 643
                                           ; SOURCE LINE # 644
0003 120000      R     LCALL   L?0391
                                           ; SOURCE LINE # 645
0006 22                RET     
             ; FUNCTION DSXS5_EC_ON_HI (END)

             ; FUNCTION DSXS5_PMIC_Initial (BEGIN)
                                           ; SOURCE LINE # 646
                                           ; SOURCE LINE # 647
                                           ; SOURCE LINE # 648
0000 120000      R     LCALL   InitPMIC
                                           ; SOURCE LINE # 649
0003 900000      E     MOV     DPTR,#PowerInitOK
0006 E0                MOVX    A,@DPTR
0007 7002              JNZ     ?C0104
                                           ; SOURCE LINE # 650
0009 FF                MOV     R7,A
000A 22                RET     
000B         ?C0104:
                                           ; SOURCE LINE # 652
000B 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 653
000D         ?C0105:
000D 22                RET     
             ; FUNCTION DSXS5_PMIC_Initial (END)

             ; FUNCTION DSXS5_EC_ON_1_8HI (BEGIN)
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 61  

0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4410              ORL     A,#010H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 657
0007 22                RET     
             ; FUNCTION DSXS5_EC_ON_1_8HI (END)

             ; FUNCTION DSXS5_RSMRST_HI (BEGIN)
                                           ; SOURCE LINE # 658
                                           ; SOURCE LINE # 659
                                           ; SOURCE LINE # 660
0000 900000      E     MOV     DPTR,#GPDRC
0003 E0                MOVX    A,@DPTR
0004 4401              ORL     A,#01H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 661
0007 22                RET     
             ; FUNCTION DSXS5_RSMRST_HI (END)

             ; FUNCTION DSXS5_Init_Status (BEGIN)
                                           ; SOURCE LINE # 663
                                           ; SOURCE LINE # 664
                                           ; SOURCE LINE # 665
0000 900000      E     MOV     DPTR,#GPDRJ
0003 E0                MOVX    A,@DPTR
0004 4440              ORL     A,#040H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 666
0007 900000      E     MOV     DPTR,#SysPowState
000A 7455              MOV     A,#055H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 667
000D 22                RET     
             ; FUNCTION DSXS5_Init_Status (END)

             ; FUNCTION Oem_DSXS5Sequence (BEGIN)
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
                                           ; SOURCE LINE # 683
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0345
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0345:
0008 6009              JZ      ?C0113
                                           ; SOURCE LINE # 684
                                           ; SOURCE LINE # 685
                                           ; SOURCE LINE # 686
000A 120000      R     LCALL   L?0382
000D 7002              JNZ     ?C0346
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0346:
0011 705A              JNZ     ?C0112
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 689
                                           ; SOURCE LINE # 690
0013         ?C0113:
                                           ; SOURCE LINE # 692
0013 900000      E     MOV     DPTR,#PWSeqStep
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 62  

0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 9406              SUBB    A,#06H
001A 5051              JNC     ?C0112
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQDSXS5+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQDSXS5+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7022              JNZ     ?C0115
                                           ; SOURCE LINE # 695
                                           ; SOURCE LINE # 696
002E 120000      R     LCALL   L?0378
0031 2400        R     ADD     A,#LOW asPowerSEQDSXS5
0033 F582              MOV     DPL,A
0035 E4                CLR     A
0036 3400        R     ADDC    A,#HIGH asPowerSEQDSXS5
                                           ; SOURCE LINE # 697
0038 120000      R     LCALL   L?0376
003B 2400        R     ADD     A,#LOW asPowerSEQDSXS5+02H
003D F582              MOV     DPL,A
003F E4                CLR     A
0040 3400        R     ADDC    A,#HIGH asPowerSEQDSXS5+02H
                                           ; SOURCE LINE # 698
0042 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 699
0045 900000      E     MOV     DPTR,#PowSeqDelay
0048 E0                MOVX    A,@DPTR
0049 7002              JNZ     ?C0347
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D         ?C0347:
004D 60C4              JZ      ?C0113
                                           ; SOURCE LINE # 700
                                           ; SOURCE LINE # 701
004F 22                RET     
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 703
0050         ?C0115:
                                           ; SOURCE LINE # 705
                                           ; SOURCE LINE # 706
0050 120000      R     LCALL   L?0378
0053 2400        R     ADD     A,#LOW asPowerSEQDSXS5
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        R     ADDC    A,#HIGH asPowerSEQDSXS5
005A 120000      R     LCALL   L?0380
005D EF                MOV     A,R7
005E 600D              JZ      ?C0112
                                           ; SOURCE LINE # 707
                                           ; SOURCE LINE # 708
0060 120000      R     LCALL   L?0378
0063 2400        R     ADD     A,#LOW asPowerSEQDSXS5+02H
0065 F582              MOV     DPL,A
0067 E4                CLR     A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 63  

0068 3400        R     ADDC    A,#HIGH asPowerSEQDSXS5+02H
                                           ; SOURCE LINE # 709
006A 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 710
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
                                           ; SOURCE LINE # 713
                                           ; SOURCE LINE # 714
006D         ?C0112:
006D 22                RET     
             ; FUNCTION Oem_DSXS5Sequence (END)

             ; FUNCTION S5S0_STEP1 (BEGIN)
                                           ; SOURCE LINE # 716
                                           ; SOURCE LINE # 717
                                           ; SOURCE LINE # 718
0000 900000      E     MOV     DPTR,#cCmd
0003 E0                MOVX    A,@DPTR
0004 54FB              ANL     A,#0FBH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 719
0007 E4                CLR     A
0008 900000      E     MOV     DPTR,#AutoTimer
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 720
000C 900000      E     MOV     DPTR,#SysStatus2
000F E0                MOVX    A,@DPTR
0010 30E304            JNB     ACC.3,?C0119
                                           ; SOURCE LINE # 721
                                           ; SOURCE LINE # 722
0013 E0                MOVX    A,@DPTR
0014 54F7              ANL     A,#0F7H
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 723
0017         ?C0119:
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 725
0017 120000      R     LCALL   L?0438
                                           ; SOURCE LINE # 726
001A 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
001D E0                MOVX    A,@DPTR
001E 6005              JZ      ?C0120
                                           ; SOURCE LINE # 727
                                           ; SOURCE LINE # 728
0020 E4                CLR     A
0021 900000      E     MOV     DPTR,#DCR3
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 729
0025         ?C0120:
                                           ; SOURCE LINE # 730
                                           ; SOURCE LINE # 731
                                           ; SOURCE LINE # 732
0025 120000      R     LCALL   L?0391
                                           ; SOURCE LINE # 733
0028 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 734
002A         ?C0121:
002A 22                RET     
             ; FUNCTION S5S0_STEP1 (END)

             ; FUNCTION S5S0_EC_ON_1_8_EN (BEGIN)
                                           ; SOURCE LINE # 736
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 64  

                                           ; SOURCE LINE # 737
                                           ; SOURCE LINE # 738
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4410              ORL     A,#010H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 739
0007 22                RET     
             ; FUNCTION S5S0_EC_ON_1_8_EN (END)

             ; FUNCTION S5S0_EC_CCG4_ON_HI (BEGIN)
                                           ; SOURCE LINE # 741
                                           ; SOURCE LINE # 742
                                           ; SOURCE LINE # 744
0000 22                RET     
             ; FUNCTION S5S0_EC_CCG4_ON_HI (END)

             ; FUNCTION S5S0_PMIC_Initial (BEGIN)
                                           ; SOURCE LINE # 748
                                           ; SOURCE LINE # 749
                                           ; SOURCE LINE # 750
0000 120000      R     LCALL   InitPMIC
                                           ; SOURCE LINE # 751
0003 900000      E     MOV     DPTR,#PowerInitOK
0006 E0                MOVX    A,@DPTR
0007 7002              JNZ     ?C0124
                                           ; SOURCE LINE # 752
0009 FF                MOV     R7,A
000A 22                RET     
000B         ?C0124:
                                           ; SOURCE LINE # 754
000B 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 755
000D         ?C0125:
000D 22                RET     
             ; FUNCTION S5S0_PMIC_Initial (END)

             ; FUNCTION S5S0_AC_PRESENT_EN (BEGIN)
                                           ; SOURCE LINE # 759
                                           ; SOURCE LINE # 760
                                           ; SOURCE LINE # 761
0000 7BE0              MOV     R3,#0E0H
0002 7DB7              MOV     R5,#0B7H
0004 7F01              MOV     R7,#01H
0006 120000      E     LCALL   _Read_Eflash_Byte
0009 900000      E     MOV     DPTR,#uPGID
000C EF                MOV     A,R7
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
000E E0                MOVX    A,@DPTR
000F 900000      E     MOV     DPTR,#MBID_FB
                                           ; SOURCE LINE # 763
0012 120000      R     LCALL   L?0392
                                           ; SOURCE LINE # 764
0015 900000      E     MOV     DPTR,#SYS_STATUS
0018 E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 767
                                           ; SOURCE LINE # 768
0019         ?C0128:
0019 22                RET     
             ; FUNCTION S5S0_AC_PRESENT_EN (END)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 65  


             ; FUNCTION S5S0_RSMRST_EN (BEGIN)
                                           ; SOURCE LINE # 771
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 773
0000 900000      E     MOV     DPTR,#GPDRC
0003 E0                MOVX    A,@DPTR
0004 4401              ORL     A,#01H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 774
0007 22                RET     
             ; FUNCTION S5S0_RSMRST_EN (END)

             ; FUNCTION S5S0_PM_PWER_BTN2 (BEGIN)
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 777
                                           ; SOURCE LINE # 778
0000 120000      R     LCALL   L?0413
                                           ; SOURCE LINE # 779
0003 900000      E     MOV     DPTR,#CMOS_TEST
0006 E0                MOVX    A,@DPTR
0007 4404              ORL     A,#04H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 780
000A 22                RET     
             ; FUNCTION S5S0_PM_PWER_BTN2 (END)

             ; FUNCTION S5S0_PM_PWER_BTN3 (BEGIN)
                                           ; SOURCE LINE # 782
                                           ; SOURCE LINE # 783
                                           ; SOURCE LINE # 784
0000 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 785
0003 22                RET     
             ; FUNCTION S5S0_PM_PWER_BTN3 (END)

             ; FUNCTION S5S0_CHK_S4 (BEGIN)
                                           ; SOURCE LINE # 787
                                           ; SOURCE LINE # 788
                                           ; SOURCE LINE # 789
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 900000      E     MOV     DPTR,#GPDRF
0007 30E107            JNB     ACC.1,?C0132
                                           ; SOURCE LINE # 790
                                           ; SOURCE LINE # 791
000A E0                MOVX    A,@DPTR
000B 4402              ORL     A,#02H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 794
000E 7F01              MOV     R7,#01H
0010 22                RET     
                                           ; SOURCE LINE # 795
0011         ?C0132:
                                           ; SOURCE LINE # 797
0011 E0                MOVX    A,@DPTR
0012 54FD              ANL     A,#0FDH
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 798
0015 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 799
0017         ?C0133:
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 66  

0017 22                RET     
             ; FUNCTION S5S0_CHK_S4 (END)

             ; FUNCTION S5S0_CHK_S3 (BEGIN)
                                           ; SOURCE LINE # 801
                                           ; SOURCE LINE # 802
                                           ; SOURCE LINE # 803
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 30E003            JNB     ACC.0,?C0134
                                           ; SOURCE LINE # 804
                                           ; SOURCE LINE # 805
0007 7F01              MOV     R7,#01H
0009 22                RET     
                                           ; SOURCE LINE # 806
000A         ?C0134:
                                           ; SOURCE LINE # 808
000A 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 809
000C         ?C0135:
000C 22                RET     
             ; FUNCTION S5S0_CHK_S3 (END)

             ; FUNCTION S5S0_EC_VCCST_EN (BEGIN)
                                           ; SOURCE LINE # 811
                                           ; SOURCE LINE # 812
                                           ; SOURCE LINE # 813
0000 900000      E     MOV     DPTR,#GPDRA
0003 E0                MOVX    A,@DPTR
0004 4480              ORL     A,#080H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 814
0007 22                RET     
             ; FUNCTION S5S0_EC_VCCST_EN (END)

             ; FUNCTION S5S0_EC_VPP_PWREN (BEGIN)
                                           ; SOURCE LINE # 817
                                           ; SOURCE LINE # 818
                                           ; SOURCE LINE # 819
0000 900000      E     MOV     DPTR,#GPDRE
0003 E0                MOVX    A,@DPTR
0004 4408              ORL     A,#08H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 820
0007 22                RET     
             ; FUNCTION S5S0_EC_VPP_PWREN (END)

             ; FUNCTION S5S0_SYSON (BEGIN)
                                           ; SOURCE LINE # 824
                                           ; SOURCE LINE # 825
                                           ; SOURCE LINE # 826
0000 900000      E     MOV     DPTR,#GPDRG
0003 E0                MOVX    A,@DPTR
0004 4402              ORL     A,#02H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 827
0007 22                RET     
             ; FUNCTION S5S0_SYSON (END)

             ; FUNCTION S5S0_GPO7 (BEGIN)
                                           ; SOURCE LINE # 829
                                           ; SOURCE LINE # 830
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 67  

                                           ; SOURCE LINE # 832
0000 22                RET     
             ; FUNCTION S5S0_GPO7 (END)

             ; FUNCTION S5S0_SUSP (BEGIN)
                                           ; SOURCE LINE # 833
                                           ; SOURCE LINE # 834
                                           ; SOURCE LINE # 835
0000 900000      E     MOV     DPTR,#GPDRC
0003 E0                MOVX    A,@DPTR
0004 4440              ORL     A,#040H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 837
0007 900000      E     MOV     DPTR,#CURRENT_STATUS
000A E0                MOVX    A,@DPTR
000B 54C0              ANL     A,#0C0H
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 839
000E 020000      R     LJMP    SetS0GPIO
             ; FUNCTION S5S0_SUSP (END)

             ; FUNCTION S5S0_EC_VCCIO_EN (BEGIN)
                                           ; SOURCE LINE # 846
                                           ; SOURCE LINE # 847
                                           ; SOURCE LINE # 848
0000 900000      E     MOV     DPTR,#GPDRB
0003 E0                MOVX    A,@DPTR
0004 4404              ORL     A,#04H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 849
0007 22                RET     
             ; FUNCTION S5S0_EC_VCCIO_EN (END)

             ; FUNCTION S5S0_NVDD_PWR (BEGIN)
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 852
                                           ; SOURCE LINE # 857
0000 22                RET     
             ; FUNCTION S5S0_NVDD_PWR (END)

             ; FUNCTION S5S0_USBON (BEGIN)
                                           ; SOURCE LINE # 859
                                           ; SOURCE LINE # 860
                                           ; SOURCE LINE # 861
                                           ; SOURCE LINE # 862
0000 120000      R     LCALL   L?0424
                                           ; SOURCE LINE # 863
0003 900000      E     MOV     DPTR,#EMStatusBit
0006 E0                MOVX    A,@DPTR
0007 4480              ORL     A,#080H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 864
000A 22                RET     
             ; FUNCTION S5S0_USBON (END)

             ; FUNCTION S5S0_VCCST_PWRGD (BEGIN)
                                           ; SOURCE LINE # 866
                                           ; SOURCE LINE # 867
                                           ; SOURCE LINE # 868
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4420              ORL     A,#020H
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 68  

0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 869
0007 22                RET     
             ; FUNCTION S5S0_VCCST_PWRGD (END)

             ; FUNCTION S5S0_CHK_VDDQ_PWRGOOD (BEGIN)
                                           ; SOURCE LINE # 873
                                           ; SOURCE LINE # 874
                                           ; SOURCE LINE # 875
0000 900000      R     MOV     DPTR,#BPwrDate
0003 7403              MOV     A,#03H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 877
0006 900000      E     MOV     DPTR,#GPDRE
0009 E0                MOVX    A,@DPTR
000A 30E203            JNB     ACC.2,?C0145
                                           ; SOURCE LINE # 878
                                           ; SOURCE LINE # 881
000D 7F01              MOV     R7,#01H
000F 22                RET     
                                           ; SOURCE LINE # 882
0010         ?C0145:
                                           ; SOURCE LINE # 883
0010 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 884
0012         ?C0146:
0012 22                RET     
             ; FUNCTION S5S0_CHK_VDDQ_PWRGOOD (END)

             ; FUNCTION S5S0_VR_ON (BEGIN)
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
                                           ; SOURCE LINE # 890
0000 120000      E     LCALL   Clr_UEFIStatus
                                           ; SOURCE LINE # 891
0003 900000      E     MOV     DPTR,#GPDRE
0006 E0                MOVX    A,@DPTR
0007 4410              ORL     A,#010H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 895
000A 900000      E     MOV     DPTR,#SYS_STATUS
000D E0                MOVX    A,@DPTR
000E 30E706            JNB     ACC.7,?C0147
                                           ; SOURCE LINE # 896
                                           ; SOURCE LINE # 897
                                           ; SOURCE LINE # 898
0011 120000      R     LCALL   L?0439
0014 74A0              MOV     A,#0A0H
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 899
0017         ?C0147:
                                           ; SOURCE LINE # 901
0017 900000      E     MOV     DPTR,#MuteCount
001A 7404              MOV     A,#04H
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 902
001D 22                RET     
             ; FUNCTION S5S0_VR_ON (END)

             ; FUNCTION S5S0_CHK_VRREADY (BEGIN)
                                           ; SOURCE LINE # 904
                                           ; SOURCE LINE # 905
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 69  

                                           ; SOURCE LINE # 907
0000 D3                SETB    C
0001 900000      E     MOV     DPTR,#Read_VR_CPU_PWROK+01H
0004 E0                MOVX    A,@DPTR
0005 9411              SUBB    A,#011H
0007 900000      E     MOV     DPTR,#Read_VR_CPU_PWROK
000A E0                MOVX    A,@DPTR
000B 9401              SUBB    A,#01H
000D 4003              JC      ?C0149
                                           ; SOURCE LINE # 908
                                           ; SOURCE LINE # 909
000F 7F01              MOV     R7,#01H
0011 22                RET     
                                           ; SOURCE LINE # 910
0012         ?C0149:
                                           ; SOURCE LINE # 911
0012 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 912
0014         ?C0150:
0014 22                RET     
             ; FUNCTION S5S0_CHK_VRREADY (END)

             ; FUNCTION S5S0_PCH_PWROK (BEGIN)
                                           ; SOURCE LINE # 914
                                           ; SOURCE LINE # 915
                                           ; SOURCE LINE # 916
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4440              ORL     A,#040H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 917
0007 900000      E     MOV     DPTR,#PwrOnDly5Sec
000A 7405              MOV     A,#05H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 918
000D 22                RET     
             ; FUNCTION S5S0_PCH_PWROK (END)

             ; FUNCTION S5S0_SYS_PWROK (BEGIN)
                                           ; SOURCE LINE # 920
                                           ; SOURCE LINE # 921
                                           ; SOURCE LINE # 922
0000 900000      E     MOV     DPTR,#GPDRI
0003 E0                MOVX    A,@DPTR
0004 4480              ORL     A,#080H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 923
0007 22                RET     
             ; FUNCTION S5S0_SYS_PWROK (END)

             ; FUNCTION LPC_RST (BEGIN)
                                           ; SOURCE LINE # 925
                                           ; SOURCE LINE # 926
                                           ; SOURCE LINE # 931
0000 22                RET     
             ; FUNCTION LPC_RST (END)

             ; FUNCTION S5S0_Init_Status (BEGIN)
                                           ; SOURCE LINE # 934
                                           ; SOURCE LINE # 935
                                           ; SOURCE LINE # 936
0000 900000      E     MOV     DPTR,#P80CMOSSts
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 70  

0003 E0                MOVX    A,@DPTR
0004 20E005            JB      ACC.0,?C0154
                                           ; SOURCE LINE # 937
                                           ; SOURCE LINE # 938
0007 E4                CLR     A
0008 900000      E     MOV     DPTR,#bios_check
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 939
000C         ?C0154:
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
000C 120000      R     LCALL   L?0430
                                           ; SOURCE LINE # 942
000F E4                CLR     A
0010 900000      E     MOV     DPTR,#ShipModeEn
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 943
0014 900000      E     MOV     DPTR,#Fan_ON_Count
0017 741E              MOV     A,#01EH
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 944
001A 900000      E     MOV     DPTR,#nBrightValue
001D 7411              MOV     A,#011H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 945
0020 900000      E     MOV     DPTR,#nSKINTemp90
0023 7420              MOV     A,#020H
0025 F0                MOVX    @DPTR,A
0026 900000      E     MOV     DPTR,#EXTVGA_TEMP
0029 F0                MOVX    @DPTR,A
002A 900000      E     MOV     DPTR,#VGA_TEMP
002D F0                MOVX    @DPTR,A
002E 900000      E     MOV     DPTR,#nCpuTemp
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 946
0032 900000      E     MOV     DPTR,#ThermistorCPU_TEMP
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 948
0036 900000      E     MOV     DPTR,#SEL_STATE0
0039 E0                MOVX    A,@DPTR
003A 30E049            JNB     ACC.0,?C0155
                                           ; SOURCE LINE # 949
                                           ; SOURCE LINE # 950
003D E4                CLR     A
003E 900000      E     MOV     DPTR,#batteryFirstUsedDateH
0041 F0                MOVX    @DPTR,A
0042 900000      E     MOV     DPTR,#batteryFirstUsedDateL
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 951
0046 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0049 743F              MOV     A,#03FH
004B F0                MOVX    @DPTR,A
004C 7E00        E     MOV     R6,#HIGH batteryFirstUsedDateL
004E A3                INC     DPTR
004F 7400        E     MOV     A,#HIGH batteryFirstUsedDateL
0051 F0                MOVX    @DPTR,A
0052 A3                INC     DPTR
0053 7400        E     MOV     A,#LOW batteryFirstUsedDateL
0055 F0                MOVX    @DPTR,A
0056 A3                INC     DPTR
0057 7401              MOV     A,#01H
0059 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 71  

005A 7B16              MOV     R3,#016H
005C 7D0C              MOV     R5,#0CH
005E FF                MOV     R7,A
005F 120000      E     LCALL   _bRWSMBus
0062 EF                MOV     A,R7
0063 6021              JZ      ?C0155
                                           ; SOURCE LINE # 952
                                           ; SOURCE LINE # 953
0065 900000      E     MOV     DPTR,#batteryFirstUsedDateL
0068 E0                MOVX    A,@DPTR
0069 7006              JNZ     ?C0158
006B 900000      E     MOV     DPTR,#batteryFirstUsedDateH
006E E0                MOVX    A,@DPTR
006F 6009              JZ      ?C0157
0071         ?C0158:
                                           ; SOURCE LINE # 954
0071 900000      E     MOV     DPTR,#pProject0
0074 E0                MOVX    A,@DPTR
0075 54F7              ANL     A,#0F7H
0077 F0                MOVX    @DPTR,A
0078 8007              SJMP    ?C0159
007A         ?C0157:
                                           ; SOURCE LINE # 956
007A 900000      E     MOV     DPTR,#pProject0
007D E0                MOVX    A,@DPTR
007E 4408              ORL     A,#08H
0080 F0                MOVX    @DPTR,A
0081         ?C0159:
                                           ; SOURCE LINE # 957
0081 7FAE              MOV     R7,#0AEH
0083 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 958
                                           ; SOURCE LINE # 959
0086         ?C0155:
                                           ; SOURCE LINE # 962
0086 900000      E     MOV     DPTR,#LED_KB_PWM_Count
0089 742A              MOV     A,#02AH
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 963
008C 900000      E     MOV     DPTR,#ACPI_HOTKEY
008F E0                MOVX    A,@DPTR
0090 541F              ANL     A,#01FH
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 964
0093 900000      E     MOV     DPTR,#SYS_STATUS
0096 E0                MOVX    A,@DPTR
0097 54F8              ANL     A,#0F8H
                                           ; SOURCE LINE # 966
                                           ; SOURCE LINE # 967
0099 120000      R     LCALL   L?0397
                                           ; SOURCE LINE # 968
009C 900000      E     MOV     DPTR,#BackLight_En_Delay
009F 7410              MOV     A,#010H
00A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 969
00A2 7405              MOV     A,#05H
                                           ; SOURCE LINE # 971
00A4 120000      R     LCALL   L?0419
00A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
00A8 900000      E     MOV     DPTR,#USB_Charger
00AB E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 72  

00AC 54FB              ANL     A,#0FBH
00AE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 976
00AF 900000      E     MOV     DPTR,#GPDRB
00B2 E0                MOVX    A,@DPTR
00B3 900000      E     MOV     DPTR,#SWI_EVENT
00B6 30E106            JNB     ACC.1,?C0160
                                           ; SOURCE LINE # 977
00B9 E0                MOVX    A,@DPTR
00BA 4402              ORL     A,#02H
00BC F0                MOVX    @DPTR,A
00BD 8004              SJMP    ?C0161
00BF         ?C0160:
                                           ; SOURCE LINE # 979
00BF E0                MOVX    A,@DPTR
00C0 54FD              ANL     A,#0FDH
00C2 F0                MOVX    @DPTR,A
00C3         ?C0161:
                                           ; SOURCE LINE # 981
00C3 900000      E     MOV     DPTR,#GPDRF
00C6 E0                MOVX    A,@DPTR
00C7 30E403            JNB     ACC.4,?C0163
00CA D3                SETB    C
00CB 8001              SJMP    ?C0164
00CD         ?C0163:
00CD C3                CLR     C
00CE         ?C0164:
00CE 900000      E     MOV     DPTR,#pDevStatus1
00D1 E0                MOVX    A,@DPTR
00D2 4005              JC      ?C0162
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
00D4 4404              ORL     A,#04H
00D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 984
00D7 8003              SJMP    ?C0165
00D9         ?C0162:
                                           ; SOURCE LINE # 986
                                           ; SOURCE LINE # 987
00D9 54FB              ANL     A,#0FBH
00DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 988
00DC         ?C0165:
                                           ; SOURCE LINE # 992
00DC 900000      E     MOV     DPTR,#uReserve07
00DF E0                MOVX    A,@DPTR
00E0 4401              ORL     A,#01H
                                           ; SOURCE LINE # 994
                                           ; SOURCE LINE # 995
00E2 120000      R     LCALL   L?0399
                                           ; SOURCE LINE # 996
00E5 120000      R     LCALL   Lowpower_DISfunction
                                           ; SOURCE LINE # 998
00E8 900000      E     MOV     DPTR,#CPUThrottlingDelayTime
00EB 743C              MOV     A,#03CH
00ED F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
00EE 120000      R     LCALL   L?0415
                                           ; SOURCE LINE # 1001
00F1 22                RET     
             ; FUNCTION S5S0_Init_Status (END)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 73  


             ; FUNCTION Oem_S5S0Sequence (BEGIN)
                                           ; SOURCE LINE # 1066
                                           ; SOURCE LINE # 1067
                                           ; SOURCE LINE # 1068
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0348
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0348:
0008 6009              JZ      ?C0170
                                           ; SOURCE LINE # 1069
                                           ; SOURCE LINE # 1070
                                           ; SOURCE LINE # 1071
000A 120000      R     LCALL   L?0383
000D 7002              JNZ     ?C0349
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0349:
0011 705A              JNZ     ?C0169
                                           ; SOURCE LINE # 1072
0013         ?C0170:
                                           ; SOURCE LINE # 1074
0013 900000      E     MOV     DPTR,#PWSeqStep
0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 9419              SUBB    A,#019H
001A 5051              JNC     ?C0169
                                           ; SOURCE LINE # 1075
                                           ; SOURCE LINE # 1076
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQS5S0+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQS5S0+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7022              JNZ     ?C0172
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1078
002E 120000      R     LCALL   L?0378
0031 2400        R     ADD     A,#LOW asPowerSEQS5S0
0033 F582              MOV     DPL,A
0035 E4                CLR     A
0036 3400        R     ADDC    A,#HIGH asPowerSEQS5S0
                                           ; SOURCE LINE # 1079
0038 120000      R     LCALL   L?0376
003B 2400        R     ADD     A,#LOW asPowerSEQS5S0+02H
003D F582              MOV     DPL,A
003F E4                CLR     A
0040 3400        R     ADDC    A,#HIGH asPowerSEQS5S0+02H
                                           ; SOURCE LINE # 1080
0042 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1081
0045 900000      E     MOV     DPTR,#PowSeqDelay
0048 E0                MOVX    A,@DPTR
0049 7002              JNZ     ?C0350
004B A3                INC     DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 74  

004C E0                MOVX    A,@DPTR
004D         ?C0350:
004D 60C4              JZ      ?C0170
                                           ; SOURCE LINE # 1082
                                           ; SOURCE LINE # 1083
004F 22                RET     
                                           ; SOURCE LINE # 1084
                                           ; SOURCE LINE # 1085
0050         ?C0172:
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1088
0050 120000      R     LCALL   L?0378
0053 2400        R     ADD     A,#LOW asPowerSEQS5S0
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        R     ADDC    A,#HIGH asPowerSEQS5S0
005A 120000      R     LCALL   L?0380
005D EF                MOV     A,R7
005E 600D              JZ      ?C0169
                                           ; SOURCE LINE # 1089
                                           ; SOURCE LINE # 1090
0060 120000      R     LCALL   L?0378
0063 2400        R     ADD     A,#LOW asPowerSEQS5S0+02H
0065 F582              MOV     DPL,A
0067 E4                CLR     A
0068 3400        R     ADDC    A,#HIGH asPowerSEQS5S0+02H
                                           ; SOURCE LINE # 1091
006A 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1092
                                           ; SOURCE LINE # 1093
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1095
                                           ; SOURCE LINE # 1096
006D         ?C0169:
006D 22                RET     
             ; FUNCTION Oem_S5S0Sequence (END)

             ; FUNCTION S0S5_VR_ON (BEGIN)
                                           ; SOURCE LINE # 1099
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1101
                                           ; SOURCE LINE # 1102
                                           ; SOURCE LINE # 1103
                                           ; SOURCE LINE # 1104
                                           ; SOURCE LINE # 1106
0000 120000      R     LCALL   L?0396
                                           ; SOURCE LINE # 1111
0003 22                RET     
             ; FUNCTION S0S5_VR_ON (END)

             ; FUNCTION S0S5_NVDD_OFF (BEGIN)
                                           ; SOURCE LINE # 1113
                                           ; SOURCE LINE # 1114
                                           ; SOURCE LINE # 1119
0000 22                RET     
             ; FUNCTION S0S5_NVDD_OFF (END)

             ; FUNCTION S0S5_SUSP (BEGIN)
                                           ; SOURCE LINE # 1121
                                           ; SOURCE LINE # 1122
                                           ; SOURCE LINE # 1123
0000 900000      E     MOV     DPTR,#GPDRC
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 75  

0003 E0                MOVX    A,@DPTR
0004 54BF              ANL     A,#0BFH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1124
0007 020000      R     LJMP    SetS5GPIO
             ; FUNCTION S0S5_SUSP (END)

             ; FUNCTION S0S5_EC_VCCST_EN (BEGIN)
                                           ; SOURCE LINE # 1130
                                           ; SOURCE LINE # 1131
                                           ; SOURCE LINE # 1132
0000 900000      E     MOV     DPTR,#GPDRA
0003 E0                MOVX    A,@DPTR
0004 547F              ANL     A,#07FH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1133
0007 22                RET     
             ; FUNCTION S0S5_EC_VCCST_EN (END)

             ; FUNCTION S0S5_EC_VPP_PWREN (BEGIN)
                                           ; SOURCE LINE # 1136
                                           ; SOURCE LINE # 1137
                                           ; SOURCE LINE # 1138
0000 900000      E     MOV     DPTR,#GPDRE
0003 E0                MOVX    A,@DPTR
0004 54F7              ANL     A,#0F7H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1139
0007 22                RET     
             ; FUNCTION S0S5_EC_VPP_PWREN (END)

             ; FUNCTION S0S5_GPO7 (BEGIN)
                                           ; SOURCE LINE # 1142
                                           ; SOURCE LINE # 1143
                                           ; SOURCE LINE # 1145
0000 22                RET     
             ; FUNCTION S0S5_GPO7 (END)

             ; FUNCTION S0S5_SYS_ON (BEGIN)
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
0000 900000      E     MOV     DPTR,#GPDRG
0003 E0                MOVX    A,@DPTR
0004 54FD              ANL     A,#0FDH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1150
0007 020000      R     LJMP    Write_NOVOS4
             ; FUNCTION S0S5_SYS_ON (END)

             ; FUNCTION S0S5_DPWROK_OFF (BEGIN)
                                           ; SOURCE LINE # 1152
                                           ; SOURCE LINE # 1153
                                           ; SOURCE LINE # 1154
0000 900000      E     MOV     DPTR,#cCmd
0003 E0                MOVX    A,@DPTR
0004 20E203            JB      ACC.2,?C0184
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1157
0007 120000      R     LCALL   L?0410
                                           ; SOURCE LINE # 1158
                                           ; SOURCE LINE # 1159
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 76  

000A         ?C0184:
000A 22                RET     
             ; FUNCTION S0S5_DPWROK_OFF (END)

             ; FUNCTION S0S5_Init_Status (BEGIN)
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
                                           ; SOURCE LINE # 1165
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#F2_Pressed
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1166
0005 900000      E     MOV     DPTR,#pProject4
0008 E0                MOVX    A,@DPTR
0009 54FE              ANL     A,#0FEH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1186
;---- Variable 'EVENT_BUFFER_CNT' assigned to Register 'R7' ----
000C         ?C0185:
                                           ; SOURCE LINE # 1187
                                           ; SOURCE LINE # 1188
000C 120000      R     LCALL   L?0433
000F         ?C0351:
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 DFFC              DJNZ    R7,?C0351
                                           ; SOURCE LINE # 1189
0013 7F09              MOV     R7,#09H
0015         ?C0186:
                                           ; SOURCE LINE # 1190
                                           ; SOURCE LINE # 1191
0015 120000      R     LCALL   L?0422
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1193
0019 900000      E     MOV     DPTR,#Bioswatchdog
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1195
001D 900000      E     MOV     DPTR,#cDev
0020 E0                MOVX    A,@DPTR
0021 54F7              ANL     A,#0F7H
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1196
0024 E4                CLR     A
0025 900000      E     MOV     DPTR,#uNovoVPCCount
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1197
0029 900000      E     MOV     DPTR,#uWOVSTATUS
                                           ; SOURCE LINE # 1198
                                           ; SOURCE LINE # 1199
                                           ; SOURCE LINE # 1200
002C 120000      R     LCALL   L?0381
                                           ; SOURCE LINE # 1201
002F 900000      E     MOV     DPTR,#nBatteryStatH
0032 E0                MOVX    A,@DPTR
0033 54FB              ANL     A,#0FBH
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1202
                                           ; SOURCE LINE # 1203
0036 120000      R     LCALL   L?0405
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1204
                                           ; SOURCE LINE # 1205
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 77  

003A 120000      R     LCALL   L?0426
                                           ; SOURCE LINE # 1206
003D 900000      E     MOV     DPTR,#ECSleepCount
0040 7403              MOV     A,#03H
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1208
0043 120000      E     LCALL   PowerOffClearTPPendingData
                                           ; SOURCE LINE # 1210
0046 900000      E     MOV     DPTR,#GPDRB
0049 E0                MOVX    A,@DPTR
004A 900000      E     MOV     DPTR,#SWI_EVENT
004D 30E106            JNB     ACC.1,?C0188
                                           ; SOURCE LINE # 1211
0050 E0                MOVX    A,@DPTR
0051 4402              ORL     A,#02H
0053 F0                MOVX    @DPTR,A
0054 8004              SJMP    ?C0189
0056         ?C0188:
                                           ; SOURCE LINE # 1213
0056 E0                MOVX    A,@DPTR
0057 54FD              ANL     A,#0FDH
0059 F0                MOVX    @DPTR,A
005A         ?C0189:
                                           ; SOURCE LINE # 1216
005A 900000      E     MOV     DPTR,#cSysActionFlag
005D E0                MOVX    A,@DPTR
005E 6403              XRL     A,#03H
0060 6004              JZ      ?C0191
0062 E0                MOVX    A,@DPTR
0063 B40410            CJNE    A,#04H,?C0190
0066         ?C0191:
                                           ; SOURCE LINE # 1217
                                           ; SOURCE LINE # 1218
0066 900000      E     MOV     DPTR,#WinFlashMark
0069 7453              MOV     A,#053H
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1219
006C 900000      E     MOV     DPTR,#WinFlashMark2
006F 7435              MOV     A,#035H
0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1220
0072 7F41              MOV     R7,#041H
                                           ; SOURCE LINE # 1221
0074 8015              SJMP    ?C0366
0076         ?C0190:
                                           ; SOURCE LINE # 1223
0076 900000      E     MOV     DPTR,#cSysActionFlag
0079 E0                MOVX    A,@DPTR
007A B40211            CJNE    A,#02H,?C0192
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1225
007D 900000      E     MOV     DPTR,#WinFlashMark
0080 74AA              MOV     A,#0AAH
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1226
0083 900000      E     MOV     DPTR,#WinFlashMark1
0086 7488              MOV     A,#088H
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1227
0089 7F05              MOV     R7,#05H
008B         ?C0366:
008B 120000      E     LCALL   _InternalWDTNow
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 78  

                                           ; SOURCE LINE # 1228
008E         ?C0192:
                                           ; SOURCE LINE # 1230
008E 120000      E     LCALL   Clr_Thermal_Tab
                                           ; SOURCE LINE # 1232
0091 900000      E     MOV     DPTR,#SysStatus
0094 E0                MOVX    A,@DPTR
0095 30E712            JNB     ACC.7,?C0194
                                           ; SOURCE LINE # 1233
                                           ; SOURCE LINE # 1234
0098 C200        E     CLR     Ccb42_DISAB_KEY
                                           ; SOURCE LINE # 1235
009A 7800        E     MOV     R0,#LOW Flag
009C E6                MOV     A,@R0
009D 54FE              ANL     A,#0FEH
009F F6                MOV     @R0,A
                                           ; SOURCE LINE # 1236
00A0 120000      E     LCALL   Unlock_Scan
                                           ; SOURCE LINE # 1237
00A3 900000      E     MOV     DPTR,#SysStatus
00A6 E0                MOVX    A,@DPTR
00A7 547F              ANL     A,#07FH
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1238
00AA         ?C0194:
                                           ; SOURCE LINE # 1241
00AA 900000      E     MOV     DPTR,#PowerUVP_REG
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF 900000      E     MOV     DPTR,#PowerOVP_REG
00B2 E0                MOVX    A,@DPTR
00B3 4F                ORL     A,R7
00B4 FF                MOV     R7,A
00B5 900000      E     MOV     DPTR,#PowerOCP_REG
00B8 E0                MOVX    A,@DPTR
00B9 4F                ORL     A,R7
00BA FF                MOV     R7,A
00BB 900000      E     MOV     DPTR,#PowerOTP_REG
00BE E0                MOVX    A,@DPTR
00BF 4F                ORL     A,R7
00C0 600C              JZ      ?C0195
                                           ; SOURCE LINE # 1242
                                           ; SOURCE LINE # 1243
00C2 900000      E     MOV     DPTR,#SysStatus
00C5 E0                MOVX    A,@DPTR
00C6 20E105            JB      ACC.1,?C0195
                                           ; SOURCE LINE # 1244
00C9 7F36              MOV     R7,#036H
00CB 120000      E     LCALL   _ProcessSID
                                           ; SOURCE LINE # 1245
00CE         ?C0195:
                                           ; SOURCE LINE # 1248
00CE 120000      R     LCALL   PollingOTP
                                           ; SOURCE LINE # 1250
00D1 900000      E     MOV     DPTR,#SysStatus
00D4 E0                MOVX    A,@DPTR
00D5 20E105            JB      ACC.1,?C0197
                                           ; SOURCE LINE # 1251
00D8 7F01              MOV     R7,#01H
00DA 120000      E     LCALL   _ProcessSID
00DD         ?C0197:
                                           ; SOURCE LINE # 1252
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 79  

00DD 900000      E     MOV     DPTR,#SysStatus
00E0 E0                MOVX    A,@DPTR
00E1 54FD              ANL     A,#0FDH
                                           ; SOURCE LINE # 1253
                                           ; SOURCE LINE # 1254
                                           ; SOURCE LINE # 1255
00E3 120000      R     LCALL   L?0421
                                           ; SOURCE LINE # 1258
00E6 120000      R     LCALL   Lowpower_ENfunction
                                           ; SOURCE LINE # 1260
                                           ; SOURCE LINE # 1261
                                           ; SOURCE LINE # 1262
                                           ; SOURCE LINE # 1263
                                           ; SOURCE LINE # 1264
                                           ; SOURCE LINE # 1265
                                           ; SOURCE LINE # 1266
00E9 120000      R     LCALL   L?0384
                                           ; SOURCE LINE # 1268
                                           ; SOURCE LINE # 1269
                                           ; SOURCE LINE # 1272
00EC 120000      R     LCALL   L?0408
00EF 7455              MOV     A,#055H
00F1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1274
00F2 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
00F5 E0                MOVX    A,@DPTR
00F6 600C              JZ      ?C0198
00F8 900000      E     MOV     DPTR,#OEMControl
00FB E0                MOVX    A,@DPTR
00FC 30E305            JNB     ACC.3,?C0198
                                           ; SOURCE LINE # 1275
                                           ; SOURCE LINE # 1276
00FF E4                CLR     A
0100 FF                MOV     R7,A
0101 120000      E     LCALL   _S4S5_KeyWake
                                           ; SOURCE LINE # 1277
0104         ?C0198:
                                           ; SOURCE LINE # 1278
0104 E4                CLR     A
0105 900000      E     MOV     DPTR,#ONEKEY_FLAG
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1279
0109 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
010C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1280
010D 900000      E     MOV     DPTR,#OEMControl
0110 E0                MOVX    A,@DPTR
0111 54F7              ANL     A,#0F7H
0113 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1281
0114 22                RET     
             ; FUNCTION S0S5_Init_Status (END)

             ; FUNCTION Oem_S0S5Sequence (BEGIN)
                                           ; SOURCE LINE # 1300
                                           ; SOURCE LINE # 1301
                                           ; SOURCE LINE # 1302
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0352
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 80  

0008         ?C0352:
0008 6009              JZ      ?C0203
                                           ; SOURCE LINE # 1303
                                           ; SOURCE LINE # 1304
                                           ; SOURCE LINE # 1305
000A 120000      R     LCALL   L?0383
000D 7002              JNZ     ?C0353
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0353:
0011 705A              JNZ     ?C0202
                                           ; SOURCE LINE # 1306
                                           ; SOURCE LINE # 1308
                                           ; SOURCE LINE # 1309
0013         ?C0203:
                                           ; SOURCE LINE # 1311
0013 900000      E     MOV     DPTR,#PWSeqStep
0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 9407              SUBB    A,#07H
001A 5051              JNC     ?C0202
                                           ; SOURCE LINE # 1312
                                           ; SOURCE LINE # 1313
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQS0S5+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQS0S5+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7022              JNZ     ?C0205
                                           ; SOURCE LINE # 1314
                                           ; SOURCE LINE # 1315
002E 120000      R     LCALL   L?0378
0031 2400        R     ADD     A,#LOW asPowerSEQS0S5
0033 F582              MOV     DPL,A
0035 E4                CLR     A
0036 3400        R     ADDC    A,#HIGH asPowerSEQS0S5
                                           ; SOURCE LINE # 1316
0038 120000      R     LCALL   L?0377
003B 2400        R     ADD     A,#LOW asPowerSEQS0S5+02H
003D F582              MOV     DPL,A
003F E4                CLR     A
0040 3400        R     ADDC    A,#HIGH asPowerSEQS0S5+02H
                                           ; SOURCE LINE # 1317
0042 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1318
0045 900000      E     MOV     DPTR,#PowSeqDelay
0048 E0                MOVX    A,@DPTR
0049 7002              JNZ     ?C0354
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D         ?C0354:
004D 60C4              JZ      ?C0203
                                           ; SOURCE LINE # 1319
                                           ; SOURCE LINE # 1320
004F 22                RET     
                                           ; SOURCE LINE # 1321
                                           ; SOURCE LINE # 1322
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 81  

0050         ?C0205:
                                           ; SOURCE LINE # 1324
                                           ; SOURCE LINE # 1325
0050 120000      R     LCALL   L?0378
0053 2400        R     ADD     A,#LOW asPowerSEQS0S5
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        R     ADDC    A,#HIGH asPowerSEQS0S5
005A 120000      R     LCALL   L?0380
005D EF                MOV     A,R7
005E 600D              JZ      ?C0202
                                           ; SOURCE LINE # 1326
                                           ; SOURCE LINE # 1327
0060 120000      R     LCALL   L?0378
0063 2400        R     ADD     A,#LOW asPowerSEQS0S5+02H
0065 F582              MOV     DPL,A
0067 E4                CLR     A
0068 3400        R     ADDC    A,#HIGH asPowerSEQS0S5+02H
                                           ; SOURCE LINE # 1328
006A 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1329
                                           ; SOURCE LINE # 1330
                                           ; SOURCE LINE # 1331
                                           ; SOURCE LINE # 1332
                                           ; SOURCE LINE # 1333
006D         ?C0202:
006D 22                RET     
             ; FUNCTION Oem_S0S5Sequence (END)

             ; FUNCTION S0S3_VR_ON (BEGIN)
                                           ; SOURCE LINE # 1336
                                           ; SOURCE LINE # 1337
                                           ; SOURCE LINE # 1338
                                           ; SOURCE LINE # 1339
                                           ; SOURCE LINE # 1340
                                           ; SOURCE LINE # 1341
                                           ; SOURCE LINE # 1342
0000 120000      R     LCALL   L?0396
                                           ; SOURCE LINE # 1349
0003 22                RET     
             ; FUNCTION S0S3_VR_ON (END)

             ; FUNCTION S0S3_SUSP (BEGIN)
                                           ; SOURCE LINE # 1351
                                           ; SOURCE LINE # 1352
                                           ; SOURCE LINE # 1353
0000 900000      E     MOV     DPTR,#GPDRC
0003 E0                MOVX    A,@DPTR
0004 54BF              ANL     A,#0BFH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1358
0007 020000      R     LJMP    SetS5GPIO
             ; FUNCTION S0S3_SUSP (END)

             ; FUNCTION S0S3_EC_VCCST_EN (BEGIN)
                                           ; SOURCE LINE # 1364
                                           ; SOURCE LINE # 1365
                                           ; SOURCE LINE # 1366
0000 900000      E     MOV     DPTR,#GPDRA
0003 E0                MOVX    A,@DPTR
0004 547F              ANL     A,#07FH
0006 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 82  

                                           ; SOURCE LINE # 1367
0007 22                RET     
             ; FUNCTION S0S3_EC_VCCST_EN (END)

             ; FUNCTION S0S3_GPO7 (BEGIN)
                                           ; SOURCE LINE # 1368
                                           ; SOURCE LINE # 1369
                                           ; SOURCE LINE # 1371
0000 22                RET     
             ; FUNCTION S0S3_GPO7 (END)

             ; FUNCTION S0S3_Init_Status (BEGIN)
                                           ; SOURCE LINE # 1372
                                           ; SOURCE LINE # 1373
                                           ; SOURCE LINE # 1378
                                           ; SOURCE LINE # 1379
0000 120000      R     LCALL   L?0405
                                           ; SOURCE LINE # 1380
                                           ; SOURCE LINE # 1381
                                           ; SOURCE LINE # 1382
0003 120000      R     LCALL   L?0381
                                           ; SOURCE LINE # 1386
;---- Variable 'EVENT_BUFFER_CNT' assigned to Register 'R7' ----
0006         ?C0213:
                                           ; SOURCE LINE # 1387
                                           ; SOURCE LINE # 1388
0006 120000      R     LCALL   L?0434
0009         ?C0355:
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B DFFC              DJNZ    R7,?C0355
                                           ; SOURCE LINE # 1389
000D 7F09              MOV     R7,#09H
000F         ?C0214:
                                           ; SOURCE LINE # 1390
                                           ; SOURCE LINE # 1391
000F 120000      R     LCALL   L?0423
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1394
0013 120000      E     LCALL   PowerOffClearTPPendingData
                                           ; SOURCE LINE # 1396
0016 120000      E     LCALL   Clr_Thermal_Tab
                                           ; SOURCE LINE # 1397
0019 E4                CLR     A
                                           ; SOURCE LINE # 1398
001A 120000      R     LCALL   L?0426
                                           ; SOURCE LINE # 1399
001D 900000      E     MOV     DPTR,#AOAC_STATUS
0020 E0                MOVX    A,@DPTR
0021 5410              ANL     A,#010H
                                           ; SOURCE LINE # 1400
                                           ; SOURCE LINE # 1401
                                           ; SOURCE LINE # 1404
0023 120000      R     LCALL   L?0421
                                           ; SOURCE LINE # 1407
0026 120000      R     LCALL   Lowpower_ENfunction
                                           ; SOURCE LINE # 1409
0029 900000      E     MOV     DPTR,#pDevStatus3
002C E0                MOVX    A,@DPTR
002D 54BF              ANL     A,#0BFH
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1410
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 83  

0030 547F              ANL     A,#07FH
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1411
0033 900000      E     MOV     DPTR,#pDevStatus1
0036 E0                MOVX    A,@DPTR
0037 54FE              ANL     A,#0FEH
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1412
003A E0                MOVX    A,@DPTR
003B 54FD              ANL     A,#0FDH
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1413
003E E0                MOVX    A,@DPTR
003F 54FB              ANL     A,#0FBH
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
0042 120000      E     LCALL   Enable_Any_Key_Irq
                                           ; SOURCE LINE # 1415
0045 E4                CLR     A
0046 900000      E     MOV     DPTR,#YogaModeStatus
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1416
004A 900000      E     MOV     DPTR,#pDevStatus1
                                           ; SOURCE LINE # 1417
                                           ; SOURCE LINE # 1418
004D 120000      R     LCALL   L?0385
                                           ; SOURCE LINE # 1419
                                           ; SOURCE LINE # 1420
                                           ; SOURCE LINE # 1423
0050 120000      R     LCALL   L?0408
0053 7433              MOV     A,#033H
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1425
0056 900000      E     MOV     DPTR,#GPDRB
0059 E0                MOVX    A,@DPTR
005A 30E103            JNB     ACC.1,?C0217
005D D3                SETB    C
005E 8001              SJMP    ?C0218
0060         ?C0217:
0060 C3                CLR     C
0061         ?C0218:
0061 4013              JC      ?C0216
0063 900000      E     MOV     DPTR,#GPDRB
0066 E0                MOVX    A,@DPTR
0067 30E003            JNB     ACC.0,?C0219
006A D3                SETB    C
006B 8001              SJMP    ?C0220
006D         ?C0219:
006D C3                CLR     C
006E         ?C0220:
006E 4006              JC      ?C0216
                                           ; SOURCE LINE # 1426
0070 900000      E     MOV     DPTR,#GPCRD5
0073 7480              MOV     A,#080H
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1427
0076         ?C0216:
                                           ; SOURCE LINE # 1429
0076 120000      R     LCALL   L?0416
                                           ; SOURCE LINE # 1431
0079 22                RET     
             ; FUNCTION S0S3_Init_Status (END)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 84  


             ; FUNCTION Oem_S0S3Sequence (BEGIN)
                                           ; SOURCE LINE # 1447
                                           ; SOURCE LINE # 1448
                                           ; SOURCE LINE # 1449
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0356
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0356:
0008 6009              JZ      ?C0225
                                           ; SOURCE LINE # 1450
                                           ; SOURCE LINE # 1451
                                           ; SOURCE LINE # 1452
000A 120000      R     LCALL   L?0383
000D 7002              JNZ     ?C0357
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0357:
0011 705A              JNZ     ?C0224
                                           ; SOURCE LINE # 1453
                                           ; SOURCE LINE # 1455
                                           ; SOURCE LINE # 1456
0013         ?C0225:
                                           ; SOURCE LINE # 1458
0013 900000      E     MOV     DPTR,#PWSeqStep
0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 9404              SUBB    A,#04H
001A 5051              JNC     ?C0224
                                           ; SOURCE LINE # 1459
                                           ; SOURCE LINE # 1460
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQS0S3+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQS0S3+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7022              JNZ     ?C0227
                                           ; SOURCE LINE # 1461
                                           ; SOURCE LINE # 1462
002E 120000      R     LCALL   L?0378
0031 2400        R     ADD     A,#LOW asPowerSEQS0S3
0033 F582              MOV     DPL,A
0035 E4                CLR     A
0036 3400        R     ADDC    A,#HIGH asPowerSEQS0S3
                                           ; SOURCE LINE # 1463
0038 120000      R     LCALL   L?0377
003B 2400        R     ADD     A,#LOW asPowerSEQS0S3+02H
003D F582              MOV     DPL,A
003F E4                CLR     A
0040 3400        R     ADDC    A,#HIGH asPowerSEQS0S3+02H
                                           ; SOURCE LINE # 1464
0042 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1465
0045 900000      E     MOV     DPTR,#PowSeqDelay
0048 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 85  

0049 7002              JNZ     ?C0358
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D         ?C0358:
004D 60C4              JZ      ?C0225
                                           ; SOURCE LINE # 1466
                                           ; SOURCE LINE # 1467
004F 22                RET     
                                           ; SOURCE LINE # 1468
                                           ; SOURCE LINE # 1469
0050         ?C0227:
                                           ; SOURCE LINE # 1471
                                           ; SOURCE LINE # 1472
0050 120000      R     LCALL   L?0378
0053 2400        R     ADD     A,#LOW asPowerSEQS0S3
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        R     ADDC    A,#HIGH asPowerSEQS0S3
005A 120000      R     LCALL   L?0380
005D EF                MOV     A,R7
005E 600D              JZ      ?C0224
                                           ; SOURCE LINE # 1473
                                           ; SOURCE LINE # 1474
0060 120000      R     LCALL   L?0378
0063 2400        R     ADD     A,#LOW asPowerSEQS0S3+02H
0065 F582              MOV     DPL,A
0067 E4                CLR     A
0068 3400        R     ADDC    A,#HIGH asPowerSEQS0S3+02H
                                           ; SOURCE LINE # 1475
006A 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1476
                                           ; SOURCE LINE # 1477
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1479
                                           ; SOURCE LINE # 1480
006D         ?C0224:
006D 22                RET     
             ; FUNCTION Oem_S0S3Sequence (END)

             ; FUNCTION S3S0_PM_PWER_BTN1 (BEGIN)
                                           ; SOURCE LINE # 1483
                                           ; SOURCE LINE # 1484
                                           ; SOURCE LINE # 1485
0000 120000      R     LCALL   L?0414
                                           ; SOURCE LINE # 1486
0003 22                RET     
             ; FUNCTION S3S0_PM_PWER_BTN1 (END)

             ; FUNCTION S3S0_PM_PWER_BTN2 (BEGIN)
                                           ; SOURCE LINE # 1488
                                           ; SOURCE LINE # 1489
                                           ; SOURCE LINE # 1490
0000 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 1491
0003 900000      E     MOV     DPTR,#SysPowState
0006 7433              MOV     A,#033H
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1492
0009 22                RET     
             ; FUNCTION S3S0_PM_PWER_BTN2 (END)

             ; FUNCTION S3S0_EC_VCCST_EN (BEGIN)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 86  

                                           ; SOURCE LINE # 1493
                                           ; SOURCE LINE # 1494
                                           ; SOURCE LINE # 1495
0000 900000      E     MOV     DPTR,#GPDRA
0003 E0                MOVX    A,@DPTR
0004 4480              ORL     A,#080H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1496
0007 22                RET     
             ; FUNCTION S3S0_EC_VCCST_EN (END)

             ; FUNCTION S3S0_GPO7 (BEGIN)
                                           ; SOURCE LINE # 1497
                                           ; SOURCE LINE # 1498
                                           ; SOURCE LINE # 1500
0000 22                RET     
             ; FUNCTION S3S0_GPO7 (END)

             ; FUNCTION S3S0_SUSP (BEGIN)
                                           ; SOURCE LINE # 1501
                                           ; SOURCE LINE # 1502
                                           ; SOURCE LINE # 1503
0000 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 1504
0003 900000      E     MOV     DPTR,#GPDRC
0006 E0                MOVX    A,@DPTR
0007 4440              ORL     A,#040H
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1505
000A 120000      R     LCALL   SetS0GPIO
                                           ; SOURCE LINE # 1506
                                           ; SOURCE LINE # 1507
000D 120000      R     LCALL   L?0424
                                           ; SOURCE LINE # 1520
0010 22                RET     
             ; FUNCTION S3S0_SUSP (END)

             ; FUNCTION S3S0_EC_VCCIO_EN (BEGIN)
                                           ; SOURCE LINE # 1522
                                           ; SOURCE LINE # 1523
                                           ; SOURCE LINE # 1524
0000 900000      E     MOV     DPTR,#GPDRB
0003 E0                MOVX    A,@DPTR
0004 4404              ORL     A,#04H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1525
0007 22                RET     
             ; FUNCTION S3S0_EC_VCCIO_EN (END)

             ; FUNCTION S3S0_VCCST_PWRGD (BEGIN)
                                           ; SOURCE LINE # 1527
                                           ; SOURCE LINE # 1528
                                           ; SOURCE LINE # 1529
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4420              ORL     A,#020H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1530
0007 22                RET     
             ; FUNCTION S3S0_VCCST_PWRGD (END)

             ; FUNCTION S3S0_VR_ON (BEGIN)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 87  

                                           ; SOURCE LINE # 1532
                                           ; SOURCE LINE # 1533
                                           ; SOURCE LINE # 1534
0000 900000      E     MOV     DPTR,#GPDRE
0003 E0                MOVX    A,@DPTR
0004 4410              ORL     A,#010H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1535
0007 900000      E     MOV     DPTR,#MuteCount
000A 7412              MOV     A,#012H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1537
000D 900000      E     MOV     DPTR,#SYS_STATUS
0010 E0                MOVX    A,@DPTR
0011 30E706            JNB     ACC.7,?C0239
                                           ; SOURCE LINE # 1538
                                           ; SOURCE LINE # 1540
                                           ; SOURCE LINE # 1541
0014 120000      R     LCALL   L?0439
0017 7420              MOV     A,#020H
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1542
                                           ; SOURCE LINE # 1544
001A         ?C0239:
001A 22                RET     
             ; FUNCTION S3S0_VR_ON (END)

             ; FUNCTION PCH_PWROK (BEGIN)
                                           ; SOURCE LINE # 1545
                                           ; SOURCE LINE # 1546
                                           ; SOURCE LINE # 1547
0000 900000      E     MOV     DPTR,#GPDRH
0003 E0                MOVX    A,@DPTR
0004 4440              ORL     A,#040H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1548
0007 22                RET     
             ; FUNCTION PCH_PWROK (END)

             ; FUNCTION S3S0_Init_Status (BEGIN)
                                           ; SOURCE LINE # 1551
                                           ; SOURCE LINE # 1552
                                           ; SOURCE LINE # 1553
0000 900000      E     MOV     DPTR,#Fan_ON_Count
0003 741E              MOV     A,#01EH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1556
0006 7F9B              MOV     R7,#09BH
0008 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 1559
                                           ; SOURCE LINE # 1560
000B 120000      R     LCALL   L?0398
                                           ; SOURCE LINE # 1561
000E 900000      E     MOV     DPTR,#BackLight_En_Delay
0011 7403              MOV     A,#03H
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1562
0014 7428              MOV     A,#028H
                                           ; SOURCE LINE # 1564
0016 120000      R     LCALL   L?0419
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1565
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 88  

001A 900000      E     MOV     DPTR,#CURRENT_STATUS
001D E0                MOVX    A,@DPTR
001E 54C0              ANL     A,#0C0H
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1569
                                           ; SOURCE LINE # 1573
                                           ; SOURCE LINE # 1576
0021 120000      R     LCALL   Lowpower_DISfunction
                                           ; SOURCE LINE # 1577
                                           ; SOURCE LINE # 1578
0024 120000      R     LCALL   L?0400
                                           ; SOURCE LINE # 1579
                                           ; SOURCE LINE # 1580
0027 120000      R     LCALL   L?0415
                                           ; SOURCE LINE # 1581
002A 22                RET     
             ; FUNCTION S3S0_Init_Status (END)

             ; FUNCTION Oem_S3S0Sequence (BEGIN)
                                           ; SOURCE LINE # 1606
                                           ; SOURCE LINE # 1607
                                           ; SOURCE LINE # 1608
0000 900000      E     MOV     DPTR,#PowSeqDelay
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0359
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0359:
0008 6009              JZ      ?C0245
                                           ; SOURCE LINE # 1609
                                           ; SOURCE LINE # 1610
                                           ; SOURCE LINE # 1611
000A 120000      R     LCALL   L?0383
000D 7002              JNZ     ?C0360
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011         ?C0360:
0011 705A              JNZ     ?C0244
                                           ; SOURCE LINE # 1612
                                           ; SOURCE LINE # 1614
                                           ; SOURCE LINE # 1615
0013         ?C0245:
                                           ; SOURCE LINE # 1617
0013 900000      E     MOV     DPTR,#PWSeqStep
0016 E0                MOVX    A,@DPTR
0017 C3                CLR     C
0018 940D              SUBB    A,#0DH
001A 5051              JNC     ?C0244
                                           ; SOURCE LINE # 1618
                                           ; SOURCE LINE # 1619
001C E0                MOVX    A,@DPTR
001D 75F005            MOV     B,#05H
0020 A4                MUL     AB
0021 2400        R     ADD     A,#LOW asPowerSEQS3S0+04H
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH asPowerSEQS3S0+04H
0028 F583              MOV     DPH,A
002A E4                CLR     A
002B 93                MOVC    A,@A+DPTR
002C 7022              JNZ     ?C0247
                                           ; SOURCE LINE # 1620
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 89  

                                           ; SOURCE LINE # 1621
002E 120000      R     LCALL   L?0378
0031 2400        R     ADD     A,#LOW asPowerSEQS3S0
0033 F582              MOV     DPL,A
0035 E4                CLR     A
0036 3400        R     ADDC    A,#HIGH asPowerSEQS3S0
                                           ; SOURCE LINE # 1622
0038 120000      R     LCALL   L?0377
003B 2400        R     ADD     A,#LOW asPowerSEQS3S0+02H
003D F582              MOV     DPL,A
003F E4                CLR     A
0040 3400        R     ADDC    A,#HIGH asPowerSEQS3S0+02H
                                           ; SOURCE LINE # 1623
0042 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1624
0045 900000      E     MOV     DPTR,#PowSeqDelay
0048 E0                MOVX    A,@DPTR
0049 7002              JNZ     ?C0361
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D         ?C0361:
004D 60C4              JZ      ?C0245
                                           ; SOURCE LINE # 1625
                                           ; SOURCE LINE # 1626
004F 22                RET     
                                           ; SOURCE LINE # 1627
                                           ; SOURCE LINE # 1628
0050         ?C0247:
                                           ; SOURCE LINE # 1630
                                           ; SOURCE LINE # 1631
0050 120000      R     LCALL   L?0378
0053 2400        R     ADD     A,#LOW asPowerSEQS3S0
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        R     ADDC    A,#HIGH asPowerSEQS3S0
005A 120000      R     LCALL   L?0380
005D EF                MOV     A,R7
005E 600D              JZ      ?C0244
                                           ; SOURCE LINE # 1632
                                           ; SOURCE LINE # 1633
0060 120000      R     LCALL   L?0378
0063 2400        R     ADD     A,#LOW asPowerSEQS3S0+02H
0065 F582              MOV     DPL,A
0067 E4                CLR     A
0068 3400        R     ADDC    A,#HIGH asPowerSEQS3S0+02H
                                           ; SOURCE LINE # 1634
006A 120000      R     LCALL   L?0375
                                           ; SOURCE LINE # 1635
                                           ; SOURCE LINE # 1636
                                           ; SOURCE LINE # 1637
                                           ; SOURCE LINE # 1638
                                           ; SOURCE LINE # 1639
006D         ?C0244:
006D 22                RET     
             ; FUNCTION Oem_S3S0Sequence (END)

             ; FUNCTION CheckAutoPowerOn (BEGIN)
                                           ; SOURCE LINE # 1641
                                           ; SOURCE LINE # 1642
                                           ; SOURCE LINE # 1643
0000 900000      E     MOV     DPTR,#WinFlashMark
0003 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 90  

0004 B45322            CJNE    A,#053H,?C0253
0007 900000      E     MOV     DPTR,#WinFlashMark2
000A E0                MOVX    A,@DPTR
000B B4351B            CJNE    A,#035H,?C0253
000E 900000      E     MOV     DPTR,#SysPowState
0011 E0                MOVX    A,@DPTR
0012 6455              XRL     A,#055H
0014 6004              JZ      ?C0252
0016 E0                MOVX    A,@DPTR
0017 B4660F            CJNE    A,#066H,?C0253
001A         ?C0252:
                                           ; SOURCE LINE # 1644
                                           ; SOURCE LINE # 1646
001A 900000      E     MOV     DPTR,#AutoTimer
001D 7483              MOV     A,#083H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1647
0020 E4                CLR     A
0021 900000      E     MOV     DPTR,#WinFlashMark
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1648
0025 900000      E     MOV     DPTR,#WinFlashMark2
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1649
                                           ; SOURCE LINE # 1650
0029         ?C0253:
0029 22                RET     
             ; FUNCTION CheckAutoPowerOn (END)

             ; FUNCTION Check_EC_ON (BEGIN)
                                           ; SOURCE LINE # 1652
                                           ; SOURCE LINE # 1653
                                           ; SOURCE LINE # 1655
0000 900000      E     MOV     DPTR,#ACPI_HOTKEY
0003 E0                MOVX    A,@DPTR
0004 20E75D            JB      ACC.7,?C0254
0007 900000      E     MOV     DPTR,#LOWBATT_3TIMES
000A E0                MOVX    A,@DPTR
000B 7057              JNZ     ?C0254
                                           ; SOURCE LINE # 1656
                                           ; SOURCE LINE # 1657
000D 900000      E     MOV     DPTR,#ACPI_HOTKEY
0010 E0                MOVX    A,@DPTR
0011 20E650            JB      ACC.6,?C0254
                                           ; SOURCE LINE # 1658
                                           ; SOURCE LINE # 1661
0014 900000      E     MOV     DPTR,#GPDRB
0017 E0                MOVX    A,@DPTR
0018 30E003            JNB     ACC.0,?C0257
001B D3                SETB    C
001C 8001              SJMP    ?C0258
001E         ?C0257:
001E C3                CLR     C
001F         ?C0258:
001F 404E              JC      ?C0260
0021 900000      E     MOV     DPTR,#SysPowState
0024 E0                MOVX    A,@DPTR
0025 6455              XRL     A,#055H
0027 7046              JNZ     ?C0260
                                           ; SOURCE LINE # 1662
                                           ; SOURCE LINE # 1666
0029 900000      E     MOV     DPTR,#ShipModeEn
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 91  

002C E0                MOVX    A,@DPTR
002D B4A514            CJNE    A,#0A5H,?C0259
                                           ; SOURCE LINE # 1667
                                           ; SOURCE LINE # 1668
0030 E4                CLR     A
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1669
0032 120000      E     LCALL   Lock_ShipMode
                                           ; SOURCE LINE # 1670
0035 900000      E     MOV     DPTR,#GPCRC1
0038 7480              MOV     A,#080H
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1671
003B 900000      E     MOV     DPTR,#GPCRC2
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1672
003F 7F64              MOV     R7,#064H
0041 120000      E     LCALL   _Delay1MS
                                           ; SOURCE LINE # 1673
0044         ?C0259:
                                           ; SOURCE LINE # 1676
0044 120000      R     LCALL   L?0410
                                           ; SOURCE LINE # 1677
0047 7F02              MOV     R7,#02H
0049 120000      E     LCALL   _Delay1MS
                                           ; SOURCE LINE # 1679
004C 7F0C              MOV     R7,#0CH
004E 120000      E     LCALL   _Delay1MS
                                           ; SOURCE LINE # 1691
0051 120000      R     LCALL   L?0432
                                           ; SOURCE LINE # 1692
0054 E0                MOVX    A,@DPTR
0055 54FD              ANL     A,#0FDH
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1694
0058 900000      E     MOV     DPTR,#LENOVOPMFW_Temp
005B E0                MOVX    A,@DPTR
005C 54F7              ANL     A,#0F7H
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1695
005F E0                MOVX    A,@DPTR
0060 4420              ORL     A,#020H
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1696
0063 22                RET     
                                           ; SOURCE LINE # 1699
                                           ; SOURCE LINE # 1700
0064         ?C0254:
                                           ; SOURCE LINE # 1701
0064 900000      E     MOV     DPTR,#LENOVOPMFW_Temp
0067 E0                MOVX    A,@DPTR
0068 4408              ORL     A,#08H
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1702
006B E0                MOVX    A,@DPTR
006C 54DF              ANL     A,#0DFH
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1703
006F         ?C0260:
006F 22                RET     
             ; FUNCTION Check_EC_ON (END)

C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 92  

             ; FUNCTION check8sreset (BEGIN)
                                           ; SOURCE LINE # 1706
                                           ; SOURCE LINE # 1707
                                           ; SOURCE LINE # 1709
0000 900000      E     MOV     DPTR,#ShutDnCause
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 1710
0008 120000      E     LCALL   Init_SMBus_Regs
                                           ; SOURCE LINE # 1711
000B 900000      E     MOV     DPTR,#PWRSW8SRST
000E E0                MOVX    A,@DPTR
000F 900000      E     MOV     DPTR,#SysStatus2
0012 30E108            JNB     ACC.1,?C0261
                                           ; SOURCE LINE # 1712
                                           ; SOURCE LINE # 1713
0015 E0                MOVX    A,@DPTR
0016 4408              ORL     A,#08H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1714
0019 7FA8              MOV     R7,#0A8H
                                           ; SOURCE LINE # 1715
001B 8006              SJMP    ?C0367
001D         ?C0261:
                                           ; SOURCE LINE # 1717
                                           ; SOURCE LINE # 1718
001D E0                MOVX    A,@DPTR
001E 54F7              ANL     A,#0F7H
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1719
0021 7FA9              MOV     R7,#0A9H
0023         ?C0367:
0023 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 1720
                                           ; SOURCE LINE # 1721
0026         ?C0263:
0026 22                RET     
             ; FUNCTION check8sreset (END)

             ; FUNCTION SendSynapticsIDSequence (BEGIN)
                                           ; SOURCE LINE # 1726
                                           ; SOURCE LINE # 1727
                                           ; SOURCE LINE # 1730
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#Temp
0004 F0                MOVX    @DPTR,A
0005         ?C0266:
                                           ; SOURCE LINE # 1732
                                           ; SOURCE LINE # 1733
0005 7B01              MOV     R3,#01H
0007 7DE8              MOV     R5,#0E8H
0009 7F02              MOV     R7,#02H
000B 120000      E     LCALL   _Send2PortNWait
                                           ; SOURCE LINE # 1734
000E 7B01              MOV     R3,#01H
0010 E4                CLR     A
0011 FD                MOV     R5,A
0012 7F02              MOV     R7,#02H
0014 120000      E     LCALL   _Send2PortNWait
                                           ; SOURCE LINE # 1735
0017 900000      R     MOV     DPTR,#Temp
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 93  

001A E0                MOVX    A,@DPTR
001B 04                INC     A
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1736
001D E0                MOVX    A,@DPTR
001E C3                CLR     C
001F 9404              SUBB    A,#04H
0021 40E2              JC      ?C0266
                                           ; SOURCE LINE # 1738
0023 120000      R     LCALL   L?0440
0026 020000      E     LJMP    _Send2PortNWait
             ; FUNCTION SendSynapticsIDSequence (END)

             ; FUNCTION SendElanIDSequence (BEGIN)
                                           ; SOURCE LINE # 1741
                                           ; SOURCE LINE # 1742
                                           ; SOURCE LINE # 1743
0000 120000      R     LCALL   L?0417
                                           ; SOURCE LINE # 1744
0003 120000      R     LCALL   L?0417
                                           ; SOURCE LINE # 1745
0006 7B01              MOV     R3,#01H
0008 7DE6              MOV     R5,#0E6H
000A 7F02              MOV     R7,#02H
000C 120000      E     LCALL   _Send2PortNWait
                                           ; SOURCE LINE # 1746
000F 120000      R     LCALL   L?0440
0012 020000      E     LJMP    _Send2PortNWait
                                           ; SOURCE LINE # 1747
0015         L?0417:
0015 7B01              MOV     R3,#01H
0017 7DE6              MOV     R5,#0E6H
0019 7F02              MOV     R7,#02H
001B 120000      E     LCALL   _Send2PortNWait
001E 22                RET     
             ; FUNCTION SendElanIDSequence (END)

             ; FUNCTION SendALPSIDSequence (BEGIN)
                                           ; SOURCE LINE # 1748
                                           ; SOURCE LINE # 1749
                                           ; SOURCE LINE # 1750
0000 120000      R     LCALL   L?0418
                                           ; SOURCE LINE # 1751
0003 120000      R     LCALL   L?0418
                                           ; SOURCE LINE # 1752
0006 7B01              MOV     R3,#01H
0008 7DE7              MOV     R5,#0E7H
000A 7F02              MOV     R7,#02H
000C 120000      E     LCALL   _Send2PortNWait
                                           ; SOURCE LINE # 1753
000F 120000      R     LCALL   L?0441
0012 020000      E     LJMP    _Send2PortNWait
                                           ; SOURCE LINE # 1754
0015         L?0418:
0015 7B01              MOV     R3,#01H
0017 7DE7              MOV     R5,#0E7H
0019 7F02              MOV     R7,#02H
001B 120000      E     LCALL   _Send2PortNWait
001E 22                RET     
             ; FUNCTION SendALPSIDSequence (END)

             ; FUNCTION ReadTPid (BEGIN)
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 94  

                                           ; SOURCE LINE # 1755
                                           ; SOURCE LINE # 1756
                                           ; SOURCE LINE # 1760
0000 120000      R     LCALL   SendSynapticsIDSequence
                                           ; SOURCE LINE # 1762
0003 900000      E     MOV     DPTR,#TPID3
0006 E0                MOVX    A,@DPTR
0007 B44707            CJNE    A,#047H,?C0270
                                           ; SOURCE LINE # 1763
                                           ; SOURCE LINE # 1764
000A 900000      E     MOV     DPTR,#TP_Type
000D 7402              MOV     A,#02H
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1765
0010 22                RET     
0011         ?C0270:
                                           ; SOURCE LINE # 1767
                                           ; SOURCE LINE # 1768
0011 120000      R     LCALL   SendElanIDSequence
                                           ; SOURCE LINE # 1769
0014 900000      E     MOV     DPTR,#TPID2
0017 E0                MOVX    A,@DPTR
0018 B43C07            CJNE    A,#03CH,?C0272
                                           ; SOURCE LINE # 1770
                                           ; SOURCE LINE # 1771
001B 900000      E     MOV     DPTR,#TP_Type
001E 7401              MOV     A,#01H
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1772
0021 22                RET     
0022         ?C0272:
                                           ; SOURCE LINE # 1774
                                           ; SOURCE LINE # 1775
0022 120000      R     LCALL   SendALPSIDSequence
                                           ; SOURCE LINE # 1776
0025 900000      E     MOV     DPTR,#TPID2
0028 E0                MOVX    A,@DPTR
0029 B47306            CJNE    A,#073H,?C0275
                                           ; SOURCE LINE # 1777
                                           ; SOURCE LINE # 1778
002C 900000      E     MOV     DPTR,#TP_Type
002F 7403              MOV     A,#03H
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1779
                                           ; SOURCE LINE # 1781
                                           ; SOURCE LINE # 1782
                                           ; SOURCE LINE # 1795
0032         ?C0275:
0032 22                RET     
             ; FUNCTION ReadTPid (END)

             ; FUNCTION Write_NOVOS4 (BEGIN)
                                           ; SOURCE LINE # 1797
                                           ; SOURCE LINE # 1798
                                           ; SOURCE LINE # 1799
0000 900000      E     MOV     DPTR,#LENOVOPMFW_Temp
0003 E0                MOVX    A,@DPTR
0004 30E403            JNB     ACC.4,$ + 6H
0007 020000      R     LJMP    ?C0293
                                           ; SOURCE LINE # 1800
                                           ; SOURCE LINE # 1801
000A 7BDF              MOV     R3,#0DFH
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 95  

000C 7DB7              MOV     R5,#0B7H
000E 7F01              MOV     R7,#01H
0010 120000      E     LCALL   _Read_Eflash_Byte
0013 900000      E     MOV     DPTR,#EEPROM_PwrSts
0016 EF                MOV     A,R7
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1802
0018 900000      E     MOV     DPTR,#CURRENT_STATUS
001B E0                MOVX    A,@DPTR
001C 30E23E            JNB     ACC.2,?C0277
                                           ; SOURCE LINE # 1803
                                           ; SOURCE LINE # 1805
001F 120000      R     LCALL   L?0442
0022 C3                CLR     C
0023 9404              SUBB    A,#04H
0025 401D              JC      ?C0278
0027 E0                MOVX    A,@DPTR
0028 5407              ANL     A,#07H
002A D3                SETB    C
002B 9406              SUBB    A,#06H
002D 5015              JNC     ?C0278
                                           ; SOURCE LINE # 1806
                                           ; SOURCE LINE # 1807
002F 900000      E     MOV     DPTR,#EEPROM_PwrSts
0032 E0                MOVX    A,@DPTR
0033 20E406            JB      ACC.4,?C0279
                                           ; SOURCE LINE # 1808
                                           ; SOURCE LINE # 1809
0036 E0                MOVX    A,@DPTR
0037 30E05B            JNB     ACC.0,?C0293
                                           ; SOURCE LINE # 1810
                                           ; SOURCE LINE # 1811
                                           ; SOURCE LINE # 1812
                                           ; SOURCE LINE # 1813
                                           ; SOURCE LINE # 1814
                                           ; SOURCE LINE # 1815
                                           ; SOURCE LINE # 1816
003A 8000              SJMP    ?C0368
003C         ?C0279:
                                           ; SOURCE LINE # 1818
                                           ; SOURCE LINE # 1819
003C         ?C0368:
                                           ; SOURCE LINE # 1820
                                           ; SOURCE LINE # 1821
003C 120000      R     LCALL   L?0386
003F 74EE              MOV     A,#0EEH
                                           ; SOURCE LINE # 1822
                                           ; SOURCE LINE # 1823
                                           ; SOURCE LINE # 1824
0041 020000      R     LJMP    ?C0372
0044         ?C0278:
                                           ; SOURCE LINE # 1826
                                           ; SOURCE LINE # 1827
0044 900000      E     MOV     DPTR,#EEPROM_PwrSts
0047 E0                MOVX    A,@DPTR
0048 20E40B            JB      ACC.4,?C0283
                                           ; SOURCE LINE # 1828
                                           ; SOURCE LINE # 1829
004B E0                MOVX    A,@DPTR
004C 20E046            JB      ACC.0,?C0293
                                           ; SOURCE LINE # 1830
                                           ; SOURCE LINE # 1831
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 96  

                                           ; SOURCE LINE # 1832
                                           ; SOURCE LINE # 1833
004F 120000      R     LCALL   L?0386
0052 74EF              MOV     A,#0EFH
0054         ?C0369:
                                           ; SOURCE LINE # 1834
                                           ; SOURCE LINE # 1835
                                           ; SOURCE LINE # 1836
0054 8037              SJMP    ?C0372
0056         ?C0283:
                                           ; SOURCE LINE # 1838
                                           ; SOURCE LINE # 1839
                                           ; SOURCE LINE # 1840
                                           ; SOURCE LINE # 1841
0056 120000      R     LCALL   L?0387
0059 74EF              MOV     A,#0EFH
005B         ?C0370:
                                           ; SOURCE LINE # 1842
                                           ; SOURCE LINE # 1843
                                           ; SOURCE LINE # 1844
                                           ; SOURCE LINE # 1845
005B 8030              SJMP    ?C0372
005D         ?C0277:
                                           ; SOURCE LINE # 1847
                                           ; SOURCE LINE # 1848
005D 900000      E     MOV     DPTR,#EEPROM_PwrSts
0060 E0                MOVX    A,@DPTR
0061 20E407            JB      ACC.4,?C0287
                                           ; SOURCE LINE # 1849
                                           ; SOURCE LINE # 1850
                                           ; SOURCE LINE # 1851
                                           ; SOURCE LINE # 1852
0064 120000      R     LCALL   L?0387
0067 74FF              MOV     A,#0FFH
0069         ?C0371:
                                           ; SOURCE LINE # 1853
                                           ; SOURCE LINE # 1854
0069 8022              SJMP    ?C0372
006B         ?C0287:
                                           ; SOURCE LINE # 1856
                                           ; SOURCE LINE # 1857
006B 900000      E     MOV     DPTR,#EEPROM_PwrSts
006E E0                MOVX    A,@DPTR
006F 20E023            JB      ACC.0,?C0293
                                           ; SOURCE LINE # 1858
                                           ; SOURCE LINE # 1860
0072 120000      R     LCALL   L?0442
0075 C3                CLR     C
0076 9404              SUBB    A,#04H
0078 4003              JC      ?C0291
007A D3                SETB    C
007B 8001              SJMP    ?C0292
007D         ?C0291:
007D C3                CLR     C
007E         ?C0292:
007E 4015              JC      ?C0293
0080 120000      R     LCALL   L?0443
0083 D3                SETB    C
0084 9406              SUBB    A,#06H
0086 500D              JNC     ?C0293
                                           ; SOURCE LINE # 1861
                                           ; SOURCE LINE # 1862
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 97  

                                           ; SOURCE LINE # 1863
                                           ; SOURCE LINE # 1864
0088 120000      R     LCALL   L?0387
008B 74FF              MOV     A,#0FFH
008D         ?C0372:
008D F0                MOVX    @DPTR,A
008E 900000      E     MOV     DPTR,#eEEPROMData
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1865
0092 120000      E     LCALL   Update_EEPROMMark
                                           ; SOURCE LINE # 1866
                                           ; SOURCE LINE # 1867
                                           ; SOURCE LINE # 1868
                                           ; SOURCE LINE # 1869
                                           ; SOURCE LINE # 1870
                                           ; SOURCE LINE # 1871
0095         ?C0293:
0095 22                RET     
             ; FUNCTION Write_NOVOS4 (END)

             ; FUNCTION PulseSBPowerButton (BEGIN)
                                           ; SOURCE LINE # 1876
                                           ; SOURCE LINE # 1877
                                           ; SOURCE LINE # 1878
0000 120000      R     LCALL   L?0414
                                           ; SOURCE LINE # 1879
0003 900000      E     MOV     DPTR,#SBSWReleaseCunt
0006 7414              MOV     A,#014H
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1880
0009 22                RET     
             ; FUNCTION PulseSBPowerButton (END)

             ; FUNCTION CheckSBPowerButton (BEGIN)
                                           ; SOURCE LINE # 1886
                                           ; SOURCE LINE # 1887
                                           ; SOURCE LINE # 1888
0000 900000      E     MOV     DPTR,#SBSWReleaseCunt
0003 E0                MOVX    A,@DPTR
0004 6009              JZ      ?C0297
                                           ; SOURCE LINE # 1889
                                           ; SOURCE LINE # 1890
0006 E0                MOVX    A,@DPTR
0007 14                DEC     A
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1891
0009 E0                MOVX    A,@DPTR
000A 7003              JNZ     ?C0297
                                           ; SOURCE LINE # 1892
                                           ; SOURCE LINE # 1893
000C 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 1894
                                           ; SOURCE LINE # 1895
                                           ; SOURCE LINE # 1896
000F         ?C0297:
000F 22                RET     
             ; FUNCTION CheckSBPowerButton (END)

             ; FUNCTION GC6_FBClamp (BEGIN)
                                           ; SOURCE LINE # 1898
                                           ; SOURCE LINE # 1899
                                           ; SOURCE LINE # 1901
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 98  

0000 900000      E     MOV     DPTR,#SYS_MISC1
0003 E0                MOVX    A,@DPTR
0004 30E730            JNB     ACC.7,?C0298
0007 900000      E     MOV     DPTR,#SysPowState
000A E0                MOVX    A,@DPTR
000B 6433              XRL     A,#033H
000D 6028              JZ      ?C0298
000F E0                MOVX    A,@DPTR
0010 6455              XRL     A,#055H
0012 6023              JZ      ?C0298
                                           ; SOURCE LINE # 1902
                                           ; SOURCE LINE # 1904
0014 900000      E     MOV     DPTR,#FBClamp
0017 E0                MOVX    A,@DPTR
0018 20E235            JB      ACC.2,?C0302
                                           ; SOURCE LINE # 1905
                                           ; SOURCE LINE # 1906
001B 900000      E     MOV     DPTR,#WUEMR7
001E E0                MOVX    A,@DPTR
001F 4402              ORL     A,#02H
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1907
0022 900000      E     MOV     DPTR,#WUESR7
0025 7402              MOV     A,#02H
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1908
0028 900000      E     MOV     DPTR,#IER9
002B E0                MOVX    A,@DPTR
002C 4402              ORL     A,#02H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1909
002F 900000      E     MOV     DPTR,#FBClamp
0032 E0                MOVX    A,@DPTR
0033 4404              ORL     A,#04H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1910
                                           ; SOURCE LINE # 1911
0036 22                RET     
0037         ?C0298:
                                           ; SOURCE LINE # 1913
                                           ; SOURCE LINE # 1915
0037 900000      E     MOV     DPTR,#FBClamp
003A E0                MOVX    A,@DPTR
003B 54FD              ANL     A,#0FDH
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1917
003E E0                MOVX    A,@DPTR
003F 30E20E            JNB     ACC.2,?C0302
                                           ; SOURCE LINE # 1918
                                           ; SOURCE LINE # 1919
0042 900000      E     MOV     DPTR,#IER9
0045 E0                MOVX    A,@DPTR
0046 54FD              ANL     A,#0FDH
0048 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1920
0049 900000      E     MOV     DPTR,#FBClamp
004C E0                MOVX    A,@DPTR
004D 54FB              ANL     A,#0FBH
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1921
                                           ; SOURCE LINE # 1922
                                           ; SOURCE LINE # 1947
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 99  

0050         ?C0302:
0050 22                RET     
             ; FUNCTION GC6_FBClamp (END)

             ; FUNCTION Lowpower_ENfunction (BEGIN)
                                           ; SOURCE LINE # 1950
                                           ; SOURCE LINE # 1951
                                           ; SOURCE LINE # 1952
0000 900000      E     MOV     DPTR,#CHGIC_WriteCmd0x12H
0003 E0                MOVX    A,@DPTR
0004 4480              ORL     A,#080H
                                           ; SOURCE LINE # 1953
0006 120000      R     LCALL   L?0401
0009 120000      E     LCALL   _bRWSMBus
000C EF                MOV     A,R7
000D 7006              JNZ     ?C0304
                                           ; SOURCE LINE # 1954
                                           ; SOURCE LINE # 1955
000F 900000      E     MOV     DPTR,#CHGIC_SMbusFailCnt
0012 E0                MOVX    A,@DPTR
0013 04                INC     A
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1957
                                           ; SOURCE LINE # 1958
0015         ?C0304:
0015 22                RET     
             ; FUNCTION Lowpower_ENfunction (END)

             ; FUNCTION Lowpower_DISfunction (BEGIN)
                                           ; SOURCE LINE # 1960
                                           ; SOURCE LINE # 1961
                                           ; SOURCE LINE # 1962
0000 900000      E     MOV     DPTR,#CHGIC_WriteCmd0x12H
0003 E0                MOVX    A,@DPTR
0004 547F              ANL     A,#07FH
                                           ; SOURCE LINE # 1963
0006 120000      R     LCALL   L?0401
0009 120000      E     LCALL   _bRWSMBus
000C EF                MOV     A,R7
000D 7006              JNZ     ?C0306
                                           ; SOURCE LINE # 1964
                                           ; SOURCE LINE # 1965
000F 900000      E     MOV     DPTR,#CHGIC_SMbusFailCnt
0012 E0                MOVX    A,@DPTR
0013 04                INC     A
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1966
                                           ; SOURCE LINE # 1967
0015         ?C0306:
0015 22                RET     
             ; FUNCTION Lowpower_DISfunction (END)

             ; FUNCTION CheckInitPMIC (BEGIN)
                                           ; SOURCE LINE # 1988
                                           ; SOURCE LINE # 1989
                                           ; SOURCE LINE # 1990
0000 900000      E     MOV     DPTR,#PowerReturnData
0003 74FE              MOV     A,#0FEH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1991
0006 E4                CLR     A
0007 FD                MOV     R5,A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 100 

0008 7FE2              MOV     R7,#0E2H
000A 120000      R     LCALL   _PowerIICWriteByte
000D EF                MOV     A,R7
000E 7008              JNZ     ?C0307
                                           ; SOURCE LINE # 1992
                                           ; SOURCE LINE # 1993
0010 7FC1              MOV     R7,#0C1H
0012 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 1994
0015 7F00              MOV     R7,#00H
0017 22                RET     
                                           ; SOURCE LINE # 1995
0018         ?C0307:
                                           ; SOURCE LINE # 1996
0018 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1997
001A         ?C0308:
001A 22                RET     
             ; FUNCTION CheckInitPMIC (END)

             ; FUNCTION PMICID (BEGIN)
                                           ; SOURCE LINE # 1998
                                           ; SOURCE LINE # 1999
                                           ; SOURCE LINE # 2000
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0004 F0                MOVX    @DPTR,A
0005 7E00        E     MOV     R6,#HIGH PowerVENDODID
0007 A3                INC     DPTR
0008 7400        E     MOV     A,#HIGH PowerVENDODID
000A F0                MOVX    @DPTR,A
000B 7400        E     MOV     A,#LOW PowerVENDODID
000D 120000      R     LCALL   L?0394
0010 120000      E     LCALL   _bRWSMBus
0013 EF                MOV     A,R7
0014 7003              JNZ     ?C0310
                                           ; SOURCE LINE # 2001
                                           ; SOURCE LINE # 2002
0016 120000      R     LCALL   L?0403
                                           ; SOURCE LINE # 2003
                                           ; SOURCE LINE # 2004
0019         ?C0310:
0019 22                RET     
             ; FUNCTION PMICID (END)

             ; FUNCTION InitPMICReg (BEGIN)
                                           ; SOURCE LINE # 2005
                                           ; SOURCE LINE # 2006
                                           ; SOURCE LINE # 2007
0000 900000      E     MOV     DPTR,#PowerVENDODID
0003 E0                MOVX    A,@DPTR
0004 7003              JNZ     ?C0311
                                           ; SOURCE LINE # 2008
                                           ; SOURCE LINE # 2009
0006 120000      R     LCALL   PMICID
                                           ; SOURCE LINE # 2010
0009         ?C0311:
                                           ; SOURCE LINE # 2011
0009 E4                CLR     A
000A 900000      E     MOV     DPTR,#PowerInitIndex
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2013
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 101 

000E 900000      E     MOV     DPTR,#PowerEN_MASK
0011 7480              MOV     A,#080H
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2014
0014 900000      E     MOV     DPTR,#PowerEN_RW
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2016
0018 900000      E     MOV     DPTR,#PowerVENDODID
001B E0                MOVX    A,@DPTR
001C 6453              XRL     A,#053H
001E 701E              JNZ     ?C0312
                                           ; SOURCE LINE # 2017
                                           ; SOURCE LINE # 2018
                                           ; SOURCE LINE # 2019
0020 120000      R     LCALL   L?0425
0023 30E305            JNB     ACC.3,?C0313
                                           ; SOURCE LINE # 2020
                                           ; SOURCE LINE # 2021
0026 7424              MOV     A,#024H
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2022
0029 8003              SJMP    ?C0314
002B         ?C0313:
                                           ; SOURCE LINE # 2024
                                           ; SOURCE LINE # 2025
002B 742C              MOV     A,#02CH
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2026
002E         ?C0314:
                                           ; SOURCE LINE # 2027
                                           ; SOURCE LINE # 2028
                                           ; SOURCE LINE # 2029
002E 120000      R     LCALL   L?0407
                                           ; SOURCE LINE # 2030
0031 7402              MOV     A,#02H
                                           ; SOURCE LINE # 2031
                                           ; SOURCE LINE # 2032
                                           ; SOURCE LINE # 2033
0033 120000      R     LCALL   L?0402
                                           ; SOURCE LINE # 2034
0036 900000      E     MOV     DPTR,#PowerBUCK_FSW
0039 7403              MOV     A,#03H
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2035
003C 801B              SJMP    ?C0318
003E         ?C0312:
                                           ; SOURCE LINE # 2037
                                           ; SOURCE LINE # 2039
                                           ; SOURCE LINE # 2040
003E 120000      R     LCALL   L?0425
0041 30E305            JNB     ACC.3,?C0316
                                           ; SOURCE LINE # 2041
                                           ; SOURCE LINE # 2042
0044 7408              MOV     A,#08H
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2043
0047 8003              SJMP    ?C0317
0049         ?C0316:
                                           ; SOURCE LINE # 2045
                                           ; SOURCE LINE # 2046
0049 740C              MOV     A,#0CH
004B F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 102 

                                           ; SOURCE LINE # 2047
004C         ?C0317:
                                           ; SOURCE LINE # 2048
                                           ; SOURCE LINE # 2049
                                           ; SOURCE LINE # 2050
004C 120000      R     LCALL   L?0407
                                           ; SOURCE LINE # 2051
004F 7404              MOV     A,#04H
                                           ; SOURCE LINE # 2052
                                           ; SOURCE LINE # 2053
                                           ; SOURCE LINE # 2054
0051 120000      R     LCALL   L?0402
                                           ; SOURCE LINE # 2055
0054 E4                CLR     A
0055 900000      E     MOV     DPTR,#PowerBUCK_FSW
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2056
0059         ?C0318:
                                           ; SOURCE LINE # 2058
0059 900000      E     MOV     DPTR,#PowerInitIndex
005C E0                MOVX    A,@DPTR
005D C3                CLR     C
005E 940C              SUBB    A,#0CH
0060 5049              JNC     ?C0319
                                           ; SOURCE LINE # 2059
                                           ; SOURCE LINE # 2060
0062 E0                MOVX    A,@DPTR
0063 75F003            MOV     B,#03H
0066 A4                MUL     AB
0067 2400        R     ADD     A,#LOW powerInit
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        R     ADDC    A,#HIGH powerInit
006E F583              MOV     DPH,A
0070 E4                CLR     A
0071 93                MOVC    A,@A+DPTR
0072 FF                MOV     R7,A
0073 900000      E     MOV     DPTR,#PowerInitIndex
0076 E0                MOVX    A,@DPTR
0077 75F003            MOV     B,#03H
007A A4                MUL     AB
007B 2400        R     ADD     A,#LOW powerInit+01H
007D F582              MOV     DPL,A
007F E4                CLR     A
0080 3400        R     ADDC    A,#HIGH powerInit+01H
0082 F583              MOV     DPH,A
0084 E4                CLR     A
0085 93                MOVC    A,@A+DPTR
0086 FC                MOV     R4,A
0087 7401              MOV     A,#01H
0089 93                MOVC    A,@A+DPTR
008A F582              MOV     DPL,A
008C 8C83              MOV     DPH,R4
008E E0                MOVX    A,@DPTR
008F FD                MOV     R5,A
0090 120000      R     LCALL   _PowerIICWriteByte
0093 EF                MOV     A,R7
0094 6008              JZ      ?C0320
                                           ; SOURCE LINE # 2061
                                           ; SOURCE LINE # 2062
0096 900000      E     MOV     DPTR,#PowerInitIndex
0099 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 103 

009A 04                INC     A
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2063
009C 80BB              SJMP    ?C0318
009E         ?C0320:
                                           ; SOURCE LINE # 2065
                                           ; SOURCE LINE # 2066
009E 900000      E     MOV     DPTR,#PowerInitIndex
00A1 E0                MOVX    A,@DPTR
00A2 04                INC     A
00A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2067
00A4 7FC2              MOV     R7,#0C2H
                                           ; SOURCE LINE # 2068
                                           ; SOURCE LINE # 2069
00A6 120000      R     LCALL   L?0406
                                           ; SOURCE LINE # 2070
                                           ; SOURCE LINE # 2071
00A9 80AE              SJMP    ?C0318
00AB         ?C0319:
                                           ; SOURCE LINE # 2073
00AB 7DBF              MOV     R5,#0BFH
00AD 7FD1              MOV     R7,#0D1H
00AF 120000      R     LCALL   _PowerIICWriteByte
00B2 EF                MOV     A,R7
00B3 7005              JNZ     ?C0323
                                           ; SOURCE LINE # 2074
                                           ; SOURCE LINE # 2075
00B5 7FC3              MOV     R7,#0C3H
                                           ; SOURCE LINE # 2076
                                           ; SOURCE LINE # 2077
00B7 120000      R     LCALL   L?0406
                                           ; SOURCE LINE # 2078
                                           ; SOURCE LINE # 2079
00BA         ?C0323:
00BA 22                RET     
00BB         L?0406:
00BB 120000      E     LCALL   _RamDebug
00BE 900000      E     MOV     DPTR,#PowerInitErrorCMD
00C1 E0                MOVX    A,@DPTR
00C2 FF                MOV     R7,A
00C3 120000      E     LCALL   _RamDebug
00C6 900000      E     MOV     DPTR,#PowerInitErrorDATA
00C9 E0                MOVX    A,@DPTR
00CA FF                MOV     R7,A
00CB 120000      E     LCALL   _RamDebug
00CE 22                RET     
             ; FUNCTION InitPMICReg (END)

             ; FUNCTION InitPMIC (BEGIN)
                                           ; SOURCE LINE # 2081
                                           ; SOURCE LINE # 2082
                                           ; SOURCE LINE # 2083
0000 900000      E     MOV     DPTR,#PowerInitOK
0003 E0                MOVX    A,@DPTR
0004 7014              JNZ     ?C0326
                                           ; SOURCE LINE # 2084
                                           ; SOURCE LINE # 2085
0006 120000      R     LCALL   CheckInitPMIC
0009 EF                MOV     A,R7
000A 600E              JZ      ?C0326
                                           ; SOURCE LINE # 2086
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 104 

                                           ; SOURCE LINE # 2087
000C 120000      R     LCALL   InitPMICReg
                                           ; SOURCE LINE # 2088
000F 7FC0              MOV     R7,#0C0H
0011 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2089
0014 900000      E     MOV     DPTR,#PowerInitOK
0017 7401              MOV     A,#01H
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2090
                                           ; SOURCE LINE # 2091
                                           ; SOURCE LINE # 2092
001A         ?C0326:
001A 22                RET     
             ; FUNCTION InitPMIC (END)

             ; FUNCTION _PowerIICWriteByte (BEGIN)
                                           ; SOURCE LINE # 2094
0000 900000      R     MOV     DPTR,#Reg_offset
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2095
                                           ; SOURCE LINE # 2096
0008 E4                CLR     A
0009 900000      E     MOV     DPTR,#PMIC_counter
000C F0                MOVX    @DPTR,A
000D         ?C0327:
                                           ; SOURCE LINE # 2098
                                           ; SOURCE LINE # 2099
                                           ; SOURCE LINE # 2100
000D 900000      R     MOV     DPTR,#Reg_offset
0010 E0                MOVX    A,@DPTR
0011 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 7400        R     MOV     A,#HIGH PS_data
0018 F0                MOVX    @DPTR,A
0019 A3                INC     DPTR
001A 7400        R     MOV     A,#LOW PS_data
001C F0                MOVX    @DPTR,A
001D E4                CLR     A
001E A3                INC     DPTR
001F F0                MOVX    @DPTR,A
0020 7B68              MOV     R3,#068H
0022 7D88              MOV     R5,#088H
0024 FF                MOV     R7,A
0025 120000      E     LCALL   _bRWSMBus
0028 EF                MOV     A,R7
0029 7008              JNZ     ?C0329
                                           ; SOURCE LINE # 2101
                                           ; SOURCE LINE # 2102
002B 120000      R     LCALL   L?0403
                                           ; SOURCE LINE # 2103
002E E4                CLR     A
002F FF                MOV     R7,A
0030 120000      E     LCALL   _ResetSMBus
                                           ; SOURCE LINE # 2104
0033         ?C0329:
                                           ; SOURCE LINE # 2105
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 105 

0033 900000      R     MOV     DPTR,#Reg_offset
0036 E0                MOVX    A,@DPTR
0037 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
003A F0                MOVX    @DPTR,A
003B 7E00        E     MOV     R6,#HIGH PowerReturnData
003D A3                INC     DPTR
003E 7400        E     MOV     A,#HIGH PowerReturnData
0040 F0                MOVX    @DPTR,A
0041 7400        E     MOV     A,#LOW PowerReturnData
0043 120000      R     LCALL   L?0394
0046 120000      E     LCALL   _bRWSMBus
0049 EF                MOV     A,R7
004A 7008              JNZ     ?C0330
                                           ; SOURCE LINE # 2106
                                           ; SOURCE LINE # 2107
004C 120000      R     LCALL   L?0404
                                           ; SOURCE LINE # 2108
004F E4                CLR     A
0050 FF                MOV     R7,A
0051 120000      E     LCALL   _ResetSMBus
                                           ; SOURCE LINE # 2109
0054         ?C0330:
                                           ; SOURCE LINE # 2110
0054 900000      R     MOV     DPTR,#PS_data
0057 E0                MOVX    A,@DPTR
0058 FF                MOV     R7,A
0059 900000      E     MOV     DPTR,#PowerReturnData
005C E0                MOVX    A,@DPTR
005D 6F                XRL     A,R7
005E 7003              JNZ     ?C0331
                                           ; SOURCE LINE # 2111
                                           ; SOURCE LINE # 2112
0060 7F01              MOV     R7,#01H
0062 22                RET     
                                           ; SOURCE LINE # 2113
0063         ?C0331:
                                           ; SOURCE LINE # 2115
                                           ; SOURCE LINE # 2116
0063 900000      E     MOV     DPTR,#PMIC_counter
0066 E0                MOVX    A,@DPTR
0067 B40503            CJNE    A,#05H,?C0334
                                           ; SOURCE LINE # 2117
                                           ; SOURCE LINE # 2118
006A 7F00              MOV     R7,#00H
006C 22                RET     
                                           ; SOURCE LINE # 2119
006D         ?C0334:
                                           ; SOURCE LINE # 2120
006D 900000      R     MOV     DPTR,#Reg_offset
0070 E0                MOVX    A,@DPTR
0071 900000      E     MOV     DPTR,#PowerInitErrorCMD
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2121
0075 900000      E     MOV     DPTR,#PowerReturnData
0078 E0                MOVX    A,@DPTR
0079 900000      E     MOV     DPTR,#PowerInitErrorDATA
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2122
007D 900000      E     MOV     DPTR,#PMIC_counter
0080 E0                MOVX    A,@DPTR
0081 04                INC     A
0082 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 106 

                                           ; SOURCE LINE # 2123
                                           ; SOURCE LINE # 2124
0083 020000      R     LJMP    ?C0327
             ; FUNCTION _PowerIICWriteByte (END)

             ; FUNCTION PollingOTP (BEGIN)
                                           ; SOURCE LINE # 2127
                                           ; SOURCE LINE # 2128
                                           ; SOURCE LINE # 2129
0000 900000      E     MOV     DPTR,#PowerInitOK
0003 E0                MOVX    A,@DPTR
0004 6401              XRL     A,#01H
0006 706C              JNZ     ?C0340
                                           ; SOURCE LINE # 2130
                                           ; SOURCE LINE # 2132
0008 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
000B 74D6              MOV     A,#0D6H
000D F0                MOVX    @DPTR,A
000E 7E00        E     MOV     R6,#HIGH PowerOVP_REG
0010 A3                INC     DPTR
0011 7400        E     MOV     A,#HIGH PowerOVP_REG
0013 F0                MOVX    @DPTR,A
0014 A3                INC     DPTR
0015 7400        E     MOV     A,#LOW PowerOVP_REG
0017 120000      R     LCALL   L?0395
001A 120000      E     LCALL   _bRWSMBus
001D EF                MOV     A,R7
001E 7003              JNZ     ?C0336
                                           ; SOURCE LINE # 2133
                                           ; SOURCE LINE # 2134
0020 120000      R     LCALL   L?0404
                                           ; SOURCE LINE # 2135
0023         ?C0336:
                                           ; SOURCE LINE # 2136
0023 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0026 74D7              MOV     A,#0D7H
0028 F0                MOVX    @DPTR,A
0029 7E00        E     MOV     R6,#HIGH PowerUVP_REG
002B A3                INC     DPTR
002C 7400        E     MOV     A,#HIGH PowerUVP_REG
002E F0                MOVX    @DPTR,A
002F A3                INC     DPTR
0030 7400        E     MOV     A,#LOW PowerUVP_REG
0032 120000      R     LCALL   L?0395
0035 120000      E     LCALL   _bRWSMBus
0038 EF                MOV     A,R7
0039 7003              JNZ     ?C0337
                                           ; SOURCE LINE # 2137
                                           ; SOURCE LINE # 2138
003B 120000      R     LCALL   L?0404
                                           ; SOURCE LINE # 2139
003E         ?C0337:
                                           ; SOURCE LINE # 2140
003E 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0041 74D8              MOV     A,#0D8H
0043 F0                MOVX    @DPTR,A
0044 7E00        E     MOV     R6,#HIGH PowerOCP_REG
0046 A3                INC     DPTR
0047 7400        E     MOV     A,#HIGH PowerOCP_REG
0049 F0                MOVX    @DPTR,A
004A A3                INC     DPTR
004B 7400        E     MOV     A,#LOW PowerOCP_REG
C51 COMPILER V8.12   OEM_POWER                                                             09/14/2018 11:08:14 PAGE 107 

004D 120000      R     LCALL   L?0395
0050 120000      E     LCALL   _bRWSMBus
0053 EF                MOV     A,R7
0054 7003              JNZ     ?C0338
                                           ; SOURCE LINE # 2141
                                           ; SOURCE LINE # 2142
0056 120000      R     LCALL   L?0404
                                           ; SOURCE LINE # 2143
0059         ?C0338:
                                           ; SOURCE LINE # 2145
0059 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
005C 74D9              MOV     A,#0D9H
005E F0                MOVX    @DPTR,A
005F 7E00        E     MOV     R6,#HIGH PowerOTP_REG
0061 A3                INC     DPTR
0062 7400        E     MOV     A,#HIGH PowerOTP_REG
0064 F0                MOVX    @DPTR,A
0065 A3                INC     DPTR
0066 7400        E     MOV     A,#LOW PowerOTP_REG
0068 120000      R     LCALL   L?0395
006B 120000      E     LCALL   _bRWSMBus
006E EF                MOV     A,R7
006F 7003              JNZ     ?C0340
                                           ; SOURCE LINE # 2146
                                           ; SOURCE LINE # 2147
0071 120000      R     LCALL   L?0404
                                           ; SOURCE LINE # 2149
                                           ; SOURCE LINE # 2150
                                           ; SOURCE LINE # 2151
0074         ?C0340:
0074 22                RET     
             ; FUNCTION PollingOTP (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4637    ----
   CONSTANT SIZE    =    351    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
