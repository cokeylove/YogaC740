C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_LED
OBJECT MODULE PLACED IN Code\OEM\OEM_LED.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_LED.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_LED.C
   3           *
   4           * Copyright (c) 1983-2007, Insyde Software Corporation. All Rights Reserved.
   5           *
   6           * You may not reproduce, distribute, publish, display, perform, modify, adapt,
   7           * transmit, broadcast, present, recite, release, license or otherwise exploit
   8           * any part of this publication in any form, by any means, without the prior
   9           * written permission of Insyde Software Corporation.
  10           *---------------------------------------------------------------------------*/
  11          
  12          #include <CORE_INCLUDE.H>
  13          #include <OEM_INCLUDE.H>
  14          
  15          /* ----------------------------------------------------------------------------
  16           * FUNCTION:   OEM_Write_Leds
  17           *
  18           * Write to SCROLL LOCK, NUM LOCK, CAPS LOCK, and any custom LEDs (including
  19           * an "Fn" key LED).
  20           *
  21           * Input: data (LED_ON bit) = Data to write to the LEDs
  22           *         bit 0 - SCROLL, Scroll Lock
  23           *         bit 1 - NUM,    Num Lock
  24           *         bit 2 - CAPS,   Caps Lock
  25           *         bit 3 - OVL,    Fn LED
  26           *         bit 4 - LED4,   Undefined
  27           *         bit 5 - LED5,   Undefined
  28           *         bit 6 - LED6,   Undefined
  29           *         bit 7 - LED7,   Undefined
  30           *
  31           * Updates Led_Data variable and calls send_leds if appropriate.
  32           * ------------------------------------------------------------------------- */
  33          void OEM_Write_Leds(BYTE data_byte)
  34          {
  35   1          Led_Data = data_byte;
  36   1              //if ( uMBID & 0x40 )
  37   1          //if ( uMBID & 0x01 )       // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common
             - spec
  38   1          //if( ( uMBID & 0x03 == 0x01 ) ||( uMBID & 0x03 == 0x02 ) ) //ANGELAS008: Modidy board ID for check 15
             -" and 17"
  39   1          if ( uMBID & 0x01 )         // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common s
             -pec //ANGELAS009 remove ANGELAS008
  40   1          {
  41   2                  if ( data_byte & BIT1 )
  42   2                  {
  43   3                              Hook_NUMLED_ON();
  44   3                              SET_MASK(SYS_MISC1, b1Num_LED);
  45   3                  }
  46   2                  else
  47   2                  {
  48   3                              Hook_NUMLED_OFF();
  49   3                              CLR_MASK(SYS_MISC1, b1Num_LED);
  50   3                   }
  51   2          }
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 2   

  52   1      
  53   1          if ( data_byte & BIT2 )
  54   1          {
  55   2                      Hook_CAPLED_ON();
  56   2                      SET_MASK(SYS_MISC1, b2Cap_LED);
  57   2          }
  58   1              else
  59   1              {
  60   2                      Hook_CAPLED_OFF();
  61   2                      CLR_MASK(SYS_MISC1, b2Cap_LED);
  62   2              }
  63   1      }
  64          
  65          //MEILING030:S- remove old LED control function.
  66          /*void Lenovo_LED(void)
  67          {
  68                  if ( SystemIsS5 )
  69                  { PWR_LED_OFF(); }
  70                  else
  71                  {
  72                          LOWBATT_3TIMES =0;
  73                          if ( SystemIsS3 || (IS_MASK_SET(uISCT_2, b5ISCT_PwrLED)) )      // Check S3 and ISCT status.
  74                          {
  75                                  PowerLed_Count++;
  76                                  if ( PowerLed_Count < 20 )
  77                                  {
  78                                          PWR_LED_ON();
  79                                  }
  80                                  if( (PowerLed_Count > 20) && (PowerLed_Count <40) )
  81                                  {
  82                                          PWR_LED_OFF();
  83                                  }
  84                                  if ( PowerLed_Count > 40 )
  85                                  {
  86                                          PowerLed_Count = 0;
  87                                          PWR_LED_ON();
  88                                  }
  89                          }
  90                          else
  91                          {
  92                                  if ( SystemIsS0 || (SysPowState==SYSTEM_S5_S0)) // Check S0 and power on sequence status.
  93                                          PWR_LED_ON();
  94                          }
  95                  }
  96          
  97                  // Battery LED control
  98                  GPCRA1 = ALT;
  99                  GPCRA2 = ALT;
 100                  if ( IS_MASK_SET(SYS_MISC1,b5Crisis_LED) )
 101                  {
 102                          if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 103                          {       // under 5%
 104                                  // 660mHz of Amber, 1000ms on/ 500ms off
 105                                  C4CPRS = 0xC0;  // set frequence
 106                                  C4MCPRS = 0x00;
 107                                  DCR2 = 0x55;    // On Amber
 108                                  DCR1 = 0xFF;    // Off Green
 109                          }
 110                          else
 111                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 112                  }
 113                  else
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 3   

 114                  {
 115                          if( IS_MASK_SET(LV_Authen_Step_CNT,BIT(6)) )
 116                          {       // authentication Fail
 117                                  C4CPRS = 0xFF;  // set frequence
 118                                  C4MCPRS = 0x00;
 119          
 120                          if(SystemIsS0 || Read_AC_IN())
 121                          {
 122                              DCR2 = 0x7F;        // On Amber
 123                                  DCR1 = 0xFF;    // Off Green
 124                          }
 125                          else // not S0 & Battery Only
 126                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 127                          }
 128                          else if( IS_MASK_SET(Bat1_FPChgFlag,BIT(0)) )
 129                          {       //  abnormal pre-charge
 130                                  // Amber and Green xchange at 250ms
 131                          C4CPRS = 0x3F;  // set frequence
 132                          C4MCPRS = 0x00;
 133          
 134                          if(SystemIsS0 || Read_AC_IN())
 135                          {
 136                              DCR2 = 0x7F;        // On Amber
 137                                  DCR1 = 0xFF;    // Off Green
 138                          }
 139                          else // not S0 & Battery Only
 140                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 141                          }
 142                          else if( Read_AC_IN() )
 143                          {       // AC IN
 144                                  LOWBATT_3TIMES =0;
 145                                  PWMPOL = 0x00;                                          // sync. Green and Amber
 146                                                  
 147                                  if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 148                                  {       // Battery IN, Charging mode
 149                                          if( BAT1PERCL >= 0x50 )
 150                                          {       // over 80%
 151                                                  // Green always on
 152                                                  DCR2 = 0xFF;    // Off Amber
 153                                                  DCR1 = 0x00;    // On Green
 154                                          }
 155                                          else if( BAT1PERCL >= 0x14 )
 156                                          {       // over 20%
 157                                                  // 196mHz of Green, 5000ms on/ 100ms off
 158                                                  C4CPRS = 0x90;  // set frequence
 159                                                  C4MCPRS = 0x02;
 160                                                  DCR2 = 0xFF;    // Off Amber
 161                                                  DCR1 = 0x05;    // On Green
 162                                          }
 163                                          else if( BAT1PERCL >= 0x05 )
 164                                          {       // over 5%
 165                                                  // 303mHz of Amber, 3200ms on/ 100ms off
 166                                                  C4CPRS = 0xA8;  // set frequence
 167                                                  C4MCPRS = 0x01;
 168                                                  DCR2 = 0x08;    // On Amber
 169                                                  DCR1 = 0xFF;    // Off Green
 170                                          }
 171                                          else
 172                                          {       // under 5%
 173                                                  // 660mHz of Amber, 1000ms on/ 500ms off
 174                                                  C4CPRS = 0xC0;  // set frequence
 175                                                  C4MCPRS = 0x00;
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 4   

 176                                                  DCR2 = 0x55;    // On Amber
 177                                                  DCR1 = 0xFF;    // Off Green
 178                                          }
 179                                  }
 180                                  else
 181                                  { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 182                          }
 183                          else
 184                          {       // Dischage mode
 185                                  if ( SystemIsS5 )
 186                                  {
 187                                          DCR1 = 0xFF;            // Off Green
 188                                          if (LOWBATT_3TIMES ==0)
 189                                          {
 190                                                  DCR2 = 0xFF;    // Off Amber
 191                                          }
 192                                          else
 193                                          {
 194                                                  if (LOWBATT_3TIMES > 80)
 195                                                          DCR2 = 0x00;                                    // On Amber
 196                                                  else if (LOWBATT_3TIMES > 60)
 197                                                          DCR2 = 0xFF;                                    // Off Amber
 198                                                  else if (LOWBATT_3TIMES > 40)
 199                                                          DCR2 = 0x00;                                    // On Amber
 200                                                  else if (LOWBATT_3TIMES > 20)
 201                                                          DCR2 = 0xFF;                                    // Off Amber
 202                                                  else if (LOWBATT_3TIMES > 0)
 203                                                          DCR2 = 0x00;                                    // On Amber
 204          
 205                                                  LOWBATT_3TIMES--;
 206                                                  if (LOWBATT_3TIMES==0)
 207                                                          DCR2 = 0xFF;                                    // Off Amber
 208                                          }
 209                                  }
 210                                  else
 211                                  {
 212                                          PWMPOL = 0x00;          // sync. Green and Amber
 213                                          if( SystemIsS3 )
 214                                          {       // DC S3 mode
 215                                                  DCR2 = 0xFF;    // Off Amber
 216                                                  DCR1 = 0xFF;    // Off Green
 217                                          }
 218                                          else if( BAT1PERCL >= 0x14 )
 219                                          {
 220                                                  // Green always on
 221                                                  DCR2 = 0xFF;    // Off Amber
 222                                                  DCR1 = 0x00;    // On Green
 223                                          }
 224                                          else if( BAT1PERCL >= 0x05 )
 225                                          {       // over 5%
 226                                                  // Amber always on
 227                                                  DCR2 = 0x00;    // On Amber
 228                                                  DCR1 = 0xFF;    // Off Green
 229                                          }
 230                                          else
 231                                          {       // under 5%
 232                                                  // 660mHz of Amber, 1000ms on/ 500ms off
 233                                                  C4CPRS = 0xC0;  // set frequence
 234                                                  C4MCPRS = 0x00;
 235                                                  DCR2 = 0x55;    // On Amber
 236                                                  DCR1 = 0xFF;    // Off Green
 237                                          }
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 5   

 238                                  }
 239                          }
 240                  }
 241                  if( cCHIPType==0x01 )   // IT8586EX
 242                  {
 243                          DCR0 = DCR1;
 244                  }
 245          
 246          
 247                  #if Support_TPLED
 248                  if ( IS_MASK_SET(pDevStus, pENABLE_TP) )
 249                  {// TPLED_OFF(); }      // TouchPad ON.
 250                  else
 251                  { //TPLED_ON(); }               // TouchPad OFF.
 252                  #endif  // Support_TPLED
 253          }*/
 254          //MEILING030:E- remove old LED control function.
 255          
 256          
 257          //MEILING030:S+ add new LED control function.
 258          void Battery_Charge_Discharge_LED_CONTROL(WORD LED_ON,BYTE LED_OFF)   
 259          {
 260   1              if(!(BAT_LED_Cnt_OFF|BAT_LED_Cnt_ON))
 261   1              {
 262   2                      BAT_LED_Cnt_ON = LED_ON;
 263   2                      BAT_LED_Cnt_OFF = LED_OFF;
 264   2              }
 265   1              if(BAT_LED_Cnt_ON)
 266   1              {
 267   2                      BAT_LED_Cnt_ON = BAT_LED_Cnt_ON - 1;
 268   2                      if( (BAT1PERCL >= 0) && (BAT1PERCL <= 80) )
 269   2                      {     
 270   3                              BAT_LOW_LED_ON();
 271   3                              BAT_CHG_LED_OFF();
 272   3                      }
 273   2                      else
 274   2                      {
 275   3                              BAT_CHG_LED_ON();         
 276   3                              BAT_LOW_LED_OFF();
 277   3                      }
 278   2                      
 279   2              }
 280   1              else if(BAT_LED_Cnt_OFF)
 281   1              {
 282   2                      BAT_LED_Cnt_OFF = BAT_LED_Cnt_OFF - 1;
 283   2                      BAT_CHG_LED_OFF();               //LED OFF
 284   2                      BAT_LOW_LED_OFF();      
 285   2              }
 286   1              
 287   1              
 288   1      }
 289          
 290          void Battery_LED_CONTROL(WORD LED_ON,BYTE LED_OFF)   
 291          {
 292   1              BAT_CHG_LED_OFF();
 293   1              if(!(BAT_LED_Cnt_OFF|BAT_LED_Cnt_ON))
 294   1              {
 295   2                      BAT_LED_Cnt_ON = LED_ON;
 296   2                      BAT_LED_Cnt_OFF = LED_OFF;
 297   2              }
 298   1              
 299   1              if(BAT_LED_Cnt_ON)
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 6   

 300   1              {
 301   2                      BAT_LED_Cnt_ON = BAT_LED_Cnt_ON - 1;
 302   2                      BAT_LOW_LED_ON();       
 303   2              }
 304   1              else if(BAT_LED_Cnt_OFF)
 305   1              {
 306   2                      BAT_LED_Cnt_OFF = BAT_LED_Cnt_OFF - 1;
 307   2                      BAT_LOW_LED_OFF();       
 308   2              }
 309   1              
 310   1              
 311   1      }
 312          
 313          void Battery_LED_Reset(void)
 314          {
 315   1              
 316   1              BAT_LED_Cnt_ON = 0;
 317   1              BAT_LED_Cnt_OFF = 0;
 318   1      
 319   1              BAT_LOW_LED_OFF();         //LED OFF
 320   1              BAT_CHG_LED_OFF();
 321   1      
 322   1                      
 323   1      }
 324          
 325          
 326          void Power_LED_CONTROL(LED_STATUSE STATUS)   //HEGANGS042:Modify the led behavior follow new spec
 327          {
 328   1              if( BAT1PERCL > 0x14 )
 329   1              {
 330   2                      PWR_AMBERLED_OUTPUT;
 331   2                      CLR_MASK(PWM1LHE,DIMMING_ENABLE);
 332   2                      PWR_AMBERLED_OFF();
 333   2                      switch(STATUS)
 334   2                      {
 335   3                              case  LEDOFF:
 336   3                                      PWR_WHITELED_OUTPUT;
 337   3                                      CLR_MASK(PWM0LHE,DIMMING_ENABLE);
 338   3                                      PWR_WHITELED_OFF();
 339   3                                      break;
 340   3                              case  LEDON:
 341   3                                      PWR_WHITELED_OUTPUT;
 342   3                                      CLR_MASK(PWM0LHE,DIMMING_ENABLE);
 343   3                                      PWR_WHITELED_ON();
 344   3                                      break;
 345   3                              case LEDDIMMING:
 346   3                                      PWR_WHITELED_ALT;
 347   3                                      SET_MASK(PWM0LHE,DIMMING_ENABLE);
 348   3                                      break;
 349   3                              default:
 350   3                                      break;
 351   3                      }
 352   2              }
 353   1              else
 354   1              {
 355   2                      PWR_WHITELED_OUTPUT;
 356   2                      CLR_MASK(PWM0LHE,DIMMING_ENABLE);
 357   2                      PWR_WHITELED_OFF();
 358   2                      switch(STATUS)
 359   2                      {
 360   3                              case  LEDOFF:
 361   3                                      PWR_AMBERLED_OUTPUT;
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 7   

 362   3                                      CLR_MASK(PWM1LHE,DIMMING_ENABLE);
 363   3                                      PWR_AMBERLED_OFF();
 364   3                                      break;
 365   3                              case  LEDON:
 366   3                                      PWR_AMBERLED_OUTPUT;
 367   3                                      CLR_MASK(PWM1LHE,DIMMING_ENABLE);
 368   3                                      PWR_AMBERLED_ON();
 369   3                                      break;
 370   3                              case LEDDIMMING:
 371   3                                      PWR_AMBERLED_ALT;
 372   3                                      SET_MASK(PWM1LHE,DIMMING_ENABLE);
 373   3                                      break;
 374   3                              default:
 375   3                                      break;
 376   3                              }
 377   2              }
 378   1      }
 379          
 380          void Lenovo_LED(void)
 381          {
 382   1              if ( SystemIsS5||SystemIsDSX|| (SysPowState==SYSTEM_DSX_S5) )
 383   1              { 
 384   2                      PWR_LED_Debug=0;//Hang check
 385   2                      Power_LED_CONTROL(LEDOFF);
 386   2              }
 387   1              else
 388   1              {
 389   2                      LOWBATT_3TIMES =0;
 390   2                      if ( SystemIsS3 || (IS_MASK_SET(uISCT_2, b5ISCT_PwrLED)) )      // Check S3 and ISCT status.
 391   2                      {
 392   3                              Power_LED_CONTROL(LEDDIMMING);
 393   3                      }
 394   2                      else
 395   2                      {
 396   3                              if ( SystemIsS0 || (SysPowState==SYSTEM_S5_S0)) // Check S0 and power on sequence status.
 397   3                              {
 398   4                                      if(PWR_LED_Debug) //Hang check
 399   4                                      {
 400   5                                              Power_LED_CONTROL(LEDDIMMING);
 401   5                                              Buffer_Key(0x14);       
 402   5                                              Buffer_Key(0x23);
 403   5                                              Buffer_Key(0xF0);
 404   5                                              Buffer_Key(0x23);       
 405   5                                              Buffer_Key(0x23);
 406   5                                              F_Service_SEND = 1;
 407   5                                      }
 408   4                                      else
 409   4                                      {
 410   5                                              if(ONEKEY_TEMP_FLAG) //HEGANGS025: Modify onekey battery function
 411   5                                              {
 412   6                                                      Power_LED_CONTROL(LEDOFF);
 413   6                                              }
 414   5                                              else
 415   5                                              {
 416   6                                                      Power_LED_CONTROL(LEDON);
 417   6                                              }
 418   5                                      }
 419   4                              }
 420   3                      }
 421   2              }
 422   1      
 423   1              if ( IS_MASK_SET(SYS_MISC1,b5Crisis_LED) )
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 8   

 424   1              {
 425   2                      if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 426   2                      {        
 427   3                              Battery_LED_CONTROL(20,10);//Amber, 1000ms on/ 500ms off
 428   3                      }
 429   2                      else
 430   2                      {  
 431   3                              Battery_LED_Reset();
 432   3                      }       
 433   2              }
 434   1              else
 435   1              {
 436   2                      if( IS_MASK_SET(LV_Authen_Step_CNT,BIT(6)) )
 437   2                      {       // authentication Fail
 438   3                      if(SystemIsS0 || Read_AC_IN())
 439   3                      {
 440   4                                      Battery_LED_CONTROL(5,5);//Amber, 250ms on/ 250ms off
 441   4                      }
 442   3                      else // not S0 & Battery Only
 443   3                      { 
 444   4                              Battery_LED_Reset();
 445   4                              }       
 446   3                      }
 447   2                      else if( IS_MASK_SET(Bat1_FPChgFlag,BIT(0)) )
 448   2                      {       
 449   3                      if(SystemIsS0 || Read_AC_IN())
 450   3                      {
 451   4                                      Battery_LED_CONTROL(5,5);//Amber, 250ms on/ 250ms off
 452   4                      }
 453   3                      else // not S0 & Battery Only
 454   3                      { 
 455   4                                      Battery_LED_Reset();
 456   4                              }       
 457   3                      }
 458   2                      else if( Read_AC_IN() )
 459   2                      {       // AC IN
 460   3                              LOWBATT_3TIMES =0;
 461   3                              
 462   3                              if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 463   3                              {       
 464   4                                      Battery_Charge_Discharge_LED_CONTROL(1,0);//White solid on
 465   4                              }
 466   3                              else
 467   3                              { 
 468   4                                      Battery_LED_Reset();
 469   4                              }       // Off Amber and Green.
 470   3                      }
 471   2                      else
 472   2                      {       
 473   3                              if ( SystemIsS5 ||SystemIsDSX ||(SysPowState==SYSTEM_DSX_S5))
 474   3                              {
 475   4                                      if (LOWBATT_3TIMES ==0)
 476   4                                      {
 477   5                                              Battery_LED_Reset();
 478   5                                      }
 479   4                                      else
 480   4                                      {       //low battery flash 3 times
 481   5                                              if (LOWBATT_3TIMES > 80)
 482   5                                              {
 483   6                                                      Battery_LED_CONTROL(1,0);// On Amber
 484   6                                              }
 485   5                                              else if (LOWBATT_3TIMES > 60)
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 9   

 486   5                                              {
 487   6                                                      Battery_LED_CONTROL(0,1);// Off Amber
 488   6                                              }
 489   5                                              else if (LOWBATT_3TIMES > 40)
 490   5                                              {
 491   6                                                      Battery_LED_CONTROL(1,0);// On Amber
 492   6                                              }
 493   5                                              else if (LOWBATT_3TIMES > 20)
 494   5                                              {
 495   6                                                      Battery_LED_CONTROL(0,1);// Off Amber
 496   6                                              }
 497   5                                              else if (LOWBATT_3TIMES > 0)
 498   5                                              {
 499   6                                                  Battery_LED_CONTROL(1,0);// On Amber
 500   6                          }
 501   5                                              LOWBATT_3TIMES--;
 502   5                                              if (LOWBATT_3TIMES==0)
 503   5                                              {
 504   6                                                      Battery_LED_Reset();     // Off Amber
 505   6                                              }
 506   5                                      }
 507   4                              }
 508   3                              else
 509   3                              {
 510   4                                      Battery_LED_Reset();
 511   4                              }
 512   3                      }
 513   2              }
 514   1              /*
 515   1              if ( SystemIsS0 )
 516   1              {
 517   1                      if ( (DEVICEMODULE & 0x43) != 0 )
 518   1                      { RF_LED_LOW(); }       // RF LED ON.
 519   1                      else
 520   1                      { RF_LED_HI(); }        // RF LED OFF.
 521   1              }
 522   1              else
 523   1              { RF_LED_HI(); }                // RF LED OFF.
 524   1              */
 525   1      
 526   1              #if Support_TPLED
                      if ( IS_MASK_SET(pDevStus, pENABLE_TP) )
                      {
                              //TPLED_OFF();
                      }       // TouchPad ON.
                      else
                      { 
                              //TPLED_ON();
                      }       // TouchPad OFF.
                      #endif  // Support_TPLED
 536   1      }
 537          
 538          //MEILING030:E+ add new LED control function.
 539          
 540          void MFG_LED(void)
 541          {
 542   1              if(cOsLedCtrl.fbit.cOL_PwrLed == 1)
 543   1                      PWR_WHITELED_ON();
 544   1              else
 545   1                      PWR_WHITELED_OFF();
 546   1              if(cOsLed1Ctrl.fbit.cOL1_PwrAmber == 1)
 547   1                      PWR_AMBERLED_ON();
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 10  

 548   1              else
 549   1                      PWR_AMBERLED_OFF();
 550   1              if(cOsLedCtrl.fbit.cOL_ChgLed == 1)
 551   1                      //DCR1=0;  //MEILING030:remove.
 552   1                      BAT_CHG_LED_ON(); //MEILING030:add.
 553   1              else
 554   1                      //DCR1=0xFF;  //MEILING030:remove.
 555   1                      BAT_CHG_LED_OFF(); //MEILING030:add.
 556   1      
 557   1              if(cOsLedCtrl.fbit.cOL_DisChgLed == 1)
 558   1                      //DCR2=0;  //MEILING030:remove.
 559   1                      BAT_LOW_LED_ON(); //MEILING030:add.
 560   1              else
 561   1                      //DCR2=0xFF;  //MEILING030:remove.
 562   1                      BAT_LOW_LED_OFF(); //MEILING030:add.  //MEILING056:modify led on to off.
 563   1      
 564   1              /*
 565   1              if(cOsLedCtrl.fbit.cOL_WLANLed == 1)
 566   1                      RF_LED_LOW();
 567   1              else
 568   1                      RF_LED_HI();
 569   1              */
 570   1      
 571   1          if( uMBID & 0x01 ) // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common spe
             -c
 572   1              {
 573   2                      if( cOsLedCtrl.fbit.cOL_NumlockLed == 1 )
 574   2                      {       
 575   3                      //NUMLED_ON();
 576   3                              }
 577   2                      else
 578   2                              {
 579   3                              //NUMLED_OFF();
 580   3                              }
 581   2              }
 582   1      
 583   1              if( cOsLed1Ctrl.fbit.cOL1_CapslockLed == 1 )
 584   1                      CAPLED_ON();
 585   1              else
 586   1                      CAPLED_OFF();
 587   1      
 588   1              if( cOsLed1Ctrl.fbit.cOL1_KBBacklight == 1 )
 589   1                      DCR3 = 0x00; //MEILING001:remove.//72JERRY022: Modify GPIO setting follow SIT.
 590   1                      //EC_BKL_EN_HI(); //MEILING001:add.
 591   1              else
 592   1                      DCR3 = 0XFF; //MEILING001:remove.//72JERRY022: Modify GPIO setting follow SIT.
 593   1                      //EC_BKL_EN_LOW(); //MEILING001:add.
 594   1      
 595   1              #if Support_TPLED
                      if( cOsLedCtrl.fbit.cOL_TPActLed == 1 )
                              //TPLED_ON();
                      else
                              //TPLED_OFF();
                      #endif  // Support_TPLED
 601   1      }
 602          
 603          /*void SetKeyboardLED(void)
 604          {
 605                  BYTE BKBMax,BKBHalf;
 606                  
 607                  if ( (SystemNotS0) || (cOsLedCtrl.fbit.cOL_CtrlRight ==1) || (!Read_LID_SW_IN()) )
 608                  {
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 11  

 609                          //DCR3 = 0;  //MEILING001:remove.
 610                          EC_BKL_EN_LOW(); //MEILING001:add.
 611                          return;
 612                  }
 613          
 614                  //if ( uMBID & 0x40 )
 615                  //{     // QIQY6.
 616                  //      BKBMax = 0x4B;
 617                  //      BKBHalf = 0x33;
 618                  //}
 619                  //else
 620                  //{     // QIQY5.
 621                          BKBMax = 0xFF;
 622                          BKBHalf = 0x4D;
 623                  //}
 624          
 625                  if ( IS_MASK_SET(EMStatusBit, b0SetKBLEDON) )
 626                  {
 627                          LED_KB_PWM_Step = ((LED_KB_PWM_Step&0xFC) | 0x02);
 628                          SET_MASK(EMStatusBit, b2KBLEDChk);
 629                  }
 630                  else
 631                  {
 632                          if ( IS_MASK_SET(EMStatusBit, b2KBLEDChk) )
 633                          {
 634                                  LED_KB_PWM_Step &= 0xFC;
 635                                  CLR_MASK(EMStatusBit, b2KBLEDChk);
 636                          }
 637                  }
 638          
 639                  switch (LED_KB_PWM_Step)
 640                  {
 641                  case 0:
 642                          //DCR3 = 0;  //MEILING001:remove.
 643                          EC_BKL_EN_LOW(); //MEILING001:add.
 644                          CLR_MASK(EMStatusBit, b5RdKBLEDOn);
 645                          CLR_MASK(EMStatusBit, b2KBLEDChk);
 646                          CLR_MASK(EMStatusBit, b0SetKBLEDON);
 647                          break;
 648                  case 1:
 649                          //DCR3 = BKBHalf;  //MEILING001:remove.
 650                          //SET_MASK(EMStatusBit, b5RdKBLEDOn);
 651                          break;
 652                  case 2:
 653                          //DCR3 = BKBMax;  //MEILING001:remove.
 654                          EC_BKL_EN_HI(); //MEILING001:add.
 655                          SET_MASK(EMStatusBit, b5RdKBLEDOn);
 656                          SET_MASK(EMStatusBit, b2KBLEDChk);
 657                          SET_MASK(EMStatusBit, b0SetKBLEDON);
 658                          break;
 659                  default:
 660                          //DCR3 = 0;  //MEILING001:remove.
 661                          EC_BKL_EN_LOW(); //MEILING001:add.
 662                          LED_KB_PWM_Step = 0;
 663                          break;
 664                  }
 665          
 666                  if ( (LED_KB_PWM_Count & 0x7F) != 0 )
 667                  {
 668                          //if ( DCR3 == 0 )  //MEILING001:remove.
 669                          if(!Read_EC_BKL_EN()) //MEILING001:add.
 670                          {
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 12  

 671                                  //DCR3 = BKBMax; //MEILING001:remove.
 672                                  EC_BKL_EN_HI(); //MEILING001:add.
 673                                  LED_KB_PWM_Count |= 0x80;
 674                          }
 675                          LED_KB_PWM_Count--;
 676                  }
 677                  else
 678                  {
 679                          if ( IS_MASK_SET(LED_KB_PWM_Count, BIT7) )
 680                          {
 681                                  //DCR3 = 0;  //MEILING001:remove.
 682                                  EC_BKL_EN_LOW(); //MEILING001:add.
 683                                  LED_KB_PWM_Count = 0;
 684                          }
 685                  }
 686                  //Chk_KB_Backlight();   // Update KB backlight EEPROM. //MEILING001:remove.  //MEILING011:add.  //LMLKBL000
             -5:remove.
 687          }*///72JERRY022:- Modify GPIO setting follow SIT.
 688          //72JERRY022: S+Modify GPIO setting follow SIT.
 689          void SetKeyboardLED(void)
 690          {
 691   1              BYTE BKBMax,BKBHalf;
 692   1              if ( (SystemNotS0) || (cOsLedCtrl.fbit.cOL_CtrlRight ==1) || (!Read_LID_SW_IN()) )
 693   1              {
 694   2                      //DCR3 = 0; //REJERRY037:remove.//72JERRY039:-Modify KB backlight setting follow UI SPEC.
 695   2                      return;
 696   2              }
 697   1              if (IS_MASK_SET(pDevStatus1,b2DisableKB))//HEGANGS039:Disable KB backlight when KB is disabled by YMC
 698   1              {  
 699   2                 DCR3 = 0;
 700   2                 return;
 701   2              }
 702   1              if(ONEKEY_TEMP_FLAG) //HEGANGS025: Modify onekey battery function
 703   1              {
 704   2                      DCR3 = 0;
 705   2                      return;
 706   2              }
 707   1              BKBMax = 0xF0;
 708   1              BKBHalf = 0x25;  //REJERRY007:modify step1 backlight.
 709   1      
 710   1              if(UpdateLEDBL_delay!=0)
 711   1              {
 712   2                      UpdateLEDBL_delay--;
 713   2                      return;
 714   2              }
 715   1      
 716   1              if(uReserve07.fbit.nVPCDriverIn==1)
 717   1              {
 718   2                      if ( IS_MASK_SET(EMStatusBit, b0SetKBLEDON) )
 719   2                      {
 720   3                              if ( IS_MASK_SET(EMStatusBit, b2KBLEDChk) )
 721   3                              {
 722   4                                      LED_KB_PWM_Step=1;
 723   4                              }
 724   3                      }
 725   2                      else
 726   2                      {
 727   3                              LED_KB_PWM_Step=0;
 728   3                      }
 729   2              }
 730   1              
 731   1              /*if ( (LED_KB_PWM_Count & 0x7ff) != 0 ) //REJERRY007:modify backlight control.
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 13  

 732   1              {
 733   1                      if ( DCR3 == 0 )
 734   1                      {
 735   1                      DCR3 = BKBMax;
 736   1                      LED_KB_PWM_Count |= 0x800; //REJERRY007:modify backlight control.
 737   1                              
 738   1                      }
 739   1                      
 740   1                      LED_KB_PWM_Count--;
 741   1                              
 742   1              }*/
 743   1      
 744   1              if ( (LED_KB_PWM_Count & 0x7F) != 0 )
 745   1              {
 746   2                      if ( DCR3 == 0 )  //MEILING001:remove.
 747   2                      //if(!Read_EC_BKL_EN()) //MEILING001:add.
 748   2                      {
 749   3                              DCR3 = BKBMax; //MEILING001:remove.
 750   3                              //EC_BKL_EN_HI(); //MEILING001:add.
 751   3                              LED_KB_PWM_Count |= 0x80;
 752   3                      }
 753   2                      LED_KB_PWM_Count--;
 754   2              }
 755   1              else
 756   1              {
 757   2                      if ( IS_MASK_SET(LED_KB_PWM_Count, BIT7) ) //REJERRY007:modify backlight control.
 758   2                      {
 759   3                              if(LED_KB_PWM_Step==0)
 760   3                              {
 761   4                                      DCR3 = 0;
 762   4                                      LED_KB_PWM_Count = 0;
 763   4                              }
 764   3                      }
 765   2                      else    
 766   2                      {
 767   3                              if(LED_KB_PWM_Step==0)
 768   3                              {
 769   4                                      
 770   4                                      DCR3 = 0;
 771   4                                      SET_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo app setting.
 772   4                              }
 773   3                              else if(LED_KB_PWM_Step==1)
 774   3                              {
 775   4                              
 776   4                                      DCR3=BKBHalf;
 777   4                                      CLEAR_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo app setting.
 778   4                              }
 779   3                              else if(LED_KB_PWM_Step==2)
 780   3                              {
 781   4                              
 782   4                                      DCR3 = BKBMax;
 783   4                              CLEAR_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo app setting.
 784   4                              }
 785   3                      }
 786   2              }
 787   1      
 788   1      }
 789          //72JERRY022:E+ Modify GPIO setting follow SIT.
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 14  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com008B (BEGIN)
0000         L?0140:
0000         L?0141:
0000 900000      E     MOV     DPTR,#GPCRA1
0003 7440              MOV     A,#040H
0005 F0                MOVX    @DPTR,A
0006 900000      E     MOV     DPTR,#PWM1LHE
0009         L?0142:
0009 E0                MOVX    A,@DPTR
000A 54FE              ANL     A,#0FEH
000C F0                MOVX    @DPTR,A
000D 900000      E     MOV     DPTR,#GPDRA
0010 22                RET     
0011         L?0143:
0011 E0                MOVX    A,@DPTR
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0017 F0                MOVX    @DPTR,A
0018 CF                XCH     A,R7
0019 ED                MOV     A,R5
001A CF                XCH     A,R7
001B 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
001E ED                MOV     A,R5
001F F0                MOVX    @DPTR,A
0020 22                RET     
0021         L?0144:
0021         L?0145:
0021 900000      E     MOV     DPTR,#GPCRA0
0024 7440              MOV     A,#040H
0026 F0                MOVX    @DPTR,A
0027 900000      E     MOV     DPTR,#PWM0LHE
002A 22                RET     
002B         L?0146:
002B         L?0147:
002B F0                MOVX    @DPTR,A
002C         L?0148:
002C 900000      E     MOV     DPTR,#GPDRE
002F E0                MOVX    A,@DPTR
0030 4480              ORL     A,#080H
0032 22                RET     
0033         L?0149:
0033         L?0150:
0033 900000      E     MOV     DPTR,#SysPowState
0036 E0                MOVX    A,@DPTR
0037 6410              XRL     A,#010H
0039 22                RET     
003A         L?0151:
003A         L?0152:
003A F0                MOVX    @DPTR,A
003B 900000      E     MOV     DPTR,#GPDRA
003E E0                MOVX    A,@DPTR
003F 4404              ORL     A,#04H
0041 22                RET     
0042         L?0153:
0042 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 15  

004A E0                MOVX    A,@DPTR
004B 4F                ORL     A,R7
004C 22                RET     
004D         L?0154:
004D         L?0155:
004D E0                MOVX    A,@DPTR
004E 13                RRC     A
004F 13                RRC     A
0050 13                RRC     A
0051 541F              ANL     A,#01FH
0053 22                RET     
             ; FUNCTION Com008B (END)

             ; FUNCTION _OEM_Write_Leds (BEGIN)
                                           ; SOURCE LINE # 33
0000 900000      R     MOV     DPTR,#data_byte
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 35
0005 F500        E     MOV     Led_Data,A
                                           ; SOURCE LINE # 39
0007 900000      E     MOV     DPTR,#uMBID
000A E0                MOVX    A,@DPTR
000B 30E01D            JNB     ACC.0,?C0001
                                           ; SOURCE LINE # 40
                                           ; SOURCE LINE # 41
000E 900000      R     MOV     DPTR,#data_byte
0011 E0                MOVX    A,@DPTR
0012 30E10C            JNB     ACC.1,?C0002
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
0015 120000      E     LCALL   Hook_NUMLED_ON
                                           ; SOURCE LINE # 44
0018 900000      E     MOV     DPTR,#SYS_MISC1
001B E0                MOVX    A,@DPTR
001C 4402              ORL     A,#02H
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
001F 800A              SJMP    ?C0001
0021         ?C0002:
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
0021 120000      E     LCALL   Hook_NUMLED_OFF
                                           ; SOURCE LINE # 49
0024 900000      E     MOV     DPTR,#SYS_MISC1
0027 E0                MOVX    A,@DPTR
0028 54FD              ANL     A,#0FDH
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
002B         ?C0001:
                                           ; SOURCE LINE # 53
002B 900000      R     MOV     DPTR,#data_byte
002E E0                MOVX    A,@DPTR
002F 30E20B            JNB     ACC.2,?C0004
                                           ; SOURCE LINE # 54
                                           ; SOURCE LINE # 55
0032 120000      E     LCALL   Hook_CAPLED_ON
                                           ; SOURCE LINE # 56
0035 900000      E     MOV     DPTR,#SYS_MISC1
0038 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 16  

0039 4404              ORL     A,#04H
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 57
003C 22                RET     
003D         ?C0004:
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
003D 120000      E     LCALL   Hook_CAPLED_OFF
                                           ; SOURCE LINE # 61
0040 900000      E     MOV     DPTR,#SYS_MISC1
0043 E0                MOVX    A,@DPTR
0044 54FB              ANL     A,#0FBH
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
0047         ?C0006:
0047 22                RET     
             ; FUNCTION _OEM_Write_Leds (END)

             ; FUNCTION _Battery_Charge_Discharge_LED_CONTROL (BEGIN)
                                           ; SOURCE LINE # 258
0000 900000      R     MOV     DPTR,#bit6
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
;---- Variable 'LED_OFF' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 260
0008 120000      R     LCALL   L?0153
000B 7006              JNZ     ?C0007
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
000D 900000      R     MOV     DPTR,#bit6
                                           ; SOURCE LINE # 263
0010 120000      R     LCALL   L?0143
                                           ; SOURCE LINE # 264
0013         ?C0007:
                                           ; SOURCE LINE # 265
0013 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0016 E0                MOVX    A,@DPTR
0017 6025              JZ      ?C0008
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 267
0019 E0                MOVX    A,@DPTR
001A 14                DEC     A
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 268
001C 900000      E     MOV     DPTR,#BAT1PERCL
001F E0                MOVX    A,@DPTR
0020 C3                CLR     C
0021 9400              SUBB    A,#00H
0023 4011              JC      ?C0009
0025 E0                MOVX    A,@DPTR
0026 D3                SETB    C
0027 9450              SUBB    A,#050H
0029 500B              JNC     ?C0009
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 270
002B 900000      E     MOV     DPTR,#GPDRA
002E E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 17  

002F 54FB              ANL     A,#0FBH
                                           ; SOURCE LINE # 271
0031 120000      R     LCALL   L?0146
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 272
0035 22                RET     
0036         ?C0009:
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
0036 900000      E     MOV     DPTR,#GPDRE
0039 E0                MOVX    A,@DPTR
003A 547F              ANL     A,#07FH
                                           ; SOURCE LINE # 276
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 279
003C 800B              SJMP    ?C0118
003E         ?C0008:
                                           ; SOURCE LINE # 280
003E 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
0041 E0                MOVX    A,@DPTR
0042 6009              JZ      ?C0013
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
0044 E0                MOVX    A,@DPTR
0045 14                DEC     A
                                           ; SOURCE LINE # 283
0046 120000      R     LCALL   L?0146
0049         ?C0118:
                                           ; SOURCE LINE # 284
0049 120000      R     LCALL   L?0151
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 285
                                           ; SOURCE LINE # 288
004D         ?C0013:
004D 22                RET     
             ; FUNCTION _Battery_Charge_Discharge_LED_CONTROL (END)

             ; FUNCTION _Battery_LED_CONTROL (BEGIN)
                                           ; SOURCE LINE # 290
0000 900000      R     MOV     DPTR,#bit6
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
;---- Variable 'LED_OFF' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 291
                                           ; SOURCE LINE # 292
0008 120000      R     LCALL   L?0148
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
000C 120000      R     LCALL   L?0153
000F 7006              JNZ     ?C0014
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
0011 900000      R     MOV     DPTR,#bit6
                                           ; SOURCE LINE # 296
0014 120000      R     LCALL   L?0143
                                           ; SOURCE LINE # 297
0017         ?C0014:
                                           ; SOURCE LINE # 299
0017 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 18  

001A E0                MOVX    A,@DPTR
001B 600B              JZ      ?C0015
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
001D E0                MOVX    A,@DPTR
001E 14                DEC     A
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 302
0020 900000      E     MOV     DPTR,#GPDRA
0023 E0                MOVX    A,@DPTR
0024 54FB              ANL     A,#0FBH
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 303
0027 22                RET     
0028         ?C0015:
                                           ; SOURCE LINE # 304
0028 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
002B E0                MOVX    A,@DPTR
002C 6006              JZ      ?C0018
                                           ; SOURCE LINE # 305
                                           ; SOURCE LINE # 306
002E E0                MOVX    A,@DPTR
002F 14                DEC     A
                                           ; SOURCE LINE # 307
0030 120000      R     LCALL   L?0151
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 311
0034         ?C0018:
0034 22                RET     
             ; FUNCTION _Battery_LED_CONTROL (END)

             ; FUNCTION Battery_LED_Reset (BEGIN)
                                           ; SOURCE LINE # 313
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 316
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 317
0005 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
                                           ; SOURCE LINE # 319
0008 120000      R     LCALL   L?0152
                                           ; SOURCE LINE # 320
000B 120000      R     LCALL   L?0147
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 323
000F 22                RET     
             ; FUNCTION Battery_LED_Reset (END)

             ; FUNCTION _Power_LED_CONTROL (BEGIN)
                                           ; SOURCE LINE # 326
;---- Variable 'STATUS' assigned to Register 'R5' ----
0000 CD                XCH     A,R5
0001 EF                MOV     A,R7
0002 CD                XCH     A,R5
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
0003 900000      E     MOV     DPTR,#BAT1PERCL
0006 E0                MOVX    A,@DPTR
0007 D3                SETB    C
0008 9414              SUBB    A,#014H
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 19  

000A 402F              JC      ?C0020
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
000C 120000      R     LCALL   L?0140
000F E0                MOVX    A,@DPTR
0010 4402              ORL     A,#02H
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 333
0013 ED                MOV     A,R5
0014 14                DEC     A
0015 600F              JZ      ?C0023
0017 14                DEC     A
0018 6017              JZ      ?C0024
001A 2402              ADD     A,#02H
001C 704E              JNZ     ?C0032
                                           ; SOURCE LINE # 334
                                           ; SOURCE LINE # 335
001E         ?C0022:
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
001E 120000      R     LCALL   L?0144
                                           ; SOURCE LINE # 338
0021 120000      R     LCALL   L?0142
                                           ; SOURCE LINE # 339
0024 8042              SJMP    ?C0120
                                           ; SOURCE LINE # 340
0026         ?C0023:
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 342
0026 120000      R     LCALL   L?0144
                                           ; SOURCE LINE # 343
0029 120000      R     LCALL   L?0142
002C E0                MOVX    A,@DPTR
002D 54FE              ANL     A,#0FEH
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 344
0030 22                RET     
                                           ; SOURCE LINE # 345
0031         ?C0024:
                                           ; SOURCE LINE # 346
0031 E4                CLR     A
0032 900000      E     MOV     DPTR,#GPCRA0
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 347
0036 900000      E     MOV     DPTR,#PWM0LHE
0039         ?C0119:
                                           ; SOURCE LINE # 348
0039 802D              SJMP    ?C0120
                                           ; SOURCE LINE # 349
                                           ; SOURCE LINE # 350
                                           ; SOURCE LINE # 351
                                           ; SOURCE LINE # 352
003B         ?C0020:
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
                                           ; SOURCE LINE # 356
003B 120000      R     LCALL   L?0145
                                           ; SOURCE LINE # 357
003E 120000      R     LCALL   L?0142
0041 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 20  

0042 4401              ORL     A,#01H
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 358
0045 ED                MOV     A,R5
0046 14                DEC     A
0047 600F              JZ      ?C0029
0049 14                DEC     A
004A 6014              JZ      ?C0030
004C 2402              ADD     A,#02H
004E 701C              JNZ     ?C0032
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
0050         ?C0028:
                                           ; SOURCE LINE # 361
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 363
0050 120000      R     LCALL   L?0140
0053 E0                MOVX    A,@DPTR
0054 4402              ORL     A,#02H
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 364
0057 22                RET     
                                           ; SOURCE LINE # 365
0058         ?C0029:
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
                                           ; SOURCE LINE # 368
0058 120000      R     LCALL   L?0141
005B E0                MOVX    A,@DPTR
005C 54FD              ANL     A,#0FDH
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
005F 22                RET     
                                           ; SOURCE LINE # 370
0060         ?C0030:
                                           ; SOURCE LINE # 371
0060 E4                CLR     A
0061 900000      E     MOV     DPTR,#GPCRA1
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 372
0065 900000      E     MOV     DPTR,#PWM1LHE
0068         ?C0120:
0068 E0                MOVX    A,@DPTR
0069 4401              ORL     A,#01H
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
                                           ; SOURCE LINE # 377
                                           ; SOURCE LINE # 378
006C         ?C0032:
006C 22                RET     
             ; FUNCTION _Power_LED_CONTROL (END)

             ; FUNCTION Lenovo_LED (BEGIN)
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 382
0000 900000      E     MOV     DPTR,#SysPowState
0003 E0                MOVX    A,@DPTR
0004 6455              XRL     A,#055H
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 21  

0006 6009              JZ      ?C0034
0008 E0                MOVX    A,@DPTR
0009 6466              XRL     A,#066H
000B 6004              JZ      ?C0034
000D E0                MOVX    A,@DPTR
000E B46007            CJNE    A,#060H,?C0033
0011         ?C0034:
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 384
0011 E4                CLR     A
0012 900000      E     MOV     DPTR,#PWR_LED_Debug
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
0016 8051              SJMP    ?C0121
0018         ?C0033:
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 389
0018 E4                CLR     A
0019 900000      E     MOV     DPTR,#LOWBATT_3TIMES
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 390
001D 900000      E     MOV     DPTR,#SysPowState
0020 E0                MOVX    A,@DPTR
0021 6433              XRL     A,#033H
0023 6007              JZ      ?C0037
0025 900000      E     MOV     DPTR,#uISCT_2
0028 E0                MOVX    A,@DPTR
0029 30E504            JNB     ACC.5,?C0036
002C         ?C0037:
                                           ; SOURCE LINE # 391
                                           ; SOURCE LINE # 392
002C 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 393
002E 803E              SJMP    ?C0123
0030         ?C0036:
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
0030 120000      R     LCALL   L?0149
0033 6005              JZ      ?C0040
0035 E0                MOVX    A,@DPTR
0036 6450              XRL     A,#050H
0038 7037              JNZ     ?C0035
003A         ?C0040:
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
003A 900000      E     MOV     DPTR,#PWR_LED_Debug
003D E0                MOVX    A,@DPTR
003E 6022              JZ      ?C0041
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
0040 7F02              MOV     R7,#02H
0042 120000      R     LCALL   _Power_LED_CONTROL
                                           ; SOURCE LINE # 401
0045 7F14              MOV     R7,#014H
0047 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 402
004A 7F23              MOV     R7,#023H
004C 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 403
004F 7FF0              MOV     R7,#0F0H
0051 120000      E     LCALL   _Buffer_Key
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 22  

                                           ; SOURCE LINE # 404
0054 7F23              MOV     R7,#023H
0056 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 405
0059 7F23              MOV     R7,#023H
005B 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 406
005E D200        E     SETB    F_Service_SEND
                                           ; SOURCE LINE # 407
0060 800F              SJMP    ?C0035
0062         ?C0041:
                                           ; SOURCE LINE # 409
                                           ; SOURCE LINE # 410
0062 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
0065 E0                MOVX    A,@DPTR
0066 6004              JZ      ?C0043
                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 412
0068 E4                CLR     A
0069         ?C0121:
0069 FF                MOV     R7,A
006A         ?C0122:
                                           ; SOURCE LINE # 413
006A 8002              SJMP    ?C0123
006C         ?C0043:
                                           ; SOURCE LINE # 415
                                           ; SOURCE LINE # 416
006C 7F01              MOV     R7,#01H
006E         ?C0123:
006E 120000      R     LCALL   _Power_LED_CONTROL
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
0071         ?C0035:
                                           ; SOURCE LINE # 423
0071 900000      E     MOV     DPTR,#SYS_MISC1
0074 E0                MOVX    A,@DPTR
0075 30E50D            JNB     ACC.5,?C0045
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
0078 900000      E     MOV     DPTR,#SEL_STATE0
007B E0                MOVX    A,@DPTR
007C 30E05C            JNB     ACC.0,?C0128
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 427
007F 7D0A              MOV     R5,#0AH
0081 7F14              MOV     R7,#014H
                                           ; SOURCE LINE # 428
0083 8033              SJMP    ?C0126
0085         ?C0045:
                                           ; SOURCE LINE # 435
                                           ; SOURCE LINE # 436
0085 900000      E     MOV     DPTR,#LV_Authen_Step_CNT
0088 E0                MOVX    A,@DPTR
0089 30E615            JNB     ACC.6,?C0049
                                           ; SOURCE LINE # 437
                                           ; SOURCE LINE # 438
008C 120000      R     LCALL   L?0149
008F 6007              JZ      ?C0051
0091 900000      E     MOV     DPTR,#GPDRB
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 23  

0094 E0                MOVX    A,@DPTR
0095 30E006            JNB     ACC.0,?C0050
0098         ?C0051:
                                           ; SOURCE LINE # 439
                                           ; SOURCE LINE # 440
0098 7D05              MOV     R5,#05H
009A 7F05              MOV     R7,#05H
009C         ?C0124:
                                           ; SOURCE LINE # 441
009C 801A              SJMP    ?C0126
009E         ?C0050:
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 444
009E         ?C0125:
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 446
009E 020000      R     LJMP    ?C0135
00A1         ?C0049:
                                           ; SOURCE LINE # 447
00A1 900000      E     MOV     DPTR,#Bat1_FPChgFlag
00A4 E0                MOVX    A,@DPTR
00A5 30E018            JNB     ACC.0,?C0054
                                           ; SOURCE LINE # 448
                                           ; SOURCE LINE # 449
00A8 120000      R     LCALL   L?0150
00AB 6007              JZ      ?C0056
00AD 900000      E     MOV     DPTR,#GPDRB
00B0 E0                MOVX    A,@DPTR
00B1 30E009            JNB     ACC.0,?C0055
00B4         ?C0056:
                                           ; SOURCE LINE # 450
                                           ; SOURCE LINE # 451
00B4 7D05              MOV     R5,#05H
00B6 7F05              MOV     R7,#05H
00B8         ?C0126:
00B8 7E00              MOV     R6,#00H
00BA 020000      R     LJMP    _Battery_LED_CONTROL
                                           ; SOURCE LINE # 452
00BD         ?C0055:
                                           ; SOURCE LINE # 454
                                           ; SOURCE LINE # 455
00BD         ?C0127:
                                           ; SOURCE LINE # 456
                                           ; SOURCE LINE # 457
00BD 020000      R     LJMP    ?C0135
00C0         ?C0054:
                                           ; SOURCE LINE # 458
00C0 900000      E     MOV     DPTR,#GPDRB
00C3 E0                MOVX    A,@DPTR
00C4 30E016            JNB     ACC.0,?C0059
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 460
00C7 E4                CLR     A
00C8 900000      E     MOV     DPTR,#LOWBATT_3TIMES
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 462
00CC 900000      E     MOV     DPTR,#SEL_STATE0
00CF E0                MOVX    A,@DPTR
00D0 30E008            JNB     ACC.0,?C0060
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
00D3 E4                CLR     A
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 24  

00D4 FD                MOV     R5,A
00D5 7F01              MOV     R7,#01H
00D7 FE                MOV     R6,A
00D8 020000      R     LJMP    _Battery_Charge_Discharge_LED_CONTROL
                                           ; SOURCE LINE # 465
00DB         ?C0060:
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
00DB         ?C0128:
                                           ; SOURCE LINE # 469
                                           ; SOURCE LINE # 470
00DB 8066              SJMP    ?C0135
00DD         ?C0059:
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
00DD 900000      E     MOV     DPTR,#SysPowState
00E0 E0                MOVX    A,@DPTR
00E1 6455              XRL     A,#055H
00E3 600A              JZ      ?C0064
00E5 E0                MOVX    A,@DPTR
00E6 6466              XRL     A,#066H
00E8 6005              JZ      ?C0064
00EA E0                MOVX    A,@DPTR
00EB 6460              XRL     A,#060H
00ED 7054              JNZ     ?C0063
00EF         ?C0064:
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
00EF 900000      E     MOV     DPTR,#LOWBATT_3TIMES
00F2 E0                MOVX    A,@DPTR
00F3 7002              JNZ     ?C0065
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
00F5         ?C0129:
                                           ; SOURCE LINE # 478
00F5 804C              SJMP    ?C0135
00F7         ?C0065:
                                           ; SOURCE LINE # 480
                                           ; SOURCE LINE # 481
00F7 900000      E     MOV     DPTR,#LOWBATT_3TIMES
00FA E0                MOVX    A,@DPTR
00FB D3                SETB    C
00FC 9450              SUBB    A,#050H
00FE 4002              JC      ?C0067
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
                                           ; SOURCE LINE # 484
0100 802E              SJMP    ?C0133
0102         ?C0067:
                                           ; SOURCE LINE # 485
0102 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0105 E0                MOVX    A,@DPTR
0106 D3                SETB    C
0107 943C              SUBB    A,#03CH
0109 4002              JC      ?C0069
                                           ; SOURCE LINE # 486
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 488
010B 8014              SJMP    ?C0132
010D         ?C0069:
                                           ; SOURCE LINE # 489
010D 900000      E     MOV     DPTR,#LOWBATT_3TIMES
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 25  

0110 E0                MOVX    A,@DPTR
0111 D3                SETB    C
0112 9428              SUBB    A,#028H
0114 4002              JC      ?C0071
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
0116         ?C0131:
                                           ; SOURCE LINE # 492
0116 8018              SJMP    ?C0133
0118         ?C0071:
                                           ; SOURCE LINE # 493
0118 900000      E     MOV     DPTR,#LOWBATT_3TIMES
011B E0                MOVX    A,@DPTR
011C D3                SETB    C
011D 9414              SUBB    A,#014H
011F 4006              JC      ?C0073
                                           ; SOURCE LINE # 494
                                           ; SOURCE LINE # 495
0121         ?C0132:
0121 7D01              MOV     R5,#01H
0123 E4                CLR     A
0124 FF                MOV     R7,A
                                           ; SOURCE LINE # 496
0125 800D              SJMP    ?C0134
0127         ?C0073:
                                           ; SOURCE LINE # 497
0127 900000      E     MOV     DPTR,#LOWBATT_3TIMES
012A E0                MOVX    A,@DPTR
012B D3                SETB    C
012C 9400              SUBB    A,#00H
012E 4008              JC      ?C0068
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
0130         ?C0133:
0130 E4                CLR     A
0131 FD                MOV     R5,A
0132 7F01              MOV     R7,#01H
0134         ?C0134:
0134 FE                MOV     R6,A
0135 120000      R     LCALL   _Battery_LED_CONTROL
                                           ; SOURCE LINE # 500
0138         ?C0068:
                                           ; SOURCE LINE # 501
0138 900000      E     MOV     DPTR,#LOWBATT_3TIMES
013B E0                MOVX    A,@DPTR
013C 14                DEC     A
013D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 502
013E E0                MOVX    A,@DPTR
013F 7005              JNZ     ?C0078
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 504
0141         ?C0130:
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 506
                                           ; SOURCE LINE # 507
0141 8000              SJMP    ?C0135
0143         ?C0063:
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
0143         ?C0135:
0143 120000      R     LCALL   Battery_LED_Reset
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 26  

                                           ; SOURCE LINE # 511
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 513
                                           ; SOURCE LINE # 536
0146         ?C0078:
0146 22                RET     
             ; FUNCTION Lenovo_LED (END)

             ; FUNCTION MFG_LED (BEGIN)
                                           ; SOURCE LINE # 540
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
0000 900000      E     MOV     DPTR,#cOsLedCtrl
0003 E0                MOVX    A,@DPTR
0004 C3                CLR     C
0005 13                RRC     A
0006 900000      E     MOV     DPTR,#GPDRA
0009 30E006            JNB     ACC.0,?C0079
                                           ; SOURCE LINE # 543
000C E0                MOVX    A,@DPTR
000D 54FE              ANL     A,#0FEH
000F F0                MOVX    @DPTR,A
0010 8004              SJMP    ?C0080
0012         ?C0079:
                                           ; SOURCE LINE # 545
0012 E0                MOVX    A,@DPTR
0013 4401              ORL     A,#01H
0015 F0                MOVX    @DPTR,A
0016         ?C0080:
                                           ; SOURCE LINE # 546
0016 900000      E     MOV     DPTR,#cOsLed1Ctrl+01H
0019 120000      R     LCALL   L?0154
001C 900000      E     MOV     DPTR,#GPDRA
001F 30E006            JNB     ACC.0,?C0081
                                           ; SOURCE LINE # 547
0022 E0                MOVX    A,@DPTR
0023 54FD              ANL     A,#0FDH
0025 F0                MOVX    @DPTR,A
0026 8004              SJMP    ?C0082
0028         ?C0081:
                                           ; SOURCE LINE # 549
0028 E0                MOVX    A,@DPTR
0029 4402              ORL     A,#02H
002B F0                MOVX    @DPTR,A
002C         ?C0082:
                                           ; SOURCE LINE # 550
002C 900000      E     MOV     DPTR,#cOsLedCtrl
002F E0                MOVX    A,@DPTR
0030 13                RRC     A
0031 13                RRC     A
0032 543F              ANL     A,#03FH
0034 900000      E     MOV     DPTR,#GPDRE
0037 30E006            JNB     ACC.0,?C0083
                                           ; SOURCE LINE # 552
003A E0                MOVX    A,@DPTR
003B 547F              ANL     A,#07FH
003D F0                MOVX    @DPTR,A
003E 8004              SJMP    ?C0084
0040         ?C0083:
                                           ; SOURCE LINE # 555
0040 E0                MOVX    A,@DPTR
0041 4480              ORL     A,#080H
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 27  

0043 F0                MOVX    @DPTR,A
0044         ?C0084:
                                           ; SOURCE LINE # 557
0044 900000      E     MOV     DPTR,#cOsLedCtrl
0047 120000      R     LCALL   L?0154
004A 900000      E     MOV     DPTR,#GPDRA
004D 30E006            JNB     ACC.0,?C0085
                                           ; SOURCE LINE # 559
0050 E0                MOVX    A,@DPTR
0051 54FB              ANL     A,#0FBH
0053 F0                MOVX    @DPTR,A
0054 8004              SJMP    ?C0086
0056         ?C0085:
                                           ; SOURCE LINE # 562
0056 E0                MOVX    A,@DPTR
0057 4404              ORL     A,#04H
0059 F0                MOVX    @DPTR,A
005A         ?C0086:
                                           ; SOURCE LINE # 571
005A 900000      E     MOV     DPTR,#uMBID
005D E0                MOVX    A,@DPTR
005E 30E004            JNB     ACC.0,?C0087
                                           ; SOURCE LINE # 572
                                           ; SOURCE LINE # 573
0061 900000      E     MOV     DPTR,#cOsLedCtrl+01H
0064 E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 576
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 581
0065         ?C0087:
                                           ; SOURCE LINE # 583
0065 900000      E     MOV     DPTR,#cOsLed1Ctrl
0068 E0                MOVX    A,@DPTR
0069 900000      E     MOV     DPTR,#GPDRH
006C 30E006            JNB     ACC.0,?C0090
                                           ; SOURCE LINE # 584
006F E0                MOVX    A,@DPTR
0070 54F7              ANL     A,#0F7H
0072 F0                MOVX    @DPTR,A
0073 8004              SJMP    ?C0091
0075         ?C0090:
                                           ; SOURCE LINE # 586
0075 E0                MOVX    A,@DPTR
0076 4408              ORL     A,#08H
0078 F0                MOVX    @DPTR,A
0079         ?C0091:
                                           ; SOURCE LINE # 588
0079 900000      E     MOV     DPTR,#cOsLed1Ctrl
007C 120000      R     LCALL   L?0155
007F 30E006            JNB     ACC.0,?C0092
                                           ; SOURCE LINE # 589
0082 E4                CLR     A
0083 900000      E     MOV     DPTR,#DCR3
0086 F0                MOVX    @DPTR,A
0087 22                RET     
0088         ?C0092:
                                           ; SOURCE LINE # 592
0088 900000      E     MOV     DPTR,#DCR3
008B 74FF              MOV     A,#0FFH
008D F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 28  

                                           ; SOURCE LINE # 601
008E         ?C0094:
008E 22                RET     
             ; FUNCTION MFG_LED (END)

             ; FUNCTION SetKeyboardLED (BEGIN)
                                           ; SOURCE LINE # 689
                                           ; SOURCE LINE # 690
                                           ; SOURCE LINE # 692
0000 120000      R     LCALL   L?0150
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0099
0008 900000      E     MOV     DPTR,#cOsLedCtrl
000B E0                MOVX    A,@DPTR
000C C4                SWAP    A
000D 13                RRC     A
000E 13                RRC     A
000F 13                RRC     A
0010 5401              ANL     A,#01H
0012 30E003            JNB     ACC.0,$ + 6H
0015 020000      R     LJMP    ?C0099
0018 900000      E     MOV     DPTR,#GPDRB
001B E0                MOVX    A,@DPTR
001C 30E103            JNB     ACC.1,?C0097
001F D3                SETB    C
0020 8001              SJMP    ?C0098
0022         ?C0097:
0022 C3                CLR     C
0023         ?C0098:
0023 4003              JC      $ + 5H
0025 020000      R     LJMP    ?C0099
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 696
0028         ?C0095:
                                           ; SOURCE LINE # 697
0028 900000      E     MOV     DPTR,#pDevStatus1
002B E0                MOVX    A,@DPTR
002C 30E202            JNB     ACC.2,?C0100
                                           ; SOURCE LINE # 698
                                           ; SOURCE LINE # 699
002F 8006              SJMP    ?C0136
                                           ; SOURCE LINE # 701
0031         ?C0100:
                                           ; SOURCE LINE # 702
0031 900000      E     MOV     DPTR,#ONEKEY_TEMP_FLAG
0034 E0                MOVX    A,@DPTR
0035 6006              JZ      ?C0101
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0037         ?C0136:
0037 E4                CLR     A
0038 900000      E     MOV     DPTR,#DCR3
003B F0                MOVX    @DPTR,A
003C 22                RET     
                                           ; SOURCE LINE # 706
003D         ?C0101:
                                           ; SOURCE LINE # 707
;---- Variable 'BKBMax' assigned to Register 'R4' ----
003D 7CF0              MOV     R4,#0F0H
                                           ; SOURCE LINE # 708
;---- Variable 'BKBHalf' assigned to Register 'R6' ----
003F 7E25              MOV     R6,#025H
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 29  

                                           ; SOURCE LINE # 710
0041 900000      E     MOV     DPTR,#UpdateLEDBL_delay
0044 E0                MOVX    A,@DPTR
0045 6002              JZ      ?C0102
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
0047 803D              SJMP    ?C0137
                                           ; SOURCE LINE # 714
0049         ?C0102:
                                           ; SOURCE LINE # 716
0049 900000      E     MOV     DPTR,#uReserve07
004C E0                MOVX    A,@DPTR
004D C4                SWAP    A
004E 13                RRC     A
004F 5407              ANL     A,#07H
0051 30E018            JNB     ACC.0,?C0103
                                           ; SOURCE LINE # 717
                                           ; SOURCE LINE # 718
0054 900000      E     MOV     DPTR,#EMStatusBit
0057 E0                MOVX    A,@DPTR
0058 30E00C            JNB     ACC.0,?C0104
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
005B E0                MOVX    A,@DPTR
005C 30E20D            JNB     ACC.2,?C0103
                                           ; SOURCE LINE # 721
                                           ; SOURCE LINE # 722
005F 900000      E     MOV     DPTR,#LED_KB_PWM_Step
0062 7401              MOV     A,#01H
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 723
                                           ; SOURCE LINE # 724
0065 8005              SJMP    ?C0103
0067         ?C0104:
                                           ; SOURCE LINE # 726
                                           ; SOURCE LINE # 727
0067 E4                CLR     A
0068 900000      E     MOV     DPTR,#LED_KB_PWM_Step
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 728
                                           ; SOURCE LINE # 729
006C         ?C0103:
                                           ; SOURCE LINE # 744
006C 900000      E     MOV     DPTR,#LED_KB_PWM_Count
006F E0                MOVX    A,@DPTR
0070 547F              ANL     A,#07FH
0072 6016              JZ      ?C0107
                                           ; SOURCE LINE # 745
                                           ; SOURCE LINE # 746
0074 900000      E     MOV     DPTR,#DCR3
0077 E0                MOVX    A,@DPTR
0078 7009              JNZ     ?C0108
                                           ; SOURCE LINE # 748
                                           ; SOURCE LINE # 749
007A EC                MOV     A,R4
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 751
007C 900000      E     MOV     DPTR,#LED_KB_PWM_Count
007F E0                MOVX    A,@DPTR
0080 4480              ORL     A,#080H
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 752
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 30  

0083         ?C0108:
                                           ; SOURCE LINE # 753
0083 900000      E     MOV     DPTR,#LED_KB_PWM_Count
0086         ?C0137:
0086 E0                MOVX    A,@DPTR
0087 14                DEC     A
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 754
0089 22                RET     
008A         ?C0107:
                                           ; SOURCE LINE # 756
                                           ; SOURCE LINE # 757
008A 900000      E     MOV     DPTR,#LED_KB_PWM_Count
008D E0                MOVX    A,@DPTR
008E 30E70F            JNB     ACC.7,?C0110
                                           ; SOURCE LINE # 758
                                           ; SOURCE LINE # 759
0091 900000      E     MOV     DPTR,#LED_KB_PWM_Step
0094 E0                MOVX    A,@DPTR
0095 703B              JNZ     ?C0099
                                           ; SOURCE LINE # 760
                                           ; SOURCE LINE # 761
0097 900000      E     MOV     DPTR,#DCR3
009A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
009B 900000      E     MOV     DPTR,#LED_KB_PWM_Count
009E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
                                           ; SOURCE LINE # 764
009F 22                RET     
00A0         ?C0110:
                                           ; SOURCE LINE # 766
                                           ; SOURCE LINE # 767
00A0 900000      E     MOV     DPTR,#LED_KB_PWM_Step
00A3 E0                MOVX    A,@DPTR
00A4 700C              JNZ     ?C0113
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 770
00A6 900000      E     MOV     DPTR,#DCR3
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 771
00AA 900000      E     MOV     DPTR,#EMStatusBit
00AD E0                MOVX    A,@DPTR
00AE 4404              ORL     A,#04H
00B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 772
00B1 22                RET     
00B2         ?C0113:
                                           ; SOURCE LINE # 773
00B2 900000      E     MOV     DPTR,#LED_KB_PWM_Step
00B5 E0                MOVX    A,@DPTR
00B6 B40106            CJNE    A,#01H,?C0115
                                           ; SOURCE LINE # 774
                                           ; SOURCE LINE # 776
00B9 900000      E     MOV     DPTR,#DCR3
00BC EE                MOV     A,R6
                                           ; SOURCE LINE # 777
                                           ; SOURCE LINE # 778
00BD 800B              SJMP    ?C0138
00BF         ?C0115:
                                           ; SOURCE LINE # 779
00BF 900000      E     MOV     DPTR,#LED_KB_PWM_Step
C51 COMPILER V8.12   OEM_LED                                                               09/14/2018 11:08:06 PAGE 31  

00C2 E0                MOVX    A,@DPTR
00C3 B4020C            CJNE    A,#02H,?C0099
                                           ; SOURCE LINE # 780
                                           ; SOURCE LINE # 782
00C6 900000      E     MOV     DPTR,#DCR3
00C9 EC                MOV     A,R4
00CA         ?C0138:
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 783
00CB 900000      E     MOV     DPTR,#EMStatusBit
00CE E0                MOVX    A,@DPTR
00CF 54FB              ANL     A,#0FBH
00D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 784
                                           ; SOURCE LINE # 785
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 788
00D2         ?C0099:
00D2 22                RET     
             ; FUNCTION SetKeyboardLED (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1093    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
