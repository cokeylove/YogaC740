C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_FAN
OBJECT MODULE PLACED IN Code\OEM\OEM_FAN.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_FAN.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_FAN.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          void Fan_Init(void)
  14          {
  15   1              nFanStatus1 = Fan_Num;
  16   1              nFanStatus1 = (nFanStatus1 << 4) | Fan_Step;
  17   1              //nFanStatus1 = ((Fan_Num << 4) &0xF0) | (Fan_Step & 0x0F);
  18   1              nOSThrottlingTemp = 98; //MEILING024:change throttling temperatrue from 97 to 98.
  19   1              nOSShutdownTemp = 100;
  20   1              nShutDownTemp = 100;
  21   1      }
  22          
  23          /*****************************************************************************/
  24          // Procedure: PWM_TimeCount                                                                     TimeDiv: 50mSec
  25          // Description: PWM Beep function.
  26          // GPIO:
  27          // Referrals: Service short time PWM output, base on 50ms.
  28          /*****************************************************************************/
  29          void PWM_TimeCount(void)
  30          {
  31   1              if (uReserve07.fbit.uACInOutBeep == 0)
  32   1              {
  33   2                      if( PWM_LEDBeep_CNT == 0x00 )
  34   2                      {
  35   3                              BEEP_INIT;
  36   3                              PWM_BEEP = 0x00;
  37   3                              return;
  38   3                      }
  39   2      
  40   2                      BEEP_ALT;
  41   2                      PWM_LEDBeep_CNT--;              // decrease timer
  42   2                      // AC IN/OUT beep time
  43   2                      if( PWM_LEDBeep_CNT == 0x00 )
  44   2                      {
  45   3                              BEEP_INIT;
  46   3                              PWM_BEEP = 0x00;
  47   3                      }
  48   2              }
  49   1              else
  50   1              {
  51   2                      PWM_LEDBeep_CNT = 0;
  52   2                      BEEP_INIT;
  53   2                      PWM_BEEP = 0x00;
  54   2              }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 2   

  55   1      }
  56          
  57          /*****************************************************************************/
  58          // Procedure: ThmIC_Temperature                                                         TimeDiv: 500mSec
  59          // Description: Read RAM temperature
  60          // GPIO:
  61          // Referrals:
  62          /*****************************************************************************/
  63          extern void TempProtect_VRAM(void);
  64          void ThmIC_Temperature(void)
  65          {
  66   1              BYTE BsData,BTmlCmd;
  67   1      
  68   1              if( SystemNotS0 || (PwrOnDly5Sec!=0) )   //T089: add PwrOnDly5Sec judge.
  69   1              { 
  70   2                      return;
  71   2              }
  72   1              switch( TmlICStep & 0x03 )  //  Change TmlICStep from 7 to 3
  73   1              {
  74   2                      case 0: // HEGANGS010:Enable GPU temperature and remove read remote temp
  75   2                              BTmlCmd = Remote_Temp;
  76   2                              break;
  77   2      
  78   2                      case 1:
  79   2                              BTmlCmd = TmlIC_Temp;
  80   2                              break;
  81   2                              
  82   2                      default:
  83   2                              TmlICStep = 0;
  84   2                              return;
  85   2              }
  86   1              if(!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))  
  87   1              {      //  1. SMBus fail; 2. MBID OK; 3.  no UMA 37W ; 4.  no UMA 47W VRAM sensor  
  88   2                      TMErrCnt++;
  89   2                      TmlICStep++;
  90   2                      if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
  91   2                      {
  92   3                              if ( TMErrCnt > 7 )             // 3 Sec.
  93   3                              {
  94   4                                      SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
  95   4                              }
  96   3                      }
  97   2                      else
  98   2                      {
  99   3                              if ( TMErrCnt > 68 )    // 30 Sec.
 100   3                              {
 101   4                                      //      ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 102   4                                      TMErrCnt = 0;                                   // Clear error count.
 103   4                                      //RSMRST_LOW();  
 104   4                                      //Delay1MS(1); //ANGELAS050:remove
 105   4                                      //RSMRST_HI();   
 106   4                                      //TmlICStep++;
 107   4                              }
 108   3                      }
 109   2                      ResetSMBus(SMbusCh4);
 110   2              }
 111   1              else
 112   1              { 
 113   2                      if(BsData == 0x00)      // read 0'C  
 114   2                      {
 115   3                              TMErrCnt++;
 116   3                              TmlICStep++;
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 3   

 117   3                              if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 118   3                              {
 119   4                                      if ( TMErrCnt > 7 )             // 3 Sec.
 120   4                                      {
 121   5                                              SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
 122   5                                      }
 123   4                              }
 124   3                              else
 125   3                              {
 126   4                                      if ( TMErrCnt > 68 )    // 30 Sec.
 127   4                                      {
 128   5                                              ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 129   5                                              TMErrCnt = 0;                                   // Clear error count.
 130   5                                          //RSMRST_LOW(); 
 131   5                                          //Delay1MS(1); //ANGELAS050:remove
 132   5                                          //RSMRST_HI();  
 133   5                                          //TmlICStep++;
 134   5                                      }
 135   4                              }
 136   3                      }
 137   2                      else
 138   2                      {
 139   3                              switch( TmlICStep & 0x03 )
 140   3                              {
 141   4                                      case 0:
 142   4                                              nRamTemp = BsData;      // Save VRAM temperature. //Q16
 143   4                                              TMErrCnt = 00;          // Clear error count.
 144   4                                              CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 145   4                                              TmlICStep++;            // next step 1.
 146   4                                              break;
 147   4                                      case 1:
 148   4                                              nVramTemp = BsData;     // Save SSD temperature. //U1
 149   4                                      //      EXTVGA_TEMP=nNBTemp; //T034+
 150   4                                              TMErrCnt = 00;          // Clear error count.
 151   4                                              CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 152   4                                              TmlICStep++;            // next step 2.
 153   4                                              break;      //Remove thermal IC read remote 2 temperature
 154   4                      
 155   4                                      default:
 156   4                                              break;
 157   4                              }
 158   3                      }
 159   2              }
 160   1      
 161   1      }
 162          //-----------------------------------------------------------------------------
 163          // Service short time PWM output, base on 50ms.
 164          //-----------------------------------------------------------------------------
 165          /* //ANGELAS050:remove start
 166          void Tml_SMLink(void)
 167          {
 168                  if( !bRSMBusBlock(SMbusCh4, SMbusRBK, 0x96, 0x40, &MaxCPU_MCHTemp))//, 0x14, TRUE))
 169                  {
 170                          TMErrCnt++;
 171                          if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 172                          {
 173                                  if ( TMErrCnt > 35 )    //change 7 to 35        // 3 Sec.
 174                                  {
 175                                          SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
 176                                  }
 177                          }
 178                          else
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 4   

 179                          {
 180                                  if ( TMErrCnt > 254 ) //change 68 to 254        // 30 Sec.
 181                                  {
 182                                          //ProcessSID(THERMALCOMMFAIL_ID);       // 0x0B shutdown ID.
 183                                          TMErrCnt = 0;                                   // Clear error count.
 184                                          //RSMRST_LOW();
 185                                          //Delay1MS(1);
 186                                          //RSMRST_HI();
 187                                  }
 188                          }
 189                          ResetSMBus(SMbusCh4);
 190                  }
 191                  else
 192                  {
 193                          nOSShutdownTemp3 = MaxCPU_MCHTemp;              // Save PCH temperature.
 194                          CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 195                          TMErrCnt = 0;                                                   // Clear error count.
 196                          TmlICStep = 0;                                                  // Reset Step.
 197                  }
 198          }
 199          *///ANGELAS050:remove end
 200          /*****************************************************************************/
 201          // Procedure:                                                   TimeDiv: 500mSec
 202          // Description:  
 203          // GPIO:  
 204          // Referrals:
 205          /*****************************************************************************/
 206          /* ANGELAS050:remove start
 207          void TempProtect_VRAM(void)
 208          {
 209                          BYTE BsData,BTmlCmd;
 210                          BTmlCmd = SSD_Temp;//change SSD_Temp to SSD_Temp
 211                  
 212          
 213          
 214                          //if((!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))&&MBID_READY&&(!(uMBID&0x20)))
 215                          if(!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))// REMOVE MBID_READY judge
 216                          {        
 217                                  TMErrCnt++;
 218                                  if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 219                                  {
 220                                          if ( TMErrCnt > 7 )     // 3 Sec.
 221                                          {
 222                                                  SET_MASK(ERR_THMSTS, b0ThmICError); // Set bit0 Thermal IC read temperature error.
 223                                          }
 224                                  }
 225                                  else
 226                                  {
 227                                          if ( TMErrCnt > 68 )    // 30 Sec.
 228                                          {
 229                                                  //ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 230                                                  TMErrCnt = 0;                                   // Clear error count.
 231                                                  //RSMRST_LOW();  
 232                                                  //Delay1MS(1);
 233                                                  //RSMRST_HI();
 234                                          }
 235                                  }
 236                                  ResetSMBus(SMbusCh4);
 237                          }
 238                          else
 239                          { 
 240                          if(BsData == 0x00)// REMOVE MBID_READY judge
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 5   

 241                                  //if((BsData == 0x00)&&MBID_READY&&(!(uMBID&0x20)))
 242                                  {
 243                                          TMErrCnt++;
 244                                          if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 245                                          {
 246                                                  if ( TMErrCnt > 7 )     // 3 Sec.
 247                                                  {
 248                                                          SET_MASK(ERR_THMSTS, b0ThmICError); // Set bit0 Thermal IC read temperature error.
 249                                                  }
 250                                          }
 251                                          else
 252                                          {
 253                                                  if ( TMErrCnt > 68 )    // 30 Sec.
 254                                                  {
 255                                                          //ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 256                                                          TMErrCnt = 0;                                   // Clear error count.
 257                                                            // RSMRST_LOW(); 
 258                                                           //  Delay1MS(1);
 259                                                           //  RSMRST_HI();       
 260                                                  }
 261                                          }
 262                                  }
 263                                  else
 264                                  {
 265          
 266                                                          //nVramTemp = BsData; // Save VRAM temperature.  
 267                                                          nNBTemp=BsData;  
 268                                                          TMErrCnt = 00;          // Clear error count.
 269                                                          CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 270                                                          if(nNBTemp>=85) //change nVramTemp to nNBTemp
 271                                                          {
 272                                                            // ProcessSID(ThermalICOVerTEPM_ID); // 0x0B shutdown ID.
 273                                                             //RSMRST_LOW(); 
 274                                                            // Delay1MS(1);
 275                                                            // RSMRST_HI();               
 276                                                          }
 277                                  }
 278                            }
 279          }
 280          
 281          *///ANGELAS050:remove end
 282          /*****************************************************************************/
 283          // Procedure: VGA_Temperature                                                           TimeDiv: 500mSec
 284          // Description: Read VGA temperature(M/B)
 285          // GPIO: GPIOF6(118)
 286          // Referrals:
 287          /*****************************************************************************/
 288          void VGA_Temperature(void)
 289          {
 290   1              BYTE BsData;
 291   1              //Add read AMD GPU thermal temperature  start
 292   1      //      BYTE INIT_GPU_REG2[4] = {0x0f, 0x00, 0x01, 0xC5}; //ANGELAG016: remove
 293   1      //ANGELAG016: add start
 294   1               BYTE INIT_GPU_REG2[4] = {0x0f, 0x00, 0x00, 0x8f};
 295   1              BYTE INIT_GPU_REG1[4] = {0x0f, 0x00, 0x00, 0x8e};
 296   1              BYTE INIT_GPU_REG0[4] = {0xc0, 0x30, 0x00, 0x14};
 297   1      //ANGELAG016: add end
 298   1              if ( (CPU_TYPE & 0xC0) == 0x00 )        // Isn't check VGA support optimus?
 299   1              { nHybridGraphicsDIS;}                          // No optimus status.
 300   1              else
 301   1              { nHybridGraphicsEN; }                          // optimus status.
 302   1      
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 6   

 303   1              //if( SystemNotS0 || (PwrOnDly5Sec!=0) )         //T089: add PwrOnDly5Sec judge.
 304   1      
 305   1              // Check S0 and  VGA into.
 306   1              if( SystemNotS0 || !(nHybridGraphicsGET)|| (PwrOnDly5Sec!=0) ) //== to != // add PwrOnDly5Sec judge.modif
             -y nHybridGraphicsGET not take a reverse value 
 307   1              {  
 308   2              VGAErrCnt = 00;  
 309   2              VGA_TEMP=0;
 310   2              VGA_TBuff3=0;
 311   2              CLEAR_MASK(ERR_THMSTS,b1VGATempEr); 
 312   2              return; 
 313   2          }
 314   1           
 315   1              if((CPU_TYPE &0xc0)==0x40)
 316   1              {
 317   2      //ANGELAG016: add start
 318   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01,( BYTE* )&INIT_GPU_REG1,4,0))//load GPU register offs
             -et to SMB_ADDR
 319   2                      {
 320   3                      VGAErrCnt++;
 321   3                      }
 322   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x02,( BYTE* )&INIT_GPU_REG0,4,0))//sent data to be writt
             -en into the DGPU rgister
 323   2                      {
 324   3                      VGAErrCnt++;
 325   3                      }
 326   2      
 327   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01,( BYTE* )&INIT_GPU_REG2,4,0))//load GPU register offs
             -et to SMB_ADDR
 328   2                      {
 329   3                      VGAErrCnt++;
 330   3                      }
 331   2      //ANGELAG016: add end
 332   2      //ANGELAG016: remove start
 333   2              /*      if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01, &INIT_GPU_REG2, 4,0))
 334   2                      {
 335   2                              VGAErrCnt++;
 336   2                      }*/
 337   2      //ANGELAG016: remove end
 338   2                              
 339   2                      //vgaok=1;
 340   2                      
 341   2                      if(!bRSMBusBlock(SMbusCh4, SMbusRBK, VGA_Addr, 0x03, &sdAMDTH0))
 342   2                      {
 343   3                              VGAErrCnt++;
 344   3                              if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 345   3                              {
 346   4                                      if ( VGAErrCnt > 35 )   //change 7 to 35  // 3 Sec.
 347   4                                      {
 348   5                                              SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 349   5                                      }
 350   4                              }
 351   3                              else
 352   3                              {
 353   4                                      if ( VGAErrCnt > 254 )          // from 68 to 255       // 30 Sec.
 354   4                                      {
 355   5                                              SET_MASK(SysStatus,ERR_ShuntDownFlag);
 356   5                                              ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 357   5                                              VGAErrCnt = 00;                         // Clear error count.
 358   5                                              RSMRST_LOW();
 359   5                                              Delay1MS(1);
 360   5                                              RSMRST_HI();
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 7   

 361   5                                      }
 362   4                              }
 363   3                              ResetSMBus(SMbusCh4);
 364   3                      }
 365   2                      //sdAMDTH0=sdAMDTH0<<24;
 366   2                      else
 367   2                      {
 368   3                              VGA_TEMP=sdAMDTH0&0xff;
 369   3                              VGAErrCnt = 00;         // Clear error count.
 370   3                              CLEAR_MASK(ERR_THMSTS,b1VGATempEr);     // Clear bit1,bit5.
 371   3      
 372   3                              if ( IS_MASK_CLEAR(Fan_Debug_Temp,b1VGA_Temp) ) // Debug VGA Temperature, Engineer myself control.
 373   3                              {
 374   4                              if((VGA_TEMP&0x80)==0x80)//Filter the value of the GPU temperature greater than 128 // optimize G69
             -.
 375   4                              {
 376   5                                      return;
 377   5                              }  
 378   4                              else
 379   4                                      {
 380   5                                              VGA_TBuff3 = VGA_TBuff2;
 381   5                                              VGA_TBuff2 = VGA_TBuff1;
 382   5                                              VGA_TBuff1 = VGA_TEMP;
 383   5                                              VGA_TBuff3 = (VGA_TBuff1 + VGA_TBuff2 + VGA_TBuff3)/3;          // VGA average temperature.
 384   5                      }
 385   4                              }
 386   3                      }
 387   2              }
 388   1              //Add read AMD GPU thermal temperature end
 389   1              if((CPU_TYPE &0xc0)==0x80)
 390   1              {
 391   2                      if(!bRWSMBus(SMbusCh4, SMbusRB, EXTVGA_Addr, 0x00, &BsData, 0))// REMOVE MBID_READY judge
 392   2      
 393   2                      //if((!bRWSMBus(SMbusCh4, SMbusRB, VGA_Addr, TmlIC_Temp, &BsData, 0))&&MBID_READY&&(!(uMBID&0x20))) //ad
             -d MBID judge.
 394   2                      {
 395   3                      VGAErrCnt++;
 396   3                              if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 397   3                              {
 398   4                                      if ( VGAErrCnt > 35 )   //change 7 to 35  // 3 Sec.
 399   4                                      {
 400   5                                              SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 401   5                                      }
 402   4                              }
 403   3                              else
 404   3                              {
 405   4                                      if ( VGAErrCnt > 254 )          // from 68 to 255       // 30 Sec.
 406   4                                      {
 407   5                                              SET_MASK(SysStatus,ERR_ShuntDownFlag);
 408   5                                              ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 409   5                                              VGAErrCnt = 00;                         // Clear error count.
 410   5                                              RSMRST_LOW();
 411   5                                              Delay1MS(1);
 412   5                                              RSMRST_HI();
 413   5                                      }
 414   4                              }
 415   3                              ResetSMBus(SMbusCh4);
 416   3                      }
 417   2                      else
 418   2                      {
 419   3                              if(BsData == 0x00)      // read 0'C  // REMOVE MBID_READY judge
 420   3                              //if((BsData == 0x00)&&MBID_READY&&(!(uMBID&0x20)))// read 0'C 
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 8   

 421   3                              {
 422   4                      VGA_TEMP = BsData;      
 423   4                                      VGAErrCnt++;
 424   4                                      if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 425   4                                      {
 426   5                                              if ( VGAErrCnt > 7 )    // 3 Sec.
 427   5                                              {
 428   6                                                      SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 429   6                                              }
 430   5                                      }
 431   4                                      else
 432   4                                      {
 433   5                                              if ( VGAErrCnt > 68 )                   // 30 Sec.
 434   5                                              {
 435   6                                                      SET_MASK(SysStatus,ERR_ShuntDownFlag);
 436   6                                                      ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 437   6                                                      VGAErrCnt = 00;                         // Clear error count.
 438   6                                                      RSMRST_LOW();
 439   6                                                      Delay1MS(1);
 440   6                                                      RSMRST_HI();
 441   6                                              }
 442   5                                      }
 443   4                              }
 444   3                              else
 445   3                              {
 446   4                                      VGA_TEMP = BsData;
 447   4                                      VGAErrCnt = 00;         // Clear error count.
 448   4                                      CLEAR_MASK(ERR_THMSTS,b1VGATempEr);     // Clear bit1,bit5.
 449   4      
 450   4                                      if ( IS_MASK_CLEAR(Fan_Debug_Temp,b1VGA_Temp) ) // Debug VGA Temperature, Engineer myself control.
 451   4                                      {
 452   5                                              if((VGA_TEMP&0x80)==0x80)//Filter the value of the GPU temperature greater than 128// optimize G69
 453   5                              {
 454   6                                      return;
 455   6                              }  
 456   5                                      else
 457   5                                              {
 458   6                                                      VGA_TBuff3 = VGA_TBuff2;
 459   6                                                      VGA_TBuff2 = VGA_TBuff1;
 460   6                                                      VGA_TBuff1 = VGA_TEMP;
 461   6                                                      VGA_TBuff3 = (VGA_TBuff1 + VGA_TBuff2 + VGA_TBuff3)/3;          // VGA average temperature.
 462   6                                              }
 463   5                                      }
 464   4                              }
 465   3                      }
 466   2              }
 467   1          
 468   1      }
 469          
 470          
 471          
 472          /*****************************************************************************/
 473          // Procedure: Oem_Thermal_Control                                                               TimeDiv: 1 Sec
 474          // Description: Read CPU temperature
 475          // GPIO: GPIOF6(118)
 476          // Referrals:
 477          /*****************************************************************************/
 478          void Oem_Thermal_Control(void)
 479          {
 480   1              //if(SystemIsS0&& (PwrOnDly5Sec==0)) //add PwrOnDly5Sec judge.
 481   1              //if(SystemIsS0&& (PwrOnDly5Sec==0)&&Read_SLPS3() && Read_SLPS4()&&(PECIBIOSTEST==0)) //add PwrOnDly5Sec 
             -judge.//owhen enter S3/S4/CB,BIOS sent B4 CMD to EC from 66port for peci fail.// Remove PECI workaround.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 9   

 482   1              if(SystemIsS0&& (PwrOnDly5Sec==0)&&Read_SLPS3() && Read_SLPS4())// PECI workaround.
 483   1              {
 484   2                      if(TJMAX == 0x00)
 485   2                      {
 486   3                              PECI_ReadCPUTJMAX();
 487   3                              CPU_TYPE = CPU_TYPE & 0xFC; //
 488   3                              if (TJMAX == 105)                       //105
 489   3                                      CPU_TYPE |= 0x03;
 490   3                              else if (TJMAX == 100)          //100
 491   3                                      CPU_TYPE |= 0x02;
 492   3                              else if (TJMAX == 90)           //90
 493   3                                      CPU_TYPE |= 0x01;
 494   3                      }
 495   2                      else
 496   2                      { PECI_ReadCPUTemp(); }
 497   2                      //Optimize read CPU temperature function.
 498   2                      if( IS_MASK_SET(ERR_THMSTS, b3PECITempEr) )
 499   2                      {
 500   3                              DTS_ReadCPUTemp();
 501   3                      }
 502   2                      //0ptimize read CPU temperature function.
 503   2              }
 504   1      }
 505          
 506          /*****************************************************************************/
 507          // Procedure: Oem_Fan_Speed                                                                             TimeDiv: 1 Sec
 508          // Description: Read Fan RPM
 509          // GPIO: GPIOD6(47)
 510          // Referrals:
 511          /*****************************************************************************/
 512          void Oem_Fan_Speed(void)
 513          {
 514   1              WORD Curr_Fan1Tachometer;
 515   1              if(SystemIsS0)
 516   1              {
 517   2                      if ( (F1TMRR == 0) && (F1TLRR == 0) )
 518   2                      {
 519   3                              nAtmFanSpeed = 0;
 520   3                      }
 521   2                      else
 522   2                      {
 523   3                              Curr_Fan1Tachometer = (36000/((WORD)(F1TMRR<<8) + F1TLRR))*60;
 524   3                              nAtmFanSpeed = ( Curr_Fan1Tachometer / 100 );
 525   3                  FAN1_RPM=Curr_Fan1Tachometer;  
 526   3                      }
 527   2                      
 528   2              }
 529   1      }
 530          //72JERRY014¡êoS+ Add the second fan method
 531          void Oem_Fan1_Speed(void)
 532          {
 533   1              WORD Curr_Fan2Tachometer;
 534   1              if(SystemIsS0)
 535   1              {
 536   2                      if ( (F2TMRR == 0) && (F2TLRR == 0) )
 537   2                      {
 538   3                              nAtmFan1Speed = 0;
 539   3                      }
 540   2                      else
 541   2                      {
 542   3                              Curr_Fan2Tachometer = (36000/((WORD)(F2TMRR<<8) + F2TLRR))*60;
 543   3                              nAtmFan1Speed = ( Curr_Fan2Tachometer / 100 );
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 10  

 544   3                  FAN2_RPM=Curr_Fan2Tachometer;  
 545   3                      }
 546   2                      
 547   2              }
 548   1      }
 549          
 550          const thermaltable code Fan1Step[]= //fan1 step
 551          {
 552                  {&Fan1On_Step1, &Fan1Off_Step1, &Fan1RPM_Step1  },      // Level 0      
 553              {&Fan1On_Step2,     &Fan1Off_Step2, &Fan1RPM_Step2  },      // Level 1 
 554              {&Fan1On_Step3,     &Fan1Off_Step3, &Fan1RPM_Step3  },      // Level 2      
 555              {&Fan1On_Step4,     &Fan1Off_Step4, &Fan1RPM_Step4  },      // Level 3      
 556              {&Fan1On_Step5,     &Fan1Off_Step5, &Fan1RPM_Step5  },      // Level 4  
 557              {&Fan1On_Step6,     &Fan1Off_Step6, &Fan1RPM_Step6  },      // Level 5  
 558              {&Fan1On_Step7,     &Fan1Off_Step7, &Fan1RPM_Step7  },      // Level 6 
 559          };
 560          const thermaltable code Fan2Step[]= //fan2 step
 561          {
 562              {&Fan2On_Step1,     &Fan2Off_Step1, &Fan2RPM_Step1  },      // Level 0      
 563              {&Fan2On_Step2,     &Fan2Off_Step2, &Fan2RPM_Step2  },      // Level 1 
 564              {&Fan2On_Step3,     &Fan2Off_Step3, &Fan2RPM_Step3  },      // Level 2      
 565              {&Fan2On_Step4,     &Fan2Off_Step4, &Fan2RPM_Step4  },      // Level 3      
 566              {&Fan2On_Step5,     &Fan2Off_Step5, &Fan2RPM_Step5  },      // Level 4  
 567              {&Fan2On_Step6,     &Fan2Off_Step6, &Fan2RPM_Step6  },      // Level 5  
 568              {&Fan2On_Step7,     &Fan2Off_Step7, &Fan2RPM_Step7  },      // Level 6 
 569          };
 570          const thermal code Fan1Talbe1UMA[]= //UMA  FAN1_PWM 530  table1
 571          {
 572              {0, 42,     0,      0  },   // Level 0  on off rpm  
 573              {1, 48,     37,     22 },   // Level 1 
 574              {2, 56,     43,     31 },   // Level 2      
 575              {3, 63,     53,     35 },   // Level 3      
 576              {4, 69,     58,     35 },   // Level 4  
 577              {5, 75,     60,     35 },   // Level 5  
 578              {6, 85,     64,     35 },   // Level 6 
 579          };
 580          const thermal code Fan1Talbe2UMA[]= //UMA  FAN1_PWM 530  table2
 581          {
 582                  {0,     42,     0,      0       },      // Level 0      on off rpm      
 583              {1, 48,     37,     22      },      // Level 1 
 584              {2, 54,     43,     31      },      // Level 2      
 585              {3, 57,     49,     36      },      // Level 3      
 586              {4, 63,     53,     40      },      // Level 4  
 587              {5, 70,     58,     45      },      // Level 5  
 588              {6, 85,     65,     50      },      // Level 6 
 589          };
 590          const thermal code Fan1Talbe1DIS[]= //DIS 14''15" FAN1_PWM 530 High/balance
 591          {
 592                  {0, 44, 0,  0   },      // Level 0      
 593                  {1, 54, 37, 22  },      // Level 1 
 594                  {2, 59, 45, 27  },      // Level 2      
 595                  {3, 64, 56, 35  },      // Level 3      
 596                  {4, 70, 60, 35  },      // Level 4      
 597                  {5, 78, 68, 35  },      // Level 5      
 598                  {6, 85, 75, 35  },      // Level 6 
 599          };
 600          const thermal code Fan1Talbe2DIS_H[]= //DIS  FAN_PWM 530 table2 14" balance
 601          {
 602                  {0,     42,     0,      0       },      // Level 0      
 603              {1, 48,     37,     22      },      // Level 1 
 604              {2, 53,     43,     27      },      // Level 2      
 605              {3, 57,     49,     35      },      // Level 3      
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 11  

 606              {4, 95,     54,     39      },      // Level 4  
 607              {5, 98,     92,     46      },      // Level 5  
 608              {6, 99,     96,     51      },      // Level 6 
 609          };
 610          const thermal code Fan1Talbe2DIS_B[]= //DIS  FAN_PWM 530 table 2 15" balance
 611          {
 612                  {0,     42,     0,      0       },      // Level 0      
 613              {1, 48,     37,     22      },      // Level 1 
 614              {2, 54,     43,     27      },      // Level 2      
 615              {3, 58,     49,     35      },      // Level 3      
 616              {4, 95,     55,     39      },      // Level 4  
 617              {5, 98,     92,     46      },      // Level 5  
 618              {6, 99,     96,     51      },      // Level 6 
 619          };
 620          const thermal code Fan2Talbe1DIS[]=  //DIS  FAN_PWM 530  FAN2 TABLE1 14''15'' High/balance
 621          {
 622                  {0, 44, 0,  0   },      // Level 0      
 623                  {1, 54, 37, 22  },      // Level 1 
 624                  {2, 59, 45, 31  },      // Level 2      
 625                  {3, 63, 56, 32  },      // Level 3      
 626                  {4, 69, 58, 32  },      // Level 4      
 627                  {5, 75, 64, 32  },      // Level 5      
 628                  {6, 85, 70, 32  },      // Level 6 
 629          };
 630          const thermal code  Fan2Talbe2DIS_H[]=  //DIS  FAN_PWM 530 14'' fan2 table 2 high
 631          {
 632              {0, 42,     0,      0       },      // Level 0      
 633              {1, 48,     37,     22      },      // Level 1 
 634              {2, 53,     43,     31      },      // Level 2      
 635              {3, 57,     49,     32      },      // Level 3      
 636              {4, 61,     54,     36      },      // Level 4  
 637              {5, 65,     58,     43      },      // Level 5  
 638              {6, 85,     62,     48      },      // Level 6  
 639          };
 640          const thermal code  Fan2Talbe2DIS_B[]=  //DIS  FAN_PWM 530 FAN 2 15'' table 2 balance
 641          {
 642              {0, 42,     0,      0       },      // Level 0      
 643              {1, 48,     37,     22      },      // Level 1 
 644              {2, 54,     43,     31      },      // Level 2      
 645              {3, 58,     49,     32      },      // Level 3      
 646              {4, 61,     55,     36      },      // Level 4  
 647              {5, 72,     59,     43      },      // Level 5  
 648              {6, 85,     67,     48      },      // Level 6  
 649          };
 650          const thermal code Fan1Talbe1UMAYOGA[]= //UMA  FAN_PWM YOGA530
 651          {
 652              {0, 42,     33,     0       },      // Level 0      
 653              {1, 47,     38,     26      },      // Level 1 
 654              {2, 52,     43,     31      },      // Level 2      
 655              {3, 63,     48,     35      },      // Level 3      
 656              {4, 127,60, 38      },      // Level 4  
 657              {5, 127,60, 38      },      // Level 5  
 658              {6, 127,60, 38      },      // Level 6 
 659          };
 660          const thermal code Fan1Talbe2UMAYOGA[]= //UMA  FAN_PWM YOGA530
 661          {
 662                  {0,     40,     33,     0       },      // Level 0      
 663              {1, 45,     35,     31      },      // Level 1 
 664              {2, 50,     40,     35      },      // Level 2      
 665              {3, 56, 46, 39      },      // Level 3      
 666              {4, 62,     52,     44      },      // Level 4  
 667              {5, 62, 58, 50      },      // Level 5  
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 12  

 668              {6, 127,58, 50      },      // Level 6 
 669          };
 670          const thermal code Fan1Talbe2QUMAYOGA[]= //UMA  FAN_PWM YOGA530
 671          {
 672                  {0,     40,     33,     0       },      // Level 0      
 673              {1, 45,     35,     25      },      // Level 1 
 674              {2, 50,     40,     31      },      // Level 2      
 675              {3, 56, 46, 35      },      // Level 3      
 676              {4, 62,     52,     42      },      // Level 4  
 677              {5, 62, 58, 42      },      // Level 5  
 678              {6, 127,58, 42      },      // Level 6 
 679          };
 680          const thermal code Fan1Talbe1DISYOGA[]= //DIS FAN_PWM YOGA530
 681          {
 682              {0, 40,     33,     0       },      // Level 0      
 683              {1, 44,     37,     24      },      // Level 1 
 684              {2, 48,     41,     29      },      // Level 2      
 685              {3, 127,45, 33      },      // Level 3      
 686              {4, 127,60, 33      },      // Level 4  
 687              {5, 127,60, 33      },      // Level 5  
 688              {6, 127,60, 33      },      // Level 6 
 689          };
 690          const thermal code Fan1Talbe2DISYOGA[]= //DIS  FAN_PWM YOGA530
 691          {
 692                  {0,     38,     33,     0       },      // Level 0      
 693              {1, 42,     35,     29      },      // Level 1 
 694              {2, 46,     39,     33      },      // Level 2      
 695              {3, 50,     43,     36      },      // Level 3      
 696              {4, 58,     47,     41      },      // Level 4  
 697              {5, 68,     52,     48      },      // Level 5  
 698              {6, 127,62, 51      },      // Level 6 
 699          };
 700          
 701          const thermal code Fan1Talbe2QDISYOGA[]= //DIS  FAN_PWM YOGA530
 702          {
 703                  {0,     38,     33,     0       },      // Level 0      
 704              {1, 42,     35,     29      },      // Level 1 
 705              {2, 46,     39,     33      },      // Level 2      
 706              {3, 50,     43,     36      },      // Level 3      
 707              {4, 58,     47,     40      },      // Level 4  
 708              {5, 68,     52,     40      },      // Level 5  
 709              {6, 127,62, 40      },      // Level 6 
 710          };
 711          
 712          const thermal code Fan2Talbe1DISYOGA[]=  //DIS  FAN_PWM YOGA530
 713          {
 714              {0, 40,     33,     0       },      // Level 0      
 715              {1, 44,     37,     24      },      // Level 1 
 716              {2, 48,     41,     28      },      // Level 2      
 717              {3, 127,45, 30      },      // Level 3      
 718              {4, 127,60, 30      },      // Level 4  
 719              {5, 127,60, 30      },      // Level 5  
 720              {6, 127,60, 30      },      // Level 6 
 721          };
 722          const thermal code  Fan2Talbe2DISYOGA[]=  //DIS  FAN_PWM YOGA530
 723          {
 724              {0, 38,     33,     0       },      // Level 0      
 725              {1, 42, 35, 28      },      // Level 1 
 726              {2, 46,     39,     33      },      // Level 2      
 727              {3, 50,     43,     35      },      // Level 3      
 728              {4, 58,     47,     38      },      // Level 4  
 729              {5, 68,     52,     45      },      // Level 5  
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 13  

 730              {6, 127,62, 51      },      // Level 6  
 731          };
 732          const thermal code  Fan2Talbe2QDISYOGA[]=  //DIS  FAN_PWM YOGA530
 733          {
 734              {0, 38,     33,     0       },      // Level 0      
 735              {1, 42, 35, 28      },      // Level 1 
 736              {2, 46,     39,     30      },      // Level 2      
 737              {3, 50,     43,     35      },      // Level 3      
 738              {4, 58,     47,     38      },      // Level 4  
 739              {5, 68,     52,     38      },      // Level 5  
 740              {6, 127,62, 38      },      // Level 6  
 741          };
 742          
 743          //-----------------------------------------------------------------------------
 744          // Init. thermal fan 1
 745          //-----------------------------------------------------------------------------
 746          void InitThermalTable1(void)
 747          {
 748   1              BYTE index;
 749   1              index=0x00;
 750   1              if(ThermalMode == ThermalMode_BALANCE)
 751   1              {
 752   2                      QuiteMode = 0;
 753   2                      HighPerf = 0;
 754   2              }
 755   1              else if(ThermalMode == ThermalMode_QUIET)
 756   1              {
 757   2                      QuiteMode = 1;
 758   2                      HighPerf = 0;
 759   2              }
 760   1              else if(ThermalMode == ThermalMode_HIGHP)
 761   1              {
 762   2                      QuiteMode = 0;
 763   2                      HighPerf = 1;
 764   2              }
 765   1              
 766   1              if(Read_YOGA_ID())//yoga
 767   1              {
 768   2                      if(!FanTable_Type) //TABLE1
 769   2                      {
 770   3                              if(uMBGPU&0x02)//DIS
 771   3                              {
 772   4                                      if(nRamTemp>=48)
 773   4                                              FanTable_Type=1;
 774   4                              }
 775   3                              else  //UMA
 776   3                              {
 777   4                                      if(nRamTemp>=51)
 778   4                                              FanTable_Type=1;
 779   4                              }
 780   3                      } 
 781   2                      else //TABLE2
 782   2                      {
 783   3                              if(uMBGPU&0x02)//DIS
 784   3                              {
 785   4                                      if(nRamTemp<=45)
 786   4                                              FanTable_Type=0;
 787   4                              }
 788   3                              else  //UMA
 789   3                              {
 790   4                                      if(nRamTemp<=48)
 791   4                                              FanTable_Type=0;
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 14  

 792   4                              }
 793   3                      }
 794   2                      if(uMBGPU&0x02)//yoga DIS
 795   2                      {
 796   3                              if(!FanTable_Type)
 797   3                              {       
 798   4                                      while(index<(sizeof(Fan1Talbe1DISYOGA)/sizeof(thermal)))
 799   4                                      {
 800   5                                              *Fan1Step[index].FanOn=Fan1Talbe1DISYOGA[index].CFanOn;
 801   5                                              *Fan1Step[index].FanOff=Fan1Talbe1DISYOGA[index].CFanOff;
 802   5                                              *Fan1Step[index].RPM=Fan1Talbe1DISYOGA[index].CRPM;
 803   5                                              index++;
 804   5                                      }
 805   4                              }
 806   3                              else
 807   3                              {
 808   4                                      if(QuiteMode)
 809   4                                      {
 810   5                                              while(index<(sizeof(Fan1Talbe2QDISYOGA)/sizeof(thermal)))
 811   5                                              {
 812   6                                                      *Fan1Step[index].FanOn=Fan1Talbe2QDISYOGA[index].CFanOn;
 813   6                                                      *Fan1Step[index].FanOff=Fan1Talbe2QDISYOGA[index].CFanOff;
 814   6                                                      *Fan1Step[index].RPM=Fan1Talbe2QDISYOGA[index].CRPM;
 815   6                                                      index++;
 816   6                                              }
 817   5                                      }
 818   4                                      else
 819   4                                      {
 820   5                                              while(index<(sizeof(Fan1Talbe2DISYOGA)/sizeof(thermal)))
 821   5                                              {
 822   6                                                      *Fan1Step[index].FanOn=Fan1Talbe2DISYOGA[index].CFanOn;
 823   6                                                      *Fan1Step[index].FanOff=Fan1Talbe2DISYOGA[index].CFanOff;
 824   6                                                      *Fan1Step[index].RPM=Fan1Talbe2DISYOGA[index].CRPM;
 825   6                                                      index++;
 826   6                                              }
 827   5                                      }
 828   4                              }
 829   3                      }
 830   2                      else //yoga UMA
 831   2                      {
 832   3                              if(!FanTable_Type)
 833   3                              {
 834   4                                      while(index<(sizeof(Fan1Talbe1UMAYOGA)/sizeof(thermal)))
 835   4                                      {
 836   5                                              *Fan1Step[index].FanOn=Fan1Talbe1UMAYOGA[index].CFanOn;
 837   5                                              *Fan1Step[index].FanOff=Fan1Talbe1UMAYOGA[index].CFanOff;
 838   5                                              *Fan1Step[index].RPM=Fan1Talbe1UMAYOGA[index].CRPM;
 839   5                                              index++;
 840   5                                      }
 841   4                              }
 842   3                              else
 843   3                              {
 844   4                                      if(QuiteMode)
 845   4                                      {
 846   5                                              while(index<(sizeof(Fan1Talbe2QUMAYOGA)/sizeof(thermal)))
 847   5                                              {
 848   6                                                      *Fan1Step[index].FanOn=Fan1Talbe2QUMAYOGA[index].CFanOn;
 849   6                                                      *Fan1Step[index].FanOff=Fan1Talbe2QUMAYOGA[index].CFanOff;
 850   6                                                      *Fan1Step[index].RPM=Fan1Talbe2QUMAYOGA[index].CRPM;
 851   6                                                      index++;
 852   6                                              }
 853   5                                      }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 15  

 854   4                                      else
 855   4                                      {
 856   5                                              while(index<(sizeof(Fan1Talbe2UMAYOGA)/sizeof(thermal)))
 857   5                                              {
 858   6                                                      *Fan1Step[index].FanOn=Fan1Talbe2UMAYOGA[index].CFanOn;
 859   6                                                      *Fan1Step[index].FanOff=Fan1Talbe2UMAYOGA[index].CFanOff;
 860   6                                                      *Fan1Step[index].RPM=Fan1Talbe2UMAYOGA[index].CRPM;
 861   6                                                      index++;
 862   6                                              }
 863   5                                      }
 864   4                              }
 865   3                      }
 866   2              }
 867   1              else //530
 868   1              {
 869   2                      if(!FanTable_Type) //TABLE1
 870   2                      {
 871   3                              if(nRamTemp>=50)
 872   3                                      FanTable_Type=1;
 873   3                      }
 874   2                      else //TABLE2
 875   2                      {
 876   3                              if(nRamTemp<=45)
 877   3                                      FanTable_Type=0;
 878   3                      }
 879   2                      
 880   2                      if(uMBGPU&0x02)//530 DIS
 881   2                      {
 882   3                              if(!FanTable_Type)        // table1  fan1 14''15" High/balance mode
 883   3                              {
 884   4                                      while(index<(sizeof(Fan1Talbe1DIS)/sizeof(thermal)))
 885   4                                      {
 886   5                                              *Fan1Step[index].FanOn=Fan1Talbe1DIS[index].CFanOn;
 887   5                                              *Fan1Step[index].FanOff=Fan1Talbe1DIS[index].CFanOff;
 888   5                                              *Fan1Step[index].RPM=Fan1Talbe1DIS[index].CRPM;
 889   5                                              index++;
 890   5                                      }
 891   4                              }
 892   3                              else //table 2
 893   3                              {
 894   4                                      if(HighPerf)  //14''15'' table 2  high mode
 895   4                                      {
 896   5                                              while(index<(sizeof(Fan1Talbe2DIS_H)/sizeof(thermal)))
 897   5                                              {
 898   6                                                              *Fan1Step[index].FanOn=Fan1Talbe2DIS_H[index].CFanOn;
 899   6                                                              *Fan1Step[index].FanOff=Fan1Talbe2DIS_H[index].CFanOff;
 900   6                                                              *Fan1Step[index].RPM=Fan1Talbe2DIS_H[index].CRPM;
 901   6                                                              index++;
 902   6                                              }
 903   5                                      }
 904   4                                      else      //14''15'' table 2  Balance
 905   4                                      {
 906   5                                              while(index<(sizeof(Fan1Talbe2DIS_B)/sizeof(thermal)))
 907   5                                              {
 908   6                                                      *Fan1Step[index].FanOn=Fan1Talbe2DIS_B[index].CFanOn;
 909   6                                                      *Fan1Step[index].FanOff=Fan1Talbe2DIS_B[index].CFanOff;
 910   6                                                      *Fan1Step[index].RPM=Fan1Talbe2DIS_B[index].CRPM;
 911   6                                                      index++;
 912   6                                              }
 913   5                                      }
 914   4                              }
 915   3                              
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 16  

 916   3                      }
 917   2                      else //530 UMA
 918   2                      {
 919   3                              if(!FanTable_Type)   //table 1
 920   3                              {
 921   4                                      while(index<(sizeof(Fan1Talbe1UMA)/sizeof(thermal)))
 922   4                                      {
 923   5                                              *Fan1Step[index].FanOn=Fan1Talbe1UMA[index].CFanOn;
 924   5                                              *Fan1Step[index].FanOff=Fan1Talbe1UMA[index].CFanOff;
 925   5                                              *Fan1Step[index].RPM=Fan1Talbe1UMA[index].CRPM;
 926   5                                              index++;
 927   5                                      }
 928   4                              }
 929   3                              else                            
 930   3                              {
 931   4                                      while(index<(sizeof(Fan1Talbe2UMA)/sizeof(thermal)))   //table 2
 932   4                                      {
 933   5                                              *Fan1Step[index].FanOn=Fan1Talbe2UMA[index].CFanOn;
 934   5                                              *Fan1Step[index].FanOff=Fan1Talbe2UMA[index].CFanOff;
 935   5                                              *Fan1Step[index].RPM=Fan1Talbe2UMA[index].CRPM;
 936   5                                              index++;
 937   5                                      }
 938   4                              }
 939   3                      }
 940   2              }
 941   1      }
 942          //-----------------------------------------------------------------------------
 943          // Init. thermal fan 2
 944          //-----------------------------------------------------------------------------
 945          void InitThermalTable2(void)
 946          {
 947   1              BYTE index;
 948   1              index=0x00;
 949   1              if(Read_YOGA_ID())
 950   1              {
 951   2                      if(!FanTable_Type)//TABLE1
 952   2                      {
 953   3                              while(index<(sizeof(Fan2Talbe1DISYOGA)/sizeof(thermal)))
 954   3                              {
 955   4                                      *Fan2Step[index].FanOn=Fan2Talbe1DISYOGA[index].CFanOn;
 956   4                                  *Fan2Step[index].FanOff=Fan2Talbe1DISYOGA[index].CFanOff;
 957   4                                  *Fan2Step[index].RPM=Fan2Talbe1DISYOGA[index].CRPM;
 958   4                                  index++;
 959   4                              }
 960   3                      }
 961   2                      else//TABLE2
 962   2                      {
 963   3                              if(QuiteMode)
 964   3                              {
 965   4                                      while(index<(sizeof(Fan2Talbe2QDISYOGA)/sizeof(thermal)))
 966   4                                      {
 967   5                                              *Fan2Step[index].FanOn=Fan2Talbe2QDISYOGA[index].CFanOn;
 968   5                                              *Fan2Step[index].FanOff=Fan2Talbe2QDISYOGA[index].CFanOff;
 969   5                                              *Fan2Step[index].RPM=Fan2Talbe2QDISYOGA[index].CRPM;
 970   5                                              index++;
 971   5                                      }
 972   4                              }
 973   3                              else
 974   3                              {
 975   4                                      while(index<(sizeof(Fan2Talbe2DISYOGA)/sizeof(thermal)))
 976   4                                      {
 977   5                                              *Fan2Step[index].FanOn=Fan2Talbe2DISYOGA[index].CFanOn;
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 17  

 978   5                                              *Fan2Step[index].FanOff=Fan2Talbe2DISYOGA[index].CFanOff;
 979   5                                              *Fan2Step[index].RPM=Fan2Talbe2DISYOGA[index].CRPM;
 980   5                                              index++;
 981   5                                      }
 982   4                              }
 983   3                      }       
 984   2              }
 985   1              else//530
 986   1              {
 987   2                      if(!FanTable_Type)//TABLE 1 DIS fan2 14''15'' high/balance
 988   2                      {                 
 989   3                              while(index<(sizeof(Fan2Talbe1DIS)/sizeof(thermal)))
 990   3                                      {
 991   4                                              *Fan2Step[index].FanOn=Fan2Talbe1DIS[index].CFanOn;
 992   4                                              *Fan2Step[index].FanOff=Fan2Talbe1DIS[index].CFanOff;
 993   4                                          *Fan2Step[index].RPM=Fan2Talbe1DIS[index].CRPM;
 994   4                                              index++;
 995   4                                      }
 996   3                      }
 997   2                      else//TABLE2
 998   2                      {
 999   3                              if(HighPerf)
1000   3                              {
1001   4                                      while(index<(sizeof(Fan2Talbe2DIS_H)/sizeof(thermal)))
1002   4                                      {
1003   5                                              *Fan2Step[index].FanOn=Fan2Talbe2DIS_H[index].CFanOn;
1004   5                                              *Fan2Step[index].FanOff=Fan2Talbe2DIS_H[index].CFanOff;
1005   5                                              *Fan2Step[index].RPM=Fan2Talbe2DIS_H[index].CRPM;
1006   5                                              index++;
1007   5                                      }
1008   4                              }
1009   3                              else
1010   3                              {
1011   4                                      while(index<(sizeof(Fan2Talbe2DIS_B)/sizeof(thermal)))
1012   4                                      {
1013   5                                              *Fan2Step[index].FanOn=Fan2Talbe2DIS_B[index].CFanOn;
1014   5                                              *Fan2Step[index].FanOff=Fan2Talbe2DIS_B[index].CFanOff;
1015   5                                              *Fan2Step[index].RPM=Fan2Talbe2DIS_B[index].CRPM;
1016   5                                              index++;
1017   5                                      }
1018   4                              }
1019   3                      }       
1020   2              }
1021   1      }
1022          
1023          void Check_FANRPM_Count(BYTE *BRPM_Cnt, BYTE TempType)
1024          {
1025   1              if ( *BRPM_Cnt >= 10 )
1026   1              {
1027   2                      if ( TempType == TEMP_TYPE_FAN1RPM )
1028   2                      { 
1029   3                              Fan1RPM_Target= Fan1RPM_TargetBackUp; 
1030   3                      }       
1031   2                      else if( TempType == TEMP_TYPE_FAN2RPM ) 
1032   2                      { 
1033   3                              Fan2RPM_Target = Fan2RPM_TargetBackUp;
1034   3                      }       
1035   2      
1036   2                      *BRPM_Cnt = 0;
1037   2              }
1038   1              else
1039   1              { (*BRPM_Cnt)++; }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 18  

1040   1      }
1041          void CheckFanRPM1(void)
1042          {
1043   1              BYTE FanLevel_tcpu = Fan1Level;
1044   1      
1045   1      // check CPU fan table2:                
1046   1              if(FanLevel_tcpu <((sizeof(Fan1Step)/sizeof(thermal))-1))
1047   1              {
1048   2                      if(Average_Temp>=*Fan1Step[FanLevel_tcpu].FanOn)
1049   2                      {
1050   3                              FanLevel_tcpu+= 1;
1051   3                      }
1052   2              }
1053   1              
1054   1              if (FanLevel_tcpu>0)
1055   1              {
1056   2                      if (Average_Temp< *Fan1Step[FanLevel_tcpu].FanOff)
1057   2                      {                       
1058   3                              FanLevel_tcpu-=1;
1059   3                      }
1060   2              }
1061   1      
1062   1              Fan1Level = FanLevel_tcpu;
1063   1              Fan1RPMTemp =*Fan1Step[FanLevel_tcpu].RPM; 
1064   1      
1065   1              
1066   1          if(Fan1RPMTemp == Fan1RPM_TargetBackUp)  
1067   1          {
1068   2                  Check_FANRPM_Count(&Fan1RPMCount,TEMP_TYPE_FAN1RPM); 
1069   2          }
1070   1              else
1071   1              {
1072   2                 Fan1RPM_TargetBackUp = Fan1RPMTemp; 
1073   2                 Fan1RPMCount = 0x00;
1074   2              }
1075   1      }
1076          
1077          void CheckFanRPM2(void)
1078          {
1079   1              BYTE FanLevel_tcpu = Fan2Level;
1080   1      
1081   1      // check GPU fan table2:                
1082   1              if(FanLevel_tcpu <((sizeof(Fan2Step)/sizeof(thermal))-1))
1083   1              {
1084   2                      if(Average_Temp>=*Fan2Step[FanLevel_tcpu].FanOn)
1085   2                      {
1086   3                              FanLevel_tcpu+= 1;
1087   3                      }
1088   2              }
1089   1              
1090   1              if (FanLevel_tcpu>0)
1091   1              {
1092   2                      if (Average_Temp< *Fan2Step[FanLevel_tcpu].FanOff)
1093   2                      {                       
1094   3                              FanLevel_tcpu-=1;
1095   3                      }
1096   2              }
1097   1      
1098   1              Fan2Level = FanLevel_tcpu;
1099   1              Fan2RPMTemp =*Fan2Step[FanLevel_tcpu].RPM; 
1100   1      
1101   1              
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 19  

1102   1          if(Fan2RPMTemp == Fan2RPM_TargetBackUp)  
1103   1          {
1104   2                  Check_FANRPM_Count(&Fan2RPMCount,TEMP_TYPE_FAN2RPM); 
1105   2          }
1106   1              else
1107   1              {
1108   2                 Fan2RPM_TargetBackUp = Fan2RPMTemp; 
1109   2                 Fan2RPMCount = 0x00;
1110   2              }
1111   1      
1112   1      
1113   1      }
1114          
1115          void CheckFan1Level(void)
1116          {
1117   1              BYTE FanLevel_tcpu = Fan1Level;
1118   1      
1119   1      // check CPU fan table2:                
1120   1              if(FanLevel_tcpu <((sizeof(Fan1Step)/sizeof(thermal))-1))
1121   1              {
1122   2                      if(TEMP_Buff_3>=*Fan1Step[FanLevel_tcpu].FanOn)
1123   2                      {
1124   3                              FanLevel_tcpu+= 1;
1125   3                      }
1126   2              }
1127   1              
1128   1              if (FanLevel_tcpu>0)
1129   1              {
1130   2                      if (TEMP_Buff_3< *Fan1Step[FanLevel_tcpu].FanOff)
1131   2                      {                       
1132   3                              FanLevel_tcpu-=1;
1133   3                      }
1134   2              }
1135   1              Fan1Level = FanLevel_tcpu;
1136   1      }
1137          
1138          void CheckFan2Level(void)
1139          {
1140   1              BYTE FanLevel_tcpu = Fan2Level;
1141   1      
1142   1      // check GPU fan table2:                
1143   1              if(FanLevel_tcpu <((sizeof(Fan2Step)/sizeof(thermal))-1))
1144   1              {
1145   2                      if(VGA_TBuff3>=*Fan2Step[FanLevel_tcpu].FanOn)
1146   2                      {
1147   3                              FanLevel_tcpu+= 1;
1148   3                      }
1149   2              }
1150   1              
1151   1              if (FanLevel_tcpu>0)
1152   1              {
1153   2                      if (VGA_TBuff3< *Fan2Step[FanLevel_tcpu].FanOff)
1154   2                      {                       
1155   3                              FanLevel_tcpu-=1;
1156   3                      }
1157   2              }
1158   1              Fan2Level = FanLevel_tcpu;
1159   1      }
1160          
1161          void  CheckFanLevel(void)
1162          {
1163   1              if (Fan1Level>=Fan2Level)
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 20  

1164   1              {
1165   2                      FanLevel=Fan1Level;
1166   2              }
1167   1              else
1168   1              {
1169   2                      FanLevel=Fan2Level;
1170   2              }
1171   1      }
1172          
1173          void  CheckFan1RPM(void)
1174          {
1175   1              Fan1RPMTemp =*Fan1Step[FanLevel].RPM; 
1176   1              
1177   1          if(Fan1RPMTemp == Fan1RPM_TargetBackUp)  
1178   1          {
1179   2                      Check_FANRPM_Count(&Fan1RPMCount,TEMP_TYPE_FAN1RPM); 
1180   2          }
1181   1              else
1182   1              {
1183   2                 Fan1RPM_TargetBackUp = Fan1RPMTemp; 
1184   2                 Fan1RPMCount = 0x00;
1185   2              }
1186   1      }
1187          
1188          void  CheckFan2RPM(void)
1189          {
1190   1              Fan2RPMTemp =*Fan2Step[FanLevel].RPM; 
1191   1              if(Fan2RPMTemp == Fan2RPM_TargetBackUp)  
1192   1              {
1193   2                      Check_FANRPM_Count(&Fan2RPMCount,TEMP_TYPE_FAN2RPM); 
1194   2              }
1195   1              else
1196   1              {
1197   2                      Fan2RPM_TargetBackUp = Fan2RPMTemp; 
1198   2                      Fan2RPMCount = 0x00;
1199   2              }
1200   1      }
1201          
1202          
1203          void Fan1MainControl(void)
1204          {
1205   1              if ( FAN1Count >= 0 )   // 100ms*20=2s
1206   1              {
1207   2                      if(((Fan1RPM_Target*100)-50)>FAN1_RPM)
1208   2                      {
1209   3                              if(FAN_PWM<FAN_PWM_Max)
1210   3                              FAN_PWM++;      
1211   3                      }
1212   2                      else if(((Fan1RPM_Target*100)+50)<FAN1_RPM)
1213   2                      {
1214   3                              if(FAN_PWM>0x00)
1215   3                              FAN_PWM--;      
1216   3                      }       
1217   2      
1218   2                      FAN1Count = 0;
1219   2              }
1220   1              else
1221   1              { (FAN1Count )++; }             
1222   1              
1223   1      }
1224          void Fan2MainControl(void)
1225          {
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 21  

1226   1              if ( FAN2Count  >= 0 )  // 100ms*20=2s
1227   1              {
1228   2                      if(((Fan2RPM_Target*100)-50)>FAN2_RPM)
1229   2                      {
1230   3                              if(FAN1_PWM<FAN_PWM_Max)
1231   3                              FAN1_PWM++;     
1232   3                      }
1233   2                      else if(((Fan2RPM_Target*100)+50)<FAN2_RPM)
1234   2                      {
1235   3                              if(FAN1_PWM>0x00)
1236   3                              FAN1_PWM--;     
1237   3                      }
1238   2      
1239   2                      FAN2Count = 0;
1240   2              }
1241   1              else
1242   1              { (FAN2Count)++; }      
1243   1      }
1244          
1245          void Oem_Fan_Control(void)
1246          {
1247   1              FAN_PWM_ALT;            // Defind PWM is Alt.
1248   1              InitThermalTable1();
1249   1              // Check ISCT status.
1250   1              if ( IS_MASK_SET(uISCT, b4ISCT_FanDis) )        // Check ISCT Fan is status.
1251   1              {
1252   2                      FAN_PWM = Target_Duty = 0;      // Turn off FAN.
1253   2                      FAN1_RPM=0x00;
1254   2                      return;
1255   2              }
1256   1              if ( (IS_MASK_SET(ERR_THMSTS, b1VGATempEr)) ||
1257   1                      (IS_MASK_SET(Thro_Status2, b4FAN1_FullOn)) )  // Optimize read CPU temperature functio
1258   1              {
1259   2                      FAN_PWM = Target_Duty = FAN_PWM_Max;    // Fan turn on max.
1260   2                      return;
1261   2              }
1262   1              
1263   1              //Add workaround keep fan speed 50 duty under DOS when peci fail.
1264   1              if( IS_MASK_SET(ERR_THMSTS, b3PECITempEr)&&((SYS_STATUS & 0x07) == 0 ))
1265   1              {
1266   2                      FAN_PWM = Target_Duty = FAN_PWM_Min4;   // 50% duty
1267   2                      return;
1268   2              }
1269   1              //Add workaround keep fan speed 50 duty under DOS when peci fail.
1270   1      
1271   1              if ( Fan_ON_Count != 0 )                                        // Turn on Fan x sec.
1272   1              {
1273   2                      Fan_ON_Count--;
1274   2                      FAN_PWM = Target_Duty = FAN_PWM_Min;    // PWM min. 30%
1275   2                      return;
1276   2              }
1277   1      
1278   1              if( SystemNotS0 )       // Not S0 status.
1279   1              {
1280   2                      FAN_PWM = Target_Duty = 0;      // Turn off FAN.
1281   2                      FAN1_RPM=0x00;
1282   2                      return;
1283   2              }
1284   1      
1285   1              if(Read_YOGA_ID()) //yoga 
1286   1              {
1287   2                      if ( TEMP_Buff_3 >= VGA_TBuff3 )
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 22  

1288   2                      {       // CPU > GPU
1289   3                              Average_Temp = TEMP_Buff_3;
1290   3                      }
1291   2                      else
1292   2                      {       // GPU > CPU
1293   3                              Average_Temp = VGA_TBuff3;
1294   3                      }
1295   2      
1296   2                      if( Average_Temp <= Fan1Off_Step1)      //T105+
1297   2                      {
1298   3                              FAN_PWM = Target_Duty = 0;      // Turn off FAN.
1299   3                              FAN1_RPM=0x00;
1300   3                              return;
1301   3                      }       
1302   2      
1303   2                      if ( Average_Temp >= Fan1Off_Step1)  //T105+
1304   2                      {
1305   3                              if ( Average_Temp < Fan1On_Step1)  // change 0 to BTStepTemp//4 to 0
1306   3                              {
1307   4                                      if ( FAN_PWM != 0 )
1308   4                                      { 
1309   5                                              FAN_PWM = Target_Duty = Fan1RPM_Step1; //LMLKBL0004:add.  
1310   5                                      }       // PWM min. 30%
1311   4                                      else
1312   4                                      { 
1313   5                                              FAN_PWM = Target_Duty = 0; // turn off fan.
1314   5                                              FAN1_RPM=0x00; //ANGELAS076:add 
1315   5                                      }                               
1316   4                                      return;
1317   4                              }
1318   3                      }
1319   2                      CheckFanRPM1();
1320   2              }
1321   1              
1322   1              else   //530s
1323   1              {
1324   2                      if ( TEMP_Buff_3 >= VGA_TBuff3 )
1325   2                      {       // CPU > GPU
1326   3                              Average_Temp = TEMP_Buff_3;
1327   3                      }
1328   2                      else
1329   2                      {       // GPU > CPU
1330   3                              Average_Temp = VGA_TBuff3;
1331   3                      }
1332   2                      
1333   2                      if( Average_Temp <= Fan1Off_Step2)      //T105+
1334   2                      {
1335   3                              FAN_PWM = Target_Duty = 0;      // Turn off FAN.
1336   3                              FAN1_RPM=0x00;
1337   3                              return;
1338   3                      }       
1339   2      
1340   2                      if ( Average_Temp >= Fan1Off_Step2)  //T105+
1341   2                      {
1342   3                              if ( Average_Temp < Fan1On_Step1)  // change 0 to BTStepTemp//4 to 0
1343   3                              {
1344   4                                      if ( FAN_PWM != 0 )
1345   4                                      { 
1346   5                                              FAN_PWM = Target_Duty = 0x2E; //LMLKBL0004:add.
1347   5                                      }       // PWM min. 30%
1348   4                                      else
1349   4                                      { 
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 23  

1350   5                                              FAN_PWM = Target_Duty = 0; // turn off fan.
1351   5                                              FAN1_RPM=0x00; //ANGELAS076:add 
1352   5                                      }                               
1353   4                                      return;
1354   4                              }
1355   3                      }
1356   2                      CheckFan1Level();
1357   2                      CheckFan2Level();
1358   2                      CheckFanLevel();
1359   2                      CheckFan1RPM();
1360   2              }
1361   1              
1362   1              Fan1MainControl();                         
1363   1      }
1364          //72JERRY033: Modify fan table follow '720S_13IKB fan table_V01'.
1365          //72JERRY014¡êoS+ Add the second fan method
1366          //72JERRY078:Update fan table follow'720S_13IKB fan table_V07'. 
1367          void Oem_Fan1_Control(void)
1368          {
1369   1              FAN1_PWM_ALT;           // Defind PWM is Alt.
1370   1              InitThermalTable2();
1371   1              // Check ISCT status.
1372   1              if ( IS_MASK_SET(uISCT, b4ISCT_FanDis) )        // Check ISCT Fan is status.
1373   1              {
1374   2                      FAN1_PWM = Target_Duty = 0;     // Turn off FAN.
1375   2                      FAN2_RPM=0x00;
1376   2                      return;
1377   2              }
1378   1              
1379   1              if ( (IS_MASK_SET(ERR_THMSTS, b1VGATempEr)) ||
1380   1                      (IS_MASK_SET(Thro_Status2, b4FAN1_FullOn)) )  // Optimize read CPU temperature functio
1381   1              {
1382   2                      FAN1_PWM = Target_Duty = FAN_PWM_Max;   // Fan turn on max.
1383   2                      return;
1384   2              }
1385   1              
1386   1              //Add workaround keep fan speed 50 duty under DOS when peci fail.
1387   1              if( IS_MASK_SET(ERR_THMSTS, b3PECITempEr)&&((SYS_STATUS & 0x07) == 0 ))
1388   1              {
1389   2                      FAN1_PWM = Target_Duty = FAN_PWM_Min4;  // 50% duty
1390   2                      return;
1391   2              }
1392   1              //Add workaround keep fan speed 50 duty under DOS when peci fail.
1393   1      
1394   1              if ( Fan_ON_Count != 0 )                                        // Turn on Fan x sec.
1395   1              {
1396   2                      Fan_ON_Count--;
1397   2                      FAN1_PWM = Target_Duty = FAN_PWM_Min;   // PWM min. 30%
1398   2                      return;
1399   2              }
1400   1      
1401   1              if( SystemNotS0 )       // Not S0 status.
1402   1              {
1403   2                      FAN1_PWM = Target_Duty = 0;     // Turn off FAN.
1404   2                      FAN2_RPM=0x00;
1405   2                      return;
1406   2              }
1407   1      
1408   1              if(Read_YOGA_ID()) //yoga 
1409   1              {
1410   2                      if ( TEMP_Buff_3 >= VGA_TBuff3 )
1411   2                      {       // CPU > GPU
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 24  

1412   3                              Average_Temp = TEMP_Buff_3;
1413   3                      }
1414   2                      else
1415   2                      {       // GPU > CPU
1416   3                              Average_Temp = TEMP_Buff_3;
1417   3                      }
1418   2      
1419   2                      if( Average_Temp <= Fan2Off_Step1)      //T105+
1420   2                      {
1421   3                              FAN1_PWM = Target_Duty = 0;     // Turn off FAN.
1422   3                              FAN2_RPM=0x00;
1423   3                              return;
1424   3                      }       
1425   2      
1426   2                      if ( Average_Temp >= Fan2Off_Step1)  //T105+
1427   2                      {
1428   3                              if ( Average_Temp < Fan2On_Step1)  // change 0 to BTStepTemp//4 to 0
1429   3                              {
1430   4                                      if ( FAN1_PWM != 0 )
1431   4                                      { 
1432   5                                              FAN1_PWM = Target_Duty = Fan2RPM_Step1; //LMLKBL0004:add.  
1433   5                                      }       // PWM min. 30%
1434   4                                      else
1435   4                                      { 
1436   5                                              FAN1_PWM = Target_Duty = 0; // turn off fan.
1437   5                                              FAN2_RPM=0x00; //ANGELAS076:add 
1438   5                                      }                               
1439   4                                      return;
1440   4                              }
1441   3                      }
1442   2                      CheckFanRPM2();
1443   2              }
1444   1              
1445   1              else   //530s
1446   1              {
1447   2                      if(!FanTable_Type)  //table 1
1448   2                      {
1449   3                              if ( TEMP_Buff_3 >= VGA_TBuff3 )
1450   3                              {       // CPU > GPU
1451   4                                      Average_Temp = TEMP_Buff_3;
1452   4                              }
1453   3                              else
1454   3                              {       // GPU > CPU
1455   4                                      Average_Temp = VGA_TBuff3;
1456   4                              }
1457   3                      }
1458   2                      else  ////table 2
1459   2                      {
1460   3                              if ( VGA_TBuff3 >= 0x3D )  // GPU >=61¡ã
1461   3                              {       
1462   4                                      Average_Temp = VGA_TBuff3;
1463   4                              }
1464   3                              else                                       // GPU < 61¡ã
1465   3                              {       
1466   4                                      if ( TEMP_Buff_3 >= VGA_TBuff3 )
1467   4                                      {       // CPU > GPU
1468   5                                              Average_Temp = TEMP_Buff_3;
1469   5                                      }
1470   4                                      else
1471   4                                      {       // GPU > CPU
1472   5                                              Average_Temp = VGA_TBuff3;
1473   5                                      }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 25  

1474   4                              }
1475   3                      }
1476   2                      
1477   2                      if( Average_Temp <= Fan2Off_Step2)      //T105+
1478   2                      {
1479   3                              FAN1_PWM = Target_Duty = 0;     // Turn off FAN.
1480   3                              FAN2_RPM=0x00;
1481   3                              return;
1482   3                      }       
1483   2      
1484   2                      if ( Average_Temp >= Fan2Off_Step2)  //T105+
1485   2                      {
1486   3                              if ( Average_Temp < Fan2On_Step1)  // change 0 to BTStepTemp//4 to 0
1487   3                              {
1488   4                                      if ( FAN1_PWM != 0 )
1489   4                                      { 
1490   5                                              FAN1_PWM = Target_Duty = 0x2C; //LMLKBL0004:add.
1491   5                                      }       // PWM min. 30%
1492   4                                      else
1493   4                                      { 
1494   5                                              FAN1_PWM = Target_Duty = 0; // turn off fan.
1495   5                                              FAN2_RPM=0x00; //ANGELAS076:add 
1496   5                                      }                               
1497   4                                      return;
1498   4                              }
1499   3                      }
1500   2                      CheckFan1Level();
1501   2                      CheckFan2Level();
1502   2                      CheckFanLevel();
1503   2                      CheckFan2RPM();
1504   2              }       
1505   1              
1506   1              Fan2MainControl();              
1507   1      }
1508          void Fan_Offset_Chk(BYTE Duty_Offset, XBYTE *BDCRx)
1509          {           
1510   1              if(((Duty_Offset*100)-50)>FAN1_RPM)  //100 to 50
1511   1              {                      
1512   2              if(*BDCRx<FAN_PWM_Max)
1513   2                              { *BDCRx += 1; /*RamDebug(0x71);*/}     // +1%
1514   2              }
1515   1          else if(((Duty_Offset*100)+50)<FAN1_RPM)   //100 to 50
1516   1          {
1517   2              if(*BDCRx>0x00)
1518   2                              { *BDCRx -= 1; /*RamDebug(0x73);*/}     // -1%
1519   2          }       
1520   1      
1521   1      }
1522          //72JERRY014¡êoS+ Add the second fan method
1523          void Fan1_Offset_Chk(BYTE Duty_Offset, XBYTE *BDCRx)
1524          {           
1525   1              if(((Duty_Offset*100)-50)>FAN2_RPM)  //100 to 50
1526   1              {                      
1527   2              if(*BDCRx<FAN_PWM_Max)
1528   2                              { *BDCRx += 1; /*RamDebug(0x71);*/}     // +1%
1529   2              }
1530   1          else if(((Duty_Offset*100)+50)<FAN2_RPM)   //100 to 50
1531   1          {
1532   2              if(*BDCRx>0x00)
1533   2                              { *BDCRx -= 1; /*RamDebug(0x73);*/}     // -1%
1534   2          }       
1535   1      
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 26  

1536   1      }
1537          /*****************************************************************************/
1538          // Procedure: OEM_Throttling_Ctrl                                                               TimeDiv: 1 Sec
1539          // Description: System CPU/GPU Throttling Data
1540          // GPIO:
1541          // Referrals:  CPU/GPU Temperature
1542          /*****************************************************************************/
1543          //-----------------------------------------------------------------------------
1544          /*const CPUTHRstruct code CPUTHRTable[]= //ANGELAG006: remove start
1545          { //      Thr_Off  Thr_On  Turbo_Rem   Turbo_Off    Thr_Shut           Step  Tjxx  Throttling Table
1546          //-----------------------------------------------------------------------------
1547                  {       90,     98,             55,     60,             100 },  // 0 for DIS CPU 14'  //MEILING019:modify fan table start.  //MEILING024:c
             -hange cpu turbo off from 70 to 65.  //MEILING040:modify turbo on/off start.
1548                  {       92,     99,             57,     61,             105 },  // 1 for DIS GPU 14'
1549                  
1550                  {       90,     98,             59,     64,             100 },  // 2 for UMA CPU 14'  //MEILING024:change cpu turbo on from 60 to 65. //ME
             -ILING033:modify turbo on/off.
1551                  {       100,    100,            100,    100,            100 },  // 3 for UMA GPU 14'
1552          
1553                  {       90,     98,             55,     60,             100 },  // 4 for DIS CPU 15'  //MEILING024:change cpu turbo off from 70 to 65.  //
             -MEILING033:modify turbo on/off.
1554                  {       92,     99,             57,     61,             105 },  // 5 for DIS GPU 15'  //MEILING033:modify turbo on/off.
1555                  
1556                  {       90,     98,             58,     62,             100 },  // 6 for UMA CPU 15'  //MEILING024:change cpu turbo off from 60 to 65.  //
             -MEILING033:modify turbo on/off.  //MEILING040:modify turbo on/off end.
1557                  {       100,    100,            100,    100,            100 },  // 7 for UMA GPU 15'
1558          
1559                  {       90,             98,                     55,             60,                     100     },  // 8 for DIS CPU 17'
1560                  {       92,         99,         57,             61,                     105     },  // 9 for DIS GPU 17'
1561          
1562                  {       90,             98,                     58,             62,                     100     },  // 10 for UMA CPU 17'
1563                  {       100,    100,            100,    100,            100     }   // 11 for UMA GPU 17'  //MEILING019:modify fan table end.
1564          
1565          };*/ //ANGELAG006: remove end
1566          
1567          void Clr_Thermal_Tab(void)
1568          {
1569   1              PORT_BYTE_PNTR Thermal_pntr;
1570   1          
1571   1          CLEAR_MASK(TEST_FLAG, Fan_Control_Auto);  
1572   1             
1573   1              Thermal_pntr = &FAN_Tab_OFF;    // Base on address 0x0160.
1574   1              for( ITempW01=0; ITempW01<=9; ITempW01++ )      // Clear 0160~0169.
1575   1              {
1576   2                      *Thermal_pntr=0;
1577   2              Thermal_pntr++;
1578   2              }
1579   1      
1580   1              Thermal_pntr = &VFAN_Tab_OFF;   // Base on address 0x0170.
1581   1              for( ITempW01=0; ITempW01<=9; ITempW01++ )      // Clear 0170~0179.
1582   1              {
1583   2                      *Thermal_pntr=0;
1584   2              Thermal_pntr++;
1585   2              }
1586   1      }
1587          //ANGELAG006: add start
1588          const CPUTHRstruct code CPUTHRTable[]=
1589          { //      Thr_Off  Thr_On  Turbo_Rem   Turbo_Off    Thr_Shut           Step  Tjxx  Throttling Table
1590          //-----------------------------------------------------------------------------
1591                  {       96,     98,             60,             64,             100 },  // 0 for DIS CPU 14'  //MEILING019:modify fan table start.  //MEILING024:
             -change cpu turbo off from 70 to 65.  //MEILING040:modify turbo on/off start.
1592                  {       92,     99,             60,             65,             105 },  // 1 for DIS GPU 14'
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 27  

1593                  
1594                  {       90,     98,             65,             70,             100 },  // 2 for UMA CPU 14'  //MEILING024:change cpu turbo on from 60 to 65. //M
             -EILING033:modify turbo on/off.
1595                  {       100,    100,            100,    100,    100 },  // 3 for UMA GPU 14'
1596          
1597                  {       90,     98,             60,             65,             100 },  // 4 for DIS CPU 15'  //MEILING024:change cpu turbo off from 70 to 65.  /
             -/MEILING033:modify turbo on/off.
1598                  {       92,     99,             60,             65,             105 },  // 5 for DIS GPU 15'  //MEILING033:modify turbo on/off.
1599                  
1600                  {       90,     98,             65,             70,             100 },  // 6 for UMA CPU 15'  //MEILING024:change cpu turbo off from 60 to 65.  /
             -/MEILING033:modify turbo on/off.  //MEILING040:modify turbo on/off end.
1601                  {       100,    100,            100,    100,    100 },  // 7 for UMA GPU 15'
1602          
1603                  {       90,     98,             60,             65,             100     },  // 8 for DIS CPU 17'
1604                  {       92,     99,             60,             65,             105     },  // 9 for DIS GPU 17'
1605          
1606                  {       90,     98,             65,             70,             100     },  // 10 for UMA CPU 17'
1607                  {       100,    100,            100,            100,            100     }   // 11 for UMA GPU 17'  //MEILING019:modify fan table end.
1608          
1609          };
1610          //ANGELAG006: add end
1611          //72JERRY033: Modify fan table follow '720S_13IKB fan table_V01'.
1612          //72JERRY061:Update fan table follow'720S_13IKB fan table_V04'.
1613          
1614          void OEM_Throttling_Ctrl(void)
1615          {
1616   1              BYTE BTemp_Type,BTbStep;
1617   1              
1618   1              BTbStep = 0;//MEILING023:add.
1619   1      
1620   1              if( SystemNotS0 ) // modify cpu keep max p_state,when battery RSOC>5% under DC mode.
1621   1              //if( (SystemNotS0&&IS_MASK_SET(SYS_STATUS,AC_ADP))|| ((BAT1PERCL>0x05)&&IS_MASK_CLEAR(SYS_STATUS,AC_ADP)
             -)) 
1622   1              {
1623   2                  H_PROCHOT_OFF();
1624   2                      return;
1625   2              }
1626   1      #if FAN_TABLE_Already
1627   1      BTbStep = 0;
1628   1      
1629   1              
1630   1              //if ( IS_MASK_CLEAR(SYS_MISC1, ACPI_OS) )
1631   1              //{ Thro_DOS_Mode(BTbStep); }
1632   1              //  always std mode.
1633   1          // else
1634   1          // { 
1635   1                      Thro_Std_Mode(BTbStep); 
1636   1          // }  
1637   1      
1638   1              /*  
1639   1              else if ( IS_MASK_SET(EM7FUNCTION, QIUETMODE) )                 // bit5:QIUETMODE, Check Quite mode.
1640   1              { Thro_Quite_Mode(BTbStep); }                                           // Quite
1641   1              else if ( IS_MASK_SET(EM7FUNCTION, LSPRUNNING) )        // bit3:LSPRUNNING, Check Super performance mode.
1642   1              { Thro_Super_Mode(BTbStep); }                           // Super performance Mode.
1643   1              else
1644   1              { Thro_Std_Mode(BTbStep); }
1645   1              */  
1646   1              nOSThrottlingTemp = THR_PRO_ON; // For OS throttling temperature.
1647   1              nOSShutdownTemp = THR_Tab_Shut; // For OS Shutdown temperature.
1648   1              nShutDownTemp = THR_Tab_Shut;   // Shutdown temperature.
1649   1      #endif 
1650   1      }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 28  

1651          
1652          //-----------------------------------------------------------------------------
1653          // Throttling: Standard Mode.
1654          //-----------------------------------------------------------------------------
1655          void Thro_Std_Mode(BYTE BMBStep)
1656          {
1657   1              switch( (CPU_TYPE & 0x03) )
1658   1              {
1659   2              #if Support_TJ100
1660   2              case 2:         // Tj100 Step8 and VGA Step16.
1661   2                      THRTab_ToRAM((0+BMBStep));      //:8 to 0  // Throttle Standard table save to RAM.
1662   2                      Thro_Shut_Status((0+BMBStep),TEMP_TYPE_CPU); //:8 to 0  // Check Throttle and Shutdown status.
1663   2                      // Check CPU Turbo function.
1664   2                      Thro_Turbo(CPUTHRTable[(0+BMBStep)].Turbo_Rem,CPUTHRTable[(0+BMBStep)].Turbo_Off,TEMP_TYPE_CPU); //:8 to
             - 0 
1665   2                      break;
1666   2              #endif  // Support_TJ100
1667   2      
1668   2              default:        // Tj90 Step4 and VGA Step16 Default.
1669   2                      THRTab_ToRAM((0+BMBStep));//T14H:4 to 2 // Throttle Standard table save to RAM.
1670   2                      Thro_Shut_Status((0+BMBStep),TEMP_TYPE_CPU);    //:4 to 2               // Check Throttle and Shutdown status.
1671   2                      // Check CPU Turbo function.
1672   2                      Thro_Turbo(CPUTHRTable[(0+BMBStep)].Turbo_Rem,CPUTHRTable[(0+BMBStep)].Turbo_Off,TEMP_TYPE_CPU); //:4 to
             - 2        
1673   2                      break;
1674   2              }
1675   1      
1676   1              VTHRTab_ToRAM((1+BMBStep));//:16 to 4   // VGA Throttle Standard table save to RAM.
1677   1              Thro_Shut_Status((1+BMBStep),TEMP_TYPE_VGA); //:16 to 4  // Check Throttle and Shutdown status.
1678   1              // Check GPU Turbo function.
1679   1              Thro_Turbo(CPUTHRTable[(1+BMBStep)].Turbo_Rem,CPUTHRTable[(1+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);//:16 to 
             -4
1680   1      
1681   1          Thro_Shut_Status(0,TEMP_TYPE_local);//:Add thermal IC local and remote  over temperature protect.
1682   1          if(uMBGPU&0x02)//DIS  //ANGELAG012:add.
1683   1          {
1684   2          Thro_Shut_Status(0,TEMP_TYPE_remote);//:Add thermal IC local and remote  over temperature protect.
1685   2          }
1686   1      
1687   1      }
1688          
1689          /* //ANGELAS050:remove start
1690          //-----------------------------------------------------------------------------
1691          // Throttling: DOS Mode.
1692          //-----------------------------------------------------------------------------
1693          void Thro_DOS_Mode(BYTE BMBStep)
1694          {
1695                  switch( (CPU_TYPE & 0x03) )
1696                  {
1697                  #if Support_TJ100
1698                  case 2:         // Tj100 Step10.
1699                          THRTab_ToRAM((1+BMBStep));//T14H:10 to 1        // Throttle Standard table save to RAM.
1700                          Thro_Shut_Status((1+BMBStep),TEMP_TYPE_CPU);  //T14H:10 to 1    
1701                          break;
1702                  #endif          // Support_TJ100
1703          
1704                  default:        // Tj90 Step6 Default.
1705                          THRTab_ToRAM((3+BMBStep));//:6 to 3      // Throttle Standard table save to RAM.
1706                          Thro_Shut_Status((3+BMBStep),TEMP_TYPE_CPU);  //:6 to 3
1707                          break;
1708                  }
1709                  VTHRTab_ToRAM((5+BMBStep)); //:18 to 5  // VGA Throttle Standard table save to RAM.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 29  

1710                  Thro_Shut_Status((5+BMBStep),TEMP_TYPE_VGA);//:18 to 5  // Check Throttle and Shutdown status.
1711          
1712          }
1713          //-----------------------------------------------------------------------------
1714          // Throttling: Quite Mode.
1715          //-----------------------------------------------------------------------------
1716          void Thro_Quite_Mode(BYTE BMBStep)
1717          {
1718                  VTHRTab_ToRAM((17+BMBStep));    // VGA Throttle Standard table save to RAM.
1719                  switch( (CPU_TYPE & 0x03) )
1720                  {
1721                  case 3:         // Tj105 Step13 and VGA Step 17.
1722                          THRTab_ToRAM((13+BMBStep));                     // Throttle Standard table save to RAM.
1723                          Thro_Shut_Status((13+BMBStep),TEMP_TYPE_CPU);   // Check Throttle and Shutdown status.
1724                          // Check CPU Turbo function.
1725                          Thro_Turbo(CPUTHRTable[(13+BMBStep)].Turbo_Rem,CPUTHRTable[(13+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1726                          break;
1727          
1728                  #if Support_TJ100
1729                  case 2:         // Tj100 Step9 and VGA Step 17.
1730                          THRTab_ToRAM((9+BMBStep));                      // Throttle Standard table save to RAM.
1731                          Thro_Shut_Status((9+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
1732                          // Check CPU Turbo function.
1733                          Thro_Turbo(CPUTHRTable[(9+BMBStep)].Turbo_Rem,CPUTHRTable[(9+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1734                          break;
1735                  #endif          // Support_TJ100
1736          
1737                  case 1:         // Tj90 Step5 and VGA Step 17.
1738                  #if Support_TJ85
1739                  #else
1740                  default:        // Tj90 Step5 and VGA Step 17 Default.
1741                  #endif          // Support_TJ85
1742                          THRTab_ToRAM((5+BMBStep));      // Throttle Standard table save to RAM.
1743                          Thro_Shut_Status((5+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
1744                          // Check CPU Turbo function.
1745                          Thro_Turbo(CPUTHRTable[(5+BMBStep)].Turbo_Rem,CPUTHRTable[(5+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1746                          break;
1747          
1748                  #if Support_TJ85
1749                  default:        // Tj85 Step1 and VGA Step 17 Default.
1750                          THRTab_ToRAM((1+BMBStep));                      // Throttle Standard table save to RAM.
1751                          Thro_Shut_Status((1+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
1752                          // Check CPU Turbo function.
1753                          Thro_Turbo(CPUTHRTable[(1+BMBStep)].Turbo_Rem,CPUTHRTable[(1+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1754                          break;
1755                          #endif  // Support_TJ85
1756                  }
1757                  Thro_Shut_Status((17+BMBStep),TEMP_TYPE_VGA);   // Check Throttle and Shutdown status.
1758                  // Check GPU Turbo function.
1759                  Thro_Turbo(CPUTHRTable[(17+BMBStep)].Turbo_Rem,CPUTHRTable[(17+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);
1760          }
1761          
1762          
1763          
1764          //-----------------------------------------------------------------------------
1765          // Throttling: Super performance Mode.
1766          //-----------------------------------------------------------------------------
1767          void Thro_Super_Mode(BYTE BMBStep)
1768          {
1769                  switch( (CPU_TYPE & 0x03) )
1770                  {
1771                  case 3: // Tj105 Step15 and VGA Step18.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 30  

1772          
1773                          THRTab_ToRAM((15+BMBStep));                     // Throttle Standard table save to RAM.
1774                          Thro_Shut_Status((15+BMBStep),TEMP_TYPE_CPU);           // Check Throttle and Shutdown status.
1775                          Thro_Street((15+BMBStep),TEMP_TYPE_CPU);                // Check VGA Street status.
1776                          // Check CPU Turbo function.
1777                          Thro_Turbo(CPUTHRTable[(15+BMBStep)].Turbo_Rem,CPUTHRTable[(15+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1778                          break;
1779          
1780                  #if Support_TJ100
1781                  case 2:         // Tj100 Step11 and VGA Step18.
1782                          THRTab_ToRAM((11+BMBStep));                     // Throttle Standard table save to RAM.
1783                          Thro_Shut_Status((11+BMBStep),TEMP_TYPE_CPU);           // Check Throttle and Shutdown status.
1784                          Thro_Street((11+BMBStep),TEMP_TYPE_CPU);                // Check VGA Street status.
1785                          // Check CPU Turbo function.
1786                          Thro_Turbo(CPUTHRTable[(11+BMBStep)].Turbo_Rem,CPUTHRTable[(11+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1787                          break;
1788                  #endif          // Support_TJ100
1789          
1790                  case 1:         // Tj90 Step7 and VGA Step18.
1791                  #if Support_TJ85
1792                  #else
1793                  default:        // Tj90 Step7 and VGA Step18 Default.
1794                  #endif          // Support_TJ85
1795          
1796                          THRTab_ToRAM((7+BMBStep));                      // Throttle Standard table save to RAM.
1797                          Thro_Shut_Status((7+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
1798                          Thro_Street((7+BMBStep),TEMP_TYPE_CPU);         // Check VGA Street status.
1799                          // Check CPU Turbo function.
1800                          Thro_Turbo(CPUTHRTable[(7+BMBStep)].Turbo_Rem,CPUTHRTable[(7+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1801                          break;
1802          
1803                  #if Support_TJ85
1804                  default:        // Tj85 Step3 and VGA Step18 Default.
1805                          THRTab_ToRAM((3+BMBStep));                      // Throttle Standard table save to RAM.
1806                          Thro_Shut_Status((3+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
1807                          Thro_Street((3+BMBStep),TEMP_TYPE_CPU);         // Check VGA Street status.
1808                          // Check CPU Turbo function.
1809                          Thro_Turbo(CPUTHRTable[(3+BMBStep)].Turbo_Rem,CPUTHRTable[(3+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
1810                          break;
1811                          #endif  // Support_TJ85
1812                   }
1813          
1814                  VTHRTab_ToRAM((19+BMBStep));    // VGA Throttle Standard table save to RAM.
1815                  Thro_Shut_Status((19+BMBStep),TEMP_TYPE_VGA);   // Check Throttle and Shutdown status.
1816                  Thro_Street((19+BMBStep),TEMP_TYPE_VGA);                // Check VGA Street status.
1817                  // Check GPU Turbo function.
1818                  Thro_Turbo(CPUTHRTable[(19+BMBStep)].Turbo_Rem,CPUTHRTable[(19+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);
1819          }
1820          *///ANGELAS050:remove end
1821          //-----------------------------------------------------------------------------
1822          // Throttling: Check throttling and Shutdown status.
1823          //-----------------------------------------------------------------------------
1824          void Thro_Shut_Status(BYTE BStep, BYTE BTType)
1825          {
1826   1              BYTE BAvgTemp;
1827   1      
1828   1              if ( BTType == 2 )
1829   1              {       // Set External FAN.
1830   2                      //if ( EXT_VGA_Buff3 <= CPUTHRTable[BStep].Thr_Off )            // Check prochot turn OFF.
1831   2                      if ( EXT_VGA_Buff3 < THR_PRO_OFF)               //T14K+
1832   2                      { CLR_MASK(Thro_Status, b2ProCH_EXTVGA); }
1833   2                      //else if ( EXT_VGA_Buff3 >= CPUTHRTable[BStep].Thr_On )        // Check prochot turn ON.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 31  

1834   2                      else if ( EXT_VGA_Buff3 >= THR_PRO_ON)  //T14K+
1835   2                      { SET_MASK(Thro_Status, b2ProCH_EXTVGA); }
1836   2      
1837   2                      //if ( EXT_VGA_Buff3 >= CPUTHRTable[BStep].Thr_Shut )   // Check shutdown status.
1838   2                      if ( EXT_VGA_Buff3 >=THR_Tab_Shut)      //T14K+
1839   2                      { Thro_Count_Shut(&EXTVGA_Shut_Cnt,TEMP_TYPE_EXT); }    // Check x times for shutdown protection.
1840   2                      else
1841   2                      { EXTVGA_Shut_Cnt = 0; }
1842   2              }
1843   1              else if ( BTType == 1 )
1844   1              {       // Set Internal VGA.
1845   2                      //if ( VGA_TBuff3 <= CPUTHRTable[BStep].Thr_Off )               // Check prochot turn OFF.
1846   2                              
1847   2                      /*if ( VGA_TBuff3 < THR_PRO_OFF)                //+
1848   2                              { CLR_MASK(Thro_Status, b1ProCH_VGA); }
1849   2                              //else if ( VGA_TBuff3 >= CPUTHRTable[BStep].Thr_On )   // Check prochot turn ON.
1850   2                              else if ( VGA_TBuff3 >= THR_PRO_ON )    //+
1851   2                               { SET_MASK(Thro_Status, b1ProCH_VGA); }*/
1852   2      
1853   2                              //if ( VGA_TBuff3 >= CPUTHRTable[BStep].Thr_Shut )      // Check shutdown status.
1854   2                              if ( VGA_TBuff3 >= VTHR_Tab_Shut )  //T14K+ //G87:Modify the GPU shutdown temperature  registers
1855   2                              { Thro_Count_Shut(&VGA_Shut_Cnt,TEMP_TYPE_VGA); }       // Check x times for shutdown protection.
1856   2                              else
1857   2                              { VGA_Shut_Cnt = 0; }
1858   2              }
1859   1              else if ( BTType == 4 ) //G90:Add thermal IC local and remote  over temperature protect.
1860   1          {
1861   2               if ( nVramTemp >= nVramoverTemp )  //ANGELAS070:remove
1862   2             // if ( ThermistorCPU_TEMP >= nCPUthermistoroverTemp )  //ANGELAS070:add //thermal ic
1863   2              { Thro_Count_Shut(&local_Shut_Cnt,TEMP_TYPE_local); }   // Check x times for shutdown protection.
1864   2              else
1865   2              { local_Shut_Cnt = 0; }
1866   2          }
1867   1          else if ( BTType == 5 )//G90:Add thermal IC local and remote  over temperature protect.
1868   1          {
1869   2              if ( nRamTemp >= nRamoverTemp )  //ANGELAS070:remove //thermal remote
1870   2                 //   if ( EXTVGA_TEMP >= nGPUthermistoroverTemp )  //ANGELAS070:add
1871   2              { Thro_Count_Shut(&remote_Shut_Cnt,TEMP_TYPE_remote); }   // Check x times for shutdown protection
             -.
1872   2              else
1873   2              { remote_Shut_Cnt = 0; }
1874   2          }
1875   1              else
1876   1              {       // Set Internal CPU.
1877   2                      //if ( TEMP_Buff_3 <= CPUTHRTable[BStep].Thr_Off ) //-  // Check prochot turn OFF.
1878   2                      if ( TEMP_Buff_3 < THR_PRO_OFF) //-
1879   2                      { CLR_MASK(Thro_Status, b0ProCH_CPU); }
1880   2                      //else if ( TEMP_Buff_3 >= CPUTHRTable[BStep].Thr_On )  //- // Check prochot turn ON.
1881   2                      else if ( TEMP_Buff_3 >= THR_PRO_ON)  //-
1882   2                      { SET_MASK(Thro_Status, b0ProCH_CPU); }
1883   2      
1884   2                      //if ( TEMP_Buff_3 >= CPUTHRTable[BStep].Thr_Shut )     //-// Check shutdown status.
1885   2                      if ( TEMP_Buff_3 >= THR_Tab_Shut )      //+
1886   2                      { Thro_Count_Shut(&CPU_Shut_Cnt,TEMP_TYPE_CPU); }       // Check x times for shutdown protection.
1887   2                      else
1888   2                      { CPU_Shut_Cnt = 0; }
1889   2              }
1890   1              
1891   1      }
1892          
1893          //-----------------------------------------------------------------------------
1894          // Throttling: Check CPU/VGA Turbo status.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 32  

1895          //-----------------------------------------------------------------------------
1896          void Thro_Turbo(BYTE BTurboRem, BYTE BTurboOff, BYTE BTType)
1897          {
1898   1              BYTE BAvgTemp;
1899   1      
1900   1              if ( IS_MASK_CLEAR(SYS_MISC1, ACPI_OS) ) { return; }
1901   1              //if((CPU_TYPE &0xc0)!=0x80){return;}//G45:Add judge AMD GPU and NV GPU, AMD GPU not support torbo.//ANGE
             -LAS096:-Add CPU turbo enable/disable Q_event.
1902   1      
1903   1              if ( BTType == 2 )
1904   1              {       // Set External FAN.
1905   2                      if ( EXT_VGA_Buff3 <= BTurboRem )                               // Check turbo resume.
1906   2                      { CLR_MASK(Thro_Status, b5Turbo_EXTVGA); }
1907   2                      else if ( EXT_VGA_Buff3 >= BTurboOff )                  // Check turbo Off.
1908   2                      { SET_MASK(Thro_Status, b5Turbo_EXTVGA); }
1909   2              }
1910   1              else if ( BTType == 1 )
1911   1              {       // Set Internal VGA.
1912   2                      //if ( TEMP_Buff_3 <= BTurboRem ) // Check turbo resume.  //MEILING024:remove.
1913   2                      if ( VGA_TBuff3 <= BTurboRem ) // Check turbo resume.  //MEILING024:change to VGA temp.
1914   2                      { CLR_MASK(Thro_Status, b4Turbo_VGA); }
1915   2                      //else if ( TEMP_Buff_3 >= BTurboOff )    // Check turbo Off.  //MEILING024:remove.
1916   2                      else if ( VGA_TBuff3 >= BTurboOff ) // Check turbo Off.  //MEILING024:change to VGA temp.
1917   2                      { SET_MASK(Thro_Status, b4Turbo_VGA); }
1918   2              }
1919   1              else
1920   1              {       // Set Internal CPU.
1921   2                      if(Read_YOGA_ID()) //YOGA
1922   2                      {
1923   3                      /*      if(uMBGPU&0x02)//DIS
1924   3                              {
1925   3                                      if(VGA_TBuff3>=52)
1926   3                                      {
1927   3                                              SET_MASK(Thro_Status, b3Turbo_CPU); 
1928   3                                      }
1929   3                                      else if( VGA_TBuff3 <= 47)      // Check turbo resume.
1930   3                                      { 
1931   3                                              CLR_MASK(Thro_Status, b3Turbo_CPU);
1932   3                                      }
1933   3                              }*/
1934   3                              if(!QuiteMode)
1935   3                              {
1936   4                                      /*if(CPUI57==0x05)
1937   4                                      {
1938   4                                              if((nVramTemp>=52)||( TEMP_Buff_3 > 92) )           //Thermal u1
1939   4                                              {
1940   4                                                      SET_MASK(Thro_Status, b3Turbo_CPU); 
1941   4                                              }
1942   4                                              else if((nVramTemp <= 48)&&( TEMP_Buff_3 < 87) )        // Check turbo resume.
1943   4                                              { 
1944   4                                                      CLR_MASK(Thro_Status, b3Turbo_CPU);
1945   4                                              }
1946   4                                      }
1947   4                                      else*/
1948   4                                      {
1949   5                                              if((nVramTemp>=59)||( TEMP_Buff_3 > 97) )           //Thermal u1
1950   5                                              {
1951   6                                                      SET_MASK(Thro_Status, b3Turbo_CPU); 
1952   6                                              }
1953   5                                              else if((nVramTemp <= 55)&&( TEMP_Buff_3 < 92) )        // Check turbo resume.
1954   5                                              { 
1955   6                                                      CLR_MASK(Thro_Status, b3Turbo_CPU);
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 33  

1956   6                                              }
1957   5                                      }
1958   4                              }
1959   3                              else
1960   3                              {
1961   4                                      if((nVramTemp>=56)||( TEMP_Buff_3 > 97) )           //Thermal u1
1962   4                                      {
1963   5                                              SET_MASK(Thro_Status, b3Turbo_CPU); 
1964   5                                      }
1965   4                                      else if((nVramTemp <= 52)&&( TEMP_Buff_3 < 92) )        // Check turbo resume.
1966   4                                      { 
1967   5                                              CLR_MASK(Thro_Status, b3Turbo_CPU);
1968   5                                      }
1969   4                              }
1970   3                      }
1971   2                      else//530s
1972   2                      { 
1973   3                              if(uMBGPU&0x02)//DIS
1974   3                              {
1975   4                                      /*if(( TEMP_Buff_3 > 62)&&(VGA_TBuff3>61))
1976   4                                      {
1977   4                                              SET_MASK(Thro_Status, b3Turbo_CPU); 
1978   4                                      }
1979   4                                      else if( TEMP_Buff_3 <= 58)     // Check turbo resume.
1980   4                                      { 
1981   4                                              CLR_MASK(Thro_Status, b3Turbo_CPU);
1982   4                                      }*/
1983   4                                      /*if(CPUI57==0x05)
1984   4                                      {
1985   4                                              if((nVramTemp>=52)||( TEMP_Buff_3 > 92) )           //Thermal u1
1986   4                                              {
1987   4                                                      SET_MASK(Thro_Status, b3Turbo_CPU); 
1988   4                                              }
1989   4                                              else if((nVramTemp <= 48)&&( TEMP_Buff_3 < 87) )        // Check turbo resume.
1990   4                                              { 
1991   4                                                      CLR_MASK(Thro_Status, b3Turbo_CPU);
1992   4                                              }
1993   4                                      }
1994   4                                      else*/
1995   4                                      {
1996   5                                              if((nVramTemp>=59)||( TEMP_Buff_3 > 97) )           //Thermal u1
1997   5                                              {
1998   6                                                      SET_MASK(Thro_Status, b3Turbo_CPU); 
1999   6                                              }
2000   5                                              else if((nVramTemp <= 55)&&( TEMP_Buff_3 < 92) )        // Check turbo resume.
2001   5                                              { 
2002   6                                                      CLR_MASK(Thro_Status, b3Turbo_CPU);
2003   6                                              }
2004   5                                      }
2005   4                              }
2006   3                              else //uma
2007   3                              {
2008   4                                      if( TEMP_Buff_3 > 85)
2009   4                                      {
2010   5                                              SET_MASK(Thro_Status, b3Turbo_CPU); 
2011   5                                      }
2012   4                                      else if( TEMP_Buff_3 <= 80)     // Check turbo resume.
2013   4                                      { 
2014   5                                              CLR_MASK(Thro_Status, b3Turbo_CPU);
2015   5                                      }
2016   4                              }
2017   3                              
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 34  

2018   3                      }
2019   2              }
2020   1              
2021   1              //if ( IS_MASK_CLEAR(Thro_Status, (b3Turbo_CPU+b4Turbo_VGA+b5Turbo_EXTVGA)) )   
2022   1              //MEILING033:remove start.
2023   1              /*if ( IS_MASK_CLEAR(Thro_Status, b3Turbo_CPU) ) 
2024   1              { cTHERMThrottling &= 0xF0; }   // Not need throttling.
2025   1              else
2026   1              {
2027   1                      cTHERMThrottling &= 0xF0;       // Clear thermal throttling status.
2028   1                      cTHERMThrottling |= 0x01;       // Set P-State level.
2029   1              }*/
2030   1              //MEILING033:remove end.
2031   1              
2032   1              /*
2033   1              // Add NV D4 turbo function when battery out power over 45W .
2034   1              if(uMBID==0x17)//support 17' and NV
2035   1              {
2036   1                      if(IS_MASK_CLEAR(Thro_Status,b7ProCH_BATT))//battery mode power <35w
2037   1                      {
2038   1                              if ( IS_MASK_CLEAR(Thro_Status, (b4Turbo_VGA+b5Turbo_EXTVGA)) )
2039   1                              //if (IS_MASK_CLEAR(BatteryAlarm,BATOCP)&&IS_MASK_CLEAR(Thro_Status, (b4Turbo_VGA+b5Turbo_EXTVGA)))
2040   1                              {
2041   1                                      if ( IS_MASK_CLEAR(uVGATurboFun,uDisVGATurboOK) )               // bit2.
2042   1                                      {
2043   1                                              SET_MASK(uVGATurboFun, uDisVGATurboOK);                 // Set bit2.
2044   1                                              CLR_MASK(uVGATurboFun, uDisVGATurboD4OK);                       // Set bit4.
2045   1                                              CLR_MASK(uVGATurboFun, uDisVGATurboD2OK);                       // Set bit5.
2046   1                                              RamDebug(0xEE);  RamDebug(0x63);       
2047   1                                              ECQEvent(DIS_TURBO_63); // 0x63 VGA ENABLE turbo.G24:remove GPU turbo Q event //:Add VGA turbo Q even
             -tD1
2048   1                                      }
2049   1                              }
2050   1                              else
2051   1                              {
2052   1                                      if ( IS_MASK_CLEAR(uVGATurboFun,uDisVGATurboD2OK) )     // bit2.
2053   1                                      {
2054   1                                              SET_MASK(uVGATurboFun, uDisVGATurboD2OK);                       // Set bit5.
2055   1                                              CLR_MASK(uVGATurboFun, uDisVGATurboD4OK);                       //  bit4.
2056   1                                              CLR_MASK(uVGATurboFun, uDisVGATurboOK);                 //  bit2.
2057   1                                              RamDebug(0xEE);  
2058   1                                              RamDebug(0x62);        
2059   1                                              ECQEvent(EN_TURBO_62); // 0x62 VGA DISABLE turbo.G24:remove GPU turbo Q event//G58:Add VGA turbo Q ev
             -entD2
2060   1                                      }
2061   1                              }
2062   1                      }
2063   1                      else//battery mode power >45w
2064   1                      {
2065   1                              if ( IS_MASK_CLEAR(uVGATurboFun,uDisVGATurboD4OK) )     // bit4.
2066   1                              {
2067   1                                      SET_MASK(uVGATurboFun, uDisVGATurboD4OK);                       // Set bit4.
2068   1                                      CLR_MASK(uVGATurboFun, uDisVGATurboOK);                 // bit2.
2069   1                                      CLR_MASK(uVGATurboFun, uDisVGATurboD2OK);                       // bit5.
2070   1                                      ECQEvent(EN_TURBO_61);   //////D4
2071   1                              }
2072   1                      }
2073   1              }
2074   1              else  //support nv only
2075   1              {
2076   1      
2077   1                      if ( IS_MASK_CLEAR(Thro_Status, (b4Turbo_VGA+b5Turbo_EXTVGA)) )
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 35  

2078   1                      {
2079   1                              if ( IS_MASK_SET(uVGATurboFun,uDisVGATurboOK) )         // bit2.
2080   1                              {
2081   1                                      CLR_MASK(uVGATurboFun, uDisVGATurboOK);                 // Set bit2.
2082   1                                      RamDebug(0xEE);  RamDebug(0x63);       
2083   1                                      ECQEvent(DIS_TURBO_63); // 0x63 VGA ENABLE turbo.:remove GPU turbo Q event //:Add VGA turbo Q event
2084   1                              }
2085   1                      }
2086   1                      else
2087   1                      {
2088   1                              if ( IS_MASK_CLEAR(uVGATurboFun,uDisVGATurboOK) )       // bit2.
2089   1                              {
2090   1                                      SET_MASK(uVGATurboFun, uDisVGATurboOK);                 // Set bit2.
2091   1                                      RamDebug(0xEE);  RamDebug(0x62);      
2092   1                                      ECQEvent(EN_TURBO_62); // 0x62 VGA DISABLE turbo.G24:remove GPU turbo Q event//G58:Add VGA turbo Q eve
             -nt
2093   1                              }
2094   1                      }
2095   1              }
2096   1              //Add NV D4 turbo when battery out power over 45W.
2097   1      
2098   1              *///ANGELAS096:-Add CPU turbo enable/disable Q_event.
2099   1          //ANGELAS096:s+Add CPU turbo enable/disable Q_event.
2100   1              //Add CPU turbo (66,67)Q event follow thermal.
2101   1          if ( IS_MASK_CLEAR(Thro_Status, b3Turbo_CPU ))
2102   1              {
2103   2                      if ( IS_MASK_SET(uVGATurboFun,uDisCPUTurboOK) )         
2104   2                      {
2105   3                              CLR_MASK(uVGATurboFun, uDisCPUTurboOK); 
2106   3                  //ECQEvent(DIS_CPUTURBO_67);  //MEILING036:remove.
2107   3                  ECQEvent(EN_CPUTURBO_67);  //MEILING036:add.
2108   3                      }
2109   2              }
2110   1              else
2111   1              {
2112   2                      if ( IS_MASK_CLEAR(uVGATurboFun,uDisCPUTurboOK) )       // bit3.
2113   2                      {
2114   3                              SET_MASK(uVGATurboFun, uDisCPUTurboOK);                 // Set bit3. 
2115   3                  //ECQEvent(EN_CPUTURBO_66);  //MEILING036:remove.
2116   3                ECQEvent(DIS_CPUTURBO_66);  //MEILING036:add.
2117   3                      }
2118   2              }
2119   1              //ANGELAS096:e+Add CPU turbo enable/disable Q_event.
2120   1              // Remove CPU turbo(66,67)Q event.
2121   1              //ANGELAS103:S+Add GPU turbo enable/disable Q_event.
2122   1          //if(uMBGPU&0x01)//only UMA need support for SKL  //MEILING033:remove.
2123   1              {       
2124   2                      if ( IS_MASK_CLEAR(Thro_Status, b4Turbo_VGA) )
2125   2                      {
2126   3                              if ( IS_MASK_SET(uVGATurboFun,uDisVGATurboOK) )
2127   3                              {
2128   4                                      //ECQEvent(EN_TURBO_62);  //MEILING033:remove.
2129   4                                      cGPUThermalThrottling = 0; //MEILING033:add.
2130   4                                      CLR_MASK(uVGATurboFun, uDisVGATurboOK); 
2131   4                              }
2132   3                      
2133   3                      }
2134   2                      else
2135   2                      {
2136   3                              if ( IS_MASK_CLEAR(uVGATurboFun,uDisVGATurboOK) )       // bit2.
2137   3                              {
2138   4                                      SET_MASK(uVGATurboFun, uDisVGATurboOK);                 // Set bit2. 
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 36  

2139   4                      //ECQEvent(DIS_TURBO_63); //MEILING033:remove.
2140   4                      cGPUThermalThrottling = 0;  //ANGELAG006: modify D2 to D3 //MEILING033:add.
2141   4                              }
2142   3                      }
2143   2          }
2144   1      
2145   1              //MEILING040:S+ add internal GPU turbo on/off.
2146   1              if(uMBGPU&0x01)
2147   1              {       
2148   2                      if ( IS_MASK_CLEAR(Thro_Status3, b0IntGPU_TURBO) )
2149   2                      {
2150   3                              if ( IS_MASK_SET(uVGATurboFun,uIntVGATurbo) ) 
2151   3                              {
2152   4                                      CLR_MASK(uVGATurboFun, uIntVGATurbo);   
2153   4                                      ECQEvent(EN_TURBO_62); 
2154   4                              }
2155   3                      
2156   3                      }
2157   2                      else
2158   2                      {
2159   3                              if ( IS_MASK_CLEAR(uVGATurboFun,uIntVGATurbo) ) // bit5.
2160   3                              {
2161   4                                      SET_MASK(uVGATurboFun, uIntVGATurbo);       // set bit5.
2162   4                      ECQEvent(DIS_TURBO_63);
2163   4                              }
2164   3                      }
2165   2          }
2166   1              //MEILING040:E+
2167   1              
2168   1              //ANGELAS103:E+Add GPU turbo enable/disable Q_event.
2169   1      }
2170          
2171          //-----------------------------------------------------------------------------
2172          // Throttling: Check VGA Street status.
2173          //-----------------------------------------------------------------------------
2174          /* //ANGELAS050:remove start
2175          void Thro_Street(BYTE BStep, BYTE BTType)
2176          {
2177                  #if Support_Steering_Fun
2178                  BYTE BAvgTemp;
2179          
2180                  if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) ) { return; }
2181          
2182                  if ( BTType == 2 )
2183                  {
2184                          if ( EXT_VGA_Buff3 <= VGA_Steer_On )                            // Check VGA steering On.
2185                          { CLR_MASK(Thro_Status2, b2Steer_EXTVGA); }
2186                          else if ( EXT_VGA_Buff3 >= VGA_Steer_Off )                      // Check VGA steering Off.
2187                          { SET_MASK(Thro_Status2, b2Steer_EXTVGA); }
2188                  }
2189                  else if ( BTType == 1 )
2190                  {
2191                           if ( VGA_TBuff3 <= VGA_Steer_On )                              // Check VGA steering On.
2192                          { CLR_MASK(Thro_Status2, b1Steer_VGA); }
2193                          else if ( VGA_TBuff3 >= VGA_Steer_Off )
2194                          { SET_MASK(Thro_Status2, b1Steer_VGA); }        // Check VGA steering Off.
2195                  }
2196                  else
2197                  {       // CPU Type.
2198                          switch( (CPU_TYPE & 0x03) )
2199                          {
2200                          case 3:         // Tj105
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 37  

2201                          case 2:         // Tj100
2202                                  if ( TEMP_Buff_3 <= VGA_Steer_On )              // Check VGA steering On.
2203                                  { CLR_MASK(Thro_Status2, b0Steer_CPU); }
2204                                  else if ( TEMP_Buff_3 >= VGA_Steer_Off )// Check VGA steering Off.
2205                                  { SET_MASK(Thro_Status2, b0Steer_CPU); }
2206                                  break;
2207                          case 1:         // Tj90
2208                          default:        // Tj85 Default.
2209                                  if ( TEMP_Buff_3 <= VGA_Steer85_On )    // Check VGA steering On.
2210                                  { CLR_MASK(Thro_Status2, b0Steer_CPU); }
2211                                  else if ( TEMP_Buff_3 >= VGA_Steer_Off )// Check VGA steering Off.
2212                                  { SET_MASK(Thro_Status2, b0Steer_CPU); }
2213                                  break;
2214                          }
2215                  }
2216          
2217                  if ( IS_MASK_CLEAR(Thro_Status2, (b0Steer_CPU+b1Steer_VGA+b2Steer_EXTVGA)) )
2218                  {
2219                          if ( IS_MASK_SET(uVGATurboFun,uDisPowerSteeringOK) )    // bit1.
2220                          {
2221                                  CLR_MASK(uVGATurboFun, uDisPowerSteeringOK);            // Clear bit1.
2222                                  //ECQEvent(DIS_TURBO_63);       // 0x63 Disable VGA Steering. G24:remove GPU turbo Q event
2223                          }
2224                  }
2225                  else
2226                  {
2227                          if ( IS_MASK_CLEAR(uVGATurboFun,uDisPowerSteeringOK) )  // bit1.
2228                          {
2229                                  SET_MASK(uVGATurboFun, uDisPowerSteeringOK);            // Set bit1.
2230                                  ECQEvent(EN_PWRSTEER_64); // 0x64 Enable VGA Steering.
2231                          }
2232                  }
2233                  #endif  // Support_Steering_Fun
2234          }
2235          */ //ANGELAS050:remove end
2236          //-----------------------------------------------------------------------------
2237          // Throttling: Shutdown count used.
2238          //-----------------------------------------------------------------------------
2239          void Thro_Count_Shut(XBYTE *BShut_Cnt, BYTE TempType)
2240          {
2241   1              if ( *BShut_Cnt >= Thro_Shut_Cnt )      // Read 3 times.
2242   1              {
2243   2                      if ( TempType == 2 )
2244   2                      { ProcessSID(EXTVGAOVERTEMP_ID); }              // EXT VGAShutdown ID 0x1C.
2245   2                      else if ( TempType == 1 )
2246   2                      { ProcessSID(VGAOVERTEMP_ID); } // VGA Shutdown ID 0x12.
2247   2                      else if ( TempType == 4 )
2248   2                      { ProcessSID(CPUthermistoroverTemp_ID); }       //ANGELAS082: ThermalIClocalOVerTEPM_ID to CPUthermistoroverTe
             -mp_ID//30 to33
2249   2                      else if ( TempType == 5 )
2250   2                      { ProcessSID(GPUthermistoroverTemp_ID); }       //ANGELAS082: ThermalICremoteOVerTEPM_ID to GPUthermistoroverT
             -emp_ID//31 to 34
2251   2                      else
2252   2                      { ProcessSID(DTSOVERTEMP_ID); } // CPU Shutdown ID 0x11.
2253   2      
2254   2              SET_MASK(SysStatus,ERR_ShuntDownFlag);
2255   2                  CKCON &= 0x3F;                      // set 26 bit counter // bit7-6 00=14ms,01=113ms, 10=911ms, 11(1/9.2MHz)*2'26=7.2S
2256   2                  CKCON |= 0x10;                      // set 26 bit counter // bit7-6 00=14ms,01=113ms, 10=911ms, 11(1/9.2MHz)*2'26=7.2S
2257   2              WDTCON|=0x01;                   /* WDTRST = 1 Reset watch dog timer.*/
2258   2              WDTCON|=0x02;                   /* WDTEN  = 1 Enable watch dog.     */
2259   2              while(1);                       /* Wait for watch dog time-out      */
2260   2                      PWSeqStep = 1;
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 38  

2261   2              PowSeqDelay = 0x00;
2262   2              RamDebug(0x0F);  
2263   2                      SysPowState = SYSTEM_S0_S5;                     // EC force Shutdown.
2264   2      
2265   2                      *BShut_Cnt = 0;
2266   2                      //RSMRST_LOW();
2267   2                      //Delay1MS(1);
2268   2                      //RSMRST_HI();
2269   2                      SET_MASK(USB_Charger, b2USB_TmlDis);    // Disable USB charger.
2270   2              }
2271   1              else
2272   1              { (*BShut_Cnt)++; }
2273   1      }
2274          
2275          //-----------------------------------------------------------------------------
2276          // Throttle table save to ram.
2277          //-----------------------------------------------------------------------------
2278          void THRTab_ToRAM(BYTE BStep)
2279          {
2280   1          if(IS_MASK_SET(TEST_FLAG, Fan_Control_Auto))
2281   1          {
2282   2             return;
2283   2          }
2284   1              THR_PRO_OFF     = CPUTHRTable[BStep].Thr_Off;
2285   1              THR_PRO_ON              = CPUTHRTable[BStep].Thr_On;
2286   1              THR_Turo_Rem    = CPUTHRTable[BStep].Turbo_Rem;
2287   1              THR_Turo_OFF    = CPUTHRTable[BStep].Turbo_Off;
2288   1              THR_Tab_Shut    = CPUTHRTable[BStep].Thr_Shut;
2289   1      }
2290          //-----------------------------------------------------------------------------
2291          // VGA Throttle table save to ram.
2292          //-----------------------------------------------------------------------------
2293          void VTHRTab_ToRAM(BYTE BStep)
2294          {
2295   1          if(IS_MASK_SET(TEST_FLAG, Fan_Control_Auto))
2296   1          {
2297   2             return;
2298   2          }
2299   1              VTHR_PRO_OFF    = CPUTHRTable[BStep].Thr_Off;
2300   1              VTHR_PRO_ON             = CPUTHRTable[BStep].Thr_On;
2301   1              VTHR_Turo_Rem   = CPUTHRTable[BStep].Turbo_Rem;
2302   1              VTHR_Turo_OFF   = CPUTHRTable[BStep].Turbo_Off;
2303   1              VTHR_Tab_Shut   = CPUTHRTable[BStep].Thr_Shut;
2304   1      }
2305          
2306          /*****************************************************************************/
2307          // Procedure: ODDPowerSaving                                                                    TimeDiv: 50mSec
2308          // Description: ODD zero power control.
2309          // GPIO: GPIOA4, GPIOD7
2310          // Referrals:
2311          /*****************************************************************************/
2312          /*//ANGELAS050:remove start
2313          void ODDPowerSaving(void)
2314          {
2315                  #if Support_ODDZeroPower
2316                  // Check S0 status and ODD and ACPI Mode.
2317                  if(IS_MASK_CLEAR(SYS_MISC1, ACPI_OS))
2318                  { return; }
2319          
2320                  if( IS_MASK_SET(LENOVODEVICE, ODDPWRON) )       // Check bit6: ODD power on.
2321                  {
2322                          uVPCeventSource = 0x00;                                 // for Levono AP used.
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 39  

2323                          uVPCeventSource2 = VPCeventODD;                 // for Levono AP used.
2324                          ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
2325                          SET_MASK(uODDPWRsaving, uODD_PWRon);    // Set bit0: uODD_PWRon.
2326                          CLEAR_MASK(LENOVODEVICE, ODDPWRON);             // Clear bit6: ODD power on.
2327                  }
2328          
2329                  if( SystemIsS0 )        // Check S0 status.
2330                  {
2331                          // Power off
2332                          //if( IS_MASK_SET(LENOVODEVICE,ODDPWROFF) )
2333                          //{
2334                          //      uVPCeventSource = 0x00;                                 // for Levono AP used.
2335                          //      uVPCeventSource2 = VPCeventODD;                 // for Levono AP used.
2336                          //      ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
2337                          //      SET_MASK(uODDPWRsaving, uODD_PWRoff1);  // Set bit2: uODD_PWRoff1.
2338                          //      CLEAR_MASK(LENOVODEVICE, ODDPWROFF);    // Clear bit0: ODD power off.
2339                          //      }
2340          
2341                          // Power on by hotkey
2342                          if( IS_MASK_SET(LENOVODEVICE, ODDPWRKEYON) )// Check bit2: ODD hotkey.
2343                          {
2344                                  uVPCeventSource = 0x00;
2345                                  uVPCeventSource2 = VPCeventODDEject;
2346                                  ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
2347                                  CLEAR_MASK(LENOVODEVICE, ODDPWRKEYON);  // Clear bit2: ODD hotkey status.
2348                          }
2349          
2350                          // Power on by button
2351                          if( (ODD_DA()) && (IS_MASK_CLEAR(uODDPWRsaving, uODD_ejectbtn)) )       // open   // bit6: ODD button.
2352                          {
2353                                  if (IS_MASK_CLEAR(SysStatus,FnF3PKeyUp))
2354                                  {
2355                                          uODDtimeCnt++;
2356                                          if( uODDtimeCnt >= 3)
2357                                          {
2358                                                  SET_MASK(SysStatus,FnF3PKeyUp);
2359                                                  uODDtimeCnt = 0;
2360                                          }
2361                                  }
2362                          }
2363                          else if ((!ODD_DA())&& (IS_MASK_CLEAR(uODDPWRsaving, uODD_ejectbtn)))
2364                          {  
2365                                  if (IS_MASK_SET(SysStatus,FnF3PKeyUp))
2366                                  {
2367                                          uODDtimeCnt++;
2368                                          if( uODDtimeCnt >= 3 )
2369                                          {
2370                                                  CLEAR_MASK(uODDPWRsaving, uODD_BtnLowPluse);    // Clear bit1: ODD button low pulse.
2371                                                  CLEAR_MASK(uODDPWRsaving, uODD_low100ms);               // Clear bit4: ODD 100mSec.
2372                                                  SET_MASK(uODDPWRsaving, uODD_PWRon);                    // Set bit0: ODD power on.
2373                                                  SET_MASK(uODDPWRsaving, uODD_ejectbtn);                 // Set bit5: ODD eject button.
2374                                                  ECQEvent(ODD_BTN_EVENT);                                                // 0x53 for Levono used.
2375                                                  uODDtimeCnt = 0;
2376                                                  CLEAR_MASK(SysStatus, FnF3PKeyUp);   
2377                                          }                                                               
2378                                  }
2379                          }
2380                          else
2381                          { uODDtimeCnt = 0; }
2382          
2383                          if( IS_MASK_SET(LENOVODEVICE, ODDPWRStatus) )   // Check bit7: ODD Status.
2384                          {
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 40  

2385                                  CLEAR_MASK(uODDPWRsaving, uODD_ejectbtn);       // Set bit5: ODD eject button.
2386                                  CLEAR_MASK(LENOVODEVICE, ODDPWRStatus);         // Clear bit7: ODD Status.
2387                          }
2388          
2389                          if ( IS_MASK_SET(LENOVODEVICE, ODDPWRBTNON) )   // Check bit1: ODD power button.
2390                          {
2391                                  if( IS_MASK_CLEAR(uODDPWRsaving, uODD_BtnLowPluse))     // Check bit1:ODD low pulse.
2392                                  {
2393                                          uVPCeventSource = 0x00;
2394                                          uVPCeventSource2 = VPCeventODD;
2395                                          ECQEvent(SDV_VPC_notify);       // 0x44 for Levono used.
2396                                          SET_MASK(uODDPWRsaving, uODD_BtnLowPluse);      // Set bit1: ODD button low pulse.
2397          
2398                                          ODD_DAOUT;                                                    
2399                                          ODD_DA_HI();         
2400                                          
2401                                  }
2402                                  else
2403                                  {
2404                                          if( IS_MASK_CLEAR(uODDPWRsaving, uODD_low100ms) )       // Check bit4:ODD 100mSec low pulse.
2405                                          {
2406                                                  switch( uODDdelaytimeStep )
2407                                                  {
2408                                                  case 0:
2409                                                          if( ChkTimeScale(&uODDlowCnt, (Timer_10 +Timer_1)) )    // Delay 830mSec. //:change Timer_7 to Timer_1
2410                                                         {
2411                                                                  ODD_DAOUT;              
2412                                                                  //ODD_DA_HI();
2413                                                                  ODD_DA_LOW();    
2414                                                                  uODDdelaytimeStep++;
2415                                                          }
2416                                                          break;
2417                                                  case 1:
2418                                                          if( ChkTimeScale(&uODDlowCnt, Timer_1) )        // Delay 100mSec.  // change Timer_3 to Timer_1
2419                                                          {
2420                                                                  ODD_DAOUT;              
2421                                                                  //ODD_DA_LOW();
2422                                                                  ODD_DA_HI();      
2423                                                                  SET_MASK(uODDPWRsaving, uODD_low100ms); // Set bit4: ODD 100mSec.
2424                                                                  uODDdelaytimeStep++;
2425                                                          }
2426                                                          break;
2427                                                  default:
2428                                                          break;
2429                                                  }
2430                                          }
2431                                          else
2432                                          {
2433                                                  uVPCeventSource = 0x00;
2434                                                  uVPCeventSource2 = VPCeventODD;
2435                                                  ECQEvent(SDV_VPC_notify);       // 0x44 for Levono used.
2436                                                  ODD_DA_INPUT;    //T038 open 
2437                                                  SET_MASK(uODDPWRsaving, uODD_InitEnd);          // Set bit6: ODD initial End.
2438                                                  CLEAR_MASK(uODDPWRsaving, uODD_ejectbtn);       // Clear bit5: ODD eject button.
2439                                                  CLEAR_MASK(LENOVODEVICE, ODDPWRBTNON);          // Clear bit1: ODD power button.
2440                                                  uODDdelaytimeStep = 0;
2441                                          }
2442                                  }
2443                          }
2444                  }
2445                  #endif  // Support_ODDZeroPower.
2446          }
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 41  

2447          
2448          
2449          */ //ANGELAS050:remove end
2450          /*****************************************************************************/
2451          // Procedure: ThrottlingControl                                                         TimeDiv: 100mSec
2452          // Description: Chekc all throttling status.
2453          // GPIO:
2454          // Referrals:
2455          /*****************************************************************************/
2456          void ThrottlingControl(void)
2457          {
2458   1              if ( SystemIsS0 )
2459   1              {
2460   2                      //   Remove keep P1 states under battery mode.
2461   2                      /*
2462   2                    if ( IS_MASK_CLEAR(SYS_STATUS,AC_ADP)&&(0x00==cBATTThrottling) )
2463   2                   { cBATTThrottling = 0x01; }
2464   2                   */
2465   2                      //  Remove keep P1 states under battery mode.
2466   2                      cThrottlingSet.byte &= 0xF0;    // Clear Throttling status.
2467   2      
2468   2                      if( ( cThrottlingSet.byte & 0x0F ) < cADPThrottling )   // Compare current and ADP Throttling 
2469   2                      // if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cADPThrottling )   //0ptimize CPU P_state (change 16 s
             -tep to 8 step).//:Change MAX P_state from 7 step to 11 step.
2470   2                      {
2471   3                              cThrottlingSet.byte |= cADPThrottling;
2472   3                      }
2473   2                      if( ( cThrottlingSet.byte & 0x0F ) < cTHERMThrottling ) // Compare current and Thermal throttling./
2474   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cTHERMThrottling )//:0ptimize CPU P_state (change 16 st
             -ep to 8 step).//-
2475   2                      {
2476   3                              cThrottlingSet.byte &= 0xF0;
2477   3                              cThrottlingSet.byte |= cTHERMThrottling;
2478   3                      }
2479   2                      if( ( cThrottlingSet.byte & 0x0F ) < cBATTThrottling )  // Compare current and BAT throttling.
2480   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cBATTThrottling )//:0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2481   2                      {
2482   3                              cThrottlingSet.byte &= 0xF0;
2483   3                              cThrottlingSet.byte |= cBATTThrottling;
2484   3                      }
2485   2                      
2486   2                      //MEILING055:S+ add battery Low throttling level.
2487   2                      if( ( cThrottlingSet.byte & 0x0F ) < cBATTLowThrottling )       // Compare current and BAT throttling.
2488   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cBATTThrottling )//:0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2489   2                      {
2490   3                              cThrottlingSet.byte &= 0xF0;
2491   3                              cThrottlingSet.byte |= cBATTLowThrottling;
2492   3                      }
2493   2                      //MEILING055:E+
2494   2                      
2495   2                      if( ( cThrottlingSet.byte & 0x0F ) < nThrottlingAPSet ) // For AP or debug 
2496   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < nThrottlingAPSet )//0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2497   2                      {
2498   3                              cThrottlingSet.byte &= 0xF0;
2499   3                              cThrottlingSet.byte |= nThrottlingAPSet;
2500   3                      }
2501   2      
2502   2                      if( ( cThrottlingSet.byte & 0x0F ) != ( REAL_THROTTLING_INDEX & 0x0F ) )
2503   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) != ( REAL_THROTTLING_INDEX & PSTATE_MAXStep ) )//:0ptimiz
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 42  

             -e CPU P_state (change 16 step to 8 step).//-
2504   2                      {       // Cpu throttling for power status change
2505   3                              if( ( (nRealThermalPinGET) && (( cThrottlingSet.byte & 0x0F ) >= 0x01 ))|| (!nRealThermalPinGET) )
2506   3                              //if( ( (nRealThermalPinGET) && (( cThrottlingSet.byte & PSTATE_MAXStep ) >= 0x01 ))|| (!nRealThermalPi
             -nGET) )//:0ptimize CPU P_state (change 16 step to 8 step).
2507   3                              {
2508   4                                      cThrottlingSet.fbit.cTHRM_SW = 1;
2509   4                      RamDebug(cADPThrottling);       
2510   4                      RamDebug(cTHERMThrottling);       
2511   4                      RamDebug(cBATTThrottling);        
2512   4                      RamDebug(REAL_THROTTLING_INDEX);        
2513   4                                      REAL_THROTTLING_INDEX = (REAL_THROTTLING_INDEX & 0xF0) | (cThrottlingSet.byte & 0x0F);
2514   4                      //REAL_THROTTLING_INDEX = (REAL_THROTTLING_INDEX & 0xF0) | (cThrottlingSet.byte & PSTATE_M
             -AXStep);//:0ptimize CPU P_state (change 16 step to 8 step).//-
2515   4                      RamDebug(REAL_THROTTLING_INDEX);      
2516   4                              }
2517   3                      }
2518   2                      if(CPUThrottlingDelayTime == 0) //MEILING052:send the 0x1D event after delay time.
2519   2                      {
2520   3                              if( cThrottlingSet.fbit.cTHRM_SW )
2521   3                              {
2522   4                                      cThrottlingSet.fbit.cTHRM_SW = 0;
2523   4                                      if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) )  // Check OS mode.
2524   4                                      {
2525   5                                      RamDebug(0xEE);  RamDebug(CPU_SLOW_AD);        //T053+ 
2526   5                                              ECQEvent(CPU_SLOW_AD);  // 0x1D inform bios.
2527   5                                      }
2528   4                              }
2529   3                      }
2530   2              }
2531   1      }
2532          
2533          //MEILING033:add start GPU throttling control function.
2534          void GPUThrottlingControl(void)
2535          {
2536   1              if ( SystemIsS0 && (CPU_TYPE&0x80) ) //ANGELAG014: modify to only NV GPU //MEILING044:add.
2537   1              {
2538   2                      cGPUThrottlingSet.byte &= 0xF0; // Clear Throttling status.
2539   2      
2540   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattThrottling)     // Compare battery power Throttling 
2541   2                      {
2542   3                              cGPUThrottlingSet.byte |= cGPUBattThrottling;
2543   3                      }
2544   2                      
2545   2                      //MEILING055:S+ add battery throttling level when PnP AC.
2546   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUACtoBattThrottling) // Compare PnP AC battery Throttling 
2547   2                      {
2548   3                              cGPUThrottlingSet.byte |= cGPUACtoBattThrottling;
2549   3                      }
2550   2                      //MEILING055:E+.
2551   2                      
2552   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattOTPThrottling)  // Compare battery OPT Throttling 
2553   2                      {
2554   3                              cGPUThrottlingSet.byte &= 0xF0;
2555   3                              cGPUThrottlingSet.byte |= cGPUBattOTPThrottling;
2556   3                      }
2557   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattLowThrottling)  // Compare battery RSOC low Throttling 
2558   2                      {
2559   3                              cGPUThrottlingSet.byte &= 0xF0;
2560   3                              cGPUThrottlingSet.byte |= cGPUBattLowThrottling;
2561   3                      }
2562   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUThermalThrottling)  // Compare current and Thermal throttling
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 43  

2563   2                      {
2564   3                              cGPUThrottlingSet.byte &= 0xF0;
2565   3                              cGPUThrottlingSet.byte |= cGPUThermalThrottling;
2566   3                      }
2567   2                      //ANGELAG017: add start
2568   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattOCPThrottling)  // Compare current and Thermal throttling
2569   2                      {
2570   3                              cGPUThrottlingSet.byte &= 0xF0;
2571   3                              cGPUThrottlingSet.byte |= cGPUBattOCPThrottling;
2572   3                      }
2573   2                      //ANGELAG017: add end
2574   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) != ( GPU_REAL_THROTTLING_INDEX & 0x0F ) )
2575   2                      {       // send GPU throttling event.
2576   3                              GPU_REAL_THROTTLING_INDEX = (GPU_REAL_THROTTLING_INDEX & 0xF0) | (cGPUThrottlingSet.byte & 0x0F);
2577   3                              RamDebug(0xEE); 
2578   3                              RamDebug(GPU_SLOW);  
2579   3                              ECQEvent(GPU_SLOW);     // 0x1E inform bios.
2580   3                      }
2581   2              }
2582   1      }
2583          //MEILING033:add end.
2584          
2585          /*****************************************************************************/
2586          // Procedure: Chk_FAN_RPM_Control                                                       TimeDiv: 50mSec
2587          // Description: Check FAN is AP control.
2588          // GPIO:
2589          // Referrals:
2590          /*****************************************************************************/
2591          void Chk_FAN_RPM_Control(void)
2592          {
2593   1              BYTE BRPM_Manual;
2594   1              //if (uReserve07.fbit.nFanManual == 1)
2595   1              if(ManualFanPRM !=0)//72JERRY014¡êo Add the second fan method
2596   1              {
2597   2                      FAN_PWM_ALT; //ANGELAS018:Open fan control function.
2598   2                      if ( (FAN_PWM != FAN_PWM_Max) && (nAtmFanSpeed != ManualFanPRM) )
2599   2                      {
2600   3                              if( nAtmFanSpeed > ManualFanPRM )
2601   3                              {
2602   4                                      if( FAN_PWM > 0 )
2603   4                                      { FAN_PWM--; }
2604   4                              }
2605   3                              else
2606   3                              {
2607   4                                      if(FAN_PWM < FAN_PWM_Max)
2608   4                                      { FAN_PWM++; }
2609   4                                      else
2610   4                                      { FAN_PWM = FAN_PWM_Max; }
2611   4                              }
2612   3                      }
2613   2                      //ANGELAS017:S+Open fan control function.
2614   2                      if ( (FAN_PWM == FAN_PWM_Max) && (nAtmFanSpeed > ManualFanPRM) )
2615   2                      {
2616   3                              if( FAN_PWM > 0 )
2617   3                              { FAN_PWM--; }
2618   3                      }
2619   2                      //ANGELAS017:E+Open fan control function.
2620   2              }
2621   1              //ANGELAS018:S+Open fan control function.
2622   1              else
2623   1              {
2624   2                      #if !FAN_TABLE_Already
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 44  

                              FAN_PWM_OUT;                    // Set FAN_PWM OUTPUT.
                              EC_FAN_PWM_HI();
                              #endif  // FAN_TABLE_Already
2628   2              }
2629   1              //ANGELAS018:E+Open fan control function.
2630   1      }
2631          //72JERRY014¡êo s+Add the second fan method
2632          void Chk_FAN1_RPM_Control(void)
2633          {
2634   1              BYTE BRPM_Manual;
2635   1              //if (uReserve07.fbit.nFanManual == 1)
2636   1              if(ManualFan2PRM!=0)
2637   1              {
2638   2                      FAN1_PWM_ALT; //ANGELAS018:Open fan control function.
2639   2                      if ( (FAN1_PWM != FAN1_PWM_Max) && (nAtmFan1Speed != ManualFan2PRM) )
2640   2                      {
2641   3                              if( nAtmFan1Speed > ManualFan2PRM )
2642   3                              {
2643   4                                      if( FAN1_PWM > 0 )
2644   4                                      { FAN1_PWM--; }
2645   4                              }
2646   3                              else
2647   3                              {
2648   4                                      if(FAN1_PWM < FAN1_PWM_Max)
2649   4                                      { FAN1_PWM++; }
2650   4                                      else
2651   4                                      { FAN1_PWM = FAN1_PWM_Max; }
2652   4                              }
2653   3                      }
2654   2                      //ANGELAS017:S+Open fan control function.
2655   2                      if ( (FAN1_PWM == FAN1_PWM_Max) && (nAtmFan1Speed > ManualFan2PRM) )
2656   2                      {
2657   3                              if( FAN1_PWM > 0 )
2658   3                              { FAN1_PWM--; }
2659   3                      }
2660   2                      //ANGELAS017:E+Open fan control function.
2661   2              }
2662   1              //ANGELAS018:S+Open fan control function.
2663   1              else
2664   1              {
2665   2                      #if !FAN_TABLE_Already
                              FAN1_PWM_OUT;                   // Set FAN_PWM OUTPUT.
                              EC_FAN1_PWM_HI();
                              #endif  // FAN_TABLE_Already
2669   2              }
2670   1              //ANGELAS018:E+Open fan control function.
2671   1      }
2672          //72JERRY014¡êo e+Add the second fan method
2673          /*****************************************************************************/
2674          // Procedure: FAN_Dust_Mode                                                                             TimeDiv: 1 Sec
2675          // Description: EM8.0 Dust function
2676          // GPIO:
2677          // Referrals:
2678          /*****************************************************************************/
2679          void FAN_Dust_Mode(void)
2680          {
2681   1              #if Lenovo_FAN_Dust             // Dust mode
2682   1              if( (IS_MASK_SET(SYS_MISC1, ACPI_OS))&&(IS_MASK_CLEAR(LENOVOBATT, BATT_TEST_MODE))&&(SystemIsS0) )
2683   1              {
2684   2                      if ( IS_MASK_SET(SMartNoise, b5DedustingMode) )
2685   2                      {
2686   3                              SET_MASK(SMartNoise, b1FanCleanStart);  //start Clean Dust
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 45  

2687   3                              StartFanClean = 120;
2688   3                              CLR_MASK(SMartNoise, b5DedustingMode);
2689   3                              CLR_MASK(SMartNoise, b2StopReason);             // Dust mode by Completed.
2690   3                              //EC_FAN_ANTI_OUTPUT;//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2691   3                              Fan_Offset_Chk(FAN_Std_Max,&FAN_PWM);//
2692   3                      }
2693   2      
2694   2                      if ( IS_MASK_SET(SMartNoise, b1FanCleanStart))
2695   2                      {
2696   3                              if ( StartFanClean == 0 )
2697   3                              {       // dust mode end
2698   4                                      CLR_MASK(THERMAL_STATUS, INITOK);       // turn back fan control right to EC.
2699   4                                      FAN_PWM = FAN_PWM_Min;                          // PWM minimum.
2700   4                                      //EC_FAN_ANTI_OFF();//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2701   4                                      //EC_FAN_ANTI_INPUT;//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2702   4                                      SMartNoise &= 0xEC;                                     // Clear bit0,1,4.
2703   4                                      FanCleanFull = 0;
2704   4                                      FanCleanHalt = 0;
2705   4                                      CLR_MASK(SMartNoise, b2StopReason);     // Dust mode by Completed.
2706   4                              }
2707   3                              else
2708   3                              {
2709   4                                      StartFanClean--;
2710   4                                      if ( IS_MASK_CLEAR(SMartNoise, b0FanCleanOn))
2711   4                                      {
2712   5                                              if( !ChkTimeScale( &FanCleanFull,Timer_50 ) )  //MEILING035:modify to 50S.
2713   5                                              {
2714   6                                                      //SET_MASK(THERMAL_STATUS, INITOK);
2715   6                                                      //EC_FAN_ANTI_OFF();//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2716   6                                                      FAN_PWM = CTR2;//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2717   6                                              }
2718   5                                              else
2719   5                                              { SET_MASK(SMartNoise, b0FanCleanOn); }
2720   5                                      }
2721   4                                      else
2722   4                                      {
2723   5                                              if( !ChkTimeScale( &FanCleanHalt,Timer_40 ) ) //MEILING035:modify to 40S.
2724   5                                              {
2725   6                                                      //SET_MASK(THERMAL_STATUS, INITOK);
2726   6                                                      //FAN_PWM = 0;//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2727   6                                                      //EC_FAN_ANTI_ON();//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2728   6                                              }
2729   5                                              else
2730   5                                              { CLR_MASK(SMartNoise, b0FanCleanOn); }
2731   5                                      }
2732   4                              }
2733   3                      }
2734   2              }
2735   1              else
2736   1              {
2737   2                      //EC_FAN_ANTI_OFF();//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2738   2                      //EC_FAN_ANTI_INPUT;//JERRYCRZ014:Add fan can be reversed  in dust removal mode.
2739   2                      CLR_MASK(THERMAL_STATUS, INITOK);       // turn back fan control right to EC.
2740   2                      FanCleanFull = 0;
2741   2                      FanCleanHalt = 0;
2742   2                      SMartNoise = 0x04;                                      // Stop Fan Dust mode.
2743   2              }
2744   1              #endif  // Lenovo_FAN_Dust
2745   1      }
2746          
2747          
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 46  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com01F5 (BEGIN)
0000         L?0502:
0000         L?0503:
0000 F583              MOV     DPH,A
0002 E4                CLR     A
0003 93                MOVC    A,@A+DPTR
0004 FE                MOV     R6,A
0005 EF                MOV     A,R7
0006 75F009            MOV     B,#09H
0009 A4                MUL     AB
000A 2400        R     ADD     A,#LOW Fan1Step
000C F582              MOV     DPL,A
000E E4                CLR     A
000F 3400        R     ADDC    A,#HIGH Fan1Step
0011         L?0504:
0011 F583              MOV     DPH,A
0013 120000      E     LCALL   ?C?PLDCODE
0016 EE                MOV     A,R6
0017 120000      E     LCALL   ?C?CSTPTR
001A EF                MOV     A,R7
001B 25E0              ADD     A,ACC
001D 25E0              ADD     A,ACC
001F 22                RET     
0020         L?0505:
0020         L?0506:
0020 F583              MOV     DPH,A
0022 E4                CLR     A
0023 93                MOVC    A,@A+DPTR
0024 FE                MOV     R6,A
0025 EF                MOV     A,R7
0026 75F009            MOV     B,#09H
0029 A4                MUL     AB
002A 2400        R     ADD     A,#LOW Fan1Step+06H
002C F582              MOV     DPL,A
002E E4                CLR     A
002F 3400        R     ADDC    A,#HIGH Fan1Step+06H
0031         L?0507:
0031 F583              MOV     DPH,A
0033 120000      E     LCALL   ?C?PLDCODE
0036 EE                MOV     A,R6
0037 120000      E     LCALL   ?C?CSTPTR
003A 0F                INC     R7
003B 22                RET     
003C         L?0508:
003C         L?0509:
003C F583              MOV     DPH,A
003E E4                CLR     A
003F 93                MOVC    A,@A+DPTR
0040 FE                MOV     R6,A
0041 EF                MOV     A,R7
0042 75F009            MOV     B,#09H
0045 A4                MUL     AB
0046 22                RET     
0047         L?0510:
0047 EF                MOV     A,R7
0048 75F009            MOV     B,#09H
004B A4                MUL     AB
004C 2400        R     ADD     A,#LOW Fan1Step
004E F582              MOV     DPL,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 47  

0050 E4                CLR     A
0051 3400        R     ADDC    A,#HIGH Fan1Step
0053         L?0511:
0053 F583              MOV     DPH,A
0055 120000      E     LCALL   ?C?PLDCODE
0058 020000      E     LJMP    ?C?CLDPTR
005B         L?0513:
005B 540F              ANL     A,#0FH
005D FF                MOV     R7,A
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 EF                MOV     A,R7
0061 C3                CLR     C
0062 9E                SUBB    A,R6
0063 22                RET     
0064         L?0514:
0064 900000      E     MOV     DPTR,#VGA_TBuff2
0067 E0                MOVX    A,@DPTR
0068 900000      E     MOV     DPTR,#VGA_TBuff3
006B F0                MOVX    @DPTR,A
006C 900000      E     MOV     DPTR,#VGA_TBuff1
006F E0                MOVX    A,@DPTR
0070 900000      E     MOV     DPTR,#VGA_TBuff2
0073 F0                MOVX    @DPTR,A
0074 900000      E     MOV     DPTR,#VGA_TEMP
0077 E0                MOVX    A,@DPTR
0078 900000      E     MOV     DPTR,#VGA_TBuff1
007B F0                MOVX    @DPTR,A
007C 900000      E     MOV     DPTR,#VGA_TBuff2
007F E0                MOVX    A,@DPTR
0080 FF                MOV     R7,A
0081 900000      E     MOV     DPTR,#VGA_TBuff1
0084 E0                MOVX    A,@DPTR
0085 2F                ADD     A,R7
0086 FF                MOV     R7,A
0087 E4                CLR     A
0088 33                RLC     A
0089 FE                MOV     R6,A
008A 900000      E     MOV     DPTR,#VGA_TBuff3
008D E0                MOVX    A,@DPTR
008E 7C00              MOV     R4,#00H
0090 2F                ADD     A,R7
0091 FF                MOV     R7,A
0092 EC                MOV     A,R4
0093 3E                ADDC    A,R6
0094 FE                MOV     R6,A
0095 7D03              MOV     R5,#03H
0097 120000      E     LCALL   ?C?UIDIV
009A EF                MOV     A,R7
009B F0                MOVX    @DPTR,A
009C 22                RET     
009D         L?0515:
009D EF                MOV     A,R7
009E 75F009            MOV     B,#09H
00A1 A4                MUL     AB
00A2         L?0516:
00A2 2400        R     ADD     A,#LOW Fan1Step+03H
00A4 F582              MOV     DPL,A
00A6 E4                CLR     A
00A7 3400        R     ADDC    A,#HIGH Fan1Step+03H
00A9 22                RET     
00AA         L?0517:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 48  

00AA         L?0518:
00AA 900000      E     MOV     DPTR,#VGA_TBuff3
00AD         L?0519:
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF 900000      E     MOV     DPTR,#TEMP_Buff_3
00B2 E0                MOVX    A,@DPTR
00B3 C3                CLR     C
00B4 9F                SUBB    A,R7
00B5 22                RET     
00B6         L?0520:
00B6 540F              ANL     A,#0FH
00B8 FF                MOV     R7,A
00B9 E0                MOVX    A,@DPTR
00BA FE                MOV     R6,A
00BB EF                MOV     A,R7
00BC C3                CLR     C
00BD 9E                SUBB    A,R6
00BE 22                RET     
00BF         L?0521:
00BF 900000      E     MOV     DPTR,#Fan1Off_Step1
00C2         L?0522:
00C2 E0                MOVX    A,@DPTR
00C3 FF                MOV     R7,A
00C4 900000      E     MOV     DPTR,#Average_Temp
00C7 E0                MOVX    A,@DPTR
00C8 22                RET     
00C9         L?0523:
00C9 540F              ANL     A,#0FH
00CB FF                MOV     R7,A
00CC E0                MOVX    A,@DPTR
00CD FE                MOV     R6,A
00CE EF                MOV     A,R7
00CF C3                CLR     C
00D0 9E                SUBB    A,R6
00D1 22                RET     
00D2         L?0524:
00D2 EF                MOV     A,R7
00D3 75F009            MOV     B,#09H
00D6 A4                MUL     AB
00D7         L?0525:
00D7 2400        R     ADD     A,#LOW Fan2Step
00D9 F582              MOV     DPL,A
00DB E4                CLR     A
00DC 3400        R     ADDC    A,#HIGH Fan2Step
00DE 22                RET     
00DF         L?0526:
00DF EF                MOV     A,R7
00E0 75F009            MOV     B,#09H
00E3 A4                MUL     AB
00E4         L?0527:
00E4 2400        R     ADD     A,#LOW Fan2Step+03H
00E6 F582              MOV     DPL,A
00E8 E4                CLR     A
00E9 3400        R     ADDC    A,#HIGH Fan2Step+03H
00EB 22                RET     
00EC         L?0528:
00EC 75F009            MOV     B,#09H
00EF A4                MUL     AB
00F0         L?0529:
00F0 2400        R     ADD     A,#LOW Fan2Step+06H
00F2 F582              MOV     DPL,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 49  

00F4 E4                CLR     A
00F5 3400        R     ADDC    A,#HIGH Fan2Step+06H
00F7 22                RET     
00F8         L?0531:
00F8 FE                MOV     R6,A
00F9 E0                MOVX    A,@DPTR
00FA 7C00              MOV     R4,#00H
00FC 2400              ADD     A,#00H
00FE FF                MOV     R7,A
00FF EC                MOV     A,R4
0100 3E                ADDC    A,R6
0101 CB                XCH     A,R3
0102 EF                MOV     A,R7
0103 CB                XCH     A,R3
0104 FA                MOV     R2,A
0105 E4                CLR     A
0106 F9                MOV     R1,A
0107 F8                MOV     R0,A
0108 7FA0              MOV     R7,#0A0H
010A 7E8C              MOV     R6,#08CH
010C FD                MOV     R5,A
010D 120000      E     LCALL   ?C?SLDIV
0110 E4                CLR     A
0111 7B3C              MOV     R3,#03CH
0113 FA                MOV     R2,A
0114 F9                MOV     R1,A
0115 F8                MOV     R0,A
0116 020000      E     LJMP    ?C?LMUL
0119         L?0532:
0119         L?0533:
0119 900000      E     MOV     DPTR,#cThrottlingSet
011C         L?0534:
011C E0                MOVX    A,@DPTR
011D 54F0              ANL     A,#0F0H
011F F0                MOVX    @DPTR,A
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
0122 22                RET     
0123         L?0535:
0123         L?0536:
0123 900000      E     MOV     DPTR,#SysPowState
0126 E0                MOVX    A,@DPTR
0127 6410              XRL     A,#010H
0129 22                RET     
012A         L?0537:
012A 8D82              MOV     DPL,R5
012C 8C83              MOV     DPH,R4
012E E0                MOVX    A,@DPTR
012F 900000      E     MOV     DPTR,#CTR2
0132         L?0538:
0132 FF                MOV     R7,A
0133 E0                MOVX    A,@DPTR
0134 FE                MOV     R6,A
0135 EF                MOV     A,R7
0136 C3                CLR     C
0137 9E                SUBB    A,R6
0138 22                RET     
0139         L?0539:
0139 F0                MOVX    @DPTR,A
013A EF                MOV     A,R7
013B         L?0540:
013B 75F005            MOV     B,#05H
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 50  

013E A4                MUL     AB
013F 2400        R     ADD     A,#LOW CPUTHRTable+02H
0141 F582              MOV     DPL,A
0143 E4                CLR     A
0144 3400        R     ADDC    A,#HIGH CPUTHRTable+02H
0146 F583              MOV     DPH,A
0148 E4                CLR     A
0149 93                MOVC    A,@A+DPTR
014A 22                RET     
014B         L?0541:
014B F0                MOVX    @DPTR,A
014C EF                MOV     A,R7
014D         L?0542:
014D 75F005            MOV     B,#05H
0150 A4                MUL     AB
0151 2400        R     ADD     A,#LOW CPUTHRTable+03H
0153 F582              MOV     DPL,A
0155 E4                CLR     A
0156 3400        R     ADDC    A,#HIGH CPUTHRTable+03H
0158 F583              MOV     DPH,A
015A E4                CLR     A
015B 93                MOVC    A,@A+DPTR
015C 22                RET     
015D         L?0543:
015D FF                MOV     R7,A
015E         L?0544:
015E E0                MOVX    A,@DPTR
015F FE                MOV     R6,A
0160 EF                MOV     A,R7
0161 4E                ORL     A,R6
0162 900000      E     MOV     DPTR,#cGPUThrottlingSet
0165 F0                MOVX    @DPTR,A
0166 22                RET     
0167         L?0545:
0167 900000      E     MOV     DPTR,#TMErrCnt
016A E0                MOVX    A,@DPTR
016B 04                INC     A
016C F0                MOVX    @DPTR,A
016D 900000      E     MOV     DPTR,#TmlICStep
0170         L?0546:
0170 E0                MOVX    A,@DPTR
0171 04                INC     A
0172 F0                MOVX    @DPTR,A
0173 900000      E     MOV     DPTR,#ERR_THMSTS
0176 E0                MOVX    A,@DPTR
0177 22                RET     
0178         L?0547:
0178         L?0548:
0178 E0                MOVX    A,@DPTR
0179 FE                MOV     R6,A
017A EF                MOV     A,R7
017B 4E                ORL     A,R6
017C 900000      E     MOV     DPTR,#cThrottlingSet
017F F0                MOVX    @DPTR,A
0180 22                RET     
0181         L?0549:
0181 C9                XCH     A,R1
0182 EF                MOV     A,R7
0183 C9                XCH     A,R1
0184 E9                MOV     A,R1
0185 75F064            MOV     B,#064H
0188 A4                MUL     AB
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 51  

0189 24CE              ADD     A,#0CEH
018B FF                MOV     R7,A
018C E5F0              MOV     A,B
018E 34FF              ADDC    A,#0FFH
0190 FE                MOV     R6,A
0191 C3                CLR     C
0192 E0                MOVX    A,@DPTR
0193 9F                SUBB    A,R7
0194 22                RET     
0195         L?0550:
0195         L?0551:
0195 900000      E     MOV     DPTR,#CTR2
0198 E0                MOVX    A,@DPTR
0199 FF                MOV     R7,A
019A 900000      E     MOV     DPTR,#DCR5
019D E0                MOVX    A,@DPTR
019E 22                RET     
019F         L?0552:
019F         L?0553:
019F 900000      E     MOV     DPTR,#CTR2
01A2 E0                MOVX    A,@DPTR
01A3 FF                MOV     R7,A
01A4 900000      E     MOV     DPTR,#DCR4
01A7 E0                MOVX    A,@DPTR
01A8 22                RET     
01A9         L?0554:
01A9 540F              ANL     A,#0FH
01AB FF                MOV     R7,A
01AC E0                MOVX    A,@DPTR
01AD 540F              ANL     A,#0FH
01AF 22                RET     
01B0         L?0555:
01B0 7D01              MOV     R5,#01H
01B2 7BFF              MOV     R3,#0FFH
01B4         L?0556:
01B4 7E00              MOV     R6,#00H
01B6 7F04              MOV     R7,#04H
01B8 020000      E     LJMP    ?C?COPY
01BB         L?0557:
01BB F0                MOVX    @DPTR,A
01BC E4                CLR     A
01BD 900000      E     MOV     DPTR,#VGAErrCnt
01C0         L?0558:
01C0 F0                MOVX    @DPTR,A
01C1 900000      E     MOV     DPTR,#ERR_THMSTS
01C4 E0                MOVX    A,@DPTR
01C5 54FD              ANL     A,#0FDH
01C7 F0                MOVX    @DPTR,A
01C8 22                RET     
01C9         L?0559:
01C9 75F064            MOV     B,#064H
01CC A4                MUL     AB
01CD 24CE              ADD     A,#0CEH
01CF FF                MOV     R7,A
01D0 E5F0              MOV     A,B
01D2 34FF              ADDC    A,#0FFH
01D4 FE                MOV     R6,A
01D5 C3                CLR     C
01D6 E0                MOVX    A,@DPTR
01D7 9F                SUBB    A,R7
01D8 22                RET     
01D9         L?0560:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 52  

01D9 540F              ANL     A,#0FH
01DB FF                MOV     R7,A
01DC E0                MOVX    A,@DPTR
01DD FE                MOV     R6,A
01DE EF                MOV     A,R7
01DF C3                CLR     C
01E0 9E                SUBB    A,R6
01E1 22                RET     
01E2         L?0561:
01E2 F0                MOVX    @DPTR,A
01E3 EF                MOV     A,R7
01E4 75F005            MOV     B,#05H
01E7 A4                MUL     AB
01E8 2400        R     ADD     A,#LOW CPUTHRTable+01H
01EA F582              MOV     DPL,A
01EC E4                CLR     A
01ED 3400        R     ADDC    A,#HIGH CPUTHRTable+01H
01EF F583              MOV     DPH,A
01F1 E4                CLR     A
01F2 93                MOVC    A,@A+DPTR
01F3 22                RET     
01F4         L?0562:
01F4 F0                MOVX    @DPTR,A
01F5 EF                MOV     A,R7
01F6 75F005            MOV     B,#05H
01F9 A4                MUL     AB
01FA 2400        R     ADD     A,#LOW CPUTHRTable+04H
01FC F582              MOV     DPL,A
01FE E4                CLR     A
01FF 3400        R     ADDC    A,#HIGH CPUTHRTable+04H
0201 F583              MOV     DPH,A
0203 E4                CLR     A
0204 93                MOVC    A,@A+DPTR
0205 22                RET     
0206         L?0563:
0206 EF                MOV     A,R7
0207 75F005            MOV     B,#05H
020A A4                MUL     AB
020B 2400        R     ADD     A,#LOW CPUTHRTable
020D F582              MOV     DPL,A
020F E4                CLR     A
0210 3400        R     ADDC    A,#HIGH CPUTHRTable
0212 F583              MOV     DPH,A
0214 E4                CLR     A
0215 93                MOVC    A,@A+DPTR
0216 22                RET     
0217         L?0564:
0217         L?0565:
0217 FE                MOV     R6,A
0218 900000      E     MOV     DPTR,#Average_Temp
021B E0                MOVX    A,@DPTR
021C C3                CLR     C
021D 9E                SUBB    A,R6
021E 22                RET     
021F         L?0566:
021F E0                MOVX    A,@DPTR
0220 14                DEC     A
0221         L?0567:
0221 F0                MOVX    @DPTR,A
0222 900000      E     MOV     DPTR,#CTR2
0225 E0                MOVX    A,@DPTR
0226 FD                MOV     R5,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 53  

0227 7F1D              MOV     R7,#01DH
0229 22                RET     
022A         L?0568:
022A E9                MOV     A,R1
022B 75F064            MOV     B,#064H
022E A4                MUL     AB
022F 2432              ADD     A,#032H
0231 FF                MOV     R7,A
0232 E4                CLR     A
0233 35F0              ADDC    A,B
0235 FE                MOV     R6,A
0236 D3                SETB    C
0237 E0                MOVX    A,@DPTR
0238 9F                SUBB    A,R7
0239 22                RET     
023A         L?0569:
023A         L?0570:
023A 900000      E     MOV     DPTR,#ManualFanPRM
023D E0                MOVX    A,@DPTR
023E FF                MOV     R7,A
023F 900000      E     MOV     DPTR,#nAtmFanSpeed
0242 E0                MOVX    A,@DPTR
0243 22                RET     
0244         L?0571:
0244         L?0572:
0244 900000      E     MOV     DPTR,#ManualFan2PRM
0247 E0                MOVX    A,@DPTR
0248 FF                MOV     R7,A
0249 900000      E     MOV     DPTR,#nAtmFan1Speed
024C E0                MOVX    A,@DPTR
024D 22                RET     
024E         L?0573:
024E 900000      E     MOV     DPTR,#Fan1RPMTemp
0251 F0                MOVX    @DPTR,A
0252 900000      E     MOV     DPTR,#Fan1RPM_TargetBackUp
0255 E0                MOVX    A,@DPTR
0256 FF                MOV     R7,A
0257 900000      E     MOV     DPTR,#Fan1RPMTemp
025A E0                MOVX    A,@DPTR
025B 6F                XRL     A,R7
025C 22                RET     
025D         L?0574:
025D 900000      E     MOV     DPTR,#Fan2RPMTemp
0260 F0                MOVX    @DPTR,A
0261 900000      E     MOV     DPTR,#Fan2RPM_TargetBackUp
0264 E0                MOVX    A,@DPTR
0265 FF                MOV     R7,A
0266 900000      E     MOV     DPTR,#Fan2RPMTemp
0269 E0                MOVX    A,@DPTR
026A 6F                XRL     A,R7
026B 22                RET     
026C         L?0575:
026C 75F064            MOV     B,#064H
026F A4                MUL     AB
0270 2432              ADD     A,#032H
0272 FF                MOV     R7,A
0273 E4                CLR     A
0274 35F0              ADDC    A,B
0276 FE                MOV     R6,A
0277 D3                SETB    C
0278 E0                MOVX    A,@DPTR
0279 9F                SUBB    A,R7
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 54  

027A 22                RET     
027B         L?0576:
027B 900000      E     MOV     DPTR,#Fan1RPMTemp
027E E0                MOVX    A,@DPTR
027F 900000      E     MOV     DPTR,#Fan1RPM_TargetBackUp
0282 F0                MOVX    @DPTR,A
0283 E4                CLR     A
0284 900000      E     MOV     DPTR,#Fan1RPMCount
0287 F0                MOVX    @DPTR,A
0288 22                RET     
0289         L?0577:
0289 900000      E     MOV     DPTR,#Fan2RPMTemp
028C E0                MOVX    A,@DPTR
028D 900000      E     MOV     DPTR,#Fan2RPM_TargetBackUp
0290 F0                MOVX    @DPTR,A
0291 E4                CLR     A
0292 900000      E     MOV     DPTR,#Fan2RPMCount
0295 F0                MOVX    @DPTR,A
0296 22                RET     
0297         L?0578:
0297         L?0579:
0297 E0                MOVX    A,@DPTR
0298 FF                MOV     R7,A
0299 900000      E     MOV     DPTR,#EXT_VGA_Buff3
029C E0                MOVX    A,@DPTR
029D C3                CLR     C
029E 9F                SUBB    A,R7
029F 22                RET     
02A0         L?0580:
02A0 F0                MOVX    @DPTR,A
02A1 E4                CLR     A
02A2 900000      E     MOV     DPTR,#FanCleanFull
02A5 F0                MOVX    @DPTR,A
02A6 900000      E     MOV     DPTR,#FanCleanHalt
02A9 F0                MOVX    @DPTR,A
02AA 900000      E     MOV     DPTR,#SMartNoise
02AD 22                RET     
02AE         L?0581:
02AE E0                MOVX    A,@DPTR
02AF FE                MOV     R6,A
02B0 A3                INC     DPTR
02B1 E0                MOVX    A,@DPTR
02B2 FF                MOV     R7,A
02B3 7C00              MOV     R4,#00H
02B5 7D64              MOV     R5,#064H
02B7 020000      E     LJMP    ?C?UIDIV
02BA         L?0582:
02BA         L?0583:
02BA 900000      E     MOV     DPTR,#ERR_THMSTS
02BD E0                MOVX    A,@DPTR
02BE 4402              ORL     A,#02H
02C0 F0                MOVX    @DPTR,A
02C1 22                RET     
02C2         L?0584:
02C2 75F009            MOV     B,#09H
02C5 A4                MUL     AB
02C6 2400        R     ADD     A,#LOW Fan1Step+06H
02C8 F582              MOV     DPL,A
02CA E4                CLR     A
02CB 3400        R     ADDC    A,#HIGH Fan1Step+06H
02CD 22                RET     
02CE         L?0585:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 55  

02CE         L?0586:
02CE 900000      E     MOV     DPTR,#DCR5
02D1 E0                MOVX    A,@DPTR
02D2 D3                SETB    C
02D3 9400              SUBB    A,#00H
02D5 22                RET     
02D6         L?0587:
02D6         L?0588:
02D6 900000      E     MOV     DPTR,#DCR4
02D9 E0                MOVX    A,@DPTR
02DA D3                SETB    C
02DB 9400              SUBB    A,#00H
02DD 22                RET     
02DE         L?0589:
02DE         L?0590:
02DE 900000      E     MOV     DPTR,#TEMP_Buff_3
02E1 E0                MOVX    A,@DPTR
02E2 C3                CLR     C
02E3 945C              SUBB    A,#05CH
02E5 22                RET     
02E6         L?0591:
02E6         L?0592:
02E6 900000      E     MOV     DPTR,#CPU_TYPE
02E9 E0                MOVX    A,@DPTR
02EA 54C0              ANL     A,#0C0H
02EC 22                RET     
02ED         L?0593:
02ED         L?0594:
02ED 900000      E     MOV     DPTR,#VGAErrCnt
02F0 E0                MOVX    A,@DPTR
02F1 04                INC     A
02F2 F0                MOVX    @DPTR,A
02F3 22                RET     
02F4         L?0596:
02F4         L?0597:
02F4 900000      E     MOV     DPTR,#TEMP_Buff_3
02F7 E0                MOVX    A,@DPTR
02F8 9461              SUBB    A,#061H
02FA 22                RET     
02FB         L?0598:
02FB         L?0599:
02FB 900000      E     MOV     DPTR,#cGPUThrottlingSet
02FE E0                MOVX    A,@DPTR
02FF 540F              ANL     A,#0FH
0301 22                RET     
             ; FUNCTION Com01F5 (END)

             ; FUNCTION Fan_Init (BEGIN)
                                           ; SOURCE LINE # 13
                                           ; SOURCE LINE # 14
                                           ; SOURCE LINE # 15
0000 900000      E     MOV     DPTR,#nFanStatus1
0003 7402              MOV     A,#02H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 16
0006 E0                MOVX    A,@DPTR
0007 C4                SWAP    A
0008 54F0              ANL     A,#0F0H
000A 4405              ORL     A,#05H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 18
000D 900000      E     MOV     DPTR,#nOSThrottlingTemp
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 56  

0010 7462              MOV     A,#062H
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 19
0013 900000      E     MOV     DPTR,#nOSShutdownTemp
0016 7464              MOV     A,#064H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 20
0019 900000      E     MOV     DPTR,#nShutDownTemp
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 21
001D 22                RET     
             ; FUNCTION Fan_Init (END)

             ; FUNCTION PWM_TimeCount (BEGIN)
                                           ; SOURCE LINE # 29
                                           ; SOURCE LINE # 30
                                           ; SOURCE LINE # 31
0000 900000      E     MOV     DPTR,#uReserve07
0003 E0                MOVX    A,@DPTR
0004 20E018            JB      ACC.0,?C0002
                                           ; SOURCE LINE # 32
                                           ; SOURCE LINE # 33
0007 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
000A E0                MOVX    A,@DPTR
000B 7002              JNZ     ?C0003
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 36
000D 8015              SJMP    ?C0453
                                           ; SOURCE LINE # 38
000F         ?C0003:
                                           ; SOURCE LINE # 40
000F E4                CLR     A
0010 900000      E     MOV     DPTR,#GPCRA6
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 41
0014 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
0017 E0                MOVX    A,@DPTR
0018 14                DEC     A
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 43
001A E0                MOVX    A,@DPTR
001B 7012              JNZ     ?C0004
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
001D         ?C0452:
                                           ; SOURCE LINE # 46
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
001D 8005              SJMP    ?C0453
001F         ?C0002:
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
001F E4                CLR     A
0020 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 52
0024         ?C0453:
0024 900000      E     MOV     DPTR,#GPCRA6
0027 7482              MOV     A,#082H
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 53
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 57  

002A E4                CLR     A
002B 900000      E     MOV     DPTR,#DCR6
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 54
                                           ; SOURCE LINE # 55
002F         ?C0004:
002F 22                RET     
             ; FUNCTION PWM_TimeCount (END)

             ; FUNCTION ThmIC_Temperature (BEGIN)
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 65
                                           ; SOURCE LINE # 68
0000 120000      R     LCALL   L?0535
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0009
0008 900000      E     MOV     DPTR,#PwrOnDly5Sec
000B E0                MOVX    A,@DPTR
000C 6003              JZ      $ + 5H
000E 020000      R     LJMP    ?C0009
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 71
0011         ?C0007:
                                           ; SOURCE LINE # 72
0011 900000      E     MOV     DPTR,#TmlICStep
0014 E0                MOVX    A,@DPTR
0015 5403              ANL     A,#03H
0017 14                DEC     A
0018 600B              JZ      ?C0012
001A 04                INC     A
001B 700F              JNZ     ?C0013
                                           ; SOURCE LINE # 73
                                           ; SOURCE LINE # 74
001D         ?C0011:
                                           ; SOURCE LINE # 75
001D 900000      R     MOV     DPTR,#BTmlCmd
0020 7401              MOV     A,#01H
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 76
0023 800D              SJMP    ?C0010
                                           ; SOURCE LINE # 78
0025         ?C0012:
                                           ; SOURCE LINE # 79
0025 E4                CLR     A
0026 900000      R     MOV     DPTR,#BTmlCmd
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 80
002A 8006              SJMP    ?C0010
                                           ; SOURCE LINE # 82
002C         ?C0013:
                                           ; SOURCE LINE # 83
002C E4                CLR     A
002D 900000      E     MOV     DPTR,#TmlICStep
0030 F0                MOVX    @DPTR,A
0031 22                RET     
                                           ; SOURCE LINE # 85
0032         ?C0010:
                                           ; SOURCE LINE # 86
0032 900000      R     MOV     DPTR,#BTmlCmd
0035 E0                MOVX    A,@DPTR
0036 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0039 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 58  

003A A3                INC     DPTR
003B 7400        R     MOV     A,#HIGH BsData
003D F0                MOVX    @DPTR,A
003E A3                INC     DPTR
003F 7400        R     MOV     A,#LOW BsData
0041 F0                MOVX    @DPTR,A
0042 E4                CLR     A
0043 A3                INC     DPTR
0044 F0                MOVX    @DPTR,A
0045 7B98              MOV     R3,#098H
0047 7D08              MOV     R5,#08H
0049 7F03              MOV     R7,#03H
004B 120000      E     LCALL   _bRWSMBus
004E EF                MOV     A,R7
004F 7028              JNZ     ?C0014
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
0051 120000      R     LCALL   L?0545
0054 20E012            JB      ACC.0,?C0015
                                           ; SOURCE LINE # 91
                                           ; SOURCE LINE # 92
0057 900000      E     MOV     DPTR,#TMErrCnt
005A E0                MOVX    A,@DPTR
005B D3                SETB    C
005C 9407              SUBB    A,#07H
005E 4014              JC      ?C0017
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
0060 900000      E     MOV     DPTR,#ERR_THMSTS
0063 E0                MOVX    A,@DPTR
0064 4401              ORL     A,#01H
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
0067 800B              SJMP    ?C0017
0069         ?C0015:
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
0069 900000      E     MOV     DPTR,#TMErrCnt
006C E0                MOVX    A,@DPTR
006D D3                SETB    C
006E 9444              SUBB    A,#044H
0070 4002              JC      ?C0017
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 102
0072 E4                CLR     A
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 107
                                           ; SOURCE LINE # 108
0074         ?C0017:
                                           ; SOURCE LINE # 109
0074 7F03              MOV     R7,#03H
0076 020000      E     LJMP    _ResetSMBus
                                           ; SOURCE LINE # 110
0079         ?C0014:
                                           ; SOURCE LINE # 112
                                           ; SOURCE LINE # 113
0079 900000      R     MOV     DPTR,#BsData
007C E0                MOVX    A,@DPTR
007D 702B              JNZ     ?C0020
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 59  

                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 115
                                           ; SOURCE LINE # 116
                                           ; SOURCE LINE # 117
007F 120000      R     LCALL   L?0545
0082 20E011            JB      ACC.0,?C0021
                                           ; SOURCE LINE # 118
                                           ; SOURCE LINE # 119
0085 900000      E     MOV     DPTR,#TMErrCnt
0088 E0                MOVX    A,@DPTR
0089 D3                SETB    C
008A 9407              SUBB    A,#07H
008C 404B              JC      ?C0009
                                           ; SOURCE LINE # 120
                                           ; SOURCE LINE # 121
008E 900000      E     MOV     DPTR,#ERR_THMSTS
0091 E0                MOVX    A,@DPTR
0092 4401              ORL     A,#01H
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0095 22                RET     
0096         ?C0021:
                                           ; SOURCE LINE # 125
                                           ; SOURCE LINE # 126
0096 900000      E     MOV     DPTR,#TMErrCnt
0099 E0                MOVX    A,@DPTR
009A D3                SETB    C
009B 9444              SUBB    A,#044H
009D 403A              JC      ?C0009
                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
009F 7F0B              MOV     R7,#0BH
00A1 120000      E     LCALL   _ProcessSID
                                           ; SOURCE LINE # 129
00A4 E4                CLR     A
00A5 900000      E     MOV     DPTR,#TMErrCnt
00A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 134
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 136
00A9 22                RET     
00AA         ?C0020:
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
00AA 900000      E     MOV     DPTR,#TmlICStep
00AD E0                MOVX    A,@DPTR
00AE 5403              ANL     A,#03H
00B0 14                DEC     A
00B1 600C              JZ      ?C0028
00B3 04                INC     A
00B4 7023              JNZ     ?C0009
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 141
00B6         ?C0027:
                                           ; SOURCE LINE # 142
00B6 900000      R     MOV     DPTR,#BsData
00B9 E0                MOVX    A,@DPTR
00BA 900000      E     MOV     DPTR,#nRamTemp
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 145
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 60  

                                           ; SOURCE LINE # 146
00BD 8007              SJMP    ?C0454
                                           ; SOURCE LINE # 147
00BF         ?C0028:
                                           ; SOURCE LINE # 148
00BF 900000      R     MOV     DPTR,#BsData
00C2 E0                MOVX    A,@DPTR
00C3 900000      E     MOV     DPTR,#nVramTemp
00C6         ?C0454:
00C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 150
00C7 E4                CLR     A
00C8 900000      E     MOV     DPTR,#TMErrCnt
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 151
00CC 900000      E     MOV     DPTR,#ERR_THMSTS
00CF E0                MOVX    A,@DPTR
00D0 54FE              ANL     A,#0FEH
00D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 152
00D3 900000      E     MOV     DPTR,#TmlICStep
00D6 E0                MOVX    A,@DPTR
00D7 04                INC     A
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 158
                                           ; SOURCE LINE # 159
                                           ; SOURCE LINE # 161
00D9         ?C0009:
00D9 22                RET     
             ; FUNCTION ThmIC_Temperature (END)

             ; FUNCTION VGA_Temperature (BEGIN)
                                           ; SOURCE LINE # 288
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 294
0000 7800        R     MOV     R0,#LOW INIT_GPU_REG2
0002 7C00        R     MOV     R4,#HIGH INIT_GPU_REG2
0004 7A00        R     MOV     R2,#HIGH _?ix1000
0006 7900        R     MOV     R1,#LOW _?ix1000
0008 120000      R     LCALL   L?0555
                                           ; SOURCE LINE # 295
000B 7800        R     MOV     R0,#LOW INIT_GPU_REG1
000D 7C00        R     MOV     R4,#HIGH INIT_GPU_REG1
000F 7A00        R     MOV     R2,#HIGH _?ix1001
0011 7900        R     MOV     R1,#LOW _?ix1001
0013 120000      R     LCALL   L?0555
                                           ; SOURCE LINE # 296
0016 7800        R     MOV     R0,#LOW INIT_GPU_REG0
0018 7C00        R     MOV     R4,#HIGH INIT_GPU_REG0
001A 7D01              MOV     R5,#01H
001C 7BFF              MOV     R3,#0FFH
001E 7A00        R     MOV     R2,#HIGH _?ix1002
0020 7900        R     MOV     R1,#LOW _?ix1002
0022 120000      R     LCALL   L?0556
                                           ; SOURCE LINE # 298
0025 120000      R     LCALL   L?0591
0028 900000      E     MOV     DPTR,#SWITCHABLE
002B 7006              JNZ     ?C0030
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 61  

                                           ; SOURCE LINE # 299
002D E0                MOVX    A,@DPTR
002E 54FB              ANL     A,#0FBH
0030 F0                MOVX    @DPTR,A
0031 8004              SJMP    ?C0031
0033         ?C0030:
                                           ; SOURCE LINE # 301
0033 E0                MOVX    A,@DPTR
0034 4404              ORL     A,#04H
0036 F0                MOVX    @DPTR,A
0037         ?C0031:
                                           ; SOURCE LINE # 306
0037 900000      E     MOV     DPTR,#SysPowState
003A E0                MOVX    A,@DPTR
003B B41013            CJNE    A,#010H,?C0033
003E 900000      E     MOV     DPTR,#SWITCHABLE
0041 E0                MOVX    A,@DPTR
0042 30E203            JNB     ACC.2,?C0034
0045 D3                SETB    C
0046 8001              SJMP    ?C0035
0048         ?C0034:
0048 C3                CLR     C
0049         ?C0035:
0049 5006              JNC     ?C0033
004B 900000      E     MOV     DPTR,#PwrOnDly5Sec
004E E0                MOVX    A,@DPTR
004F 6010              JZ      ?C0032
0051         ?C0033:
                                           ; SOURCE LINE # 307
                                           ; SOURCE LINE # 308
0051 E4                CLR     A
0052 900000      E     MOV     DPTR,#VGAErrCnt
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 309
0056 900000      E     MOV     DPTR,#VGA_TEMP
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 310
005A 900000      E     MOV     DPTR,#VGA_TBuff3
                                           ; SOURCE LINE # 311
005D 120000      R     LCALL   L?0558
0060 22                RET     
                                           ; SOURCE LINE # 313
0061         ?C0032:
                                           ; SOURCE LINE # 315
0061 120000      R     LCALL   L?0591
0064 6440              XRL     A,#040H
0066 6003              JZ      $ + 5H
0068 020000      R     LJMP    ?C0037
                                           ; SOURCE LINE # 316
                                           ; SOURCE LINE # 318
006B 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
006E 04                INC     A
006F F0                MOVX    @DPTR,A
0070 A3                INC     DPTR
0071 7400        R     MOV     A,#HIGH INIT_GPU_REG1
0073 F0                MOVX    @DPTR,A
0074 7400        R     MOV     A,#LOW INIT_GPU_REG1
0076 120000      R     LCALL   L?0530
0079 7003              JNZ     ?C0038
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 320
007B 120000      R     LCALL   L?0593
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 62  

                                           ; SOURCE LINE # 321
007E         ?C0038:
                                           ; SOURCE LINE # 322
007E 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
0081 7402              MOV     A,#02H
0083 F0                MOVX    @DPTR,A
0084 A3                INC     DPTR
0085 7400        R     MOV     A,#HIGH INIT_GPU_REG0
0087 F0                MOVX    @DPTR,A
0088 7400        R     MOV     A,#LOW INIT_GPU_REG0
008A 120000      R     LCALL   L?0530
008D 7003              JNZ     ?C0039
                                           ; SOURCE LINE # 323
                                           ; SOURCE LINE # 324
008F 120000      R     LCALL   L?0593
                                           ; SOURCE LINE # 325
0092         ?C0039:
                                           ; SOURCE LINE # 327
0092 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
0095 7401              MOV     A,#01H
0097 F0                MOVX    @DPTR,A
0098 A3                INC     DPTR
0099 7400        R     MOV     A,#HIGH INIT_GPU_REG2
009B F0                MOVX    @DPTR,A
009C A3                INC     DPTR
009D 7400        R     MOV     A,#LOW INIT_GPU_REG2
009F F0                MOVX    @DPTR,A
00A0 A3                INC     DPTR
00A1 7404              MOV     A,#04H
00A3 F0                MOVX    @DPTR,A
00A4 E4                CLR     A
00A5 A3                INC     DPTR
00A6 F0                MOVX    @DPTR,A
00A7 7B82              MOV     R3,#082H
00A9 7D94              MOV     R5,#094H
00AB 7F03              MOV     R7,#03H
00AD 120000      E     LCALL   _bWSMBusBlock
00B0 EF                MOV     A,R7
00B1 7003              JNZ     ?C0040
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
00B3 120000      R     LCALL   L?0594
                                           ; SOURCE LINE # 330
00B6         ?C0040:
                                           ; SOURCE LINE # 341
00B6 900000      E     MOV     DPTR,#?_bRSMBusBlock?BYTE+03H
00B9 7403              MOV     A,#03H
00BB F0                MOVX    @DPTR,A
00BC 7E00        E     MOV     R6,#HIGH sdAMDTH0
00BE A3                INC     DPTR
00BF 7400        E     MOV     A,#HIGH sdAMDTH0
00C1 F0                MOVX    @DPTR,A
00C2 A3                INC     DPTR
00C3 7400        E     MOV     A,#LOW sdAMDTH0
00C5 F0                MOVX    @DPTR,A
00C6 7B82              MOV     R3,#082H
00C8 7D14              MOV     R5,#014H
00CA 7F03              MOV     R7,#03H
00CC 120000      E     LCALL   _bRSMBusBlock
00CF EF                MOV     A,R7
00D0 702A              JNZ     ?C0041
                                           ; SOURCE LINE # 342
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 63  

                                           ; SOURCE LINE # 343
00D2 900000      E     MOV     DPTR,#VGAErrCnt
                                           ; SOURCE LINE # 344
00D5 120000      R     LCALL   L?0546
00D8 20E10E            JB      ACC.1,?C0042
                                           ; SOURCE LINE # 345
                                           ; SOURCE LINE # 346
00DB 900000      E     MOV     DPTR,#VGAErrCnt
00DE E0                MOVX    A,@DPTR
00DF D3                SETB    C
00E0 9423              SUBB    A,#023H
00E2 4011              JC      ?C0044
                                           ; SOURCE LINE # 347
                                           ; SOURCE LINE # 348
00E4 120000      R     LCALL   L?0582
                                           ; SOURCE LINE # 349
                                           ; SOURCE LINE # 350
00E7 800C              SJMP    ?C0044
00E9         ?C0042:
                                           ; SOURCE LINE # 352
                                           ; SOURCE LINE # 353
00E9 900000      E     MOV     DPTR,#VGAErrCnt
00EC E0                MOVX    A,@DPTR
00ED D3                SETB    C
00EE 94FE              SUBB    A,#0FEH
00F0 4003              JC      ?C0044
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 358
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
00F2 120000      R     LCALL   L?0512
                                           ; SOURCE LINE # 361
                                           ; SOURCE LINE # 362
00F5         ?C0044:
                                           ; SOURCE LINE # 363
00F5 7F03              MOV     R7,#03H
00F7 120000      E     LCALL   _ResetSMBus
                                           ; SOURCE LINE # 364
00FA 8021              SJMP    ?C0037
00FC         ?C0041:
                                           ; SOURCE LINE # 367
                                           ; SOURCE LINE # 368
00FC 900000      E     MOV     DPTR,#sdAMDTH0
00FF 120000      E     LCALL   ?C?LLDXDATA
0102 900000      E     MOV     DPTR,#VGA_TEMP
0105 EF                MOV     A,R7
                                           ; SOURCE LINE # 369
                                           ; SOURCE LINE # 370
0106 120000      R     LCALL   L?0557
                                           ; SOURCE LINE # 372
0109 900000      E     MOV     DPTR,#Fan_Debug_Temp
010C E0                MOVX    A,@DPTR
010D 20E10D            JB      ACC.1,?C0037
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
0110 900000      E     MOV     DPTR,#VGA_TEMP
0113 E0                MOVX    A,@DPTR
0114 30E703            JNB     ACC.7,$ + 6H
0117 020000      R     LJMP    ?C0036
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 64  

                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 377
011A         ?C0048:
                                           ; SOURCE LINE # 379
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 382
                                           ; SOURCE LINE # 383
011A 120000      R     LCALL   L?0514
                                           ; SOURCE LINE # 384
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
                                           ; SOURCE LINE # 387
011D         ?C0037:
                                           ; SOURCE LINE # 389
011D 120000      R     LCALL   L?0592
0120 6480              XRL     A,#080H
0122 6003              JZ      $ + 5H
0124 020000      R     LJMP    ?C0036
                                           ; SOURCE LINE # 390
                                           ; SOURCE LINE # 391
0127 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
012A F0                MOVX    @DPTR,A
012B A3                INC     DPTR
012C 7400        R     MOV     A,#HIGH BsData
012E F0                MOVX    @DPTR,A
012F A3                INC     DPTR
0130 7400        R     MOV     A,#LOW BsData
0132 F0                MOVX    @DPTR,A
0133 E4                CLR     A
0134 A3                INC     DPTR
0135 F0                MOVX    @DPTR,A
0136 7B9E              MOV     R3,#09EH
0138 7D08              MOV     R5,#08H
013A 7F03              MOV     R7,#03H
013C 120000      E     LCALL   _bRWSMBus
013F EF                MOV     A,R7
0140 7028              JNZ     ?C0051
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
0142 900000      E     MOV     DPTR,#VGAErrCnt
                                           ; SOURCE LINE # 396
0145 120000      R     LCALL   L?0546
0148 20E10E            JB      ACC.1,?C0052
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
014B 900000      E     MOV     DPTR,#VGAErrCnt
014E E0                MOVX    A,@DPTR
014F D3                SETB    C
0150 9423              SUBB    A,#023H
0152 4011              JC      ?C0054
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
0154 120000      R     LCALL   L?0582
                                           ; SOURCE LINE # 401
                                           ; SOURCE LINE # 402
0157 800C              SJMP    ?C0054
0159         ?C0052:
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
0159 900000      E     MOV     DPTR,#VGAErrCnt
015C E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 65  

015D D3                SETB    C
015E 94FE              SUBB    A,#0FEH
0160 4003              JC      ?C0054
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
                                           ; SOURCE LINE # 410
                                           ; SOURCE LINE # 411
                                           ; SOURCE LINE # 412
0162 120000      R     LCALL   L?0512
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
0165         ?C0054:
                                           ; SOURCE LINE # 415
0165 7F03              MOV     R7,#03H
0167 020000      E     LJMP    _ResetSMBus
                                           ; SOURCE LINE # 416
016A         ?C0051:
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
016A 900000      R     MOV     DPTR,#BsData
016D E0                MOVX    A,@DPTR
016E FF                MOV     R7,A
016F 7049              JNZ     ?C0057
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
0171 900000      E     MOV     DPTR,#VGA_TEMP
0174 EF                MOV     A,R7
0175 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 423
0176 900000      E     MOV     DPTR,#VGAErrCnt
                                           ; SOURCE LINE # 424
0179 120000      R     LCALL   L?0546
017C 20E10D            JB      ACC.1,?C0058
                                           ; SOURCE LINE # 425
                                           ; SOURCE LINE # 426
017F 900000      E     MOV     DPTR,#VGAErrCnt
0182 E0                MOVX    A,@DPTR
0183 D3                SETB    C
0184 9407              SUBB    A,#07H
0186 404D              JC      ?C0036
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
0188 120000      R     LCALL   L?0583
                                           ; SOURCE LINE # 429
                                           ; SOURCE LINE # 430
018B 22                RET     
018C         ?C0058:
                                           ; SOURCE LINE # 432
                                           ; SOURCE LINE # 433
018C 900000      E     MOV     DPTR,#VGAErrCnt
018F E0                MOVX    A,@DPTR
0190 D3                SETB    C
0191 9444              SUBB    A,#044H
0193 4040              JC      ?C0036
                                           ; SOURCE LINE # 434
                                           ; SOURCE LINE # 435
0195 900000      E     MOV     DPTR,#SysStatus
0198 E0                MOVX    A,@DPTR
0199 4402              ORL     A,#02H
019B F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 66  

                                           ; SOURCE LINE # 436
019C 7F20              MOV     R7,#020H
019E 120000      E     LCALL   _ProcessSID
                                           ; SOURCE LINE # 437
01A1 E4                CLR     A
01A2 900000      E     MOV     DPTR,#VGAErrCnt
01A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
01A6 900000      E     MOV     DPTR,#GPDRC
01A9 E0                MOVX    A,@DPTR
01AA 54FE              ANL     A,#0FEH
01AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 439
01AD 7F01              MOV     R7,#01H
01AF 120000      E     LCALL   _Delay1MS
                                           ; SOURCE LINE # 440
01B2 900000      E     MOV     DPTR,#GPDRC
01B5 E0                MOVX    A,@DPTR
01B6 4401              ORL     A,#01H
01B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 441
                                           ; SOURCE LINE # 442
                                           ; SOURCE LINE # 443
01B9 22                RET     
01BA         ?C0057:
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 446
01BA 900000      R     MOV     DPTR,#BsData
01BD E0                MOVX    A,@DPTR
01BE 900000      E     MOV     DPTR,#VGA_TEMP
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 448
01C1 120000      R     LCALL   L?0557
                                           ; SOURCE LINE # 450
01C4 900000      E     MOV     DPTR,#Fan_Debug_Temp
01C7 E0                MOVX    A,@DPTR
01C8 20E10A            JB      ACC.1,?C0036
                                           ; SOURCE LINE # 451
                                           ; SOURCE LINE # 452
01CB 900000      E     MOV     DPTR,#VGA_TEMP
01CE E0                MOVX    A,@DPTR
01CF 20E703            JB      ACC.7,?C0036
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 455
01D2         ?C0064:
                                           ; SOURCE LINE # 457
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
01D2 120000      R     LCALL   L?0514
                                           ; SOURCE LINE # 462
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 465
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 468
01D5         ?C0036:
01D5 22                RET     
01D6         L?0512:
01D6 900000      E     MOV     DPTR,#SysStatus
01D9 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 67  

01DA 4402              ORL     A,#02H
01DC F0                MOVX    @DPTR,A
01DD 7F20              MOV     R7,#020H
01DF 120000      E     LCALL   _ProcessSID
01E2 E4                CLR     A
01E3 900000      E     MOV     DPTR,#VGAErrCnt
01E6 F0                MOVX    @DPTR,A
01E7 900000      E     MOV     DPTR,#GPDRC
01EA E0                MOVX    A,@DPTR
01EB 54FE              ANL     A,#0FEH
01ED F0                MOVX    @DPTR,A
01EE 7F01              MOV     R7,#01H
01F0 120000      E     LCALL   _Delay1MS
01F3 900000      E     MOV     DPTR,#GPDRC
01F6 E0                MOVX    A,@DPTR
01F7 4401              ORL     A,#01H
01F9 F0                MOVX    @DPTR,A
01FA 22                RET     
01FB         L?0530:
01FB A3                INC     DPTR
01FC F0                MOVX    @DPTR,A
01FD A3                INC     DPTR
01FE 7404              MOV     A,#04H
0200 F0                MOVX    @DPTR,A
0201 E4                CLR     A
0202 A3                INC     DPTR
0203 F0                MOVX    @DPTR,A
0204 7B82              MOV     R3,#082H
0206 7D94              MOV     R5,#094H
0208 7F03              MOV     R7,#03H
020A 120000      E     LCALL   _bWSMBusBlock
020D EF                MOV     A,R7
020E 22                RET     
             ; FUNCTION VGA_Temperature (END)

             ; FUNCTION Oem_Thermal_Control (BEGIN)
                                           ; SOURCE LINE # 478
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 482
0000 120000      R     LCALL   L?0535
0003 705E              JNZ     ?C0075
0005 900000      E     MOV     DPTR,#PwrOnDly5Sec
0008 E0                MOVX    A,@DPTR
0009 7058              JNZ     ?C0075
000B 900000      E     MOV     DPTR,#GPDRD
000E E0                MOVX    A,@DPTR
000F 30E051            JNB     ACC.0,?C0075
0012 E0                MOVX    A,@DPTR
0013 30E14D            JNB     ACC.1,?C0075
                                           ; SOURCE LINE # 483
                                           ; SOURCE LINE # 484
0016 900000      E     MOV     DPTR,#TJMAX
0019 E0                MOVX    A,@DPTR
001A 703A              JNZ     ?C0067
                                           ; SOURCE LINE # 485
                                           ; SOURCE LINE # 486
001C 120000      E     LCALL   PECI_ReadCPUTJMAX
                                           ; SOURCE LINE # 487
001F 900000      E     MOV     DPTR,#CPU_TYPE
0022 E0                MOVX    A,@DPTR
0023 54FC              ANL     A,#0FCH
0025 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 68  

                                           ; SOURCE LINE # 488
0026 900000      E     MOV     DPTR,#TJMAX
0029 E0                MOVX    A,@DPTR
002A B46909            CJNE    A,#069H,?C0068
                                           ; SOURCE LINE # 489
002D 900000      E     MOV     DPTR,#CPU_TYPE
0030 E0                MOVX    A,@DPTR
0031 4403              ORL     A,#03H
0033 F0                MOVX    @DPTR,A
0034 8023              SJMP    ?C0073
0036         ?C0068:
                                           ; SOURCE LINE # 490
0036 900000      E     MOV     DPTR,#TJMAX
0039 E0                MOVX    A,@DPTR
003A B46409            CJNE    A,#064H,?C0070
                                           ; SOURCE LINE # 491
003D 900000      E     MOV     DPTR,#CPU_TYPE
0040 E0                MOVX    A,@DPTR
0041 4402              ORL     A,#02H
0043 F0                MOVX    @DPTR,A
0044 8013              SJMP    ?C0073
0046         ?C0070:
                                           ; SOURCE LINE # 492
0046 900000      E     MOV     DPTR,#TJMAX
0049 E0                MOVX    A,@DPTR
004A B45A0C            CJNE    A,#05AH,?C0073
                                           ; SOURCE LINE # 493
004D 900000      E     MOV     DPTR,#CPU_TYPE
0050 E0                MOVX    A,@DPTR
0051 4401              ORL     A,#01H
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
0054 8003              SJMP    ?C0073
0056         ?C0067:
                                           ; SOURCE LINE # 496
0056 120000      E     LCALL   PECI_ReadCPUTemp
0059         ?C0073:
                                           ; SOURCE LINE # 498
0059 900000      E     MOV     DPTR,#ERR_THMSTS
005C E0                MOVX    A,@DPTR
005D 30E303            JNB     ACC.3,?C0075
                                           ; SOURCE LINE # 499
                                           ; SOURCE LINE # 500
0060 120000      E     LCALL   DTS_ReadCPUTemp
                                           ; SOURCE LINE # 501
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 504
0063         ?C0075:
0063 22                RET     
             ; FUNCTION Oem_Thermal_Control (END)

             ; FUNCTION Oem_Fan_Speed (BEGIN)
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 513
                                           ; SOURCE LINE # 515
0000 120000      R     LCALL   L?0536
0003 703D              JNZ     ?C0079
                                           ; SOURCE LINE # 516
                                           ; SOURCE LINE # 517
0005 900000      E     MOV     DPTR,#F1TMRR
0008 E0                MOVX    A,@DPTR
0009 700B              JNZ     ?C0077
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 69  

000B 900000      E     MOV     DPTR,#F1TLRR
000E E0                MOVX    A,@DPTR
000F 7005              JNZ     ?C0077
                                           ; SOURCE LINE # 518
                                           ; SOURCE LINE # 519
0011 900000      E     MOV     DPTR,#nAtmFanSpeed
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 520
0015 22                RET     
0016         ?C0077:
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
0016 900000      E     MOV     DPTR,#F1TMRR
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#F1TLRR
001D 120000      R     LCALL   L?0531
0020 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
0023 EE                MOV     A,R6
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 524
0028 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
002B 120000      R     LCALL   L?0581
002E 900000      E     MOV     DPTR,#nAtmFanSpeed
0031 EF                MOV     A,R7
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 525
0033 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A 900000      E     MOV     DPTR,#FAN1_RPM
003D CF                XCH     A,R7
003E F0                MOVX    @DPTR,A
003F A3                INC     DPTR
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
0042         ?C0079:
0042 22                RET     
             ; FUNCTION Oem_Fan_Speed (END)

             ; FUNCTION Oem_Fan1_Speed (BEGIN)
                                           ; SOURCE LINE # 531
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 534
0000 120000      R     LCALL   L?0536
0003 703D              JNZ     ?C0083
                                           ; SOURCE LINE # 535
                                           ; SOURCE LINE # 536
0005 900000      E     MOV     DPTR,#F2TMRR
0008 E0                MOVX    A,@DPTR
0009 700B              JNZ     ?C0081
000B 900000      E     MOV     DPTR,#F2TLRR
000E E0                MOVX    A,@DPTR
000F 7005              JNZ     ?C0081
                                           ; SOURCE LINE # 537
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 70  

                                           ; SOURCE LINE # 538
0011 900000      E     MOV     DPTR,#nAtmFan1Speed
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
0015 22                RET     
0016         ?C0081:
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
0016 900000      E     MOV     DPTR,#F2TMRR
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#F2TLRR
001D 120000      R     LCALL   L?0531
0020 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
0023 EE                MOV     A,R6
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 543
0028 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
002B 120000      R     LCALL   L?0581
002E 900000      E     MOV     DPTR,#nAtmFan1Speed
0031 EF                MOV     A,R7
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 544
0033 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A 900000      E     MOV     DPTR,#FAN2_RPM
003D CF                XCH     A,R7
003E F0                MOVX    @DPTR,A
003F A3                INC     DPTR
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 545
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 548
0042         ?C0083:
0042 22                RET     
             ; FUNCTION Oem_Fan1_Speed (END)

             ; FUNCTION InitThermalTable1 (BEGIN)
                                           ; SOURCE LINE # 746
                                           ; SOURCE LINE # 747
                                           ; SOURCE LINE # 749
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 750
0002 900000      E     MOV     DPTR,#ThermalMode
0005 E0                MOVX    A,@DPTR
0006 B40107            CJNE    A,#01H,?C0084
                                           ; SOURCE LINE # 751
                                           ; SOURCE LINE # 752
0009 E4                CLR     A
000A 900000      E     MOV     DPTR,#QuiteMode
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 753
                                           ; SOURCE LINE # 754
000E 800E              SJMP    ?C0455
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 71  

0010         ?C0084:
                                           ; SOURCE LINE # 755
0010 900000      E     MOV     DPTR,#ThermalMode
0013 E0                MOVX    A,@DPTR
0014 B4020D            CJNE    A,#02H,?C0086
                                           ; SOURCE LINE # 756
                                           ; SOURCE LINE # 757
0017 900000      E     MOV     DPTR,#QuiteMode
001A 7401              MOV     A,#01H
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 758
001D E4                CLR     A
001E         ?C0455:
001E 900000      E     MOV     DPTR,#HighPerf
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 759
0022 8011              SJMP    ?C0085
0024         ?C0086:
                                           ; SOURCE LINE # 760
0024 900000      E     MOV     DPTR,#ThermalMode
0027 E0                MOVX    A,@DPTR
0028 B4030A            CJNE    A,#03H,?C0085
                                           ; SOURCE LINE # 761
                                           ; SOURCE LINE # 762
002B E4                CLR     A
002C 900000      E     MOV     DPTR,#QuiteMode
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
0030 900000      E     MOV     DPTR,#HighPerf
0033 04                INC     A
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
0035         ?C0085:
                                           ; SOURCE LINE # 766
0035 900000      E     MOV     DPTR,#GPDRC
0038 E0                MOVX    A,@DPTR
0039 20E503            JB      ACC.5,$ + 6H
003C 020000      R     LJMP    ?C0089
                                           ; SOURCE LINE # 767
                                           ; SOURCE LINE # 768
003F 900000      E     MOV     DPTR,#FanTable_Type
0042 E0                MOVX    A,@DPTR
0043 7023              JNZ     ?C0090
                                           ; SOURCE LINE # 769
                                           ; SOURCE LINE # 770
0045 900000      E     MOV     DPTR,#uMBGPU
0048 E0                MOVX    A,@DPTR
0049 30E10B            JNB     ACC.1,?C0091
                                           ; SOURCE LINE # 771
                                           ; SOURCE LINE # 772
004C 900000      E     MOV     DPTR,#nRamTemp
004F E0                MOVX    A,@DPTR
0050 C3                CLR     C
0051 9430              SUBB    A,#030H
0053 4033              JC      ?C0095
                                           ; SOURCE LINE # 773
                                           ; SOURCE LINE # 774
0055 8009              SJMP    ?C0456
0057         ?C0091:
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 777
0057 900000      E     MOV     DPTR,#nRamTemp
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 72  

005A E0                MOVX    A,@DPTR
005B C3                CLR     C
005C 9433              SUBB    A,#033H
005E 4028              JC      ?C0095
                                           ; SOURCE LINE # 778
0060         ?C0456:
0060 900000      E     MOV     DPTR,#FanTable_Type
0063 7401              MOV     A,#01H
0065 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 780
0066 8020              SJMP    ?C0095
0068         ?C0090:
                                           ; SOURCE LINE # 782
                                           ; SOURCE LINE # 783
0068 900000      E     MOV     DPTR,#uMBGPU
006B E0                MOVX    A,@DPTR
006C 30E10B            JNB     ACC.1,?C0096
                                           ; SOURCE LINE # 784
                                           ; SOURCE LINE # 785
006F 900000      E     MOV     DPTR,#nRamTemp
0072 E0                MOVX    A,@DPTR
0073 D3                SETB    C
0074 942D              SUBB    A,#02DH
0076 5010              JNC     ?C0095
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 787
0078 8009              SJMP    ?C0457
007A         ?C0096:
                                           ; SOURCE LINE # 789
                                           ; SOURCE LINE # 790
007A 900000      E     MOV     DPTR,#nRamTemp
007D E0                MOVX    A,@DPTR
007E D3                SETB    C
007F 9430              SUBB    A,#030H
0081 5005              JNC     ?C0095
                                           ; SOURCE LINE # 791
0083         ?C0457:
0083 E4                CLR     A
0084 900000      E     MOV     DPTR,#FanTable_Type
0087 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 792
                                           ; SOURCE LINE # 793
0088         ?C0095:
                                           ; SOURCE LINE # 794
0088 900000      E     MOV     DPTR,#uMBGPU
008B E0                MOVX    A,@DPTR
008C 20E103            JB      ACC.1,$ + 6H
008F 020000      R     LJMP    ?C0100
                                           ; SOURCE LINE # 795
                                           ; SOURCE LINE # 796
0092 900000      E     MOV     DPTR,#FanTable_Type
0095 E0                MOVX    A,@DPTR
0096 7034              JNZ     ?C0101
                                           ; SOURCE LINE # 797
0098         ?C0102:
                                           ; SOURCE LINE # 798
0098 EF                MOV     A,R7
0099 C3                CLR     C
009A 9407              SUBB    A,#07H
009C 4003              JC      $ + 5H
009E 020000      R     LJMP    ?C0145
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 73  

                                           ; SOURCE LINE # 799
                                           ; SOURCE LINE # 800
00A1 EF                MOV     A,R7
00A2 25E0              ADD     A,ACC
00A4 25E0              ADD     A,ACC
00A6 2400        R     ADD     A,#LOW Fan1Talbe1DISYOGA+01H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        R     ADDC    A,#HIGH Fan1Talbe1DISYOGA+01H
                                           ; SOURCE LINE # 801
00AD 120000      R     LCALL   L?0502
00B0 2400        R     ADD     A,#LOW Fan1Talbe1DISYOGA+02H
00B2 F582              MOV     DPL,A
00B4 E4                CLR     A
00B5 3400        R     ADDC    A,#HIGH Fan1Talbe1DISYOGA+02H
00B7 120000      R     LCALL   L?0508
00BA 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 802
00BD 120000      R     LCALL   L?0504
00C0 2400        R     ADD     A,#LOW Fan1Talbe1DISYOGA+03H
00C2 F582              MOV     DPL,A
00C4 E4                CLR     A
00C5 3400        R     ADDC    A,#HIGH Fan1Talbe1DISYOGA+03H
                                           ; SOURCE LINE # 803
00C7 120000      R     LCALL   L?0505
                                           ; SOURCE LINE # 804
00CA 80CC              SJMP    ?C0102
                                           ; SOURCE LINE # 805
00CC         ?C0101:
                                           ; SOURCE LINE # 807
                                           ; SOURCE LINE # 808
00CC 900000      E     MOV     DPTR,#QuiteMode
00CF E0                MOVX    A,@DPTR
00D0 6034              JZ      ?C0109
                                           ; SOURCE LINE # 809
00D2         ?C0106:
                                           ; SOURCE LINE # 810
00D2 EF                MOV     A,R7
00D3 C3                CLR     C
00D4 9407              SUBB    A,#07H
00D6 4003              JC      $ + 5H
00D8 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 811
                                           ; SOURCE LINE # 812
00DB EF                MOV     A,R7
00DC 25E0              ADD     A,ACC
00DE 25E0              ADD     A,ACC
00E0 2400        R     ADD     A,#LOW Fan1Talbe2QDISYOGA+01H
00E2 F582              MOV     DPL,A
00E4 E4                CLR     A
00E5 3400        R     ADDC    A,#HIGH Fan1Talbe2QDISYOGA+01H
                                           ; SOURCE LINE # 813
00E7 120000      R     LCALL   L?0502
00EA 2400        R     ADD     A,#LOW Fan1Talbe2QDISYOGA+02H
00EC F582              MOV     DPL,A
00EE E4                CLR     A
00EF 3400        R     ADDC    A,#HIGH Fan1Talbe2QDISYOGA+02H
00F1 120000      R     LCALL   L?0508
00F4 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 814
00F7 120000      R     LCALL   L?0504
00FA 2400        R     ADD     A,#LOW Fan1Talbe2QDISYOGA+03H
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 74  

00FC F582              MOV     DPL,A
00FE E4                CLR     A
00FF 3400        R     ADDC    A,#HIGH Fan1Talbe2QDISYOGA+03H
                                           ; SOURCE LINE # 815
0101 120000      R     LCALL   L?0505
                                           ; SOURCE LINE # 816
0104 80CC              SJMP    ?C0106
                                           ; SOURCE LINE # 817
                                           ; SOURCE LINE # 819
0106         ?C0109:
                                           ; SOURCE LINE # 820
0106 EF                MOV     A,R7
0107 C3                CLR     C
0108 9407              SUBB    A,#07H
010A 4003              JC      $ + 5H
010C 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
010F EF                MOV     A,R7
0110 25E0              ADD     A,ACC
0112 25E0              ADD     A,ACC
0114 2400        R     ADD     A,#LOW Fan1Talbe2DISYOGA+01H
0116 F582              MOV     DPL,A
0118 E4                CLR     A
0119 3400        R     ADDC    A,#HIGH Fan1Talbe2DISYOGA+01H
                                           ; SOURCE LINE # 823
011B 120000      R     LCALL   L?0503
011E 2400        R     ADD     A,#LOW Fan1Talbe2DISYOGA+02H
0120 F582              MOV     DPL,A
0122 E4                CLR     A
0123 3400        R     ADDC    A,#HIGH Fan1Talbe2DISYOGA+02H
0125 120000      R     LCALL   L?0509
0128 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 824
012B 120000      R     LCALL   L?0504
012E 2400        R     ADD     A,#LOW Fan1Talbe2DISYOGA+03H
0130 F582              MOV     DPL,A
0132 E4                CLR     A
0133 3400        R     ADDC    A,#HIGH Fan1Talbe2DISYOGA+03H
                                           ; SOURCE LINE # 825
0135 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 826
0138 80CC              SJMP    ?C0109
                                           ; SOURCE LINE # 827
                                           ; SOURCE LINE # 828
                                           ; SOURCE LINE # 829
013A         ?C0100:
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 832
013A 900000      E     MOV     DPTR,#FanTable_Type
013D E0                MOVX    A,@DPTR
013E 7034              JNZ     ?C0112
                                           ; SOURCE LINE # 833
0140         ?C0113:
                                           ; SOURCE LINE # 834
0140 EF                MOV     A,R7
0141 C3                CLR     C
0142 9407              SUBB    A,#07H
0144 4003              JC      $ + 5H
0146 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 835
                                           ; SOURCE LINE # 836
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 75  

0149 EF                MOV     A,R7
014A 25E0              ADD     A,ACC
014C 25E0              ADD     A,ACC
014E 2400        R     ADD     A,#LOW Fan1Talbe1UMAYOGA+01H
0150 F582              MOV     DPL,A
0152 E4                CLR     A
0153 3400        R     ADDC    A,#HIGH Fan1Talbe1UMAYOGA+01H
                                           ; SOURCE LINE # 837
0155 120000      R     LCALL   L?0503
0158 2400        R     ADD     A,#LOW Fan1Talbe1UMAYOGA+02H
015A F582              MOV     DPL,A
015C E4                CLR     A
015D 3400        R     ADDC    A,#HIGH Fan1Talbe1UMAYOGA+02H
015F 120000      R     LCALL   L?0509
0162 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 838
0165 120000      R     LCALL   L?0504
0168 2400        R     ADD     A,#LOW Fan1Talbe1UMAYOGA+03H
016A F582              MOV     DPL,A
016C E4                CLR     A
016D 3400        R     ADDC    A,#HIGH Fan1Talbe1UMAYOGA+03H
                                           ; SOURCE LINE # 839
016F 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 840
0172 80CC              SJMP    ?C0113
                                           ; SOURCE LINE # 841
0174         ?C0112:
                                           ; SOURCE LINE # 843
                                           ; SOURCE LINE # 844
0174 900000      E     MOV     DPTR,#QuiteMode
0177 E0                MOVX    A,@DPTR
0178 6034              JZ      ?C0120
                                           ; SOURCE LINE # 845
017A         ?C0117:
                                           ; SOURCE LINE # 846
017A EF                MOV     A,R7
017B C3                CLR     C
017C 9407              SUBB    A,#07H
017E 4003              JC      $ + 5H
0180 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 847
                                           ; SOURCE LINE # 848
0183 EF                MOV     A,R7
0184 25E0              ADD     A,ACC
0186 25E0              ADD     A,ACC
0188 2400        R     ADD     A,#LOW Fan1Talbe2QUMAYOGA+01H
018A F582              MOV     DPL,A
018C E4                CLR     A
018D 3400        R     ADDC    A,#HIGH Fan1Talbe2QUMAYOGA+01H
                                           ; SOURCE LINE # 849
018F 120000      R     LCALL   L?0503
0192 2400        R     ADD     A,#LOW Fan1Talbe2QUMAYOGA+02H
0194 F582              MOV     DPL,A
0196 E4                CLR     A
0197 3400        R     ADDC    A,#HIGH Fan1Talbe2QUMAYOGA+02H
0199 120000      R     LCALL   L?0509
019C 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 850
019F 120000      R     LCALL   L?0504
01A2 2400        R     ADD     A,#LOW Fan1Talbe2QUMAYOGA+03H
01A4 F582              MOV     DPL,A
01A6 E4                CLR     A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 76  

01A7 3400        R     ADDC    A,#HIGH Fan1Talbe2QUMAYOGA+03H
                                           ; SOURCE LINE # 851
01A9 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 852
01AC 80CC              SJMP    ?C0117
                                           ; SOURCE LINE # 853
                                           ; SOURCE LINE # 855
01AE         ?C0120:
                                           ; SOURCE LINE # 856
01AE EF                MOV     A,R7
01AF C3                CLR     C
01B0 9407              SUBB    A,#07H
01B2 4003              JC      $ + 5H
01B4 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 857
                                           ; SOURCE LINE # 858
01B7 EF                MOV     A,R7
01B8 25E0              ADD     A,ACC
01BA 25E0              ADD     A,ACC
01BC 2400        R     ADD     A,#LOW Fan1Talbe2UMAYOGA+01H
01BE F582              MOV     DPL,A
01C0 E4                CLR     A
01C1 3400        R     ADDC    A,#HIGH Fan1Talbe2UMAYOGA+01H
                                           ; SOURCE LINE # 859
01C3 120000      R     LCALL   L?0503
01C6 2400        R     ADD     A,#LOW Fan1Talbe2UMAYOGA+02H
01C8 F582              MOV     DPL,A
01CA E4                CLR     A
01CB 3400        R     ADDC    A,#HIGH Fan1Talbe2UMAYOGA+02H
01CD 120000      R     LCALL   L?0509
01D0 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 860
01D3 120000      R     LCALL   L?0504
01D6 2400        R     ADD     A,#LOW Fan1Talbe2UMAYOGA+03H
01D8 F582              MOV     DPL,A
01DA E4                CLR     A
01DB 3400        R     ADDC    A,#HIGH Fan1Talbe2UMAYOGA+03H
                                           ; SOURCE LINE # 861
01DD 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 862
01E0 80CC              SJMP    ?C0120
                                           ; SOURCE LINE # 863
                                           ; SOURCE LINE # 864
                                           ; SOURCE LINE # 865
                                           ; SOURCE LINE # 866
01E2         ?C0089:
                                           ; SOURCE LINE # 868
                                           ; SOURCE LINE # 869
01E2 900000      E     MOV     DPTR,#FanTable_Type
01E5 E0                MOVX    A,@DPTR
01E6 7011              JNZ     ?C0123
                                           ; SOURCE LINE # 870
                                           ; SOURCE LINE # 871
01E8 900000      E     MOV     DPTR,#nRamTemp
01EB E0                MOVX    A,@DPTR
01EC C3                CLR     C
01ED 9432              SUBB    A,#032H
01EF 4016              JC      ?C0125
                                           ; SOURCE LINE # 872
01F1 900000      E     MOV     DPTR,#FanTable_Type
01F4 7401              MOV     A,#01H
01F6 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 77  

                                           ; SOURCE LINE # 873
01F7 800E              SJMP    ?C0125
01F9         ?C0123:
                                           ; SOURCE LINE # 875
                                           ; SOURCE LINE # 876
01F9 900000      E     MOV     DPTR,#nRamTemp
01FC E0                MOVX    A,@DPTR
01FD D3                SETB    C
01FE 942D              SUBB    A,#02DH
0200 5005              JNC     ?C0125
                                           ; SOURCE LINE # 877
0202 E4                CLR     A
0203 900000      E     MOV     DPTR,#FanTable_Type
0206 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 878
0207         ?C0125:
                                           ; SOURCE LINE # 880
0207 900000      E     MOV     DPTR,#uMBGPU
020A E0                MOVX    A,@DPTR
020B 20E103            JB      ACC.1,$ + 6H
020E 020000      R     LJMP    ?C0127
                                           ; SOURCE LINE # 881
                                           ; SOURCE LINE # 882
0211 900000      E     MOV     DPTR,#FanTable_Type
0214 E0                MOVX    A,@DPTR
0215 7034              JNZ     ?C0128
                                           ; SOURCE LINE # 883
0217         ?C0129:
                                           ; SOURCE LINE # 884
0217 EF                MOV     A,R7
0218 C3                CLR     C
0219 9407              SUBB    A,#07H
021B 4003              JC      $ + 5H
021D 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 885
                                           ; SOURCE LINE # 886
0220 EF                MOV     A,R7
0221 25E0              ADD     A,ACC
0223 25E0              ADD     A,ACC
0225 2400        R     ADD     A,#LOW Fan1Talbe1DIS+01H
0227 F582              MOV     DPL,A
0229 E4                CLR     A
022A 3400        R     ADDC    A,#HIGH Fan1Talbe1DIS+01H
                                           ; SOURCE LINE # 887
022C 120000      R     LCALL   L?0503
022F 2400        R     ADD     A,#LOW Fan1Talbe1DIS+02H
0231 F582              MOV     DPL,A
0233 E4                CLR     A
0234 3400        R     ADDC    A,#HIGH Fan1Talbe1DIS+02H
0236 120000      R     LCALL   L?0509
0239 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 888
023C 120000      R     LCALL   L?0504
023F 2400        R     ADD     A,#LOW Fan1Talbe1DIS+03H
0241 F582              MOV     DPL,A
0243 E4                CLR     A
0244 3400        R     ADDC    A,#HIGH Fan1Talbe1DIS+03H
                                           ; SOURCE LINE # 889
0246 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 890
0249 80CC              SJMP    ?C0129
                                           ; SOURCE LINE # 891
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 78  

024B         ?C0128:
                                           ; SOURCE LINE # 893
                                           ; SOURCE LINE # 894
024B 900000      E     MOV     DPTR,#HighPerf
024E E0                MOVX    A,@DPTR
024F 6034              JZ      ?C0136
                                           ; SOURCE LINE # 895
0251         ?C0133:
                                           ; SOURCE LINE # 896
0251 EF                MOV     A,R7
0252 C3                CLR     C
0253 9407              SUBB    A,#07H
0255 4003              JC      $ + 5H
0257 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 897
                                           ; SOURCE LINE # 898
025A EF                MOV     A,R7
025B 25E0              ADD     A,ACC
025D 25E0              ADD     A,ACC
025F 2400        R     ADD     A,#LOW Fan1Talbe2DIS_H+01H
0261 F582              MOV     DPL,A
0263 E4                CLR     A
0264 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_H+01H
                                           ; SOURCE LINE # 899
0266 120000      R     LCALL   L?0503
0269 2400        R     ADD     A,#LOW Fan1Talbe2DIS_H+02H
026B F582              MOV     DPL,A
026D E4                CLR     A
026E 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_H+02H
0270 120000      R     LCALL   L?0509
0273 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 900
0276 120000      R     LCALL   L?0504
0279 2400        R     ADD     A,#LOW Fan1Talbe2DIS_H+03H
027B F582              MOV     DPL,A
027D E4                CLR     A
027E 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_H+03H
                                           ; SOURCE LINE # 901
0280 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 902
0283 80CC              SJMP    ?C0133
                                           ; SOURCE LINE # 903
                                           ; SOURCE LINE # 905
0285         ?C0136:
                                           ; SOURCE LINE # 906
0285 EF                MOV     A,R7
0286 C3                CLR     C
0287 9407              SUBB    A,#07H
0289 4003              JC      $ + 5H
028B 020000      R     LJMP    ?C0145
                                           ; SOURCE LINE # 907
                                           ; SOURCE LINE # 908
028E EF                MOV     A,R7
028F 25E0              ADD     A,ACC
0291 25E0              ADD     A,ACC
0293 2400        R     ADD     A,#LOW Fan1Talbe2DIS_B+01H
0295 F582              MOV     DPL,A
0297 E4                CLR     A
0298 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_B+01H
                                           ; SOURCE LINE # 909
029A 120000      R     LCALL   L?0503
029D 2400        R     ADD     A,#LOW Fan1Talbe2DIS_B+02H
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 79  

029F F582              MOV     DPL,A
02A1 E4                CLR     A
02A2 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_B+02H
02A4 120000      R     LCALL   L?0509
02A7 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 910
02AA 120000      R     LCALL   L?0504
02AD 2400        R     ADD     A,#LOW Fan1Talbe2DIS_B+03H
02AF F582              MOV     DPL,A
02B1 E4                CLR     A
02B2 3400        R     ADDC    A,#HIGH Fan1Talbe2DIS_B+03H
                                           ; SOURCE LINE # 911
02B4 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 912
02B7 80CC              SJMP    ?C0136
                                           ; SOURCE LINE # 913
                                           ; SOURCE LINE # 914
                                           ; SOURCE LINE # 916
02B9         ?C0127:
                                           ; SOURCE LINE # 918
                                           ; SOURCE LINE # 919
02B9 900000      E     MOV     DPTR,#FanTable_Type
02BC E0                MOVX    A,@DPTR
02BD 7031              JNZ     ?C0143
                                           ; SOURCE LINE # 920
02BF         ?C0140:
                                           ; SOURCE LINE # 921
02BF EF                MOV     A,R7
02C0 C3                CLR     C
02C1 9407              SUBB    A,#07H
02C3 505C              JNC     ?C0145
                                           ; SOURCE LINE # 922
                                           ; SOURCE LINE # 923
02C5 EF                MOV     A,R7
02C6 25E0              ADD     A,ACC
02C8 25E0              ADD     A,ACC
02CA 2400        R     ADD     A,#LOW Fan1Talbe1UMA+01H
02CC F582              MOV     DPL,A
02CE E4                CLR     A
02CF 3400        R     ADDC    A,#HIGH Fan1Talbe1UMA+01H
                                           ; SOURCE LINE # 924
02D1 120000      R     LCALL   L?0503
02D4 2400        R     ADD     A,#LOW Fan1Talbe1UMA+02H
02D6 F582              MOV     DPL,A
02D8 E4                CLR     A
02D9 3400        R     ADDC    A,#HIGH Fan1Talbe1UMA+02H
02DB 120000      R     LCALL   L?0509
02DE 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 925
02E1 120000      R     LCALL   L?0504
02E4 2400        R     ADD     A,#LOW Fan1Talbe1UMA+03H
02E6 F582              MOV     DPL,A
02E8 E4                CLR     A
02E9 3400        R     ADDC    A,#HIGH Fan1Talbe1UMA+03H
                                           ; SOURCE LINE # 926
02EB 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 927
02EE 80CF              SJMP    ?C0140
                                           ; SOURCE LINE # 928
                                           ; SOURCE LINE # 930
02F0         ?C0143:
                                           ; SOURCE LINE # 931
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 80  

02F0 EF                MOV     A,R7
02F1 C3                CLR     C
02F2 9407              SUBB    A,#07H
02F4 502B              JNC     ?C0145
                                           ; SOURCE LINE # 932
                                           ; SOURCE LINE # 933
02F6 EF                MOV     A,R7
02F7 25E0              ADD     A,ACC
02F9 25E0              ADD     A,ACC
02FB 2400        R     ADD     A,#LOW Fan1Talbe2UMA+01H
02FD F582              MOV     DPL,A
02FF E4                CLR     A
0300 3400        R     ADDC    A,#HIGH Fan1Talbe2UMA+01H
                                           ; SOURCE LINE # 934
0302 120000      R     LCALL   L?0503
0305 2400        R     ADD     A,#LOW Fan1Talbe2UMA+02H
0307 F582              MOV     DPL,A
0309 E4                CLR     A
030A 3400        R     ADDC    A,#HIGH Fan1Talbe2UMA+02H
030C 120000      R     LCALL   L?0509
030F 120000      R     LCALL   L?0516
                                           ; SOURCE LINE # 935
0312 120000      R     LCALL   L?0504
0315 2400        R     ADD     A,#LOW Fan1Talbe2UMA+03H
0317 F582              MOV     DPL,A
0319 E4                CLR     A
031A 3400        R     ADDC    A,#HIGH Fan1Talbe2UMA+03H
                                           ; SOURCE LINE # 936
031C 120000      R     LCALL   L?0506
                                           ; SOURCE LINE # 937
031F 80CF              SJMP    ?C0143
                                           ; SOURCE LINE # 938
                                           ; SOURCE LINE # 939
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
0321         ?C0145:
0321 22                RET     
             ; FUNCTION InitThermalTable1 (END)

             ; FUNCTION InitThermalTable2 (BEGIN)
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 946
                                           ; SOURCE LINE # 948
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 949
0002 900000      E     MOV     DPTR,#GPDRC
0005 E0                MOVX    A,@DPTR
0006 20E503            JB      ACC.5,$ + 6H
0009 020000      R     LJMP    ?C0146
                                           ; SOURCE LINE # 950
                                           ; SOURCE LINE # 951
000C 900000      E     MOV     DPTR,#FanTable_Type
000F E0                MOVX    A,@DPTR
0010 7040              JNZ     ?C0147
                                           ; SOURCE LINE # 952
0012         ?C0148:
                                           ; SOURCE LINE # 953
0012 EF                MOV     A,R7
0013 C3                CLR     C
0014 9407              SUBB    A,#07H
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 81  

0016 4003              JC      $ + 5H
0018 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 954
                                           ; SOURCE LINE # 955
001B EF                MOV     A,R7
001C 25E0              ADD     A,ACC
001E 25E0              ADD     A,ACC
0020 2400        R     ADD     A,#LOW Fan2Talbe1DISYOGA+01H
0022 F582              MOV     DPL,A
0024 E4                CLR     A
0025 3400        R     ADDC    A,#HIGH Fan2Talbe1DISYOGA+01H
0027 120000      R     LCALL   L?0509
002A 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 956
002D 120000      R     LCALL   L?0504
0030 2400        R     ADD     A,#LOW Fan2Talbe1DISYOGA+02H
0032 F582              MOV     DPL,A
0034 E4                CLR     A
0035 3400        R     ADDC    A,#HIGH Fan2Talbe1DISYOGA+02H
0037 120000      R     LCALL   L?0509
003A 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 957
003D 120000      R     LCALL   L?0504
0040 2400        R     ADD     A,#LOW Fan2Talbe1DISYOGA+03H
0042 F582              MOV     DPL,A
0044 E4                CLR     A
0045 3400        R     ADDC    A,#HIGH Fan2Talbe1DISYOGA+03H
0047 120000      R     LCALL   L?0509
004A 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 958
004D 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 959
0050 80C0              SJMP    ?C0148
                                           ; SOURCE LINE # 960
0052         ?C0147:
                                           ; SOURCE LINE # 962
                                           ; SOURCE LINE # 963
0052 900000      E     MOV     DPTR,#QuiteMode
0055 E0                MOVX    A,@DPTR
0056 6040              JZ      ?C0155
                                           ; SOURCE LINE # 964
0058         ?C0152:
                                           ; SOURCE LINE # 965
0058 EF                MOV     A,R7
0059 C3                CLR     C
005A 9407              SUBB    A,#07H
005C 4003              JC      $ + 5H
005E 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 966
                                           ; SOURCE LINE # 967
0061 EF                MOV     A,R7
0062 25E0              ADD     A,ACC
0064 25E0              ADD     A,ACC
0066 2400        R     ADD     A,#LOW Fan2Talbe2QDISYOGA+01H
0068 F582              MOV     DPL,A
006A E4                CLR     A
006B 3400        R     ADDC    A,#HIGH Fan2Talbe2QDISYOGA+01H
006D 120000      R     LCALL   L?0509
0070 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 968
0073 120000      R     LCALL   L?0504
0076 2400        R     ADD     A,#LOW Fan2Talbe2QDISYOGA+02H
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 82  

0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        R     ADDC    A,#HIGH Fan2Talbe2QDISYOGA+02H
007D 120000      R     LCALL   L?0509
0080 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 969
0083 120000      R     LCALL   L?0504
0086 2400        R     ADD     A,#LOW Fan2Talbe2QDISYOGA+03H
0088 F582              MOV     DPL,A
008A E4                CLR     A
008B 3400        R     ADDC    A,#HIGH Fan2Talbe2QDISYOGA+03H
008D 120000      R     LCALL   L?0509
0090 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 970
0093 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 971
0096 80C0              SJMP    ?C0152
                                           ; SOURCE LINE # 972
                                           ; SOURCE LINE # 974
0098         ?C0155:
                                           ; SOURCE LINE # 975
0098 EF                MOV     A,R7
0099 C3                CLR     C
009A 9407              SUBB    A,#07H
009C 4003              JC      $ + 5H
009E 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 976
                                           ; SOURCE LINE # 977
00A1 EF                MOV     A,R7
00A2 25E0              ADD     A,ACC
00A4 25E0              ADD     A,ACC
00A6 2400        R     ADD     A,#LOW Fan2Talbe2DISYOGA+01H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        R     ADDC    A,#HIGH Fan2Talbe2DISYOGA+01H
00AD 120000      R     LCALL   L?0509
00B0 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 978
00B3 120000      R     LCALL   L?0504
00B6 2400        R     ADD     A,#LOW Fan2Talbe2DISYOGA+02H
00B8 F582              MOV     DPL,A
00BA E4                CLR     A
00BB 3400        R     ADDC    A,#HIGH Fan2Talbe2DISYOGA+02H
00BD 120000      R     LCALL   L?0509
00C0 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 979
00C3 120000      R     LCALL   L?0504
00C6 2400        R     ADD     A,#LOW Fan2Talbe2DISYOGA+03H
00C8 F582              MOV     DPL,A
00CA E4                CLR     A
00CB 3400        R     ADDC    A,#HIGH Fan2Talbe2DISYOGA+03H
00CD 120000      R     LCALL   L?0509
00D0 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 980
00D3 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 981
00D6 80C0              SJMP    ?C0155
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
                                           ; SOURCE LINE # 984
00D8         ?C0146:
                                           ; SOURCE LINE # 986
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 83  

                                           ; SOURCE LINE # 987
00D8 900000      E     MOV     DPTR,#FanTable_Type
00DB E0                MOVX    A,@DPTR
00DC 7040              JNZ     ?C0158
                                           ; SOURCE LINE # 988
00DE         ?C0159:
                                           ; SOURCE LINE # 989
00DE EF                MOV     A,R7
00DF C3                CLR     C
00E0 9407              SUBB    A,#07H
00E2 4003              JC      $ + 5H
00E4 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 990
                                           ; SOURCE LINE # 991
00E7 EF                MOV     A,R7
00E8 25E0              ADD     A,ACC
00EA 25E0              ADD     A,ACC
00EC 2400        R     ADD     A,#LOW Fan2Talbe1DIS+01H
00EE F582              MOV     DPL,A
00F0 E4                CLR     A
00F1 3400        R     ADDC    A,#HIGH Fan2Talbe1DIS+01H
00F3 120000      R     LCALL   L?0509
00F6 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 992
00F9 120000      R     LCALL   L?0504
00FC 2400        R     ADD     A,#LOW Fan2Talbe1DIS+02H
00FE F582              MOV     DPL,A
0100 E4                CLR     A
0101 3400        R     ADDC    A,#HIGH Fan2Talbe1DIS+02H
0103 120000      R     LCALL   L?0509
0106 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 993
0109 120000      R     LCALL   L?0504
010C 2400        R     ADD     A,#LOW Fan2Talbe1DIS+03H
010E F582              MOV     DPL,A
0110 E4                CLR     A
0111 3400        R     ADDC    A,#HIGH Fan2Talbe1DIS+03H
0113 120000      R     LCALL   L?0509
0116 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 994
0119 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 995
011C 80C0              SJMP    ?C0159
                                           ; SOURCE LINE # 996
011E         ?C0158:
                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
011E 900000      E     MOV     DPTR,#HighPerf
0121 E0                MOVX    A,@DPTR
0122 603D              JZ      ?C0166
                                           ; SOURCE LINE # 1000
0124         ?C0163:
                                           ; SOURCE LINE # 1001
0124 EF                MOV     A,R7
0125 C3                CLR     C
0126 9407              SUBB    A,#07H
0128 5074              JNC     ?C0168
                                           ; SOURCE LINE # 1002
                                           ; SOURCE LINE # 1003
012A EF                MOV     A,R7
012B 25E0              ADD     A,ACC
012D 25E0              ADD     A,ACC
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 84  

012F 2400        R     ADD     A,#LOW Fan2Talbe2DIS_H+01H
0131 F582              MOV     DPL,A
0133 E4                CLR     A
0134 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_H+01H
0136 120000      R     LCALL   L?0509
0139 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 1004
013C 120000      R     LCALL   L?0504
013F 2400        R     ADD     A,#LOW Fan2Talbe2DIS_H+02H
0141 F582              MOV     DPL,A
0143 E4                CLR     A
0144 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_H+02H
0146 120000      R     LCALL   L?0509
0149 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 1005
014C 120000      R     LCALL   L?0504
014F 2400        R     ADD     A,#LOW Fan2Talbe2DIS_H+03H
0151 F582              MOV     DPL,A
0153 E4                CLR     A
0154 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_H+03H
0156 120000      R     LCALL   L?0509
0159 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 1006
015C 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 1007
015F 80C3              SJMP    ?C0163
                                           ; SOURCE LINE # 1008
                                           ; SOURCE LINE # 1010
0161         ?C0166:
                                           ; SOURCE LINE # 1011
0161 EF                MOV     A,R7
0162 C3                CLR     C
0163 9407              SUBB    A,#07H
0165 5037              JNC     ?C0168
                                           ; SOURCE LINE # 1012
                                           ; SOURCE LINE # 1013
0167 EF                MOV     A,R7
0168 25E0              ADD     A,ACC
016A 25E0              ADD     A,ACC
016C 2400        R     ADD     A,#LOW Fan2Talbe2DIS_B+01H
016E F582              MOV     DPL,A
0170 E4                CLR     A
0171 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_B+01H
0173 120000      R     LCALL   L?0509
0176 120000      R     LCALL   L?0525
                                           ; SOURCE LINE # 1014
0179 120000      R     LCALL   L?0504
017C 2400        R     ADD     A,#LOW Fan2Talbe2DIS_B+02H
017E F582              MOV     DPL,A
0180 E4                CLR     A
0181 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_B+02H
0183 120000      R     LCALL   L?0509
0186 120000      R     LCALL   L?0527
                                           ; SOURCE LINE # 1015
0189 120000      R     LCALL   L?0504
018C 2400        R     ADD     A,#LOW Fan2Talbe2DIS_B+03H
018E F582              MOV     DPL,A
0190 E4                CLR     A
0191 3400        R     ADDC    A,#HIGH Fan2Talbe2DIS_B+03H
0193 120000      R     LCALL   L?0509
0196 120000      R     LCALL   L?0529
                                           ; SOURCE LINE # 1016
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 85  

0199 120000      R     LCALL   L?0507
                                           ; SOURCE LINE # 1017
019C 80C3              SJMP    ?C0166
                                           ; SOURCE LINE # 1018
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
                                           ; SOURCE LINE # 1021
019E         ?C0168:
019E 22                RET     
             ; FUNCTION InitThermalTable2 (END)

             ; FUNCTION _Check_FANRPM_Count (BEGIN)
                                           ; SOURCE LINE # 1023
;---- Variable 'BRPM_Cnt' assigned to Register 'R1/R2/R3' ----
;---- Variable 'TempType' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 1024
                                           ; SOURCE LINE # 1025
0000 120000      E     LCALL   ?C?CLDPTR
0003 C3                CLR     C
0004 940A              SUBB    A,#0AH
0006 401E              JC      ?C0169
                                           ; SOURCE LINE # 1026
                                           ; SOURCE LINE # 1027
0008 ED                MOV     A,R5
0009 B4010A            CJNE    A,#01H,?C0170
                                           ; SOURCE LINE # 1028
                                           ; SOURCE LINE # 1029
000C 900000      E     MOV     DPTR,#Fan1RPM_TargetBackUp
000F E0                MOVX    A,@DPTR
0010 900000      E     MOV     DPTR,#Fan1RPM_Target
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1030
0014 800C              SJMP    ?C0171
0016         ?C0170:
                                           ; SOURCE LINE # 1031
0016 ED                MOV     A,R5
0017 B40208            CJNE    A,#02H,?C0171
                                           ; SOURCE LINE # 1032
                                           ; SOURCE LINE # 1033
001A 900000      E     MOV     DPTR,#Fan2RPM_TargetBackUp
001D E0                MOVX    A,@DPTR
001E 900000      E     MOV     DPTR,#Fan2RPM_Target
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1034
0022         ?C0171:
                                           ; SOURCE LINE # 1036
0022 E4                CLR     A
0023 020000      E     LJMP    ?C?CSTPTR
                                           ; SOURCE LINE # 1037
0026         ?C0169:
                                           ; SOURCE LINE # 1039
0026 7401              MOV     A,#01H
0028 120000      E     LCALL   ?C?CILDPTR
                                           ; SOURCE LINE # 1040
002B         ?C0174:
002B 22                RET     
             ; FUNCTION _Check_FANRPM_Count (END)

             ; FUNCTION CheckFanRPM1 (BEGIN)
                                           ; SOURCE LINE # 1041
                                           ; SOURCE LINE # 1042
                                           ; SOURCE LINE # 1043
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 86  

0000 900000      E     MOV     DPTR,#Fan1Level
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1046
0005 C3                CLR     C
0006 940E              SUBB    A,#0EH
0008 5009              JNC     ?C0175
                                           ; SOURCE LINE # 1047
                                           ; SOURCE LINE # 1048
000A 120000      R     LCALL   L?0510
000D 120000      R     LCALL   L?0564
0010 4001              JC      ?C0175
                                           ; SOURCE LINE # 1049
                                           ; SOURCE LINE # 1050
0012 0F                INC     R7
                                           ; SOURCE LINE # 1051
                                           ; SOURCE LINE # 1052
0013         ?C0175:
                                           ; SOURCE LINE # 1054
0013 EF                MOV     A,R7
0014 D3                SETB    C
0015 9400              SUBB    A,#00H
0017 400C              JC      ?C0177
                                           ; SOURCE LINE # 1055
                                           ; SOURCE LINE # 1056
0019 120000      R     LCALL   L?0515
001C 120000      R     LCALL   L?0511
001F 120000      R     LCALL   L?0564
0022 5001              JNC     ?C0177
                                           ; SOURCE LINE # 1057
                                           ; SOURCE LINE # 1058
0024 1F                DEC     R7
                                           ; SOURCE LINE # 1059
                                           ; SOURCE LINE # 1060
0025         ?C0177:
                                           ; SOURCE LINE # 1062
0025 900000      E     MOV     DPTR,#Fan1Level
0028 EF                MOV     A,R7
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1063
002A 120000      R     LCALL   L?0584
002D 120000      R     LCALL   L?0511
                                           ; SOURCE LINE # 1066
0030 120000      R     LCALL   L?0573
0033 700B              JNZ     ?C0179
                                           ; SOURCE LINE # 1067
                                           ; SOURCE LINE # 1068
0035 7B01              MOV     R3,#01H
0037 7A00        E     MOV     R2,#HIGH Fan1RPMCount
0039 7900        E     MOV     R1,#LOW Fan1RPMCount
003B 7D01              MOV     R5,#01H
003D 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1069
0040         ?C0179:
                                           ; SOURCE LINE # 1071
                                           ; SOURCE LINE # 1072
                                           ; SOURCE LINE # 1073
0040 120000      R     LCALL   L?0576
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1075
0043         ?C0181:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 87  

0043 22                RET     
             ; FUNCTION CheckFanRPM1 (END)

             ; FUNCTION CheckFanRPM2 (BEGIN)
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1078
                                           ; SOURCE LINE # 1079
0000 900000      E     MOV     DPTR,#Fan2Level
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1082
0005 C3                CLR     C
0006 940E              SUBB    A,#0EH
0008 500C              JNC     ?C0182
                                           ; SOURCE LINE # 1083
                                           ; SOURCE LINE # 1084
000A 120000      R     LCALL   L?0524
000D 120000      R     LCALL   L?0511
0010 120000      R     LCALL   L?0565
0013 4001              JC      ?C0182
                                           ; SOURCE LINE # 1085
                                           ; SOURCE LINE # 1086
0015 0F                INC     R7
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1088
0016         ?C0182:
                                           ; SOURCE LINE # 1090
0016 EF                MOV     A,R7
0017 D3                SETB    C
0018 9400              SUBB    A,#00H
001A 400C              JC      ?C0184
                                           ; SOURCE LINE # 1091
                                           ; SOURCE LINE # 1092
001C 120000      R     LCALL   L?0526
001F 120000      R     LCALL   L?0511
0022 120000      R     LCALL   L?0565
0025 5001              JNC     ?C0184
                                           ; SOURCE LINE # 1093
                                           ; SOURCE LINE # 1094
0027 1F                DEC     R7
                                           ; SOURCE LINE # 1095
                                           ; SOURCE LINE # 1096
0028         ?C0184:
                                           ; SOURCE LINE # 1098
0028 900000      E     MOV     DPTR,#Fan2Level
002B EF                MOV     A,R7
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1099
002D 120000      R     LCALL   L?0528
0030 120000      R     LCALL   L?0511
                                           ; SOURCE LINE # 1102
0033 120000      R     LCALL   L?0574
0036 700B              JNZ     ?C0186
                                           ; SOURCE LINE # 1103
                                           ; SOURCE LINE # 1104
0038 7B01              MOV     R3,#01H
003A 7A00        E     MOV     R2,#HIGH Fan2RPMCount
003C 7900        E     MOV     R1,#LOW Fan2RPMCount
003E 7D02              MOV     R5,#02H
0040 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1105
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 88  

0043         ?C0186:
                                           ; SOURCE LINE # 1107
                                           ; SOURCE LINE # 1108
                                           ; SOURCE LINE # 1109
0043 120000      R     LCALL   L?0577
                                           ; SOURCE LINE # 1110
                                           ; SOURCE LINE # 1113
0046         ?C0188:
0046 22                RET     
             ; FUNCTION CheckFanRPM2 (END)

             ; FUNCTION CheckFan1Level (BEGIN)
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
                                           ; SOURCE LINE # 1117
0000 900000      E     MOV     DPTR,#Fan1Level
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1120
0005 C3                CLR     C
0006 940E              SUBB    A,#0EH
0008 500D              JNC     ?C0189
                                           ; SOURCE LINE # 1121
                                           ; SOURCE LINE # 1122
000A 120000      R     LCALL   L?0510
000D FE                MOV     R6,A
000E 900000      E     MOV     DPTR,#TEMP_Buff_3
0011 E0                MOVX    A,@DPTR
0012 C3                CLR     C
0013 9E                SUBB    A,R6
0014 4001              JC      ?C0189
                                           ; SOURCE LINE # 1123
                                           ; SOURCE LINE # 1124
0016 0F                INC     R7
                                           ; SOURCE LINE # 1125
                                           ; SOURCE LINE # 1126
0017         ?C0189:
                                           ; SOURCE LINE # 1128
0017 EF                MOV     A,R7
0018 D3                SETB    C
0019 9400              SUBB    A,#00H
001B 4010              JC      ?C0191
                                           ; SOURCE LINE # 1129
                                           ; SOURCE LINE # 1130
001D 120000      R     LCALL   L?0515
0020 120000      R     LCALL   L?0511
0023 FE                MOV     R6,A
0024 900000      E     MOV     DPTR,#TEMP_Buff_3
0027 E0                MOVX    A,@DPTR
0028 C3                CLR     C
0029 9E                SUBB    A,R6
002A 5001              JNC     ?C0191
                                           ; SOURCE LINE # 1131
                                           ; SOURCE LINE # 1132
002C 1F                DEC     R7
                                           ; SOURCE LINE # 1133
                                           ; SOURCE LINE # 1134
002D         ?C0191:
                                           ; SOURCE LINE # 1135
002D 900000      E     MOV     DPTR,#Fan1Level
0030 EF                MOV     A,R7
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 89  

0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1136
0032 22                RET     
             ; FUNCTION CheckFan1Level (END)

             ; FUNCTION CheckFan2Level (BEGIN)
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
                                           ; SOURCE LINE # 1140
0000 900000      E     MOV     DPTR,#Fan2Level
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1143
0005 C3                CLR     C
0006 940E              SUBB    A,#0EH
0008 5010              JNC     ?C0194
                                           ; SOURCE LINE # 1144
                                           ; SOURCE LINE # 1145
000A 120000      R     LCALL   L?0524
000D 120000      R     LCALL   L?0511
0010 FE                MOV     R6,A
0011 900000      E     MOV     DPTR,#VGA_TBuff3
0014 E0                MOVX    A,@DPTR
0015 C3                CLR     C
0016 9E                SUBB    A,R6
0017 4001              JC      ?C0194
                                           ; SOURCE LINE # 1146
                                           ; SOURCE LINE # 1147
0019 0F                INC     R7
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
001A         ?C0194:
                                           ; SOURCE LINE # 1151
001A EF                MOV     A,R7
001B D3                SETB    C
001C 9400              SUBB    A,#00H
001E 4010              JC      ?C0196
                                           ; SOURCE LINE # 1152
                                           ; SOURCE LINE # 1153
0020 120000      R     LCALL   L?0526
0023 120000      R     LCALL   L?0511
0026 FE                MOV     R6,A
0027 900000      E     MOV     DPTR,#VGA_TBuff3
002A E0                MOVX    A,@DPTR
002B C3                CLR     C
002C 9E                SUBB    A,R6
002D 5001              JNC     ?C0196
                                           ; SOURCE LINE # 1154
                                           ; SOURCE LINE # 1155
002F 1F                DEC     R7
                                           ; SOURCE LINE # 1156
                                           ; SOURCE LINE # 1157
0030         ?C0196:
                                           ; SOURCE LINE # 1158
0030 900000      E     MOV     DPTR,#Fan2Level
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1159
0035 22                RET     
             ; FUNCTION CheckFan2Level (END)

C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 90  

             ; FUNCTION L?0595 (BEGIN)
0000 120000      R     LCALL   CheckFan1Level
0003 120000      R     LCALL   CheckFan2Level
             ; FUNCTION CheckFanLevel (BEGIN)
                                           ; SOURCE LINE # 1161
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
0006 900000      E     MOV     DPTR,#Fan2Level
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B 900000      E     MOV     DPTR,#Fan1Level
000E E0                MOVX    A,@DPTR
000F C3                CLR     C
0010 9F                SUBB    A,R7
0011 4002              JC      ?C0199
                                           ; SOURCE LINE # 1164
                                           ; SOURCE LINE # 1165
                                           ; SOURCE LINE # 1166
0013 8003              SJMP    ?C0458
0015         ?C0199:
                                           ; SOURCE LINE # 1168
                                           ; SOURCE LINE # 1169
0015 900000      E     MOV     DPTR,#Fan2Level
0018         ?C0458:
0018 E0                MOVX    A,@DPTR
0019 900000      E     MOV     DPTR,#FanLevel
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
001D         ?C0201:
001D 22                RET     
             ; FUNCTION CheckFanLevel (END)

             ; FUNCTION CheckFan1RPM (BEGIN)
                                           ; SOURCE LINE # 1173
                                           ; SOURCE LINE # 1174
                                           ; SOURCE LINE # 1175
0000 900000      E     MOV     DPTR,#FanLevel
0003 E0                MOVX    A,@DPTR
0004 120000      R     LCALL   L?0584
0007 120000      R     LCALL   L?0511
                                           ; SOURCE LINE # 1177
000A 120000      R     LCALL   L?0573
000D 700B              JNZ     ?C0202
                                           ; SOURCE LINE # 1178
                                           ; SOURCE LINE # 1179
000F 7B01              MOV     R3,#01H
0011 7A00        E     MOV     R2,#HIGH Fan1RPMCount
0013 7900        E     MOV     R1,#LOW Fan1RPMCount
0015 7D01              MOV     R5,#01H
0017 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1180
001A         ?C0202:
                                           ; SOURCE LINE # 1182
                                           ; SOURCE LINE # 1183
                                           ; SOURCE LINE # 1184
001A 120000      R     LCALL   L?0576
                                           ; SOURCE LINE # 1185
                                           ; SOURCE LINE # 1186
001D         ?C0204:
001D 22                RET     
             ; FUNCTION CheckFan1RPM (END)
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 91  


             ; FUNCTION CheckFan2RPM (BEGIN)
                                           ; SOURCE LINE # 1188
                                           ; SOURCE LINE # 1189
                                           ; SOURCE LINE # 1190
0000 900000      E     MOV     DPTR,#FanLevel
0003 E0                MOVX    A,@DPTR
0004 120000      R     LCALL   L?0528
0007 120000      R     LCALL   L?0511
                                           ; SOURCE LINE # 1191
000A 120000      R     LCALL   L?0574
000D 700B              JNZ     ?C0205
                                           ; SOURCE LINE # 1192
                                           ; SOURCE LINE # 1193
000F 7B01              MOV     R3,#01H
0011 7A00        E     MOV     R2,#HIGH Fan2RPMCount
0013 7900        E     MOV     R1,#LOW Fan2RPMCount
0015 7D02              MOV     R5,#02H
0017 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1194
001A         ?C0205:
                                           ; SOURCE LINE # 1196
                                           ; SOURCE LINE # 1197
                                           ; SOURCE LINE # 1198
001A 120000      R     LCALL   L?0577
                                           ; SOURCE LINE # 1199
                                           ; SOURCE LINE # 1200
001D         ?C0207:
001D 22                RET     
             ; FUNCTION CheckFan2RPM (END)

             ; FUNCTION Fan1MainControl (BEGIN)
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
                                           ; SOURCE LINE # 1205
0000 900000      E     MOV     DPTR,#FAN1Count
0003 E0                MOVX    A,@DPTR
0004 C3                CLR     C
0005 9400              SUBB    A,#00H
0007 403C              JC      ?C0208
                                           ; SOURCE LINE # 1206
                                           ; SOURCE LINE # 1207
0009 900000      E     MOV     DPTR,#Fan1RPM_Target
000C E0                MOVX    A,@DPTR
000D 900000      E     MOV     DPTR,#FAN1_RPM+01H
0010 120000      R     LCALL   L?0559
0013 900000      E     MOV     DPTR,#FAN1_RPM
0016 E0                MOVX    A,@DPTR
0017 9E                SUBB    A,R6
0018 500C              JNC     ?C0209
                                           ; SOURCE LINE # 1208
                                           ; SOURCE LINE # 1209
001A 120000      R     LCALL   L?0550
001D C3                CLR     C
001E 9F                SUBB    A,R7
001F 501E              JNC     ?C0211
                                           ; SOURCE LINE # 1210
0021 E0                MOVX    A,@DPTR
0022 04                INC     A
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1211
0024 8019              SJMP    ?C0211
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 92  

0026         ?C0209:
                                           ; SOURCE LINE # 1212
0026 900000      E     MOV     DPTR,#Fan1RPM_Target
0029 E0                MOVX    A,@DPTR
002A 900000      E     MOV     DPTR,#FAN1_RPM+01H
002D 120000      R     LCALL   L?0575
0030 900000      E     MOV     DPTR,#FAN1_RPM
0033 E0                MOVX    A,@DPTR
0034 9E                SUBB    A,R6
0035 4008              JC      ?C0211
                                           ; SOURCE LINE # 1213
                                           ; SOURCE LINE # 1214
0037 120000      R     LCALL   L?0585
003A 4003              JC      ?C0211
                                           ; SOURCE LINE # 1215
003C E0                MOVX    A,@DPTR
003D 14                DEC     A
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1216
003F         ?C0211:
                                           ; SOURCE LINE # 1218
003F E4                CLR     A
0040 900000      E     MOV     DPTR,#FAN1Count
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1219
0044 22                RET     
0045         ?C0208:
                                           ; SOURCE LINE # 1221
0045 900000      E     MOV     DPTR,#FAN1Count
0048 E0                MOVX    A,@DPTR
0049 04                INC     A
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1223
004B         ?C0215:
004B 22                RET     
             ; FUNCTION Fan1MainControl (END)

             ; FUNCTION Fan2MainControl (BEGIN)
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1225
                                           ; SOURCE LINE # 1226
0000 900000      E     MOV     DPTR,#FAN2Count
0003 E0                MOVX    A,@DPTR
0004 C3                CLR     C
0005 9400              SUBB    A,#00H
0007 403C              JC      ?C0216
                                           ; SOURCE LINE # 1227
                                           ; SOURCE LINE # 1228
0009 900000      E     MOV     DPTR,#Fan2RPM_Target
000C E0                MOVX    A,@DPTR
000D 900000      E     MOV     DPTR,#FAN2_RPM+01H
0010 120000      R     LCALL   L?0559
0013 900000      E     MOV     DPTR,#FAN2_RPM
0016 E0                MOVX    A,@DPTR
0017 9E                SUBB    A,R6
0018 500C              JNC     ?C0217
                                           ; SOURCE LINE # 1229
                                           ; SOURCE LINE # 1230
001A 120000      R     LCALL   L?0552
001D C3                CLR     C
001E 9F                SUBB    A,R7
001F 501E              JNC     ?C0219
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 93  

                                           ; SOURCE LINE # 1231
0021 E0                MOVX    A,@DPTR
0022 04                INC     A
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1232
0024 8019              SJMP    ?C0219
0026         ?C0217:
                                           ; SOURCE LINE # 1233
0026 900000      E     MOV     DPTR,#Fan2RPM_Target
0029 E0                MOVX    A,@DPTR
002A 900000      E     MOV     DPTR,#FAN2_RPM+01H
002D 120000      R     LCALL   L?0575
0030 900000      E     MOV     DPTR,#FAN2_RPM
0033 E0                MOVX    A,@DPTR
0034 9E                SUBB    A,R6
0035 4008              JC      ?C0219
                                           ; SOURCE LINE # 1234
                                           ; SOURCE LINE # 1235
0037 120000      R     LCALL   L?0587
003A 4003              JC      ?C0219
                                           ; SOURCE LINE # 1236
003C E0                MOVX    A,@DPTR
003D 14                DEC     A
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1237
003F         ?C0219:
                                           ; SOURCE LINE # 1239
003F E4                CLR     A
0040 900000      E     MOV     DPTR,#FAN2Count
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1240
0044 22                RET     
0045         ?C0216:
                                           ; SOURCE LINE # 1242
0045 900000      E     MOV     DPTR,#FAN2Count
0048 E0                MOVX    A,@DPTR
0049 04                INC     A
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1243
004B         ?C0223:
004B 22                RET     
             ; FUNCTION Fan2MainControl (END)

             ; FUNCTION Oem_Fan_Control (BEGIN)
                                           ; SOURCE LINE # 1245
                                           ; SOURCE LINE # 1246
                                           ; SOURCE LINE # 1247
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#GPCRA5
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1248
0005 120000      R     LCALL   InitThermalTable1
                                           ; SOURCE LINE # 1250
0008 900000      E     MOV     DPTR,#uISCT
000B E0                MOVX    A,@DPTR
000C 30E403            JNB     ACC.4,?C0224
                                           ; SOURCE LINE # 1251
                                           ; SOURCE LINE # 1252
                                           ; SOURCE LINE # 1253
000F 020000      R     LJMP    ?C0469
                                           ; SOURCE LINE # 1255
0012         ?C0224:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 94  

                                           ; SOURCE LINE # 1256
0012 900000      E     MOV     DPTR,#ERR_THMSTS
0015 E0                MOVX    A,@DPTR
0016 20E107            JB      ACC.1,?C0227
0019 900000      E     MOV     DPTR,#Thro_Status2
001C E0                MOVX    A,@DPTR
001D 30E406            JNB     ACC.4,?C0226
0020         ?C0227:
                                           ; SOURCE LINE # 1258
                                           ; SOURCE LINE # 1259
0020 900000      E     MOV     DPTR,#CTR2
0023 020000      R     LJMP    ?C0462
                                           ; SOURCE LINE # 1261
0026         ?C0226:
                                           ; SOURCE LINE # 1264
0026 900000      E     MOV     DPTR,#ERR_THMSTS
0029 E0                MOVX    A,@DPTR
002A 30E311            JNB     ACC.3,?C0228
002D 900000      E     MOV     DPTR,#SYS_STATUS
0030 E0                MOVX    A,@DPTR
0031 5407              ANL     A,#07H
0033 7009              JNZ     ?C0228
                                           ; SOURCE LINE # 1265
                                           ; SOURCE LINE # 1266
0035 900000      E     MOV     DPTR,#CTR2
0038 E0                MOVX    A,@DPTR
0039 FD                MOV     R5,A
003A 7F32              MOV     R7,#032H
003C 8009              SJMP    ?C0463
                                           ; SOURCE LINE # 1268
003E         ?C0228:
                                           ; SOURCE LINE # 1271
003E 900000      E     MOV     DPTR,#Fan_ON_Count
0041 E0                MOVX    A,@DPTR
0042 600D              JZ      ?C0229
                                           ; SOURCE LINE # 1272
                                           ; SOURCE LINE # 1273
                                           ; SOURCE LINE # 1274
0044 120000      R     LCALL   L?0566
0047         ?C0463:
0047 120000      E     LCALL   _Cal_PWM_Duty
004A 900000      E     MOV     DPTR,#Target_Duty
004D EF                MOV     A,R7
004E 020000      R     LJMP    ?C0467
                                           ; SOURCE LINE # 1276
0051         ?C0229:
                                           ; SOURCE LINE # 1278
0051 120000      R     LCALL   L?0536
0054 6003              JZ      ?C0230
                                           ; SOURCE LINE # 1279
                                           ; SOURCE LINE # 1280
0056         ?C0461:
                                           ; SOURCE LINE # 1281
0056 020000      R     LJMP    ?C0469
                                           ; SOURCE LINE # 1283
0059         ?C0230:
                                           ; SOURCE LINE # 1285
0059 900000      E     MOV     DPTR,#GPDRC
005C E0                MOVX    A,@DPTR
005D 30E53F            JNB     ACC.5,?C0231
                                           ; SOURCE LINE # 1286
                                           ; SOURCE LINE # 1287
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 95  

0060 120000      R     LCALL   L?0517
0063 4002              JC      ?C0232
                                           ; SOURCE LINE # 1288
                                           ; SOURCE LINE # 1289
                                           ; SOURCE LINE # 1290
0065 8003              SJMP    ?C0459
0067         ?C0232:
                                           ; SOURCE LINE # 1292
                                           ; SOURCE LINE # 1293
0067 900000      E     MOV     DPTR,#VGA_TBuff3
006A         ?C0459:
006A E0                MOVX    A,@DPTR
006B 900000      E     MOV     DPTR,#Average_Temp
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1294
006F         ?C0233:
                                           ; SOURCE LINE # 1296
006F 120000      R     LCALL   L?0521
0072 D3                SETB    C
0073 9F                SUBB    A,R7
0074 5003              JNC     ?C0234
                                           ; SOURCE LINE # 1297
                                           ; SOURCE LINE # 1298
0076         ?C0465:
                                           ; SOURCE LINE # 1299
0076 020000      R     LJMP    ?C0469
                                           ; SOURCE LINE # 1301
0079         ?C0234:
                                           ; SOURCE LINE # 1303
0079 120000      R     LCALL   L?0521
007C C3                CLR     C
007D 9F                SUBB    A,R7
007E 401A              JC      ?C0235
                                           ; SOURCE LINE # 1304
                                           ; SOURCE LINE # 1305
0080 900000      E     MOV     DPTR,#Fan1On_Step1
0083 120000      R     LCALL   L?0522
0086 9F                SUBB    A,R7
0087 5011              JNC     ?C0235
                                           ; SOURCE LINE # 1306
                                           ; SOURCE LINE # 1307
0089 900000      E     MOV     DPTR,#DCR5
008C E0                MOVX    A,@DPTR
008D 6009              JZ      ?C0237
                                           ; SOURCE LINE # 1308
                                           ; SOURCE LINE # 1309
008F 900000      E     MOV     DPTR,#Fan1RPM_Step1
0092         ?C0462:
0092 E0                MOVX    A,@DPTR
0093 900000      E     MOV     DPTR,#Target_Duty
0096         ?C0464:
                                           ; SOURCE LINE # 1310
0096 8040              SJMP    ?C0467
0098         ?C0237:
                                           ; SOURCE LINE # 1312
                                           ; SOURCE LINE # 1313
0098         ?C0466:
                                           ; SOURCE LINE # 1314
                                           ; SOURCE LINE # 1315
0098 8044              SJMP    ?C0469
                                           ; SOURCE LINE # 1317
                                           ; SOURCE LINE # 1318
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 96  

009A         ?C0235:
                                           ; SOURCE LINE # 1319
009A 120000      R     LCALL   CheckFanRPM1
                                           ; SOURCE LINE # 1320
009D 8055              SJMP    ?C0239
009F         ?C0231:
                                           ; SOURCE LINE # 1323
                                           ; SOURCE LINE # 1324
009F 120000      R     LCALL   L?0517
00A2 4002              JC      ?C0240
                                           ; SOURCE LINE # 1325
                                           ; SOURCE LINE # 1326
                                           ; SOURCE LINE # 1327
00A4 8003              SJMP    ?C0460
00A6         ?C0240:
                                           ; SOURCE LINE # 1329
                                           ; SOURCE LINE # 1330
00A6 900000      E     MOV     DPTR,#VGA_TBuff3
00A9         ?C0460:
00A9 E0                MOVX    A,@DPTR
00AA 900000      E     MOV     DPTR,#Average_Temp
00AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1331
00AE         ?C0241:
                                           ; SOURCE LINE # 1333
00AE 900000      E     MOV     DPTR,#Fan1Off_Step2
00B1 120000      R     LCALL   L?0522
00B4 D3                SETB    C
00B5 9F                SUBB    A,R7
00B6 5002              JNC     ?C0242
                                           ; SOURCE LINE # 1334
                                           ; SOURCE LINE # 1335
00B8         ?C0468:
                                           ; SOURCE LINE # 1336
00B8 8024              SJMP    ?C0469
                                           ; SOURCE LINE # 1338
00BA         ?C0242:
                                           ; SOURCE LINE # 1340
00BA 900000      E     MOV     DPTR,#Fan1Off_Step2
00BD 120000      R     LCALL   L?0522
00C0 C3                CLR     C
00C1 9F                SUBB    A,R7
00C2 402A              JC      ?C0243
                                           ; SOURCE LINE # 1341
                                           ; SOURCE LINE # 1342
00C4 900000      E     MOV     DPTR,#Fan1On_Step1
00C7 120000      R     LCALL   L?0522
00CA 9F                SUBB    A,R7
00CB 5021              JNC     ?C0243
                                           ; SOURCE LINE # 1343
                                           ; SOURCE LINE # 1344
00CD 900000      E     MOV     DPTR,#DCR5
00D0 E0                MOVX    A,@DPTR
00D1 600B              JZ      ?C0245
                                           ; SOURCE LINE # 1345
                                           ; SOURCE LINE # 1346
00D3 900000      E     MOV     DPTR,#Target_Duty
00D6 742E              MOV     A,#02EH
00D8         ?C0467:
00D8 F0                MOVX    @DPTR,A
00D9 900000      E     MOV     DPTR,#DCR5
00DC F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 97  

                                           ; SOURCE LINE # 1347
00DD 22                RET     
00DE         ?C0245:
                                           ; SOURCE LINE # 1349
                                           ; SOURCE LINE # 1350
00DE         ?C0469:
00DE E4                CLR     A
00DF 900000      E     MOV     DPTR,#Target_Duty
00E2 F0                MOVX    @DPTR,A
00E3 900000      E     MOV     DPTR,#DCR5
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1351
00E7 900000      E     MOV     DPTR,#FAN1_RPM
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1352
00ED 22                RET     
                                           ; SOURCE LINE # 1354
                                           ; SOURCE LINE # 1355
00EE         ?C0243:
                                           ; SOURCE LINE # 1356
                                           ; SOURCE LINE # 1357
                                           ; SOURCE LINE # 1358
00EE 120000      R     LCALL   L?0595
                                           ; SOURCE LINE # 1359
00F1 120000      R     LCALL   CheckFan1RPM
                                           ; SOURCE LINE # 1360
00F4         ?C0239:
                                           ; SOURCE LINE # 1362
00F4 120000      R     LCALL   Fan1MainControl
                                           ; SOURCE LINE # 1363
00F7         ?C0225:
00F7 22                RET     
             ; FUNCTION Oem_Fan_Control (END)

             ; FUNCTION Oem_Fan1_Control (BEGIN)
                                           ; SOURCE LINE # 1367
                                           ; SOURCE LINE # 1368
                                           ; SOURCE LINE # 1369
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#GPCRA4
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1370
0005 120000      R     LCALL   InitThermalTable2
                                           ; SOURCE LINE # 1372
0008 900000      E     MOV     DPTR,#uISCT
000B E0                MOVX    A,@DPTR
000C 30E403            JNB     ACC.4,?C0247
                                           ; SOURCE LINE # 1373
                                           ; SOURCE LINE # 1374
                                           ; SOURCE LINE # 1375
000F 020000      R     LJMP    ?C0483
                                           ; SOURCE LINE # 1377
0012         ?C0247:
                                           ; SOURCE LINE # 1379
0012 900000      E     MOV     DPTR,#ERR_THMSTS
0015 E0                MOVX    A,@DPTR
0016 20E107            JB      ACC.1,?C0250
0019 900000      E     MOV     DPTR,#Thro_Status2
001C E0                MOVX    A,@DPTR
001D 30E406            JNB     ACC.4,?C0249
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 98  

0020         ?C0250:
                                           ; SOURCE LINE # 1381
                                           ; SOURCE LINE # 1382
0020 900000      E     MOV     DPTR,#CTR2
0023 020000      R     LJMP    ?C0474
                                           ; SOURCE LINE # 1384
0026         ?C0249:
                                           ; SOURCE LINE # 1387
0026 900000      E     MOV     DPTR,#ERR_THMSTS
0029 E0                MOVX    A,@DPTR
002A 30E311            JNB     ACC.3,?C0251
002D 900000      E     MOV     DPTR,#SYS_STATUS
0030 E0                MOVX    A,@DPTR
0031 5407              ANL     A,#07H
0033 7009              JNZ     ?C0251
                                           ; SOURCE LINE # 1388
                                           ; SOURCE LINE # 1389
0035 900000      E     MOV     DPTR,#CTR2
0038 E0                MOVX    A,@DPTR
0039 FD                MOV     R5,A
003A 7F32              MOV     R7,#032H
003C 8009              SJMP    ?C0475
                                           ; SOURCE LINE # 1391
003E         ?C0251:
                                           ; SOURCE LINE # 1394
003E 900000      E     MOV     DPTR,#Fan_ON_Count
0041 E0                MOVX    A,@DPTR
0042 600D              JZ      ?C0252
                                           ; SOURCE LINE # 1395
                                           ; SOURCE LINE # 1396
                                           ; SOURCE LINE # 1397
0044 120000      R     LCALL   L?0566
0047         ?C0475:
0047 120000      E     LCALL   _Cal_PWM_Duty
004A 900000      E     MOV     DPTR,#Target_Duty
004D EF                MOV     A,R7
004E 020000      R     LJMP    ?C0479
                                           ; SOURCE LINE # 1399
0051         ?C0252:
                                           ; SOURCE LINE # 1401
0051 120000      R     LCALL   L?0536
0054 6003              JZ      ?C0253
                                           ; SOURCE LINE # 1402
                                           ; SOURCE LINE # 1403
0056         ?C0473:
                                           ; SOURCE LINE # 1404
0056 020000      R     LJMP    ?C0483
                                           ; SOURCE LINE # 1406
0059         ?C0253:
                                           ; SOURCE LINE # 1408
0059 900000      E     MOV     DPTR,#GPDRC
005C E0                MOVX    A,@DPTR
005D 30E546            JNB     ACC.5,?C0254
                                           ; SOURCE LINE # 1409
                                           ; SOURCE LINE # 1410
0060 120000      R     LCALL   L?0518
0063 4002              JC      ?C0255
                                           ; SOURCE LINE # 1411
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
0065 8003              SJMP    ?C0470
0067         ?C0255:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 99  

                                           ; SOURCE LINE # 1415
                                           ; SOURCE LINE # 1416
0067 900000      E     MOV     DPTR,#TEMP_Buff_3
006A         ?C0470:
006A E0                MOVX    A,@DPTR
006B 900000      E     MOV     DPTR,#Average_Temp
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1417
006F         ?C0256:
                                           ; SOURCE LINE # 1419
006F 900000      E     MOV     DPTR,#Fan2Off_Step1
0072 120000      R     LCALL   L?0522
0075 D3                SETB    C
0076 9F                SUBB    A,R7
0077 5003              JNC     ?C0257
                                           ; SOURCE LINE # 1420
                                           ; SOURCE LINE # 1421
0079         ?C0477:
                                           ; SOURCE LINE # 1422
0079 020000      R     LJMP    ?C0483
                                           ; SOURCE LINE # 1424
007C         ?C0257:
                                           ; SOURCE LINE # 1426
007C 900000      E     MOV     DPTR,#Fan2Off_Step1
007F 120000      R     LCALL   L?0522
0082 C3                CLR     C
0083 9F                SUBB    A,R7
0084 401A              JC      ?C0258
                                           ; SOURCE LINE # 1427
                                           ; SOURCE LINE # 1428
0086 900000      E     MOV     DPTR,#Fan2On_Step1
0089 120000      R     LCALL   L?0522
008C 9F                SUBB    A,R7
008D 5011              JNC     ?C0258
                                           ; SOURCE LINE # 1429
                                           ; SOURCE LINE # 1430
008F 900000      E     MOV     DPTR,#DCR4
0092 E0                MOVX    A,@DPTR
0093 6009              JZ      ?C0260
                                           ; SOURCE LINE # 1431
                                           ; SOURCE LINE # 1432
0095 900000      E     MOV     DPTR,#Fan2RPM_Step1
0098         ?C0474:
0098 E0                MOVX    A,@DPTR
0099 900000      E     MOV     DPTR,#Target_Duty
009C         ?C0476:
                                           ; SOURCE LINE # 1433
009C 805E              SJMP    ?C0479
009E         ?C0260:
                                           ; SOURCE LINE # 1435
                                           ; SOURCE LINE # 1436
009E         ?C0478:
                                           ; SOURCE LINE # 1437
                                           ; SOURCE LINE # 1438
009E 8062              SJMP    ?C0483
                                           ; SOURCE LINE # 1440
                                           ; SOURCE LINE # 1441
00A0         ?C0258:
                                           ; SOURCE LINE # 1442
00A0 120000      R     LCALL   CheckFanRPM2
                                           ; SOURCE LINE # 1443
00A3 020000      R     LJMP    ?C0262
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 100 

00A6         ?C0254:
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1447
00A6 900000      E     MOV     DPTR,#FanTable_Type
00A9 E0                MOVX    A,@DPTR
00AA 700C              JNZ     ?C0263
                                           ; SOURCE LINE # 1448
                                           ; SOURCE LINE # 1449
00AC 120000      R     LCALL   L?0518
00AF 4002              JC      ?C0264
                                           ; SOURCE LINE # 1450
                                           ; SOURCE LINE # 1451
                                           ; SOURCE LINE # 1452
00B1 801A              SJMP    ?C0482
00B3         ?C0264:
                                           ; SOURCE LINE # 1454
                                           ; SOURCE LINE # 1455
00B3 900000      E     MOV     DPTR,#VGA_TBuff3
00B6         ?C0471:
                                           ; SOURCE LINE # 1456
                                           ; SOURCE LINE # 1457
00B6 8015              SJMP    ?C0482
00B8         ?C0263:
                                           ; SOURCE LINE # 1459
                                           ; SOURCE LINE # 1460
00B8 900000      E     MOV     DPTR,#VGA_TBuff3
00BB E0                MOVX    A,@DPTR
00BC C3                CLR     C
00BD 943D              SUBB    A,#03DH
00BF 4002              JC      ?C0267
                                           ; SOURCE LINE # 1461
                                           ; SOURCE LINE # 1462
00C1         ?C0481:
                                           ; SOURCE LINE # 1463
00C1 800A              SJMP    ?C0482
00C3         ?C0267:
                                           ; SOURCE LINE # 1465
                                           ; SOURCE LINE # 1466
00C3 120000      R     LCALL   L?0518
00C6 4002              JC      ?C0269
                                           ; SOURCE LINE # 1467
                                           ; SOURCE LINE # 1468
                                           ; SOURCE LINE # 1469
00C8 8003              SJMP    ?C0472
00CA         ?C0269:
                                           ; SOURCE LINE # 1471
                                           ; SOURCE LINE # 1472
00CA 900000      E     MOV     DPTR,#VGA_TBuff3
00CD         ?C0472:
00CD         ?C0482:
00CD E0                MOVX    A,@DPTR
00CE 900000      E     MOV     DPTR,#Average_Temp
00D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1473
                                           ; SOURCE LINE # 1474
                                           ; SOURCE LINE # 1475
00D2         ?C0266:
                                           ; SOURCE LINE # 1477
00D2 900000      E     MOV     DPTR,#Fan2Off_Step2
00D5 120000      R     LCALL   L?0522
00D8 D3                SETB    C
00D9 9F                SUBB    A,R7
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 101 

00DA 5002              JNC     ?C0271
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1479
00DC         ?C0480:
                                           ; SOURCE LINE # 1480
00DC 8024              SJMP    ?C0483
                                           ; SOURCE LINE # 1482
00DE         ?C0271:
                                           ; SOURCE LINE # 1484
00DE 900000      E     MOV     DPTR,#Fan2Off_Step2
00E1 120000      R     LCALL   L?0522
00E4 C3                CLR     C
00E5 9F                SUBB    A,R7
00E6 402A              JC      ?C0272
                                           ; SOURCE LINE # 1485
                                           ; SOURCE LINE # 1486
00E8 900000      E     MOV     DPTR,#Fan2On_Step1
00EB 120000      R     LCALL   L?0522
00EE 9F                SUBB    A,R7
00EF 5021              JNC     ?C0272
                                           ; SOURCE LINE # 1487
                                           ; SOURCE LINE # 1488
00F1 900000      E     MOV     DPTR,#DCR4
00F4 E0                MOVX    A,@DPTR
00F5 600B              JZ      ?C0274
                                           ; SOURCE LINE # 1489
                                           ; SOURCE LINE # 1490
00F7 900000      E     MOV     DPTR,#Target_Duty
00FA 742C              MOV     A,#02CH
00FC         ?C0479:
00FC F0                MOVX    @DPTR,A
00FD 900000      E     MOV     DPTR,#DCR4
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1491
0101 22                RET     
0102         ?C0274:
                                           ; SOURCE LINE # 1493
                                           ; SOURCE LINE # 1494
0102         ?C0483:
0102 E4                CLR     A
0103 900000      E     MOV     DPTR,#Target_Duty
0106 F0                MOVX    @DPTR,A
0107 900000      E     MOV     DPTR,#DCR4
010A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1495
010B 900000      E     MOV     DPTR,#FAN2_RPM
010E F0                MOVX    @DPTR,A
010F A3                INC     DPTR
0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1496
0111 22                RET     
                                           ; SOURCE LINE # 1498
                                           ; SOURCE LINE # 1499
0112         ?C0272:
                                           ; SOURCE LINE # 1500
                                           ; SOURCE LINE # 1501
                                           ; SOURCE LINE # 1502
0112 120000      R     LCALL   L?0595
                                           ; SOURCE LINE # 1503
0115 120000      R     LCALL   CheckFan2RPM
                                           ; SOURCE LINE # 1504
0118         ?C0262:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 102 

                                           ; SOURCE LINE # 1506
0118 120000      R     LCALL   Fan2MainControl
                                           ; SOURCE LINE # 1507
011B         ?C0248:
011B 22                RET     
             ; FUNCTION Oem_Fan1_Control (END)

             ; FUNCTION _Fan_Offset_Chk (BEGIN)
                                           ; SOURCE LINE # 1508
;---- Variable 'BDCRx' assigned to Register 'R4/R5' ----
;---- Variable 'Duty_Offset' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 1509
                                           ; SOURCE LINE # 1510
0000 900000      E     MOV     DPTR,#FAN1_RPM+01H
0003 120000      R     LCALL   L?0549
0006 900000      E     MOV     DPTR,#FAN1_RPM
0009 E0                MOVX    A,@DPTR
000A 9E                SUBB    A,R6
000B 500D              JNC     ?C0276
                                           ; SOURCE LINE # 1511
                                           ; SOURCE LINE # 1512
000D 120000      R     LCALL   L?0537
0010 5022              JNC     ?C0281
                                           ; SOURCE LINE # 1513
0012 8D82              MOV     DPL,R5
0014 8C83              MOV     DPH,R4
0016 E0                MOVX    A,@DPTR
0017 04                INC     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1514
0019 22                RET     
001A         ?C0276:
                                           ; SOURCE LINE # 1515
001A 900000      E     MOV     DPTR,#FAN1_RPM+01H
001D 120000      R     LCALL   L?0568
0020 900000      E     MOV     DPTR,#FAN1_RPM
0023 E0                MOVX    A,@DPTR
0024 9E                SUBB    A,R6
0025 400D              JC      ?C0281
                                           ; SOURCE LINE # 1516
                                           ; SOURCE LINE # 1517
0027 8D82              MOV     DPL,R5
0029 8C83              MOV     DPH,R4
002B E0                MOVX    A,@DPTR
002C D3                SETB    C
002D 9400              SUBB    A,#00H
002F 4003              JC      ?C0281
                                           ; SOURCE LINE # 1518
0031 E0                MOVX    A,@DPTR
0032 14                DEC     A
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1519
                                           ; SOURCE LINE # 1521
0034         ?C0281:
0034 22                RET     
             ; FUNCTION _Fan_Offset_Chk (END)

             ; FUNCTION _Fan1_Offset_Chk (BEGIN)
                                           ; SOURCE LINE # 1523
;---- Variable 'BDCRx' assigned to Register 'R4/R5' ----
;---- Variable 'Duty_Offset' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 1524
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 103 

                                           ; SOURCE LINE # 1525
0000 900000      E     MOV     DPTR,#FAN2_RPM+01H
0003 120000      R     LCALL   L?0549
0006 900000      E     MOV     DPTR,#FAN2_RPM
0009 E0                MOVX    A,@DPTR
000A 9E                SUBB    A,R6
000B 500D              JNC     ?C0282
                                           ; SOURCE LINE # 1526
                                           ; SOURCE LINE # 1527
000D 120000      R     LCALL   L?0537
0010 5022              JNC     ?C0287
                                           ; SOURCE LINE # 1528
0012 8D82              MOV     DPL,R5
0014 8C83              MOV     DPH,R4
0016 E0                MOVX    A,@DPTR
0017 04                INC     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1529
0019 22                RET     
001A         ?C0282:
                                           ; SOURCE LINE # 1530
001A 900000      E     MOV     DPTR,#FAN2_RPM+01H
001D 120000      R     LCALL   L?0568
0020 900000      E     MOV     DPTR,#FAN2_RPM
0023 E0                MOVX    A,@DPTR
0024 9E                SUBB    A,R6
0025 400D              JC      ?C0287
                                           ; SOURCE LINE # 1531
                                           ; SOURCE LINE # 1532
0027 8D82              MOV     DPL,R5
0029 8C83              MOV     DPH,R4
002B E0                MOVX    A,@DPTR
002C D3                SETB    C
002D 9400              SUBB    A,#00H
002F 4003              JC      ?C0287
                                           ; SOURCE LINE # 1533
0031 E0                MOVX    A,@DPTR
0032 14                DEC     A
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1534
                                           ; SOURCE LINE # 1536
0034         ?C0287:
0034 22                RET     
             ; FUNCTION _Fan1_Offset_Chk (END)

             ; FUNCTION Clr_Thermal_Tab (BEGIN)
                                           ; SOURCE LINE # 1567
                                           ; SOURCE LINE # 1568
                                           ; SOURCE LINE # 1571
0000 900000      E     MOV     DPTR,#TEST_FLAG
0003 E0                MOVX    A,@DPTR
0004 547F              ANL     A,#07FH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1573
;---- Variable 'Thermal_pntr' assigned to Register 'DPTR' ----
0007 900000      E     MOV     DPTR,#FAN_Tab_OFF
                                           ; SOURCE LINE # 1574
000A E4                CLR     A
000B F500        E     MOV     ITempW01,A
000D F500        E     MOV     ITempW01+01H,A
000F         ?C0288:
                                           ; SOURCE LINE # 1575
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 104 

                                           ; SOURCE LINE # 1576
000F E4                CLR     A
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1577
0011 A3                INC     DPTR
                                           ; SOURCE LINE # 1578
0012 0500        E     INC     ITempW01+01H
0014 E500        E     MOV     A,ITempW01+01H
0016 7002              JNZ     ?C0450
0018 0500        E     INC     ITempW01
001A         ?C0450:
001A E500        E     MOV     A,ITempW01+01H
001C 640A              XRL     A,#0AH
001E 4500        E     ORL     A,ITempW01
0020 70ED              JNZ     ?C0288
0022         ?C0289:
                                           ; SOURCE LINE # 1580
0022 900000      E     MOV     DPTR,#VFAN_Tab_OFF
                                           ; SOURCE LINE # 1581
0025 E4                CLR     A
0026 F500        E     MOV     ITempW01,A
0028 F500        E     MOV     ITempW01+01H,A
002A         ?C0291:
                                           ; SOURCE LINE # 1582
                                           ; SOURCE LINE # 1583
002A E4                CLR     A
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1584
002C A3                INC     DPTR
                                           ; SOURCE LINE # 1585
002D 0500        E     INC     ITempW01+01H
002F E500        E     MOV     A,ITempW01+01H
0031 7002              JNZ     ?C0451
0033 0500        E     INC     ITempW01
0035         ?C0451:
0035 E500        E     MOV     A,ITempW01+01H
0037 640A              XRL     A,#0AH
0039 4500        E     ORL     A,ITempW01
003B 70ED              JNZ     ?C0291
                                           ; SOURCE LINE # 1586
003D         ?C0294:
003D 22                RET     
             ; FUNCTION Clr_Thermal_Tab (END)

             ; FUNCTION OEM_Throttling_Ctrl (BEGIN)
                                           ; SOURCE LINE # 1614
                                           ; SOURCE LINE # 1615
                                           ; SOURCE LINE # 1618
;---- Variable 'BTbStep' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1620
0000 120000      R     LCALL   L?0536
0003 6008              JZ      ?C0295
                                           ; SOURCE LINE # 1622
                                           ; SOURCE LINE # 1623
0005 900000      E     MOV     DPTR,#GPDRJ
0008 E0                MOVX    A,@DPTR
0009 54EF              ANL     A,#0EFH
000B F0                MOVX    @DPTR,A
000C 22                RET     
                                           ; SOURCE LINE # 1625
000D         ?C0295:
                                           ; SOURCE LINE # 1627
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 105 

000D E4                CLR     A
000E FF                MOV     R7,A
                                           ; SOURCE LINE # 1635
000F 120000      R     LCALL   _Thro_Std_Mode
                                           ; SOURCE LINE # 1646
0012 900000      E     MOV     DPTR,#THR_PRO_ON
0015 E0                MOVX    A,@DPTR
0016 900000      E     MOV     DPTR,#nOSThrottlingTemp
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1647
001A 900000      E     MOV     DPTR,#THR_Tab_Shut
001D E0                MOVX    A,@DPTR
001E 900000      E     MOV     DPTR,#nOSShutdownTemp
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1648
0022 900000      E     MOV     DPTR,#THR_Tab_Shut
0025 E0                MOVX    A,@DPTR
0026 900000      E     MOV     DPTR,#nShutDownTemp
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1650
002A         ?C0296:
002A 22                RET     
             ; FUNCTION OEM_Throttling_Ctrl (END)

             ; FUNCTION _Thro_Std_Mode (BEGIN)
                                           ; SOURCE LINE # 1655
0000 900000      R     MOV     DPTR,#BMBStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1656
                                           ; SOURCE LINE # 1657
0005 900000      E     MOV     DPTR,#CPU_TYPE
0008 E0                MOVX    A,@DPTR
0009 5403              ANL     A,#03H
000B 24FE              ADD     A,#0FEH
                                           ; SOURCE LINE # 1658
                                           ; SOURCE LINE # 1660
000D         ?C0298:
                                           ; SOURCE LINE # 1661
                                           ; SOURCE LINE # 1662
                                           ; SOURCE LINE # 1664
                                           ; SOURCE LINE # 1665
                                           ; SOURCE LINE # 1668
000D         ?C0484:
000D 900000      R     MOV     DPTR,#BMBStep
0010 E0                MOVX    A,@DPTR
0011 FF                MOV     R7,A
0012 120000      R     LCALL   _THRTab_ToRAM
                                           ; SOURCE LINE # 1670
0015 900000      R     MOV     DPTR,#BMBStep
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A E4                CLR     A
001B FD                MOV     R5,A
001C 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 1672
001F 900000      R     MOV     DPTR,#BMBStep
0022 E0                MOVX    A,@DPTR
0023 FE                MOV     R6,A
0024 120000      R     LCALL   L?0540
0027 FF                MOV     R7,A
0028 EE                MOV     A,R6
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 106 

0029 120000      R     LCALL   L?0542
002C FD                MOV     R5,A
002D E4                CLR     A
002E FB                MOV     R3,A
002F 120000      R     LCALL   _Thro_Turbo
                                           ; SOURCE LINE # 1673
                                           ; SOURCE LINE # 1674
0032         ?C0297:
                                           ; SOURCE LINE # 1676
0032 900000      R     MOV     DPTR,#BMBStep
0035 E0                MOVX    A,@DPTR
0036 04                INC     A
0037 FF                MOV     R7,A
0038 120000      R     LCALL   _VTHRTab_ToRAM
                                           ; SOURCE LINE # 1677
003B 900000      R     MOV     DPTR,#BMBStep
003E E0                MOVX    A,@DPTR
003F 04                INC     A
0040 FF                MOV     R7,A
0041 7D01              MOV     R5,#01H
0043 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 1679
0046 900000      R     MOV     DPTR,#BMBStep
0049 E0                MOVX    A,@DPTR
004A FE                MOV     R6,A
004B 75F005            MOV     B,#05H
004E A4                MUL     AB
004F 2400        R     ADD     A,#LOW CPUTHRTable+07H
0051 F582              MOV     DPL,A
0053 E4                CLR     A
0054 3400        R     ADDC    A,#HIGH CPUTHRTable+07H
0056 F583              MOV     DPH,A
0058 E4                CLR     A
0059 93                MOVC    A,@A+DPTR
005A FF                MOV     R7,A
005B EE                MOV     A,R6
005C 75F005            MOV     B,#05H
005F A4                MUL     AB
0060 2400        R     ADD     A,#LOW CPUTHRTable+08H
0062 F582              MOV     DPL,A
0064 E4                CLR     A
0065 3400        R     ADDC    A,#HIGH CPUTHRTable+08H
0067 F583              MOV     DPH,A
0069 E4                CLR     A
006A 93                MOVC    A,@A+DPTR
006B FD                MOV     R5,A
006C 7B01              MOV     R3,#01H
006E 120000      R     LCALL   _Thro_Turbo
                                           ; SOURCE LINE # 1681
0071 7D04              MOV     R5,#04H
0073 E4                CLR     A
0074 FF                MOV     R7,A
0075 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 1682
0078 900000      E     MOV     DPTR,#uMBGPU
007B E0                MOVX    A,@DPTR
007C 30E107            JNB     ACC.1,?C0301
                                           ; SOURCE LINE # 1683
                                           ; SOURCE LINE # 1684
007F 7D05              MOV     R5,#05H
0081 E4                CLR     A
0082 FF                MOV     R7,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 107 

0083 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 1685
                                           ; SOURCE LINE # 1687
0086         ?C0301:
0086 22                RET     
             ; FUNCTION _Thro_Std_Mode (END)

             ; FUNCTION _Thro_Shut_Status (BEGIN)
                                           ; SOURCE LINE # 1824
0000 900000      R     MOV     DPTR,#BStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1825
                                           ; SOURCE LINE # 1828
0008 6402              XRL     A,#02H
000A 7037              JNZ     ?C0302
                                           ; SOURCE LINE # 1829
                                           ; SOURCE LINE # 1831
000C 900000      E     MOV     DPTR,#THR_PRO_OFF
000F 120000      R     LCALL   L?0578
0012 5009              JNC     ?C0303
                                           ; SOURCE LINE # 1832
0014 900000      E     MOV     DPTR,#Thro_Status
0017 E0                MOVX    A,@DPTR
0018 54FB              ANL     A,#0FBH
001A F0                MOVX    @DPTR,A
001B 800F              SJMP    ?C0304
001D         ?C0303:
                                           ; SOURCE LINE # 1834
001D 900000      E     MOV     DPTR,#THR_PRO_ON
0020 120000      R     LCALL   L?0578
0023 4007              JC      ?C0304
                                           ; SOURCE LINE # 1835
0025 900000      E     MOV     DPTR,#Thro_Status
0028 E0                MOVX    A,@DPTR
0029 4404              ORL     A,#04H
002B F0                MOVX    @DPTR,A
002C         ?C0304:
                                           ; SOURCE LINE # 1838
002C 900000      E     MOV     DPTR,#THR_Tab_Shut
002F 120000      R     LCALL   L?0579
0032 4009              JC      ?C0306
                                           ; SOURCE LINE # 1839
0034 7E00        E     MOV     R6,#HIGH EXTVGA_Shut_Cnt
0036 7F00        E     MOV     R7,#LOW EXTVGA_Shut_Cnt
0038 7D02              MOV     R5,#02H
003A 020000      R     LJMP    ?C0488
003D         ?C0306:
                                           ; SOURCE LINE # 1841
003D E4                CLR     A
003E 900000      E     MOV     DPTR,#EXTVGA_Shut_Cnt
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1842
0042 22                RET     
0043         ?C0302:
                                           ; SOURCE LINE # 1843
0043 900000      R     MOV     DPTR,#BTType
0046 E0                MOVX    A,@DPTR
0047 B4011C            CJNE    A,#01H,?C0309
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 108 

                                           ; SOURCE LINE # 1844
                                           ; SOURCE LINE # 1854
004A 900000      E     MOV     DPTR,#VTHR_Tab_Shut
004D E0                MOVX    A,@DPTR
004E FF                MOV     R7,A
004F 900000      E     MOV     DPTR,#VGA_TBuff3
0052 E0                MOVX    A,@DPTR
0053 C3                CLR     C
0054 9F                SUBB    A,R7
0055 4009              JC      ?C0310
                                           ; SOURCE LINE # 1855
0057 7E00        E     MOV     R6,#HIGH VGA_Shut_Cnt
0059 7F00        E     MOV     R7,#LOW VGA_Shut_Cnt
005B 7D01              MOV     R5,#01H
005D         ?C0485:
005D 020000      R     LJMP    ?C0488
0060         ?C0310:
                                           ; SOURCE LINE # 1857
0060 E4                CLR     A
0061 900000      E     MOV     DPTR,#VGA_Shut_Cnt
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1858
0065 22                RET     
0066         ?C0309:
                                           ; SOURCE LINE # 1859
0066 900000      R     MOV     DPTR,#BTType
0069 E0                MOVX    A,@DPTR
006A B40417            CJNE    A,#04H,?C0313
                                           ; SOURCE LINE # 1860
                                           ; SOURCE LINE # 1861
006D 900000      E     MOV     DPTR,#nVramTemp
0070 E0                MOVX    A,@DPTR
0071 C3                CLR     C
0072 945A              SUBB    A,#05AH
0074 4008              JC      ?C0314
                                           ; SOURCE LINE # 1863
0076 7E00        E     MOV     R6,#HIGH local_Shut_Cnt
0078 7F00        E     MOV     R7,#LOW local_Shut_Cnt
007A 7D04              MOV     R5,#04H
007C         ?C0486:
007C 8052              SJMP    ?C0488
007E         ?C0314:
                                           ; SOURCE LINE # 1865
007E E4                CLR     A
007F 900000      E     MOV     DPTR,#local_Shut_Cnt
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1866
0083 22                RET     
0084         ?C0313:
                                           ; SOURCE LINE # 1867
0084 900000      R     MOV     DPTR,#BTType
0087 E0                MOVX    A,@DPTR
0088 B40517            CJNE    A,#05H,?C0317
                                           ; SOURCE LINE # 1868
                                           ; SOURCE LINE # 1869
008B 900000      E     MOV     DPTR,#nRamTemp
008E E0                MOVX    A,@DPTR
008F C3                CLR     C
0090 945A              SUBB    A,#05AH
0092 4008              JC      ?C0318
                                           ; SOURCE LINE # 1871
0094 7E00        E     MOV     R6,#HIGH remote_Shut_Cnt
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 109 

0096 7F00        E     MOV     R7,#LOW remote_Shut_Cnt
0098 7D05              MOV     R5,#05H
009A         ?C0487:
009A 8034              SJMP    ?C0488
009C         ?C0318:
                                           ; SOURCE LINE # 1873
009C E4                CLR     A
009D 900000      E     MOV     DPTR,#remote_Shut_Cnt
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1874
00A1 22                RET     
00A2         ?C0317:
                                           ; SOURCE LINE # 1876
                                           ; SOURCE LINE # 1878
00A2 900000      E     MOV     DPTR,#THR_PRO_OFF
00A5 120000      R     LCALL   L?0519
00A8 5009              JNC     ?C0321
                                           ; SOURCE LINE # 1879
00AA 900000      E     MOV     DPTR,#Thro_Status
00AD E0                MOVX    A,@DPTR
00AE 54FE              ANL     A,#0FEH
00B0 F0                MOVX    @DPTR,A
00B1 800F              SJMP    ?C0322
00B3         ?C0321:
                                           ; SOURCE LINE # 1881
00B3 900000      E     MOV     DPTR,#THR_PRO_ON
00B6 120000      R     LCALL   L?0519
00B9 4007              JC      ?C0322
                                           ; SOURCE LINE # 1882
00BB 900000      E     MOV     DPTR,#Thro_Status
00BE E0                MOVX    A,@DPTR
00BF 4401              ORL     A,#01H
00C1 F0                MOVX    @DPTR,A
00C2         ?C0322:
                                           ; SOURCE LINE # 1885
00C2 900000      E     MOV     DPTR,#THR_Tab_Shut
00C5 120000      R     LCALL   L?0519
00C8 4009              JC      ?C0324
                                           ; SOURCE LINE # 1886
00CA 7E00        E     MOV     R6,#HIGH CPU_Shut_Cnt
00CC 7F00        E     MOV     R7,#LOW CPU_Shut_Cnt
00CE E4                CLR     A
00CF FD                MOV     R5,A
00D0         ?C0488:
00D0 020000      R     LJMP    _Thro_Count_Shut
00D3         ?C0324:
                                           ; SOURCE LINE # 1888
00D3 E4                CLR     A
00D4 900000      E     MOV     DPTR,#CPU_Shut_Cnt
00D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1889
                                           ; SOURCE LINE # 1891
00D8         ?C0326:
00D8 22                RET     
             ; FUNCTION _Thro_Shut_Status (END)

             ; FUNCTION _Thro_Turbo (BEGIN)
                                           ; SOURCE LINE # 1896
;---- Variable 'BTurboRem' assigned to Register 'R7' ----
;---- Variable 'BTType' assigned to Register 'R3' ----
;---- Variable 'BTurboOff' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 1897
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 110 

                                           ; SOURCE LINE # 1900
0000 900000      E     MOV     DPTR,#SYS_MISC1
0003 E0                MOVX    A,@DPTR
0004 20E703            JB      ACC.7,$ + 6H
0007 020000      R     LJMP    ?C0328
000A         ?C0327:
                                           ; SOURCE LINE # 1903
000A EB                MOV     A,R3
000B 6402              XRL     A,#02H
000D 7027              JNZ     ?C0329
                                           ; SOURCE LINE # 1904
                                           ; SOURCE LINE # 1905
000F 900000      E     MOV     DPTR,#EXT_VGA_Buff3
0012 E0                MOVX    A,@DPTR
0013 D3                SETB    C
0014 9F                SUBB    A,R7
0015 500A              JNC     ?C0330
                                           ; SOURCE LINE # 1906
0017 900000      E     MOV     DPTR,#Thro_Status
001A E0                MOVX    A,@DPTR
001B 54DF              ANL     A,#0DFH
001D F0                MOVX    @DPTR,A
001E 020000      R     LJMP    ?C0333
0021         ?C0330:
                                           ; SOURCE LINE # 1907
0021 900000      E     MOV     DPTR,#EXT_VGA_Buff3
0024 E0                MOVX    A,@DPTR
0025 C3                CLR     C
0026 9D                SUBB    A,R5
0027 5003              JNC     $ + 5H
0029 020000      R     LJMP    ?C0333
                                           ; SOURCE LINE # 1908
002C 900000      E     MOV     DPTR,#Thro_Status
002F E0                MOVX    A,@DPTR
0030 4420              ORL     A,#020H
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1909
0033 020000      R     LJMP    ?C0333
0036         ?C0329:
                                           ; SOURCE LINE # 1910
0036 EB                MOV     A,R3
0037 6401              XRL     A,#01H
0039 7027              JNZ     ?C0334
                                           ; SOURCE LINE # 1911
                                           ; SOURCE LINE # 1913
003B 900000      E     MOV     DPTR,#VGA_TBuff3
003E E0                MOVX    A,@DPTR
003F D3                SETB    C
0040 9F                SUBB    A,R7
0041 500A              JNC     ?C0335
                                           ; SOURCE LINE # 1914
0043 900000      E     MOV     DPTR,#Thro_Status
0046 E0                MOVX    A,@DPTR
0047 54EF              ANL     A,#0EFH
0049 F0                MOVX    @DPTR,A
004A 020000      R     LJMP    ?C0333
004D         ?C0335:
                                           ; SOURCE LINE # 1916
004D 900000      E     MOV     DPTR,#VGA_TBuff3
0050 E0                MOVX    A,@DPTR
0051 C3                CLR     C
0052 9D                SUBB    A,R5
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 111 

0053 5003              JNC     $ + 5H
0055 020000      R     LJMP    ?C0333
                                           ; SOURCE LINE # 1917
0058 900000      E     MOV     DPTR,#Thro_Status
005B E0                MOVX    A,@DPTR
005C 4410              ORL     A,#010H
005E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1918
005F 020000      R     LJMP    ?C0333
0062         ?C0334:
                                           ; SOURCE LINE # 1920
                                           ; SOURCE LINE # 1921
0062 900000      E     MOV     DPTR,#GPDRC
0065 E0                MOVX    A,@DPTR
0066 30E546            JNB     ACC.5,?C0339
                                           ; SOURCE LINE # 1922
                                           ; SOURCE LINE # 1934
0069 900000      E     MOV     DPTR,#QuiteMode
006C E0                MOVX    A,@DPTR
006D 7020              JNZ     ?C0340
                                           ; SOURCE LINE # 1935
                                           ; SOURCE LINE # 1948
                                           ; SOURCE LINE # 1949
006F 900000      E     MOV     DPTR,#nVramTemp
0072 E0                MOVX    A,@DPTR
0073 C3                CLR     C
0074 943B              SUBB    A,#03BH
0076 5025              JNC     ?C0489
0078 120000      R     LCALL   L?0596
007B 4002              JC      ?C0341
007D         ?C0342:
                                           ; SOURCE LINE # 1950
                                           ; SOURCE LINE # 1951
                                           ; SOURCE LINE # 1952
007D 8060              SJMP    ?C0493
007F         ?C0341:
                                           ; SOURCE LINE # 1953
007F 900000      E     MOV     DPTR,#nVramTemp
0082 E0                MOVX    A,@DPTR
0083 D3                SETB    C
0084 9437              SUBB    A,#037H
0086 5070              JNC     ?C0333
0088 120000      R     LCALL   L?0589
008B 506B              JNC     ?C0333
                                           ; SOURCE LINE # 1954
                                           ; SOURCE LINE # 1955
                                           ; SOURCE LINE # 1956
                                           ; SOURCE LINE # 1957
                                           ; SOURCE LINE # 1958
008D 8062              SJMP    ?C0494
008F         ?C0340:
                                           ; SOURCE LINE # 1960
                                           ; SOURCE LINE # 1961
008F 900000      E     MOV     DPTR,#nVramTemp
0092 E0                MOVX    A,@DPTR
0093 C3                CLR     C
0094 9438              SUBB    A,#038H
0096 5005              JNC     ?C0347
0098 120000      R     LCALL   L?0596
009B 4002              JC      ?C0346
009D         ?C0347:
                                           ; SOURCE LINE # 1962
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 112 

                                           ; SOURCE LINE # 1963
009D         ?C0489:
                                           ; SOURCE LINE # 1964
009D 8040              SJMP    ?C0493
009F         ?C0346:
                                           ; SOURCE LINE # 1965
009F 900000      E     MOV     DPTR,#nVramTemp
00A2 E0                MOVX    A,@DPTR
00A3 D3                SETB    C
00A4 9434              SUBB    A,#034H
00A6 5050              JNC     ?C0333
00A8 120000      R     LCALL   L?0589
00AB 504B              JNC     ?C0333
                                           ; SOURCE LINE # 1966
                                           ; SOURCE LINE # 1967
00AD         ?C0490:
                                           ; SOURCE LINE # 1968
                                           ; SOURCE LINE # 1969
                                           ; SOURCE LINE # 1970
00AD 8042              SJMP    ?C0494
00AF         ?C0339:
                                           ; SOURCE LINE # 1972
                                           ; SOURCE LINE # 1973
00AF 900000      E     MOV     DPTR,#uMBGPU
00B2 E0                MOVX    A,@DPTR
00B3 30E120            JNB     ACC.1,?C0351
                                           ; SOURCE LINE # 1974
                                           ; SOURCE LINE # 1995
                                           ; SOURCE LINE # 1996
00B6 900000      E     MOV     DPTR,#nVramTemp
00B9 E0                MOVX    A,@DPTR
00BA C3                CLR     C
00BB 943B              SUBB    A,#03BH
00BD 5005              JNC     ?C0353
00BF 120000      R     LCALL   L?0597
00C2 4002              JC      ?C0352
00C4         ?C0353:
                                           ; SOURCE LINE # 1997
                                           ; SOURCE LINE # 1998
00C4         ?C0491:
                                           ; SOURCE LINE # 1999
00C4 8019              SJMP    ?C0493
00C6         ?C0352:
                                           ; SOURCE LINE # 2000
00C6 900000      E     MOV     DPTR,#nVramTemp
00C9 E0                MOVX    A,@DPTR
00CA D3                SETB    C
00CB 9437              SUBB    A,#037H
00CD 5029              JNC     ?C0333
00CF 120000      R     LCALL   L?0590
00D2 5024              JNC     ?C0333
                                           ; SOURCE LINE # 2001
                                           ; SOURCE LINE # 2002
00D4         ?C0492:
                                           ; SOURCE LINE # 2003
                                           ; SOURCE LINE # 2004
                                           ; SOURCE LINE # 2005
00D4 801B              SJMP    ?C0494
00D6         ?C0351:
                                           ; SOURCE LINE # 2007
                                           ; SOURCE LINE # 2008
00D6 900000      E     MOV     DPTR,#TEMP_Buff_3
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 113 

00D9 E0                MOVX    A,@DPTR
00DA D3                SETB    C
00DB 9455              SUBB    A,#055H
00DD 4009              JC      ?C0357
                                           ; SOURCE LINE # 2009
                                           ; SOURCE LINE # 2010
00DF         ?C0493:
00DF 900000      E     MOV     DPTR,#Thro_Status
00E2 E0                MOVX    A,@DPTR
00E3 4408              ORL     A,#08H
00E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2011
00E6 8010              SJMP    ?C0333
00E8         ?C0357:
                                           ; SOURCE LINE # 2012
00E8 900000      E     MOV     DPTR,#TEMP_Buff_3
00EB E0                MOVX    A,@DPTR
00EC D3                SETB    C
00ED 9450              SUBB    A,#050H
00EF 5007              JNC     ?C0333
                                           ; SOURCE LINE # 2013
                                           ; SOURCE LINE # 2014
00F1         ?C0494:
00F1 900000      E     MOV     DPTR,#Thro_Status
00F4 E0                MOVX    A,@DPTR
00F5 54F7              ANL     A,#0F7H
00F7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2015
                                           ; SOURCE LINE # 2016
                                           ; SOURCE LINE # 2018
                                           ; SOURCE LINE # 2019
00F8         ?C0333:
                                           ; SOURCE LINE # 2101
00F8 900000      E     MOV     DPTR,#Thro_Status
00FB E0                MOVX    A,@DPTR
00FC 20E30F            JB      ACC.3,?C0360
                                           ; SOURCE LINE # 2102
                                           ; SOURCE LINE # 2103
00FF 900000      E     MOV     DPTR,#uVGATurboFun
0102 E0                MOVX    A,@DPTR
0103 30E318            JNB     ACC.3,?C0362
                                           ; SOURCE LINE # 2104
                                           ; SOURCE LINE # 2105
0106 E0                MOVX    A,@DPTR
0107 54F7              ANL     A,#0F7H
0109 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2107
010A 7F67              MOV     R7,#067H
                                           ; SOURCE LINE # 2108
                                           ; SOURCE LINE # 2109
010C 800D              SJMP    ?C0495
010E         ?C0360:
                                           ; SOURCE LINE # 2111
                                           ; SOURCE LINE # 2112
010E 900000      E     MOV     DPTR,#uVGATurboFun
0111 E0                MOVX    A,@DPTR
0112 20E309            JB      ACC.3,?C0362
                                           ; SOURCE LINE # 2113
                                           ; SOURCE LINE # 2114
0115 E0                MOVX    A,@DPTR
0116 4408              ORL     A,#08H
0118 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 114 

                                           ; SOURCE LINE # 2116
0119 7F66              MOV     R7,#066H
011B         ?C0495:
011B 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2117
                                           ; SOURCE LINE # 2118
011E         ?C0362:
                                           ; SOURCE LINE # 2123
                                           ; SOURCE LINE # 2124
011E 900000      E     MOV     DPTR,#Thro_Status
0121 E0                MOVX    A,@DPTR
0122 20E415            JB      ACC.4,?C0364
                                           ; SOURCE LINE # 2125
                                           ; SOURCE LINE # 2126
0125 900000      E     MOV     DPTR,#uVGATurboFun
0128 E0                MOVX    A,@DPTR
0129 30E21E            JNB     ACC.2,?C0366
                                           ; SOURCE LINE # 2127
                                           ; SOURCE LINE # 2129
012C E4                CLR     A
012D 900000      E     MOV     DPTR,#cGPUThermalThrottling
0130 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2130
0131 900000      E     MOV     DPTR,#uVGATurboFun
0134 E0                MOVX    A,@DPTR
0135 54FB              ANL     A,#0FBH
0137 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2131
                                           ; SOURCE LINE # 2133
0138 8010              SJMP    ?C0366
013A         ?C0364:
                                           ; SOURCE LINE # 2135
                                           ; SOURCE LINE # 2136
013A 900000      E     MOV     DPTR,#uVGATurboFun
013D E0                MOVX    A,@DPTR
013E 20E209            JB      ACC.2,?C0366
                                           ; SOURCE LINE # 2137
                                           ; SOURCE LINE # 2138
0141 E0                MOVX    A,@DPTR
0142 4404              ORL     A,#04H
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2140
0145 E4                CLR     A
0146 900000      E     MOV     DPTR,#cGPUThermalThrottling
0149 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2141
                                           ; SOURCE LINE # 2142
014A         ?C0366:
                                           ; SOURCE LINE # 2143
                                           ; SOURCE LINE # 2146
014A 900000      E     MOV     DPTR,#uMBGPU
014D E0                MOVX    A,@DPTR
014E 30E026            JNB     ACC.0,?C0328
                                           ; SOURCE LINE # 2147
                                           ; SOURCE LINE # 2148
0151 900000      E     MOV     DPTR,#Thro_Status3
0154 E0                MOVX    A,@DPTR
0155 20E00F            JB      ACC.0,?C0369
                                           ; SOURCE LINE # 2149
                                           ; SOURCE LINE # 2150
0158 900000      E     MOV     DPTR,#uVGATurboFun
015B E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 115 

015C 30E518            JNB     ACC.5,?C0328
                                           ; SOURCE LINE # 2151
                                           ; SOURCE LINE # 2152
015F E0                MOVX    A,@DPTR
0160 54DF              ANL     A,#0DFH
0162 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2153
0163 7F62              MOV     R7,#062H
                                           ; SOURCE LINE # 2154
                                           ; SOURCE LINE # 2156
0165 800D              SJMP    ?C0496
0167         ?C0369:
                                           ; SOURCE LINE # 2158
                                           ; SOURCE LINE # 2159
0167 900000      E     MOV     DPTR,#uVGATurboFun
016A E0                MOVX    A,@DPTR
016B 20E509            JB      ACC.5,?C0328
                                           ; SOURCE LINE # 2160
                                           ; SOURCE LINE # 2161
016E E0                MOVX    A,@DPTR
016F 4420              ORL     A,#020H
0171 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2162
0172 7F63              MOV     R7,#063H
0174         ?C0496:
0174 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2163
                                           ; SOURCE LINE # 2164
                                           ; SOURCE LINE # 2165
                                           ; SOURCE LINE # 2169
0177         ?C0328:
0177 22                RET     
             ; FUNCTION _Thro_Turbo (END)

             ; FUNCTION _Thro_Count_Shut (BEGIN)
                                           ; SOURCE LINE # 2239
0000 900000      R     MOV     DPTR,#TempType
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
0005 900000      R     MOV     DPTR,#BShut_Cnt
0008 EE                MOV     A,R6
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B EF                MOV     A,R7
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2240
                                           ; SOURCE LINE # 2241
000D F582              MOV     DPL,A
000F 8E83              MOV     DPH,R6
0011 E0                MOVX    A,@DPTR
0012 C3                CLR     C
0013 9403              SUBB    A,#03H
0015 4046              JC      ?C0373
                                           ; SOURCE LINE # 2242
                                           ; SOURCE LINE # 2243
0017 900000      R     MOV     DPTR,#TempType
001A E0                MOVX    A,@DPTR
001B B40204            CJNE    A,#02H,?C0374
                                           ; SOURCE LINE # 2244
001E 7F1C              MOV     R7,#01CH
0020 8023              SJMP    ?C0500
0022         ?C0374:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 116 

                                           ; SOURCE LINE # 2245
0022 900000      R     MOV     DPTR,#TempType
0025 E0                MOVX    A,@DPTR
0026 B40104            CJNE    A,#01H,?C0376
                                           ; SOURCE LINE # 2246
0029 7F12              MOV     R7,#012H
002B         ?C0497:
002B 8018              SJMP    ?C0500
002D         ?C0376:
                                           ; SOURCE LINE # 2247
002D 900000      R     MOV     DPTR,#TempType
0030 E0                MOVX    A,@DPTR
0031 B40404            CJNE    A,#04H,?C0378
                                           ; SOURCE LINE # 2248
0034 7F33              MOV     R7,#033H
0036         ?C0498:
0036 800D              SJMP    ?C0500
0038         ?C0378:
                                           ; SOURCE LINE # 2249
0038 900000      R     MOV     DPTR,#TempType
003B E0                MOVX    A,@DPTR
003C B40504            CJNE    A,#05H,?C0380
                                           ; SOURCE LINE # 2250
003F 7F34              MOV     R7,#034H
0041         ?C0499:
0041 8002              SJMP    ?C0500
0043         ?C0380:
                                           ; SOURCE LINE # 2252
0043 7F11              MOV     R7,#011H
0045         ?C0500:
0045 120000      E     LCALL   _ProcessSID
0048         ?C0375:
                                           ; SOURCE LINE # 2254
0048 900000      E     MOV     DPTR,#SysStatus
004B E0                MOVX    A,@DPTR
004C 4402              ORL     A,#02H
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2255
004F 538E3F            ANL     CKCON,#03FH
                                           ; SOURCE LINE # 2256
0052 438E10            ORL     CKCON,#010H
                                           ; SOURCE LINE # 2257
0055 43D801            ORL     WDTCON,#01H
                                           ; SOURCE LINE # 2258
0058 43D802            ORL     WDTCON,#02H
005B         ?C0382:
                                           ; SOURCE LINE # 2259
005B 80FE              SJMP    ?C0382
                                           ; SOURCE LINE # 2260
                                           ; SOURCE LINE # 2261
                                           ; SOURCE LINE # 2262
                                           ; SOURCE LINE # 2263
                                           ; SOURCE LINE # 2265
                                           ; SOURCE LINE # 2269
                                           ; SOURCE LINE # 2270
005D         ?C0373:
                                           ; SOURCE LINE # 2272
005D 900000      R     MOV     DPTR,#BShut_Cnt
0060 E0                MOVX    A,@DPTR
0061 FE                MOV     R6,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 117 

0064 F582              MOV     DPL,A
0066 8E83              MOV     DPH,R6
0068 E0                MOVX    A,@DPTR
0069 04                INC     A
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2273
006B         ?C0385:
006B 22                RET     
             ; FUNCTION _Thro_Count_Shut (END)

             ; FUNCTION _THRTab_ToRAM (BEGIN)
                                           ; SOURCE LINE # 2278
;---- Variable 'BStep' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 2279
                                           ; SOURCE LINE # 2280
0000 900000      E     MOV     DPTR,#TEST_FLAG
0003 E0                MOVX    A,@DPTR
0004 20E71F            JB      ACC.7,?C0387
                                           ; SOURCE LINE # 2281
                                           ; SOURCE LINE # 2283
0007         ?C0386:
                                           ; SOURCE LINE # 2284
0007 120000      R     LCALL   L?0563
000A 900000      E     MOV     DPTR,#THR_PRO_OFF
                                           ; SOURCE LINE # 2285
000D 120000      R     LCALL   L?0561
0010 900000      E     MOV     DPTR,#THR_PRO_ON
                                           ; SOURCE LINE # 2286
0013 120000      R     LCALL   L?0539
0016 900000      E     MOV     DPTR,#THR_Turo_Rem
                                           ; SOURCE LINE # 2287
0019 120000      R     LCALL   L?0541
001C 900000      E     MOV     DPTR,#THR_Turo_OFF
                                           ; SOURCE LINE # 2288
001F 120000      R     LCALL   L?0562
0022 900000      E     MOV     DPTR,#THR_Tab_Shut
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2289
0026         ?C0387:
0026 22                RET     
             ; FUNCTION _THRTab_ToRAM (END)

             ; FUNCTION _VTHRTab_ToRAM (BEGIN)
                                           ; SOURCE LINE # 2293
;---- Variable 'BStep' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 2294
                                           ; SOURCE LINE # 2295
0000 900000      E     MOV     DPTR,#TEST_FLAG
0003 E0                MOVX    A,@DPTR
0004 20E71F            JB      ACC.7,?C0389
                                           ; SOURCE LINE # 2296
                                           ; SOURCE LINE # 2298
0007         ?C0388:
                                           ; SOURCE LINE # 2299
0007 120000      R     LCALL   L?0563
000A 900000      E     MOV     DPTR,#VTHR_PRO_OFF
                                           ; SOURCE LINE # 2300
000D 120000      R     LCALL   L?0561
0010 900000      E     MOV     DPTR,#VTHR_PRO_ON
                                           ; SOURCE LINE # 2301
0013 120000      R     LCALL   L?0539
0016 900000      E     MOV     DPTR,#VTHR_Turo_Rem
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 118 

                                           ; SOURCE LINE # 2302
0019 120000      R     LCALL   L?0541
001C 900000      E     MOV     DPTR,#VTHR_Turo_OFF
                                           ; SOURCE LINE # 2303
001F 120000      R     LCALL   L?0562
0022 900000      E     MOV     DPTR,#VTHR_Tab_Shut
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2304
0026         ?C0389:
0026 22                RET     
             ; FUNCTION _VTHRTab_ToRAM (END)

             ; FUNCTION ThrottlingControl (BEGIN)
                                           ; SOURCE LINE # 2456
                                           ; SOURCE LINE # 2457
                                           ; SOURCE LINE # 2458
0000 120000      R     LCALL   L?0536
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0405
                                           ; SOURCE LINE # 2459
                                           ; SOURCE LINE # 2466
0008 900000      E     MOV     DPTR,#cThrottlingSet
000B E0                MOVX    A,@DPTR
000C 54F0              ANL     A,#0F0H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2468
000F E0                MOVX    A,@DPTR
0010 900000      E     MOV     DPTR,#cADPThrottling
0013 120000      R     LCALL   L?0513
0016 500B              JNC     ?C0391
                                           ; SOURCE LINE # 2470
                                           ; SOURCE LINE # 2471
0018 900000      E     MOV     DPTR,#cThrottlingSet
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D 900000      E     MOV     DPTR,#cADPThrottling
0020 120000      R     LCALL   L?0547
                                           ; SOURCE LINE # 2472
0023         ?C0391:
                                           ; SOURCE LINE # 2473
0023 900000      E     MOV     DPTR,#cThrottlingSet
0026 E0                MOVX    A,@DPTR
0027 900000      E     MOV     DPTR,#cTHERMThrottling
002A 120000      R     LCALL   L?0513
002D 5009              JNC     ?C0392
                                           ; SOURCE LINE # 2475
                                           ; SOURCE LINE # 2476
                                           ; SOURCE LINE # 2477
002F 120000      R     LCALL   L?0532
0032 900000      E     MOV     DPTR,#cTHERMThrottling
0035 120000      R     LCALL   L?0547
                                           ; SOURCE LINE # 2478
0038         ?C0392:
                                           ; SOURCE LINE # 2479
0038 900000      E     MOV     DPTR,#cThrottlingSet
003B E0                MOVX    A,@DPTR
003C 900000      E     MOV     DPTR,#cBATTThrottling
003F 120000      R     LCALL   L?0520
0042 5009              JNC     ?C0393
                                           ; SOURCE LINE # 2481
                                           ; SOURCE LINE # 2482
                                           ; SOURCE LINE # 2483
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 119 

0044 120000      R     LCALL   L?0532
0047 900000      E     MOV     DPTR,#cBATTThrottling
004A 120000      R     LCALL   L?0548
                                           ; SOURCE LINE # 2484
004D         ?C0393:
                                           ; SOURCE LINE # 2487
004D 900000      E     MOV     DPTR,#cThrottlingSet
0050 E0                MOVX    A,@DPTR
0051 900000      E     MOV     DPTR,#cBATTLowThrottling
0054 120000      R     LCALL   L?0520
0057 5009              JNC     ?C0394
                                           ; SOURCE LINE # 2489
                                           ; SOURCE LINE # 2490
                                           ; SOURCE LINE # 2491
0059 120000      R     LCALL   L?0533
005C 900000      E     MOV     DPTR,#cBATTLowThrottling
005F 120000      R     LCALL   L?0548
                                           ; SOURCE LINE # 2492
0062         ?C0394:
                                           ; SOURCE LINE # 2495
0062 900000      E     MOV     DPTR,#cThrottlingSet
0065 E0                MOVX    A,@DPTR
0066 900000      E     MOV     DPTR,#nThrottlingAPSet
0069 120000      R     LCALL   L?0523
006C 5009              JNC     ?C0395
                                           ; SOURCE LINE # 2497
                                           ; SOURCE LINE # 2498
                                           ; SOURCE LINE # 2499
006E 120000      R     LCALL   L?0533
0071 900000      E     MOV     DPTR,#nThrottlingAPSet
0074 120000      R     LCALL   L?0548
                                           ; SOURCE LINE # 2500
0077         ?C0395:
                                           ; SOURCE LINE # 2502
0077 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
007A E0                MOVX    A,@DPTR
007B 900000      E     MOV     DPTR,#cThrottlingSet
007E 120000      R     LCALL   L?0554
0081 6F                XRL     A,R7
0082 605A              JZ      ?C0396
                                           ; SOURCE LINE # 2504
                                           ; SOURCE LINE # 2505
0084 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
0087 E0                MOVX    A,@DPTR
0088 30E70B            JNB     ACC.7,?C0399
008B 900000      E     MOV     DPTR,#cThrottlingSet
008E E0                MOVX    A,@DPTR
008F 540F              ANL     A,#0FH
0091 C3                CLR     C
0092 9401              SUBB    A,#01H
0094 500D              JNC     ?C0398
0096         ?C0399:
0096 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
0099 E0                MOVX    A,@DPTR
009A 30E703            JNB     ACC.7,?C0400
009D D3                SETB    C
009E 8001              SJMP    ?C0401
00A0         ?C0400:
00A0 C3                CLR     C
00A1         ?C0401:
00A1 403B              JC      ?C0396
00A3         ?C0398:
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 120 

                                           ; SOURCE LINE # 2507
                                           ; SOURCE LINE # 2508
00A3 900000      E     MOV     DPTR,#cThrottlingSet
00A6 E0                MOVX    A,@DPTR
00A7 4440              ORL     A,#040H
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2509
00AA 900000      E     MOV     DPTR,#cADPThrottling
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2510
00B2 900000      E     MOV     DPTR,#cTHERMThrottling
00B5 E0                MOVX    A,@DPTR
00B6 FF                MOV     R7,A
00B7 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2511
00BA 900000      E     MOV     DPTR,#cBATTThrottling
00BD E0                MOVX    A,@DPTR
00BE FF                MOV     R7,A
00BF 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2512
00C2 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
00C5 E0                MOVX    A,@DPTR
00C6 FF                MOV     R7,A
00C7 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2513
00CA 900000      E     MOV     DPTR,#cThrottlingSet
00CD E0                MOVX    A,@DPTR
00CE 540F              ANL     A,#0FH
00D0 FF                MOV     R7,A
00D1 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
00D4 E0                MOVX    A,@DPTR
00D5 54F0              ANL     A,#0F0H
00D7 4F                ORL     A,R7
00D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2515
00D9 E0                MOVX    A,@DPTR
00DA FF                MOV     R7,A
00DB 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2516
                                           ; SOURCE LINE # 2517
00DE         ?C0396:
                                           ; SOURCE LINE # 2518
00DE 900000      E     MOV     DPTR,#CPUThrottlingDelayTime
00E1 E0                MOVX    A,@DPTR
00E2 7026              JNZ     ?C0405
                                           ; SOURCE LINE # 2519
                                           ; SOURCE LINE # 2520
00E4 900000      E     MOV     DPTR,#cThrottlingSet
00E7 E0                MOVX    A,@DPTR
00E8 C4                SWAP    A
00E9 13                RRC     A
00EA 13                RRC     A
00EB 5403              ANL     A,#03H
00ED 30E01A            JNB     ACC.0,?C0405
                                           ; SOURCE LINE # 2521
                                           ; SOURCE LINE # 2522
00F0 E0                MOVX    A,@DPTR
00F1 54BF              ANL     A,#0BFH
00F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2523
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 121 

00F4 900000      E     MOV     DPTR,#SYS_MISC1
00F7 E0                MOVX    A,@DPTR
00F8 30E70F            JNB     ACC.7,?C0405
                                           ; SOURCE LINE # 2524
                                           ; SOURCE LINE # 2525
00FB 7FEE              MOV     R7,#0EEH
00FD 120000      E     LCALL   _RamDebug
0100 7F1D              MOV     R7,#01DH
0102 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2526
0105 7F1D              MOV     R7,#01DH
0107 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2527
                                           ; SOURCE LINE # 2528
                                           ; SOURCE LINE # 2529
                                           ; SOURCE LINE # 2530
                                           ; SOURCE LINE # 2531
010A         ?C0405:
010A 22                RET     
             ; FUNCTION ThrottlingControl (END)

             ; FUNCTION GPUThrottlingControl (BEGIN)
                                           ; SOURCE LINE # 2534
                                           ; SOURCE LINE # 2535
                                           ; SOURCE LINE # 2536
0000 120000      R     LCALL   L?0536
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0414
0008 900000      E     MOV     DPTR,#CPU_TYPE
000B E0                MOVX    A,@DPTR
000C 20E703            JB      ACC.7,$ + 6H
000F 020000      R     LJMP    ?C0414
                                           ; SOURCE LINE # 2537
                                           ; SOURCE LINE # 2538
0012 900000      E     MOV     DPTR,#cGPUThrottlingSet
0015 E0                MOVX    A,@DPTR
0016 54F0              ANL     A,#0F0H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2540
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#cGPUBattThrottling
001D 120000      R     LCALL   L?0523
0020 500A              JNC     ?C0407
                                           ; SOURCE LINE # 2541
                                           ; SOURCE LINE # 2542
0022 900000      E     MOV     DPTR,#cGPUThrottlingSet
0025 E0                MOVX    A,@DPTR
0026 900000      E     MOV     DPTR,#cGPUBattThrottling
0029 120000      R     LCALL   L?0543
                                           ; SOURCE LINE # 2543
002C         ?C0407:
                                           ; SOURCE LINE # 2546
002C 120000      R     LCALL   L?0598
002F 900000      E     MOV     DPTR,#cGPUACtoBattThrottling
0032 120000      R     LCALL   L?0538
0035 500A              JNC     ?C0408
                                           ; SOURCE LINE # 2547
                                           ; SOURCE LINE # 2548
0037 900000      E     MOV     DPTR,#cGPUThrottlingSet
003A E0                MOVX    A,@DPTR
003B 900000      E     MOV     DPTR,#cGPUACtoBattThrottling
003E 120000      R     LCALL   L?0543
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 122 

                                           ; SOURCE LINE # 2549
0041         ?C0408:
                                           ; SOURCE LINE # 2552
0041 900000      E     MOV     DPTR,#cGPUThrottlingSet
0044 E0                MOVX    A,@DPTR
0045 900000      E     MOV     DPTR,#cGPUBattOTPThrottling
0048 120000      R     LCALL   L?0560
004B 500C              JNC     ?C0409
                                           ; SOURCE LINE # 2553
                                           ; SOURCE LINE # 2554
004D 900000      E     MOV     DPTR,#cGPUThrottlingSet
                                           ; SOURCE LINE # 2555
0050 120000      R     LCALL   L?0534
0053 900000      E     MOV     DPTR,#cGPUBattOTPThrottling
0056 120000      R     LCALL   L?0544
                                           ; SOURCE LINE # 2556
0059         ?C0409:
                                           ; SOURCE LINE # 2557
0059 900000      E     MOV     DPTR,#cGPUThrottlingSet
005C E0                MOVX    A,@DPTR
005D 900000      E     MOV     DPTR,#cGPUBattLowThrottling
0060 120000      R     LCALL   L?0560
0063 500C              JNC     ?C0410
                                           ; SOURCE LINE # 2558
                                           ; SOURCE LINE # 2559
0065 900000      E     MOV     DPTR,#cGPUThrottlingSet
                                           ; SOURCE LINE # 2560
0068 120000      R     LCALL   L?0534
006B 900000      E     MOV     DPTR,#cGPUBattLowThrottling
006E 120000      R     LCALL   L?0544
                                           ; SOURCE LINE # 2561
0071         ?C0410:
                                           ; SOURCE LINE # 2562
0071 120000      R     LCALL   L?0598
0074 FF                MOV     R7,A
0075 900000      E     MOV     DPTR,#cGPUThermalThrottling
0078 E0                MOVX    A,@DPTR
0079 FE                MOV     R6,A
007A EF                MOV     A,R7
007B C3                CLR     C
007C 9E                SUBB    A,R6
007D 500C              JNC     ?C0411
                                           ; SOURCE LINE # 2563
                                           ; SOURCE LINE # 2564
007F 900000      E     MOV     DPTR,#cGPUThrottlingSet
                                           ; SOURCE LINE # 2565
0082 120000      R     LCALL   L?0534
0085 900000      E     MOV     DPTR,#cGPUThermalThrottling
0088 120000      R     LCALL   L?0544
                                           ; SOURCE LINE # 2566
008B         ?C0411:
                                           ; SOURCE LINE # 2568
008B 120000      R     LCALL   L?0599
008E FF                MOV     R7,A
008F 900000      E     MOV     DPTR,#cGPUBattOCPThrottling
0092 E0                MOVX    A,@DPTR
0093 FE                MOV     R6,A
0094 EF                MOV     A,R7
0095 C3                CLR     C
0096 9E                SUBB    A,R6
0097 500C              JNC     ?C0412
                                           ; SOURCE LINE # 2569
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 123 

                                           ; SOURCE LINE # 2570
0099 900000      E     MOV     DPTR,#cGPUThrottlingSet
                                           ; SOURCE LINE # 2571
009C 120000      R     LCALL   L?0534
009F 900000      E     MOV     DPTR,#cGPUBattOCPThrottling
00A2 120000      R     LCALL   L?0544
                                           ; SOURCE LINE # 2572
00A5         ?C0412:
                                           ; SOURCE LINE # 2574
00A5 900000      E     MOV     DPTR,#GPU_REAL_THROTTLING_INDEX
00A8 E0                MOVX    A,@DPTR
00A9 900000      E     MOV     DPTR,#cGPUThrottlingSet
00AC 120000      R     LCALL   L?0554
00AF 6F                XRL     A,R7
00B0 601B              JZ      ?C0414
                                           ; SOURCE LINE # 2575
                                           ; SOURCE LINE # 2576
00B2 E0                MOVX    A,@DPTR
00B3 540F              ANL     A,#0FH
00B5 FF                MOV     R7,A
00B6 900000      E     MOV     DPTR,#GPU_REAL_THROTTLING_INDEX
00B9 E0                MOVX    A,@DPTR
00BA 54F0              ANL     A,#0F0H
00BC 4F                ORL     A,R7
00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2577
00BE 7FEE              MOV     R7,#0EEH
00C0 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2578
00C3 7F1E              MOV     R7,#01EH
00C5 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2579
00C8 7F1E              MOV     R7,#01EH
00CA 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2580
                                           ; SOURCE LINE # 2581
                                           ; SOURCE LINE # 2582
00CD         ?C0414:
00CD 22                RET     
             ; FUNCTION GPUThrottlingControl (END)

             ; FUNCTION Chk_FAN_RPM_Control (BEGIN)
                                           ; SOURCE LINE # 2591
                                           ; SOURCE LINE # 2592
                                           ; SOURCE LINE # 2595
0000 900000      E     MOV     DPTR,#ManualFanPRM
0003 E0                MOVX    A,@DPTR
0004 604B              JZ      ?C0425
                                           ; SOURCE LINE # 2596
                                           ; SOURCE LINE # 2597
0006 E4                CLR     A
0007 900000      E     MOV     DPTR,#GPCRA5
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2598
000B 120000      R     LCALL   L?0550
000E 6F                XRL     A,R7
000F 602B              JZ      ?C0416
0011 120000      R     LCALL   L?0569
0014 6F                XRL     A,R7
0015 6025              JZ      ?C0416
                                           ; SOURCE LINE # 2599
                                           ; SOURCE LINE # 2600
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 124 

0017 120000      R     LCALL   L?0569
001A D3                SETB    C
001B 9F                SUBB    A,R7
001C 400A              JC      ?C0417
                                           ; SOURCE LINE # 2601
                                           ; SOURCE LINE # 2602
001E 120000      R     LCALL   L?0585
0021 4019              JC      ?C0416
                                           ; SOURCE LINE # 2603
0023 E0                MOVX    A,@DPTR
0024 14                DEC     A
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2604
0026 8014              SJMP    ?C0416
0028         ?C0417:
                                           ; SOURCE LINE # 2606
                                           ; SOURCE LINE # 2607
0028 120000      R     LCALL   L?0551
002B C3                CLR     C
002C 9F                SUBB    A,R7
002D 5005              JNC     ?C0420
                                           ; SOURCE LINE # 2608
002F E0                MOVX    A,@DPTR
0030 04                INC     A
0031 F0                MOVX    @DPTR,A
0032 8008              SJMP    ?C0416
0034         ?C0420:
                                           ; SOURCE LINE # 2610
0034 900000      E     MOV     DPTR,#CTR2
0037 E0                MOVX    A,@DPTR
0038 900000      E     MOV     DPTR,#DCR5
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2611
                                           ; SOURCE LINE # 2612
003C         ?C0416:
                                           ; SOURCE LINE # 2614
003C 120000      R     LCALL   L?0551
003F 6F                XRL     A,R7
0040 700F              JNZ     ?C0425
0042 120000      R     LCALL   L?0570
0045 D3                SETB    C
0046 9F                SUBB    A,R7
0047 4008              JC      ?C0425
                                           ; SOURCE LINE # 2615
                                           ; SOURCE LINE # 2616
0049 120000      R     LCALL   L?0586
004C 4003              JC      ?C0425
                                           ; SOURCE LINE # 2617
004E E0                MOVX    A,@DPTR
004F 14                DEC     A
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2618
                                           ; SOURCE LINE # 2620
                                           ; SOURCE LINE # 2623
                                           ; SOURCE LINE # 2628
                                           ; SOURCE LINE # 2630
0051         ?C0425:
0051 22                RET     
             ; FUNCTION Chk_FAN_RPM_Control (END)

             ; FUNCTION Chk_FAN1_RPM_Control (BEGIN)
                                           ; SOURCE LINE # 2632
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 125 

                                           ; SOURCE LINE # 2633
                                           ; SOURCE LINE # 2636
0000 900000      E     MOV     DPTR,#ManualFan2PRM
0003 E0                MOVX    A,@DPTR
0004 604B              JZ      ?C0436
                                           ; SOURCE LINE # 2637
                                           ; SOURCE LINE # 2638
0006 E4                CLR     A
0007 900000      E     MOV     DPTR,#GPCRA4
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2639
000B 120000      R     LCALL   L?0552
000E 6F                XRL     A,R7
000F 602B              JZ      ?C0427
0011 120000      R     LCALL   L?0571
0014 6F                XRL     A,R7
0015 6025              JZ      ?C0427
                                           ; SOURCE LINE # 2640
                                           ; SOURCE LINE # 2641
0017 120000      R     LCALL   L?0571
001A D3                SETB    C
001B 9F                SUBB    A,R7
001C 400A              JC      ?C0428
                                           ; SOURCE LINE # 2642
                                           ; SOURCE LINE # 2643
001E 120000      R     LCALL   L?0587
0021 4019              JC      ?C0427
                                           ; SOURCE LINE # 2644
0023 E0                MOVX    A,@DPTR
0024 14                DEC     A
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2645
0026 8014              SJMP    ?C0427
0028         ?C0428:
                                           ; SOURCE LINE # 2647
                                           ; SOURCE LINE # 2648
0028 120000      R     LCALL   L?0553
002B C3                CLR     C
002C 9F                SUBB    A,R7
002D 5005              JNC     ?C0431
                                           ; SOURCE LINE # 2649
002F E0                MOVX    A,@DPTR
0030 04                INC     A
0031 F0                MOVX    @DPTR,A
0032 8008              SJMP    ?C0427
0034         ?C0431:
                                           ; SOURCE LINE # 2651
0034 900000      E     MOV     DPTR,#CTR2
0037 E0                MOVX    A,@DPTR
0038 900000      E     MOV     DPTR,#DCR4
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2652
                                           ; SOURCE LINE # 2653
003C         ?C0427:
                                           ; SOURCE LINE # 2655
003C 120000      R     LCALL   L?0553
003F 6F                XRL     A,R7
0040 700F              JNZ     ?C0436
0042 120000      R     LCALL   L?0572
0045 D3                SETB    C
0046 9F                SUBB    A,R7
0047 4008              JC      ?C0436
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 126 

                                           ; SOURCE LINE # 2656
                                           ; SOURCE LINE # 2657
0049 120000      R     LCALL   L?0588
004C 4003              JC      ?C0436
                                           ; SOURCE LINE # 2658
004E E0                MOVX    A,@DPTR
004F 14                DEC     A
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2659
                                           ; SOURCE LINE # 2661
                                           ; SOURCE LINE # 2664
                                           ; SOURCE LINE # 2669
                                           ; SOURCE LINE # 2671
0051         ?C0436:
0051 22                RET     
             ; FUNCTION Chk_FAN1_RPM_Control (END)

             ; FUNCTION FAN_Dust_Mode (BEGIN)
                                           ; SOURCE LINE # 2679
                                           ; SOURCE LINE # 2680
                                           ; SOURCE LINE # 2682
0000 900000      E     MOV     DPTR,#SYS_MISC1
0003 E0                MOVX    A,@DPTR
0004 20E703            JB      ACC.7,$ + 6H
0007 020000      R     LJMP    ?C0437
000A 900000      E     MOV     DPTR,#LENOVOBATT
000D E0                MOVX    A,@DPTR
000E 30E403            JNB     ACC.4,$ + 6H
0011 020000      R     LJMP    ?C0437
0014 120000      R     LCALL   L?0536
0017 6003              JZ      $ + 5H
0019 020000      R     LJMP    ?C0437
                                           ; SOURCE LINE # 2683
                                           ; SOURCE LINE # 2684
001C 900000      E     MOV     DPTR,#SMartNoise
001F E0                MOVX    A,@DPTR
0020 30E521            JNB     ACC.5,?C0438
                                           ; SOURCE LINE # 2685
                                           ; SOURCE LINE # 2686
0023 E0                MOVX    A,@DPTR
0024 4402              ORL     A,#02H
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2687
0027 900000      E     MOV     DPTR,#StartFanClean
002A 7478              MOV     A,#078H
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2688
002D 900000      E     MOV     DPTR,#SMartNoise
0030 E0                MOVX    A,@DPTR
0031 54DF              ANL     A,#0DFH
0033 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2689
0034 E0                MOVX    A,@DPTR
0035 54FB              ANL     A,#0FBH
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2691
0038 900000      E     MOV     DPTR,#FAN_Std_Max
003B E0                MOVX    A,@DPTR
003C FF                MOV     R7,A
003D 7C00        E     MOV     R4,#HIGH DCR5
003F 7D00        E     MOV     R5,#LOW DCR5
0041 120000      R     LCALL   _Fan_Offset_Chk
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 127 

                                           ; SOURCE LINE # 2692
0044         ?C0438:
                                           ; SOURCE LINE # 2694
0044 900000      E     MOV     DPTR,#SMartNoise
0047 E0                MOVX    A,@DPTR
0048 30E16F            JNB     ACC.1,?C0449
                                           ; SOURCE LINE # 2695
                                           ; SOURCE LINE # 2696
004B 900000      E     MOV     DPTR,#StartFanClean
004E E0                MOVX    A,@DPTR
004F 701F              JNZ     ?C0440
                                           ; SOURCE LINE # 2697
                                           ; SOURCE LINE # 2698
0051 900000      E     MOV     DPTR,#THERMAL_STATUS
0054 E0                MOVX    A,@DPTR
0055 54F7              ANL     A,#0F7H
                                           ; SOURCE LINE # 2699
0057 120000      R     LCALL   L?0567
005A 120000      E     LCALL   _Cal_PWM_Duty
005D 900000      E     MOV     DPTR,#DCR5
0060 EF                MOV     A,R7
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2702
0062 900000      E     MOV     DPTR,#SMartNoise
0065 E0                MOVX    A,@DPTR
0066 54EC              ANL     A,#0ECH
                                           ; SOURCE LINE # 2703
                                           ; SOURCE LINE # 2704
                                           ; SOURCE LINE # 2705
0068 120000      R     LCALL   L?0580
006B E0                MOVX    A,@DPTR
006C 54FB              ANL     A,#0FBH
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2706
006F 22                RET     
0070         ?C0440:
                                           ; SOURCE LINE # 2708
                                           ; SOURCE LINE # 2709
0070 900000      E     MOV     DPTR,#StartFanClean
0073 E0                MOVX    A,@DPTR
0074 14                DEC     A
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2710
0076 900000      E     MOV     DPTR,#SMartNoise
0079 E0                MOVX    A,@DPTR
007A 20E01D            JB      ACC.0,?C0442
                                           ; SOURCE LINE # 2711
                                           ; SOURCE LINE # 2712
007D 7E00        E     MOV     R6,#HIGH FanCleanFull
007F 7F00        E     MOV     R7,#LOW FanCleanFull
0081 7D32              MOV     R5,#032H
0083 120000      E     LCALL   _ChkTimeScale
0086 EF                MOV     A,R7
0087 7009              JNZ     ?C0443
                                           ; SOURCE LINE # 2713
                                           ; SOURCE LINE # 2716
0089 900000      E     MOV     DPTR,#CTR2
008C E0                MOVX    A,@DPTR
008D 900000      E     MOV     DPTR,#DCR5
0090 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2717
0091 22                RET     
C51 COMPILER V8.12   OEM_FAN                                                               09/14/2018 11:08:10 PAGE 128 

0092         ?C0443:
                                           ; SOURCE LINE # 2719
0092 900000      E     MOV     DPTR,#SMartNoise
0095 E0                MOVX    A,@DPTR
0096 4401              ORL     A,#01H
0098 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2720
0099 22                RET     
009A         ?C0442:
                                           ; SOURCE LINE # 2722
                                           ; SOURCE LINE # 2723
009A 7E00        E     MOV     R6,#HIGH FanCleanHalt
009C 7F00        E     MOV     R7,#LOW FanCleanHalt
009E 7D28              MOV     R5,#028H
00A0 120000      E     LCALL   _ChkTimeScale
00A3 EF                MOV     A,R7
00A4 6014              JZ      ?C0449
                                           ; SOURCE LINE # 2724
                                           ; SOURCE LINE # 2728
00A6         ?C0446:
                                           ; SOURCE LINE # 2730
00A6 900000      E     MOV     DPTR,#SMartNoise
00A9 E0                MOVX    A,@DPTR
00AA 54FE              ANL     A,#0FEH
00AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2731
                                           ; SOURCE LINE # 2732
                                           ; SOURCE LINE # 2733
                                           ; SOURCE LINE # 2734
00AD 22                RET     
00AE         ?C0437:
                                           ; SOURCE LINE # 2736
                                           ; SOURCE LINE # 2739
00AE 900000      E     MOV     DPTR,#THERMAL_STATUS
00B1 E0                MOVX    A,@DPTR
00B2 54F7              ANL     A,#0F7H
                                           ; SOURCE LINE # 2740
                                           ; SOURCE LINE # 2741
                                           ; SOURCE LINE # 2742
00B4 120000      R     LCALL   L?0580
00B7 7404              MOV     A,#04H
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2743
                                           ; SOURCE LINE # 2745
00BA         ?C0449:
00BA 22                RET     
             ; FUNCTION FAN_Dust_Mode (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6055    ----
   CONSTANT SIZE    =    674    ----
   XDATA SIZE       =   ----      30
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
